<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mcuboot MCUboot &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="miniboot Minimal bootloader" href="../miniboot/index.html" />
    <link rel="prev" title="Bootloader Utilities" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../12.5.1" >12.5.1</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/index.html">OS Components</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../audioutils/index.html">Audio Utility libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Bootloader Utilities</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">mcuboot</span></code> MCUboot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-mcuboot-compatible-application-firmware-images">Creating MCUboot-compatible application firmware images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-mcuboot-on-nuttx-as-a-secure-boot-solution">Using MCUboot on NuttX as a secure boot solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assumptions">Assumptions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#ioctl-mtd-commands">IOCTL MTD commands</a></li>
<li class="toctree-l5"><a class="reference internal" href="#write-access-alignment">Write access alignment</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">Limitations</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#flash-map-backend-flash-map-backend-h-functions-are-not-multitasking-safe"><code class="docutils literal notranslate"><span class="pre">&lt;flash_map_backend/flash_map_backend.h&gt;</span></code> functions are not multitasking-safe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../miniboot/index.html"><code class="docutils literal notranslate"><span class="pre">miniboot</span></code> Minimal bootloader</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../benchmarks/index.html">Benchmark Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canutils/index.html">CAN Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Cryptography Library Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fsutils/index.html">File System Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../games/index.html">Games</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../graphics/index.html">Graphics Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../industry/index.html">Industrial Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../inertial/index.html">Inertial Libraries Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../interpreters/index.html">Interpreters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lte/index.html">LTE Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math/index.html">Math Library Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mlearing/index.html">Machine Learning Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../netutils/index.html">Network Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nsh/index.html">NuttShell (NSH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdr/index.html">Software Define Radio Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../system/index.html">System Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/index.html">Host Side Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wireless/index.html">Wireless Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Bootloader Utilities</a></li>
      <li class="breadcrumb-item active"><code class="docutils literal notranslate"><span class="pre">mcuboot</span></code> MCUboot</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/applications/boot/mcuboot/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mcuboot-mcuboot">
<h1><code class="docutils literal notranslate"><span class="pre">mcuboot</span></code> MCUboot<a class="headerlink" href="#mcuboot-mcuboot" title="Permalink to this heading"></a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this heading"></a></h2>
<p>The NuttX port of MCUboot secure boot library expects that the platform provides
a Flash storage with the following partitions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_PRIMARY_SLOT_PATH</span></code>: MTD partition for the application
firmware image PRIMARY slot;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_SECONDARY_SLOT_PATH</span></code>: MTD partition for the application
firmware image SECONDARY slot;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_SCRATCH_PATH</span></code>: MTD partition for the Scratch area;</p></li>
</ul>
<p>Also, these are optional features that may be enabled:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_WATCHDOG</span></code>: If <code class="docutils literal notranslate"><span class="pre">CONFIG_WATCHDOG</span></code> is enabled, MCUboot shall
reset the watchdog timer indicated by <code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_WATCHDOG_DEVPATH</span></code> to
the current timeout value, preventing any imminent watchdog timeouts.</p></li>
</ul>
<p>The porting layer of MCUboot library consists of the following interfaces:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;flash_map_backend/flash_map_backend.h&gt;</span></code>, for enabling MCUboot to manage
the application firmware image slots in the device storage.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;mcuboot_config/mcuboot_config.h&gt;</span></code>, for configuration of MCUboot’s features.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;mcuboot_config/mcuboot_logging.h&gt;</span></code>, for providing logging capabilities.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;os/os_malloc.h&gt;</span></code>, for providing MCUboot access to the OS memory management interfaces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;sysflash/sysflash.h&gt;</span></code>, for configuration of the system’s flash area organization.</p></li>
</ul>
<p>The NuttX port of MCUboot is implemented at application-level and requires minimal
knowledge about characteristics of the underlying storage device. This is achieved
by means of the <code class="docutils literal notranslate"><span class="pre">BCH</span></code> and <code class="docutils literal notranslate"><span class="pre">FTL</span></code> subsystems, which enable MCUboot to manage MTD
partitions via character device drivers using standard POSIX filesystem operations
(e.g. <code class="docutils literal notranslate"><span class="pre">open()</span></code> / <code class="docutils literal notranslate"><span class="pre">close()</span></code> / <code class="docutils literal notranslate"><span class="pre">read()</span></code> / <code class="docutils literal notranslate"><span class="pre">write()</span></code>).</p>
</section>
<section id="creating-mcuboot-compatible-application-firmware-images">
<h2>Creating MCUboot-compatible application firmware images<a class="headerlink" href="#creating-mcuboot-compatible-application-firmware-images" title="Permalink to this heading"></a></h2>
<p>One common use case for MCUboot is to integrate it to a firmware update agent, which
is an important component of a secure firmware update subsystem. Through MCUboot APIs
an application is able to install a newly received application firmware image and,
once this application firmware image is assured to be valid, the application may
confirm it as a stable image. In case that application firmware image is deemed
bogus, MCUboot provides an API for invalidating that update, which will induce a
rollback procedure to the most recent stable application firmware image.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CONFIG_EXAMPLES_MCUBOOT_UPDATE_AGENT</span></code> example demonstrates this workflow by
downloading an application firmware image from a webserver, installing it and triggering
the firmware update process for the next boot after a system reset. There is also the
<code class="docutils literal notranslate"><span class="pre">CONFIG_EXAMPLES_MCUBOOT_SLOT_CONFIRM</span></code>, which is a fairly simple example that just
calls an MCUboot API for confirming the executing application firmware image as stable.</p>
<p>For more information about all MCUboot examples, see <code class="docutils literal notranslate"><span class="pre">examples/mcuboot</span></code> directory.</p>
</section>
<section id="using-mcuboot-on-nuttx-as-a-secure-boot-solution">
<h2>Using MCUboot on NuttX as a secure boot solution<a class="headerlink" href="#using-mcuboot-on-nuttx-as-a-secure-boot-solution" title="Permalink to this heading"></a></h2>
<p>NuttX port for MCUboot also enables the creation of a secure bootloader application
requiring minimal platform-specific implementation. The logical implementation for
the secure boot is performed at application-level by the MCUboot library. Once MCUboot
validates the application firmware image, it delegates the loading and execution of the
application firmware image to a platform-specific routine, which is accessed via
<code class="docutils literal notranslate"><span class="pre">boardctl(BOARDIOC_BOOT_IMAGE)</span></code> call. Each platform must then provide an implementation
for the <code class="docutils literal notranslate"><span class="pre">board_boot_image()</span></code> for executing the required actions in order to boot a new
application firmware image (e.g. deinitialize peripherals, load the Program Counter register
with the application firmware image entry point address).</p>
<p>The MCUboot bootloader application may be enabled by selecting the <code class="docutils literal notranslate"><span class="pre">CONFIG_MCUBOOT_BOOTLOADER</span></code>
option.</p>
</section>
<section id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this heading"></a></h2>
<section id="ioctl-mtd-commands">
<h3>IOCTL MTD commands<a class="headerlink" href="#ioctl-mtd-commands" title="Permalink to this heading"></a></h3>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">&lt;flash_map_backend/flash_map_backend.h&gt;</span></code> expects that the MTD
driver for a given image partition handles the following <code class="docutils literal notranslate"><span class="pre">ioctl</span></code> commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MTDIOC_GEOMETRY</span></code>, for retrieving information about the geometry of the MTD,
required for the configuration of the size of each flash area.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MTDIOC_ERASESTATE</span></code>, for retrieving the byte value of an erased cell of the MTD,
required for the implementation of <code class="docutils literal notranslate"><span class="pre">flash_area_erased_val()</span></code> interface.</p></li>
</ul>
</section>
<section id="write-access-alignment">
<h3>Write access alignment<a class="headerlink" href="#write-access-alignment" title="Permalink to this heading"></a></h3>
<p>Through <code class="docutils literal notranslate"><span class="pre">flash_area_align()</span></code> interface MCUboot expects that the implementation provides
the shortest data length that may be written via <code class="docutils literal notranslate"><span class="pre">flash_area_write()</span></code> interface. The NuttX
implementation passes through the <code class="docutils literal notranslate"><span class="pre">BCH</span></code> and <code class="docutils literal notranslate"><span class="pre">FTL</span></code> layers, which appropriately handle the
write alignment restrictions of the underlying MTD. So The NuttX implementation of
<code class="docutils literal notranslate"><span class="pre">flash_area_align()</span></code> is able to return a fixed value of 1 byte, even if the MTD does not
support byte operations.</p>
</section>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading"></a></h2>
<section id="flash-map-backend-flash-map-backend-h-functions-are-not-multitasking-safe">
<h3><code class="docutils literal notranslate"><span class="pre">&lt;flash_map_backend/flash_map_backend.h&gt;</span></code> functions are not multitasking-safe<a class="headerlink" href="#flash-map-backend-flash-map-backend-h-functions-are-not-multitasking-safe" title="Permalink to this heading"></a></h3>
<p>MCUboot’s documentation imposes no restrictions regarding the usage of its public interfaces,
which doesn’t mean they are thread-safe.
But, regarding NuttX implementation of the <code class="docutils literal notranslate"><span class="pre">&lt;flash_map_backend/flash_map_backend.h&gt;</span></code>, it is
safe to state that they are <strong>not</strong> multitasking-safe. NuttX implementation manages the MTD
partitions via character device drivers. As file-descriptors cannot be shared between different
tasks, if one task calls <code class="docutils literal notranslate"><span class="pre">flash_area_open</span></code> and another task calls <code class="docutils literal notranslate"><span class="pre">flash_area_&lt;read/write/close&gt;</span></code>
passing the same <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">flash_area</span></code> instance, it will result in failure.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Bootloader Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../miniboot/index.html" class="btn btn-neutral float-right" title="miniboot Minimal bootloader" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>