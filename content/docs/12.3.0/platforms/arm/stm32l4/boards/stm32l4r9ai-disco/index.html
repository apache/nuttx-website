<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ST STM32L4R9AI-DISCO &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="ST STM32L5" href="../../../stm32l5/index.html" />
    <link rel="prev" title="ST STM32L476VG-DISCO" href="../stm32l476vg-disco/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../../12.5.1" >12.5.1</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">ARM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../a64/index.html">Allwinner A64</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../imxrt/index.html">i.MX RT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf52/index.html">Nordic nRF52</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf53/index.html">Nordic nRF53</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf91/index.html">Nordic nRF91</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rp2040/index.html">rp2040</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../s32k1xx/index.html">NXP S32K1XX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../s32k3xx/index.html">NXP S32K3XX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../samv7/index.html">SAM V7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f0/index.html">ST STM32F0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f1/index.html">ST STM32F1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f2/index.html">ST STM32F2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f3/index.html">ST STM32F3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f4/index.html">ST STM32F4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f7/index.html">ST STM32F7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32g0/index.html">ST STM32G0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32g4/index.html">ST STM32G4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32h7/index.html">ST STM32H7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l0/index.html">ST STM32L0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l1/index.html">ST STM32L1</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">ST STM32L4</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../index.html#supported-mcus">Supported MCUs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#peripheral-support">Peripheral Support</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="../b-l475e-iot01a/index.html">ST B-L475E-IOT01A</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-l432kc/index.html">ST Nucleo L432KC</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-l452re/index.html">ST Nucleo L452RE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-l476rg/index.html">ST Nucleo L476RG</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-l496zg/index.html">ST Nucleo L496ZG</a></li>
<li class="toctree-l5"><a class="reference internal" href="../steval-stlcs01v1/index.html">ST STEVAL-STLCS01V1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm32l476-mdk/index.html">STM32L476-mdk</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm32l476vg-disco/index.html">ST STM32L476VG-DISCO</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">ST STM32L4R9AI-DISCO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l5/index.html">ST STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32u5/index.html">ST STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32wb/index.html">ST STM32WB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32wl5/index.html">ST STM32WL5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../xmc4/index.html">Infineon XMC4000</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">AVR8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/index.html">Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">ARM</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">ST STM32L4</a></li>
      <li class="breadcrumb-item active">ST STM32L4R9AI-DISCO</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/platforms/arm/stm32l4/boards/stm32l4r9ai-disco/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="st-stm32l4r9ai-disco">
<h1>ST STM32L4R9AI-DISCO<a class="headerlink" href="#st-stm32l4r9ai-disco" title="Permalink to this heading"></a></h1>
<p>This page discusses issues unique to NuttX configurations for the ST
STM32L4R9AI Discovery board from ST Micro.  See</p>
<blockquote>
<div><p><a class="reference external" href="https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-discovery-kits/32l4r9idiscovery.html">https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-discovery-kits/32l4r9idiscovery.html</a></p>
</div></blockquote>
<p>STM32L4R9AI:</p>
<ul class="simple">
<li><p>Microprocessor: 32-bit ARM Cortex M4 at 120MHz STM32L4R9AI</p></li>
<li><p>Memory: 2048 KB Flash and 192+64+384 KB SRAM</p></li>
<li><p>ADC: 1x12-bit, 5 MSPS A/D converter: up to 14 external channels</p></li>
<li><p>DAC: 2 channels</p></li>
<li><p>DFSDM: 4 filters, 8 channels</p></li>
<li><p>DMA: 16-stream DMA controllers with FIFOs and burst support</p></li>
<li><p>Timers: Up to 11 timers: up to eight 16-bit, two 32-bit timers, two
watchdog timers, and a SysTick timer</p></li>
<li><p>GPIO: Up to 131 I/O ports with interrupt capability</p></li>
<li><p>I2C: Up to 4 x I2C interfaces</p></li>
<li><p>USARTs:Up to 3 USARTs, 2 UARTs, 1 LPUART</p></li>
<li><p>SPIs: Up to 3 SPIs</p></li>
<li><p>SAIs: Up to 2 dual-channel audio interfaces</p></li>
<li><p>CAN interface</p></li>
<li><p>SDIO interface</p></li>
<li><p>OCTOSPI interface</p></li>
<li><p>Camera interface</p></li>
<li><p>USB:  USB 2.0 full-speed device/host/OTG controller with on-chip PHY</p></li>
<li><p>CRC calculation unit</p></li>
<li><p>RTC</p></li>
</ul>
<p>Board features:</p>
<ul class="simple">
<li><p>Peripherals: 1 d-pad joystick, 2 x LED, AMOLED display, USC OTG FS,
2 x MEMS Digital Microphones, SAI codec, 16 Mbit PSRAM,
512 Mbit OCTOSPI Flash, current ammeter</p></li>
<li><p>Debug: Serial wire debug and JTAG interfaces</p></li>
</ul>
<p>Uses a STM32F103 to provide a ST-Link for programming, debug similar to the
OpenOcd FTDI function - USB to JTAG front-end.</p>
<section id="mbed">
<h2>mbed<a class="headerlink" href="#mbed" title="Permalink to this heading"></a></h2>
<p>The STM32L4R9AI-DISCO includes boot loader from mbed:</p>
<blockquote>
<div><p><a class="reference external" href="https://mbed.org/handbook/Homepage">https://mbed.org/handbook/Homepage</a></p>
</div></blockquote>
<p>Using the mbed loader:</p>
<ol class="arabic simple">
<li><p>Connect the board to the host PC using the USB connector.</p></li>
<li><p>A new file system will appear called DIS_L4R9AI; open it with Windows
Explorer (assuming that you are using Windows).</p></li>
<li><p>Drag and drop nuttx.bin into the MBED window.  This will load the
nuttx.bin binary into the board.  The DIS_L49RAIO window will
close then re-open and the board will be running the new code.</p></li>
</ol>
</section>
<section id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Permalink to this heading"></a></h2>
<section id="buttons">
<h3>Buttons<a class="headerlink" href="#buttons" title="Permalink to this heading"></a></h3>
<p>B1 USER: the user button is connected to the I/O PC13 (pin 2) of the STM32
microcontroller.</p>
</section>
<section id="leds">
<h3>LEDs<a class="headerlink" href="#leds" title="Permalink to this heading"></a></h3>
<p>The STM32L4R9AI-DISCO board provides two user LEDs, LD1 (orange) and LD2 (green).
PB0 is LD1 (orange)
PH4 is LD2 (green)
- When the I/O is HIGH value, the LED is on.
- When the I/O is LOW, the LED is off.</p>
<p>These LEDs are not used by the board port unless CONFIG_ARCH_LEDS is
defined.  In that case, the usage by the board port is defined in
include/board.h and src/stm32_autoleds.c. The LEDs are used to encode OS-related
events as follows when the green LED (PH4) is available:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SYMBOL</p></th>
<th class="head"><p>Meaning</p></th>
<th class="head"><p>LD2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LED_STARTED</p></td>
<td><p>NuttX has been started</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>LED_HEAPALLOCATE</p></td>
<td><p>Heap has been allocated</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>LED_IRQSENABLED</p></td>
<td><p>Interrupts enabled</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>LED_STACKCREATED</p></td>
<td><p>Idle stack created</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-even"><td><p>LED_INIRQ</p></td>
<td><p>In an interrupt</p></td>
<td><p>No change</p></td>
</tr>
<tr class="row-odd"><td><p>LED_SIGNAL</p></td>
<td><p>In a signal handler</p></td>
<td><p>No change</p></td>
</tr>
<tr class="row-even"><td><p>LED_ASSERTION</p></td>
<td><p>An assertion failed</p></td>
<td><p>No change</p></td>
</tr>
<tr class="row-odd"><td><p>LED_PANIC</p></td>
<td><p>The system has crashed</p></td>
<td><p>Blinking</p></td>
</tr>
<tr class="row-even"><td><p>LED_IDLE</p></td>
<td><p>MCU is is sleep mode</p></td>
<td><p>Not used</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Thus if LD2 is on, NuttX has successfully booted and is, apparently,
running normally. If LD2 is flashing at approximately 2Hz, then a fatal error
has been detected and the system has halted.</p>
</section>
<section id="u-s-arts-and-serial-consoles">
<h3>U[S]ARTs and Serial Consoles<a class="headerlink" href="#u-s-arts-and-serial-consoles" title="Permalink to this heading"></a></h3>
</section>
<section id="usart1">
<h3>USART1<a class="headerlink" href="#usart1" title="Permalink to this heading"></a></h3>
<p>Pins and Connectors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  RXD: PA11  CN10 pin 14
       PB7   CN7 pin 21
  TXD: PA10  CN9 pin 3, CN10 pin 33
       PB6   CN5 pin 3, CN10 pin 17

NOTE:  You may need to edit the include/board.h to select different USART1
pin selections.

TTL to RS-232 converter connection:

  =========== ============
  Nucleo CN10 STM32F4x1RE
  =========== ============
  Pin 21 PA9  USART1_RX
  Pin 33 PA10 USART1_TX
  Pin 20 GND
  Pin 8  U5V
  =========== ============

  Warning you make need to reverse RX/TX on some RS-232 converters

To configure USART1 as the console::

  CONFIG_STM32L4_USART1=y
  CONFIG_USART1_SERIALDRIVER=y
  CONFIG_USART1_SERIAL_CONSOLE=y
  CONFIG_USART1_RXBUFSIZE=256
  CONFIG_USART1_TXBUFSIZE=256
  CONFIG_USART1_BAUD=115200
  CONFIG_USART1_BITS=8
  CONFIG_USART1_PARITY=0
  CONFIG_USART1_2STOP=0
</pre></div>
</div>
</section>
<section id="usart2">
<h3>USART2<a class="headerlink" href="#usart2" title="Permalink to this heading"></a></h3>
<p>Pins and Connectors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  RXD: PA3   CN9 pin 1 (See SB13, 14, 62, 63). CN10 pin 37
       PD6
  TXD: PA2   CN9 pin 2(See SB13, 14, 62, 63). CN10 pin 35
       PD5

TTL to RS-232 converter connection:

  =========== ============
  Nucleo CN9  STM32F4x1RE
  =========== ============
  Pin 1  PA3  USART2_RX
  Pin 2  PA2  USART2_TX
  =========== ============

  Warning you make need to reverse RX/TX on some RS-232 converters

Solder Bridges.  This configuration requires:

- SB62 and SB63 Closed: PA2 and PA3 on STM32 MCU are connected to D1 and D0
  (pin 7 and pin 8) on Arduino connector CN9 and ST Morpho connector CN10
  as USART signals.  Thus SB13 and SB14 should be OFF.

- SB13 and SB14 Open:  PA2 and PA3 on STM32F103C8T6 (ST-LINK MCU) are
  disconnected to PA3 and PA2 on STM32 MCU.

To configure USART2 as the console::

  CONFIG_STM32L4_USART2=y
  CONFIG_USART2_SERIALDRIVER=y
  CONFIG_USART2_SERIAL_CONSOLE=y
  CONFIG_USART2_RXBUFSIZE=256
  CONFIG_USART2_TXBUFSIZE=256
  CONFIG_USART2_BAUD=115200
  CONFIG_USART2_BITS=8
  CONFIG_USART2_PARITY=0
  CONFIG_USART2_2STOP=0
</pre></div>
</div>
</section>
<section id="uart4">
<h3>UART4<a class="headerlink" href="#uart4" title="Permalink to this heading"></a></h3>
<p>Pins and Connectors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>RXD: PA1 -&gt; CN11 D5
TXD: PA0 -&gt; CN17 A4
</pre></div>
</div>
<p>To configure USART4 as the console:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_STM32L4_UART4=y
CONFIG_USART4_SERIALDRIVER=y
CONFIG_USART4_SERIAL_CONSOLE=y
CONFIG_USART4_RXBUFSIZE=512
CONFIG_USART4_TXBUFSIZE=256
CONFIG_USART4_BAUD=2000000
CONFIG_USART4_BITS=8
CONFIG_USART4_PARITY=0
CONFIG_USART4_2STOP=0
</pre></div>
</div>
</section>
<section id="virtual-com-port">
<h3>Virtual COM Port<a class="headerlink" href="#virtual-com-port" title="Permalink to this heading"></a></h3>
<p>Yet another option is to use UART2 and the USB virtual COM port.  This
option may be more convenient for long term development, but is painful
to use during board bring-up.</p>
<p>Solder Bridges.  This configuration requires:</p>
<ul class="simple">
<li><p>SB62 and SB63 Open: PA2 and PA3 on STM32 MCU are disconnected to D1
and D0 (pin 7 and pin 8) on Arduino connector CN9 and ST Morpho
connector CN10.</p></li>
<li><p>SB13 and SB14 Closed:  PA2 and PA3 on STM32F103C8T6 (ST-LINK MCU) are
connected to PA3 and PA2 on STM32 MCU to have USART communication
between them. Thus SB61, SB62 and SB63 should be OFF.</p></li>
</ul>
<p>Configuring USART2 is the same as given above.</p>
<p>Question:  What BAUD should be configure to interface with the Virtual
COM port?  115200 8N1?</p>
</section>
<section id="default">
<h3>Default<a class="headerlink" href="#default" title="Permalink to this heading"></a></h3>
<p>As shipped, SB62 and SB63 are open and SB13 and SB14 closed, so the
virtual COM port is enabled.</p>
</section>
</section>
<section id="segger-j-link">
<h2>Segger J-Link<a class="headerlink" href="#segger-j-link" title="Permalink to this heading"></a></h2>
<p>Reference: <a class="reference external" href="https://www.segger.com/downloads/application-notes/AN00021">https://www.segger.com/downloads/application-notes/AN00021</a></p>
<ol class="arabic simple">
<li><p>Connect J-Link VTref      (1) to pin VDD</p></li>
<li><p>Connect J-Link SWDIO      (7) to pin PA13</p></li>
<li><p>Connect J-Link SWCLK      (9) to pin PA14</p></li>
<li><p>Connect J-Link SWO       (13) to pin PB3</p></li>
<li><p>Connect J-Link RESET     (15) to pin NRST</p></li>
<li><p>Connect J-Link 5V-Supply (19) to pin 5V</p></li>
<li><p>Connect J-Link GND        (4) to pin GND</p></li>
</ol>
<p>Jumpers on CN4 (ST-Link) must be removed for external debug.</p>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<section id="knsh">
<h3>knsh<a class="headerlink" href="#knsh" title="Permalink to this heading"></a></h3>
<p>This is identical to the nsh configuration below except that (1) NuttX
is built as a PROTECTED mode, monolithic module and the user applications
are built separately and, as a consequence, (2) some features that are
only available in the FLAT build are disabled.</p>
<p>It is recommends to use a special make command; not just ‘make’ but make
with the following two arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make pass1 pass2
</pre></div>
</div>
<p>In the normal case (just ‘make’), make will attempt to build both user-
and kernel-mode blobs more or less interleaved.  That actual works!
However, for me it is very confusing so I prefer the above make command:
Make the user-space binaries first (pass1), then make the kernel-space
binaries (pass2)</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>At the end of the build, there will be several files in the top-level
NuttX build directory:</p>
<blockquote>
<div><dl class="simple">
<dt>PASS1:</dt><dd><p>nuttx_user.elf    - The pass1 user-space ELF file
nuttx_user.hex    - The pass1 Intel HEX format file (selected in defconfig)
User.map          - Symbols in the user-space ELF file</p>
</dd>
<dt>PASS2:</dt><dd><p>nuttx             - The pass2 kernel-space ELF file
nuttx.hex         - The pass2 Intel HEX file (selected in defconfig)
System.map        - Symbols in the kernel-space ELF file</p>
</dd>
</dl>
<p>The J-Link programmer will except files in .hex, .mot, .srec, and .bin
formats.</p>
</div></blockquote>
</li>
<li><p>Combining .hex files.  If you plan to use the .hex files with your
debugger or FLASH utility, then you may need to combine the two hex
files into a single .hex file.  Here is how you can do that.</p>
<ol class="loweralpha">
<li><p>The ‘tail’ of the nuttx.hex file should look something like this
(with my comments added):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  $ tail nuttx.hex
  # 00, data records
  ...
  :10 9DC0 00 01000000000800006400020100001F0004
  :10 9DD0 00 3B005A0078009700B500D400F300110151
  :08 9DE0 00 30014E016D0100008D
  # 05, Start Linear Address Record
  :04 0000 05 0800 0419 D2
  # 01, End Of File record
  :00 0000 01 FF

Use an editor such as vi to remove the 05 and 01 records.
</pre></div>
</div>
</li>
<li><p>The ‘head’ of the nuttx_user.hex file should look something like
this (again with my comments added):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  $ head nuttx_user.hex
  # 04, Extended Linear Address Record
  :02 0000 04 0801 F1
  # 00, data records
  :10 8000 00 BD89 01084C800108C8110208D01102087E
  :10 8010 00 0010 00201C1000201C1000203C16002026
  :10 8020 00 4D80 01085D80010869800108ED83010829
  ...

Nothing needs to be done here.  The nuttx_user.hex file should
be fine.
</pre></div>
</div>
</li>
<li><p>Combine the edited nuttx.hex and un-edited nuttx_user.hex
file to produce a single combined hex file:</p>
<blockquote>
<div><blockquote>
<div><p>$ cat nuttx.hex nuttx_user.hex &gt;combined.hex</p>
</div></blockquote>
<p>Then use the combined.hex file with the to write the FLASH image.
If you do this a lot, you will probably want to invest a little time
to develop a tool to automate these steps.</p>
</div></blockquote>
</li>
</ol>
</li>
</ol>
</section>
<section id="nsh">
<h3>nsh<a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h3>
<p>Configures the NuttShell (nsh) located at apps/examples/nsh for the
STM32L4R9AI-DISCO board.  The Configuration enables the serial interfaces
on UART4.  Support for builtin applications is enabled, but in the base
configuration no builtin applications are selected (see NOTES below).</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>This configuration uses the mconf-based configuration tool.  To
change this configuration using that tool, you should:</p>
<p>Execute ‘make menuconfig’ in nuttx/ in order to start the
reconfiguration process.</p>
</li>
<li><p>By default, this configuration uses the Generic ARM EABI toolchain
for Linux.  That can easily be reconfigured, of course.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=y                 : Builds under Linux
CONFIG_ARM_TOOLCHAIN_GNU_EABI=y  : Generic EABI toolchain for Linux
</pre></div>
</div>
</li>
<li><p>The default console is UART4</p></li>
<li><p>This example can be used to verify the OTGFS functionality. USB is
not enabled in the default configuration but can be enabled with the
following settings: (TODO: need to test!):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_STM32L4_OTGFS=y

CONFIG_USBDEV=y
CONFIG_USBDEV_SELFPOWERED=y
</pre></div>
</div>
<p>These will enable the USB CDC/ACM serial device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_CDCACM=y
CONFIG_CDCACM_EP0MAXPACKET=64
CONFIG_CDCACM_EPINTIN=1
CONFIG_CDCACM_EPINTIN_FSSIZE=64
CONFIG_CDCACM_EPINTIN_HSSIZE=64
CONFIG_CDCACM_EPBULKOUT=3
CONFIG_CDCACM_EPBULKOUT_FSSIZE=64
CONFIG_CDCACM_EPBULKOUT_HSSIZE=512
CONFIG_CDCACM_EPBULKIN=2
CONFIG_CDCACM_EPBULKIN_FSSIZE=64
CONFIG_CDCACM_EPBULKIN_HSSIZE=512
CONFIG_CDCACM_NRDREQS=4
CONFIG_CDCACM_NWRREQS=4
CONFIG_CDCACM_BULKIN_REQLEN=96
CONFIG_CDCACM_RXBUFSIZE=257
CONFIG_CDCACM_TXBUFSIZE=193
CONFIG_CDCACM_VENDORID=0x0525
CONFIG_CDCACM_PRODUCTID=0xa4a7
CONFIG_CDCACM_VENDORSTR=&quot;NuttX&quot;
CONFIG_CDCACM_PRODUCTSTR=&quot;CDC/ACM Serial&quot;

CONFIG_SERIAL_REMOVABLE=y
</pre></div>
</div>
<p>These will enable the USB serial example at apps/examples/usbserial:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BOARDCTL_USBDEVCTRL=y

CONFIG_EXAMPLES_USBSERIAL=y
CONFIG_EXAMPLES_USBSERIAL_BUFSIZE=512
CONFIG_EXAMPLES_USBSERIAL_TRACEINIT=y
CONFIG_EXAMPLES_USBSERIAL_TRACECLASS=y
CONFIG_EXAMPLES_USBSERIAL_TRACETRANSFERS=y
CONFIG_EXAMPLES_USBSERIAL_TRACECONTROLLER=y
CONFIG_EXAMPLES_USBSERIAL_TRACEINTERRUPTS=y
</pre></div>
</div>
<p>Optional USB debug features::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_DEBUG_FEATURES=y
CONFIG_DEBUG_USB=y
CONFIG_ARCH_USBDUMP=y
CONFIG_USBDEV_TRACE=y
CONFIG_USBDEV_TRACE_NRECORDS=128
CONFIG_USBDEV_TRACE_STRINGS=y
CONFIG_USBDEV_TRACE_INITIALIDSET=y

CONFIG_NSH_USBDEV_TRACE=y
CONFIG_NSH_USBDEV_TRACEINIT=y
CONFIG_NSH_USBDEV_TRACECLASS=y
CONFIG_NSH_USBDEV_TRACETRANSFERS=y
CONFIG_NSH_USBDEV_TRACECONTROLLER=y
CONFIG_NSH_USBDEV_TRACEINTERRUPTS=y
</pre></div>
</div>
</li>
</ol>
</section>
<section id="nxhello">
<h3>nxhello<a class="headerlink" href="#nxhello" title="Permalink to this heading"></a></h3>
<p>A simple NSH example using apps/examples/nxhello, a very simply test of
basic NX functionality.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../stm32l476vg-disco/index.html" class="btn btn-neutral float-left" title="ST STM32L476VG-DISCO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../stm32l5/index.html" class="btn btn-neutral float-right" title="ST STM32L5" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>