<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Olimex STM32-P207 &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="OMNIBUSF4" href="../omnibusf4/index.html" />
    <link rel="prev" title="Olimex STM32-H407" href="../olimex-stm32-h407/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">ARM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../a64/index.html">Allwinner A64</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../imxrt/index.html">i.MX RT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf52/index.html">Nordic nRF52</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf53/index.html">Nordic nRF53</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf91/index.html">Nordic nRF91</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rp2040/index.html">rp2040</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../s32k1xx/index.html">NXP S32K1XX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../s32k3xx/index.html">NXP S32K3XX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../samv7/index.html">SAM V7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f0/index.html">ST STM32F0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f1/index.html">ST STM32F1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f2/index.html">ST STM32F2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f3/index.html">ST STM32F3</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">ST STM32F4</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../index.html#supported-mcus">Supported MCUs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#peripheral-support">Peripheral Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#fpu">FPU</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#development-environment">Development Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#gnu-toolchain-options">GNU Toolchain Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#ides">IDEs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#nuttx-eabi-buildroot-toolchain">NuttX EABI “buildroot” Toolchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#nxflat-toolchain">NXFLAT Toolchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#protected-mode-build">Protected Mode Build</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="../axoloti/index.html">Axoloti</a></li>
<li class="toctree-l5"><a class="reference internal" href="../clicker2-stm32/index.html">Mikroe Clicker2 STM32</a></li>
<li class="toctree-l5"><a class="reference internal" href="../mikroe-stm32f4/index.html">mikroe-stm32f4</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-f401re/index.html">ST Nucleo F401RE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-f410rb/index.html">ST Nucleo F410RB</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-f411re/index.html">ST Nucleo F401RE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-f412zg/index.html">ST Nucleo F410RB</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-f429zi/index.html">ST Nucleo F429ZI</a></li>
<li class="toctree-l5"><a class="reference internal" href="../nucleo-f446re/index.html">ST Nucleo F446RE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../olimex-stm32-e407/index.html">Olimex STM32-E407</a></li>
<li class="toctree-l5"><a class="reference internal" href="../olimex-stm32-h405/index.html">Olimex STM32-P207</a></li>
<li class="toctree-l5"><a class="reference internal" href="../olimex-stm32-h407/index.html">Olimex STM32-H407</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Olimex STM32-P207</a></li>
<li class="toctree-l5"><a class="reference internal" href="../omnibusf4/index.html">OMNIBUSF4</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm3240g-eval/index.html">ST STM32140G-EVAL</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm32f411-minimum/index.html">stm32f411-minimum</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm32f411e-disco/index.html">ST STM32F411E-Discovery</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm32f429i-disco/index.html">ST STM32F429I-DISCO</a></li>
<li class="toctree-l5"><a class="reference internal" href="../stm32f4discovery/index.html">ST STM32F4-Discovery</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f7/index.html">ST STM32F7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32g0/index.html">ST STM32G0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32g4/index.html">ST STM32G4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32h7/index.html">ST STM32H7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l0/index.html">ST STM32L0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l1/index.html">ST STM32L1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l4/index.html">ST STM32L4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l5/index.html">ST STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32u5/index.html">ST STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32wb/index.html">ST STM32WB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32wl5/index.html">ST STM32WL5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../xmc4/index.html">Infineon XMC4000</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">AVR8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/index.html">Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">ARM</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">ST STM32F4</a></li>
      <li class="breadcrumb-item active">Olimex STM32-P207</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/platforms/arm/stm32f4/boards/olimex-stm32-p407/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="olimex-stm32-p207">
<h1>Olimex STM32-P207<a class="headerlink" href="#olimex-stm32-p207" title="Permalink to this heading"></a></h1>
<p>The NuttX configuration for the Olimex STM32-P407 is derives more or less
directly from the Olimex STM32-P207 board support.  The P207 and P407 seem
to share the same board design.  Other code comes from the STM3240G board
support (which has the same crystal and clocking) and from the STM32 F4
Discovery (which has the same STM32 part)</p>
<section id="board-support">
<h2>Board Support<a class="headerlink" href="#board-support" title="Permalink to this heading"></a></h2>
<p>The following peripherals are available in this configuration.</p>
<ul class="simple">
<li><p>LEDs: Show the system status</p></li>
<li><p>Buttons: TAMPER-button, WKUP-button, J1-Joystick (consists of RIGHT-,
UP-, LEFT-, DOWN-, and CENTER-button).</p></li>
<li><p>ADC: ADC1 samples the red trim potentiometer AN_TR
Built in app ‘adc’ works.</p></li>
<li><p>USB-FS-OTG: There is a USB-A-connector (host) connected to the full
speed STM32 OTG inputs.</p></li>
<li><p>USB-HS-OTG: The other connector (device) is connected to the high speed
STM32 OTG inputs.</p></li>
<li><p>CAN: Built in app ‘can’ works, but apart from that not really tested.</p></li>
<li><p>Ethernet: Ping to other station on the network works.</p></li>
<li><p>microSD: Not fully functional.  See below.</p></li>
<li><p>LCD: Nokia 6610. This is similar the Nokia 6100 LCD used on other
Olimex boards.  There is a driver for that LCD at
Obsoleted/nuttx/drivers/lcd/nokia6100.c, however, it was removed
because it was not properly integrated.  It uses a 9-bit SPI
interface which is difficult to get working properly.</p></li>
<li><p>External SRAM: Support is included for the onboard SRAM.  It uses SRAM
settings from another board that might need to be tweaked.
Difficult to test because the SRAM conflicts with both
RS232 ports.</p></li>
<li><p>Other: Buzzer, Camera, Temperature sensor, audio have not been tested.</p></li>
</ul>
<blockquote>
<div><p>If so, then it requires a 9-bit</p>
</div></blockquote>
</section>
<section id="microsd-card-interface">
<h2>microSD Card Interface<a class="headerlink" href="#microsd-card-interface" title="Permalink to this heading"></a></h2>
<section id="microsd-connector">
<h3>microSD Connector<a class="headerlink" href="#microsd-connector" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>----------------- ----------------- ------------------------
SD/MMC CONNECTOR        BOARD        GPIO CONFIGURATION(s
PIN SIGNAL             SIGNAL          (no remapping)
--- ------------- ----------------- -------------------------
1   DAT2/RES      SD_D2/USART3_TX/  PC10 GPIO_SDIO_D2
                  SPI3_SCK
2   CD/DAT3/CS    SD_D3/USART3_RX/  PC11 GPIO_SDIO_D3
                  SPI3_MISO
3   CMD/DI        SD_CMD            PD2  GPIO_SDIO_CMD
4   VDD           N/A               N/A
5   CLK/SCLK      SD_CLK/SPI3_MOSI  PC12 GPIO_SDIO_CK
6   VSS           N/A               N/A
7   DAT0/D0       SD_D0/DCMI_D2     PC8  GPIO_SDIO_D0
8   DAT1/RES      SD_D1/DCMI_D3     PC9  GPIO_SDIO_D1
--- ------------- ----------------- -------------------------

NOTES:
1. DAT4, DAT4, DAT6, and DAT7 not connected.
2. There are no alternative pin selections.
3. There is no card detect (CD) GPIO input so we will not
   sense if there is a card in the SD slot or not.  This will
   make usage very awkward.
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>Enabling SDIO-based MMC/SD support:</p>
<p>System Type-&gt;STM32 Peripheral Support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_STM32_SDIO=y                      : Enable SDIO support
CONFIG_STM32_DMA2=y                      : DMA2 is needed by the driver
</pre></div>
</div>
<p>Device Drivers -&gt; MMC/SD Driver Support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MMCSD=y                           : Enable MMC/SD support
CONFIG_MMSCD_NSLOTS=1                    : One slot per driver instance
# CONFIG_MMCSD_HAVE_CARDDETECT is not set : No card-detect GPIO
# CONFIG_MMCSD_MMCSUPPORT is not set     : Interferes with some SD cards
# CONFIG_MMCSD_SPI is not set            : No SPI-based MMC/SD support
CONFIG_MMCSD_SDIO=y                      : SDIO-based MMC/SD support
CONFIG_MMCSD_MULTIBLOCK_LIMIT=1          : Disable to keep things simple
CONFIG_SDIO_DMA=y                        : Use SDIO DMA
# CONFIG_SDIO_BLOCKSETUP is not set      : (not implemented)
</pre></div>
</div>
<p>Library Routines:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SCHED_WORKQUEUE=y                 : Driver needs work queue support
</pre></div>
</div>
<p>Application Configuration -&gt; NSH Library:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NSH_ARCHINIT=y                    : NSH board-initialization
</pre></div>
</div>
</section>
<section id="using-the-sd-card">
<h3>Using the SD card<a class="headerlink" href="#using-the-sd-card" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Since there is no CD GPIO pin, the firmware sill not know if there is
a card in the SD slot or not.  It will assume that there is and attempt
to mount the SD card on power-up.  If there is no SD card in the card
slot, there will be a long delay during initialization as the firmware
attempts to query the non-existent card, timeout, and retry.</p></li>
<li><p>After booting, an SDIO device will appear as /dev/mmcsd0</p></li>
<li><p>If you try mounting an SD card with nothing in the slot, the
mount will fail:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t vfat /dev/mmcsd0 /mnt/sdcard
nsh: mount: mount failed: 19
</pre></div>
</div>
</li>
</ol>
</section>
<section id="status">
<h3>STATUS:<a class="headerlink" href="#status" title="Permalink to this heading"></a></h3>
<p>2017-01-28:  There is no card communication.  All commands to the SD card timeout.</p>
</section>
</section>
<section id="otgfs-host">
<h2>OTGFS Host<a class="headerlink" href="#otgfs-host" title="Permalink to this heading"></a></h2>
<blockquote>
<div></div></blockquote>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<section id="information-common-to-all-configurations">
<h3>Information Common to All Configurations<a class="headerlink" href="#information-common-to-all-configurations" title="Permalink to this heading"></a></h3>
<p>Each Olimex STM32-P407 configuration is maintained in a sub-directory and can be
selected as follow:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tools/configure.sh olimex-stm32-p407:&lt;subdir&gt;
</pre></div>
</div>
<p>Where &lt;subdir&gt; is one of the configuration sub-directories listed in the
following section.</p>
<p>Before building, make sure the PATH environment variable includes the
correct path to the directory than holds your toolchain binaries.</p>
<p>And then build NuttX by simply typing the following.  At the conclusion of
the make, the nuttx binary will reside in an ELF file called, simply, nuttx.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make oldconfig
make
</pre></div>
</div>
<p>NOTES:</p>
<ol class="arabic">
<li><p>This configuration uses the mconf-based configuration tool.  To
change this configurations using that tool, you should:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Build and install the kconfig-mconf tool.  See nuttx/README.txt
see additional README.txt files in the NuttX tools repository.</p></li>
<li><p>Execute ‘make menuconfig’ in nuttx/ in order to start the
reconfiguration process.</p></li>
</ol>
</div></blockquote>
</li>
<li><p>Serial Output</p>
<blockquote>
<div><p>This configuraiont produces all of its test output on the serial
console.  This configuration has USART3 enabled as a serial console.
This is the connector labeled RS232_2.  This can easily be changed
by reconfiguring with ‘make menuconfig’.</p>
</div></blockquote>
</li>
<li><p>Toolchain</p>
<blockquote>
<div><p>By default, the host platform is set to be Linux using the NuttX
buildroot toolchain. The host and/or toolchain selection can easily
be changed with ‘make menuconfig’.</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Note that CONFIG_STM32_DISABLE_IDLE_SLEEP_DURING_DEBUG is enabled so</dt><dd><p>that the JTAG connection is not disconnected by the idle loop.</p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="configuration-sub-directories">
<h3>Configuration sub-directories<a class="headerlink" href="#configuration-sub-directories" title="Permalink to this heading"></a></h3>
<p>The &lt;subdir&gt; that is provided above as an argument to the tools/configure.sh
must be is one of the following.</p>
</section>
<section id="dhtxx">
<h3>dhtxx<a class="headerlink" href="#dhtxx" title="Permalink to this heading"></a></h3>
<p>Configuration added by Abdelatif Guettouche for testing the the DHTxx
sensor.  This configuration expects this setup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DHTXX_PIN_OUTPUT   PG9
DHTXX_PIN_INPUT    PG9
</pre></div>
</div>
<p>The STM32 free-running timer is also required.</p>
</section>
<section id="hidkbd">
<h3>hidkbd<a class="headerlink" href="#hidkbd" title="Permalink to this heading"></a></h3>
<p>This is another NSH configuration that supports a USB HID Keyboard
device and the HID keyboard example at apps/examples/hidkbd.</p>
<p>STATUS:
2018-10-07:  Not all keyboards will connect successfully. I have not
looked into the details but it may be that those keyboards are not
compatible with the driver (which only accepts “boot” keyboards).
Also, when typing input into the HID keyboard, characters are often
missing and sometimes duplicated.  This is like some issue with the
read logic of drivers/usbhost_hidkbc.c.</p>
</section>
<section id="kelf">
<h3>kelf<a class="headerlink" href="#kelf" title="Permalink to this heading"></a></h3>
<p>This is a protected mode version of the apps/examples/elf test of
loadable ELF programs.  This version is unique because the ELF programs
are loaded into user space.</p>
<p>NOTES:</p>
<ol class="arabic">
<li><dl class="simple">
<dt>See build recommendations and instructions for combining the .hex</dt><dd><p>files under the section entitled “Protected Mode Build” above.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Unlike other versions of apps/examples/elf configurations, the test</dt><dd><p>ELF programs are not provided internally on a ROMFS or CROMFS file
system.  This is due to the fact that those file systems are built in
user space and there is no mechanism in the build system to easily
get them into the kernel space.</p>
<p>Instead, the programs must be copied to a USB FLASH drive from your
host PC.  The programs can be found at apps/examples/elf/tests/romfs.
All of those files should be copied to the USB FLASH drive.  The
apps/example/elf will wait on power up until the USB FLASH drive
has been inserted and initialized.</p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="kmodule">
<h3>kmodule<a class="headerlink" href="#kmodule" title="Permalink to this heading"></a></h3>
<p>This is a protected mode version of the apps/examples/module test of
loadable ELF kernel modules.  This version is unique because the ELF
programs are loaded into the protected kernel space.</p>
<p>NOTES:</p>
<ol class="arabic">
<li><dl class="simple">
<dt>See build recommendations and instructions for combining the .hex</dt><dd><p>files under the section entitled “Protected Mode Build” above.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Unlike other versions of apps/examples/module configurations, the test</dt><dd><blockquote>
<div><p>ELF modules are not provided internally on a ROMFS or CROMFS file
system.  This is due to the fact that those file systems are built in
user space and there is no mechanism in the build system to easily
get them into the kernel space.</p>
<p>Instead, the module(s) must be copied to a USB FLASH drive from your
host PC.  The module(s) can be found at apps/examples/module/driver/fsroot.
All of those file(s) should be copied to the USB FLASH drive.  Like the
kelf configuration, the logic in apps/example/module will wait on power
up until the USB FLASH drive has been inserted and initialized.</p>
</div></blockquote>
<dl class="simple">
<dt>STATUS:</dt><dd><dl class="simple">
<dt>2018-08-07:  After some struggle, the configuration appears to be</dt><dd><p>working correctly.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</li>
</ol>
</section>
<section id="knsh">
<h3>knsh<a class="headerlink" href="#knsh" title="Permalink to this heading"></a></h3>
<p>This is identical to the nsh configuration below except that NuttX
is built as a PROTECTED mode, monolithic module and the user applications
are built separately.</p>
<p>NOTES:</p>
<ol class="arabic simple">
<li><p>See build recommendations and instructions for combining the .hex
files under the section entitled “Protected Mode Build” above.</p></li>
</ol>
</section>
<section id="module">
<h3>module<a class="headerlink" href="#module" title="Permalink to this heading"></a></h3>
<p>A simple stripped down NSH configuration that was used for testing NuttX
OS modules using the test at apps/examples/module.  Key difference from
the nsh configuration include these additions to the configuration file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BOARDCTL_OS_SYMTAB=y
CONFIG_EXAMPLES_MODULE=y
CONFIG_EXAMPLES_MODULE_BUILTINFS=y
CONFIG_EXAMPLES_MODULE_DEVMINOR=0
CONFIG_EXAMPLES_MODULE_DEVPATH=&quot;/dev/ram0&quot;
CONFIG_FS_ROMFS=y
CONFIG_LIBC_ARCH_ELF=y
CONFIG_MODULE=y
CONFIG_LIBC_MODLIB=y
CONFIG_MODLIB_MAXDEPEND=2
CONFIG_MODLIB_ALIGN_LOG2=2
CONFIG_MODLIB_BUFFERSIZE=128
CONFIG_MODLIB_BUFFERINCR=32
</pre></div>
</div>
<p>The could be followed may be added for testing shared libraries in the
FLAT build using apps/examples/sotest (assuming that you also have SD
card support enabled and that the SD card is mount at /mnt/sdcard):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_LIBC_DLFCN=y
CONFIG_EXAMPLES_SOTEST=y
CONFIG_EXAMPLES_SOTEST_BINDIR=&quot;/mnt/sdcard&quot;
</pre></div>
</div>
<p>NOTE: You must always have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_STM32_CCMEXCLUDE=y
</pre></div>
</div>
<p>because code cannot be executed from CCM memory.</p>
<p>STATUS:
2018-06-01: Configuration added.  Works perfectly.</p>
</section>
<section id="nsh">
<h3>nsh<a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h3>
<p>This is the NuttShell (NSH) using the NSH startup logic at
apps/examples/nsh</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>USB host support for USB FLASH sticks is enabled.  See the notes
above under “OTGFS Host”.</p>
<p>STATUS: I have seen this work with some FLASH sticks but not with
others.  I have not studied the failure case carefully.  They seem
to fail because the request is NAKed.  That is not a failure, however,
that is normal behavior when the FLASH is not ready.</p>
<p>There have been other cases like this with the STM32 host drivers:
in the event of NAKs, other drivers retry and wait for the data.  The
STM32 does not but returns the NAK failure immediately.  My guess is
that there needs to be be some retry logic to the driver 100%
reliable.</p>
</li>
<li><p>Kernel Modules / Shared Libraries</p>
<p>I used this configuration for testing NuttX kernel modules in the
FLAT build with the following configuration additions to the
configuration file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    CONFIG_BOARDCTL_OS_SYMTAB=y
    CONFIG_EXAMPLES_MODULE=y
    CONFIG_EXAMPLES_MODULE_BUILTINFS=y
    CONFIG_EXAMPLES_MODULE_DEVMINOR=0
    CONFIG_EXAMPLES_MODULE_DEVPATH=&quot;/dev/ram0&quot;
    CONFIG_FS_ROMFS=y
    CONFIG_LIBC_ARCH_ELF=y
    CONFIG_MODULE=y
    CONFIG_LIBC_MODLIB=y
    CONFIG_MODLIB_ALIGN_LOG2=2
    CONFIG_MODLIB_BUFFERINCR=32
    CONFIG_MODLIB_BUFFERSIZE=128

Add the following for testing shared libraries in the FLAT
build::

    CONFIG_LIBC_DLFCN=y
    CONFIG_EXAMPLES_SOTEST=y
    CONFIG_EXAMPLES_SOTEST_BUILTINFS=y
    CONFIG_EXAMPLES_SOTEST_DEVMINOR=1
    CONFIG_EXAMPLES_SOTEST_DEVPATH=&quot;/dev/ram1&quot;
</pre></div>
</div>
</li>
</ol>
</section>
<section id="zmodem">
<h3>zmodem<a class="headerlink" href="#zmodem" title="Permalink to this heading"></a></h3>
<p>This configuration was used to test the zmodem utilities at
apps/system/zmodem.  Two serial ports are used in this configuration:</p>
<ol class="arabic simple">
<li><p>USART6 (RS232_1) is the serial console (because it does not support
hardware flow control). It is configured 115200 8N1.</p></li>
<li><p>USART3 (RS232_2) is the zmodem port and does require that hardware
flow control be enabled for use.  It is configured 9600 8N1.</p></li>
</ol>
<p>On the target these will correspond to /dev/ttyS0 and /dev/ttyS1,
respectively.</p>
<p>It is possible to configure a system without hardware flow control and
using the same USART for both the serial console and for zmodem.
However, you would have to take extreme care with buffering and data
throughput considerations to assure that there is no Rx data overrun.</p>
<p>General usage instructions:</p>
<ol class="arabic">
<li><p>Common Setup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[on target]
nsh&gt; mount -t vfat /dev/sda /mnt

[on Linux host]
$ sudo stty -F /dev/ttyS0 9600
$ sudo stty -F /dev/ttyS0 crtscts *
$ sudo stty -F /dev/ttyS0 raw
$ sudo stty -F /dev/ttyS0

* Because hardware flow control will be enabled on the target side
  in this configuration.
</pre></div>
</div>
</li>
<li><p>Host-to-Target File Transfer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  [on target]
  nsh&gt; rz

  [on host]
  $ sudo sz &lt;filename&gt; [-l nnnn] &lt;/dev/ttyS0 &gt;/dev/ttyS0

Where &lt;filename&gt; is the file that you want to transfer. If -l nnnn is
not specified, then there will likely be packet buffer overflow errors.
nnnn should be set to a strictly less than CONFIG_SYSTEM_ZMODEM_PKTBUFSIZE.
All testing was performed with -l 512.

If you are using the NuttX implementation of rz and sz on the Linux host,
then the last command simplifies to just::

  [on host]
  $ cp README.txt /tmp/.
  $ sudo ./sz -d /dev/ttyS1 README.txt

Assuming that /dev/ttyS0 is the serial and /dev/ttyS1 is the zmodem port
on the Linux host as well.  NOTE:  By default, files will be transferred
to and from the /tmp directory only.

Refer to the README file at apps/examples/zmodem for detailed information
about building rz/sz for the host and about zmodem usage in general.
</pre></div>
</div>
</li>
<li><p>Target-to-Host File Transfer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[on host]
$ rz &lt;/dev/ttyS0 &gt;/dev/ttyS0
</pre></div>
</div>
<p>The transferred file will end up in the current directory.</p>
<p>If you are using the NuttX implementation of rz and sz on the Linux host,
then the last command simplifies to just:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[on host]
$ ./rz
</pre></div>
</div>
<p>The transferred file will lie in the /tmp directory.</p>
<p>Then on the target side:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[on target]
nsh sz &lt;filename&gt;
</pre></div>
</div>
<p>Where &lt;filename&gt; is the file that you want to transfer.</p>
</li>
</ol>
</section>
</section>
<section id="id1">
<h2>STATUS<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>2016-12-21: This board configuration was ported from the Olimex STM32 P207
port.  Note that none of the above features have been verified.  USB, CAN,
ADC, and Ethernet are disabled in the base NSH configuration until they
can be verified.  These features should be functional but may required
some tweaks due to the different clock configurations.  The Olimex STM32
P207 nsh/defconfig would be a good starting place for restoring these
feature configurations.</p>
<p>CCM memory is not included in the heap (CONFIG_STM32_CCMEXCLUDE=y) because
it does not support DMA, leaving only 128KiB for program usage.</p>
<p>2017-01-23:  Added the knsh configuration and support for the PROTECTED
build mode.</p>
<p>2018-05-27:  Added the zmodem configuration.  Verified correct operation
with host-to-target transfers (using Linux sz command).  There appears
to be a problem using the NuttX sz command running on the host???</p>
<p>2018-05-28:  Verified correct operation with target-to-host transfers (using
Linux rz command).  There appears to be a problem using the NuttX rz
command running on the host???</p>
<p>2018-06-01: Added the module configuration.  Works perfectly.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../olimex-stm32-h407/index.html" class="btn btn-neutral float-left" title="Olimex STM32-H407" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../omnibusf4/index.html" class="btn btn-neutral float-right" title="OMNIBUSF4" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>