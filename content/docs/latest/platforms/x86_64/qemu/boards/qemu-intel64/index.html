<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qemu-intel64 &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Xtensa" href="../../../../xtensa/index.html" />
    <link rel="prev" title="QEMU x86_64" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../../12.5.1" >12.5.1</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../arm/index.html">ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../arm64/index.html">ARM64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">Microchip AVR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ceva/index.html">CEVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../hc/index.html">HC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mips/index.html">MIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misco/index.html">Misoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../or1k/index.html">OpenRISC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../renesas/index.html">Renesas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/index.html">Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sparc/index.html">SPARC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tricore/index.html">TriCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86/index.html">Intel 80x86</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Intel 80x86_64</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#arch-x86-64-src-common-directory">arch/x86_64/src/common/ Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#architecture-specific-directories">Architecture-Specific Directories</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../index.html#chip-specific-directories">Chip-Specific directories</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html">QEMU x86_64</a><ul class="current">
<li class="toctree-l5 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z16/index.html">Z16</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z80/index.html">Z80</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../logos/index.html">NuttX Logos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Intel 80x86_64</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">QEMU x86_64</a></li>
      <li class="breadcrumb-item active">qemu-intel64</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/platforms/x86_64/qemu/boards/qemu-intel64/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="qemu-intel64">
<h1>qemu-intel64<a class="headerlink" href="#qemu-intel64" title="Permalink to this heading"></a></h1>
<p>This page file describes the contents of the build configurations available
for the NuttX QEMU x86_64 port.</p>
<section id="creating-a-bootable-disk">
<h2>Creating a bootable disk<a class="headerlink" href="#creating-a-bootable-disk" title="Permalink to this heading"></a></h2>
<p>This build supports multiboot2, which means that usual multiboot2 bootlaoders,
e.g. grub can be used. To create a bootable disk with grub2, create a directory
named <code class="docutils literal notranslate"><span class="pre">iso</span></code> with grub configuration file and the compiled <code class="docutils literal notranslate"><span class="pre">nuttx.elf</span></code>.</p>
<p>Directory and file hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- iso/
  - boot/
    - grub/
      - grub.cfg
    - nuttx.elf
</pre></div>
</div>
<p>The grub.cfg should contain the boot entry of NuttX:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set timeout=0
set default=0
menuentry &quot;kernel&quot; {
  multiboot2 /boot/nuttx.elf
}
</pre></div>
</div>
<section id="making-the-disk">
<h3>Making the disk<a class="headerlink" href="#making-the-disk" title="Permalink to this heading"></a></h3>
<p>Use the following command to create the disk.
P.S. In some distros, <code class="docutils literal notranslate"><span class="pre">grub-mkrescue</span></code> is called <code class="docutils literal notranslate"><span class="pre">grub2-mkrescue</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>grub-mkrescue -o boot.iso iso
</pre></div>
</div>
</section>
<section id="grub-with-uefi">
<h3>Grub with UEFI<a class="headerlink" href="#grub-with-uefi" title="Permalink to this heading"></a></h3>
<p>This flow is very similar except you need to have the BOOTX64.EFI file.
You can find this in most Linux distributions:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>iso/
└── boot
    ├── efi
    │   └── EFI
    │       └── BOOT
    │           └── BOOTX64.EFI
    ├── grub
    │   └── grub.cfg
    └── nuttx.elf
</pre></div>
</div>
</section>
</section>
<section id="qemu-kvm">
<h2>QEMU/KVM<a class="headerlink" href="#qemu-kvm" title="Permalink to this heading"></a></h2>
<p>QEMU is a generic and open source machine emulator and virtual machine.  Here are
some links (which will probably be mostly outdated by the time your read this):</p>
<ul class="simple">
<li><p>Home Page: <a class="reference external" href="http://wiki.qemu.org/Main_Page">http://wiki.qemu.org/Main_Page</a></p></li>
<li><p>Downloads: <a class="reference external" href="http://wiki.qemu.org/Download">http://wiki.qemu.org/Download</a></p></li>
<li><p>Documentation: <a class="reference external" href="http://wiki.qemu.org/Manual">http://wiki.qemu.org/Manual</a></p></li>
</ul>
<p>KVM is the Linux kernel hypervisor.
It supports creations of virtual machines in Linux systems.
It is usually coupled with Qemu as its I/O supporting layer.</p>
<p>The qemu can be build from source or downloaded from distro repositories.
However, a modern CPU and KVM support are mandatory because the X2APIC is not
available in pure emulator mode.
This mean using this build with qemu in windows or old x86 machine can be
frustrating. In such case, looks the next section and use bochs emulator instead.</p>
<section id="running-qemu">
<h3>Running QEMU<a class="headerlink" href="#running-qemu" title="Permalink to this heading"></a></h3>
<p>In the top-level NuttX directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qemu-system-x86_64 -cpu host -enable-kvm -m 2G -cdrom boot.iso -nographic -serial mon:stdio
</pre></div>
</div>
<p>This multiplex the qemu console and COM1 to your console.</p>
<p>Use control-a 1 and 2 to switch between.
Use control-a x to terminate the emulation.</p>
<p>P.S. Make sure that you CPU supports the mandatory features. Look at Real machine
section for more information.</p>
<p>For testing the PCI bus and driver layers.  This QEMU configuration can be used
with the pcitest NuttX configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qemu-system-x86_64  -cpu host,+pcid,+x2apic,+tsc-deadline,+xsave,+rdrand --enable-kvm -smp 1 -m 2G -cdrom boot.iso --nographic -s -no-reboot -device edu -device pci-testdev
</pre></div>
</div>
<p>This will enable the QEMU pci-test and edu PCI test devices which test PIO, MMIO, IRQ, and DMA
functions.  Additionally it will show detailed information about the enumeration of the PCI bus.</p>
<p>If you want to boot using UEFI and TianoCore you will need to add a flag like this to
point at OVMF <code class="docutils literal notranslate"><span class="pre">--bios</span> <span class="pre">/usr/share/edk2/ovmf/OVMF_CODE.fd</span></code></p>
</section>
</section>
<section id="bochs">
<h2>Bochs<a class="headerlink" href="#bochs" title="Permalink to this heading"></a></h2>
<p>Bochs is also a generic and open source machine emulator and virtualizer.
It does very comprehensive emulation of x86 platform, even the state-of-art processors.
Here are some links (which will probably be mostly outdated by the time your read this):</p>
<ul class="simple">
<li><p>Home Page: <a class="reference external" href="http://bochs.sourceforge.net">http://bochs.sourceforge.net</a></p></li>
</ul>
<p>The bochs can be build from source.
Unlike qemu, it does not rely on KVM to support modern hardware features,
therefore it can also be used under Windows.
When building bochs, remember to enable x86-64 support with <code class="docutils literal notranslate"><span class="pre">--enable-x86-64</span></code>.
If you also want support for SIMD instructions, enable them with <code class="docutils literal notranslate"><span class="pre">--enable-avx</span> <span class="pre">--enable-evex</span></code>.</p>
<section id="running-bochs">
<h3>Running Bochs<a class="headerlink" href="#running-bochs" title="Permalink to this heading"></a></h3>
<p>First edit/check the <code class="docutils literal notranslate"><span class="pre">.bochsrc</span></code>
You can create one in the top-level NuttX directory or bochs will use the one in your $HOME.
Remember to change the CPU model to one with mandatory features and enable the COM port.</p>
<ul>
<li><p>Find and edit (You might adjust the IPS as you machine perform):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cpu: model=broadwell_ult, count=1, ips=50000000, reset_on_triple_fault=0, ignore_bad_msrs=0, msrs=&quot;msrs.def&quot;
ata0-master: type=cdrom, path=&quot;&lt;PATH TO boot.iso&gt;&quot;, status=inserted
</pre></div>
</div>
</li>
<li><p>Add:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>com1: enabled=1, mode=file, dev=com1.out
</pre></div>
</div>
</li>
<li><p>In the top-level NuttX directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bochs
</pre></div>
</div>
</li>
</ul>
<p>The emulator will drop into debugger mode.
Enter <code class="docutils literal notranslate"><span class="pre">c</span></code> to start the emulation.
COM port output will be in the com1.out file.</p>
</section>
</section>
<section id="real-machine">
<h2>Real machine<a class="headerlink" href="#real-machine" title="Permalink to this heading"></a></h2>
<p>This port should work on real x86-64 machine with a proper CPU.
The mandatory CPU features are:</p>
<ul class="simple">
<li><p>TSC DEADLINE or APIC timer</p></li>
<li><p>PCID</p></li>
<li><p>X2APIC</p></li>
</ul>
<p>WARNING: IF you use TSC DEADLINE, make sure that your CPU’s TSC DEADLINE timer
is not buggy!</p>
</section>
<section id="toolchains">
<h2>Toolchains<a class="headerlink" href="#toolchains" title="Permalink to this heading"></a></h2>
<p>Currently, only the Linux GCC toolchain is tested.
While building on a modern x86_64 PC, the default system GCC can be used.</p>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<section id="common-configuration-notes">
<h3>Common Configuration Notes<a class="headerlink" href="#common-configuration-notes" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Each Qemu-intel64 configuration is maintained in a sub-directory
and can be selected as follow:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tools/configure.sh qemu-intel64:&lt;subdir&gt;
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;subdir&gt;</span></code> is one of the configuration sub-directories described in
the following paragraph.</p>
</li>
<li><p>These configurations use the mconf-based configuration tool.  To
change a configurations using that tool, you should:</p>
<ol class="loweralpha simple">
<li><p>Build and install the kconfig-mconf tool.  See nuttx/README.txt
see additional README.txt files in the NuttX tools repository.</p></li>
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code> in nuttx/ in order to start the
reconfiguration process.</p></li>
</ol>
</li>
<li><p>By default, all configurations assume the Linux.  This is easily
reconfigured:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=y
</pre></div>
</div>
</li>
</ol>
</section>
<section id="configuration-sub-directories">
<h3>Configuration Sub-Directories<a class="headerlink" href="#configuration-sub-directories" title="Permalink to this heading"></a></h3>
</section>
<section id="ostest">
<h3>ostest<a class="headerlink" href="#ostest" title="Permalink to this heading"></a></h3>
<p>The “standard” NuttX examples/ostest configuration.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../index.html" class="btn btn-neutral float-left" title="QEMU x86_64" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../../xtensa/index.html" class="btn btn-neutral float-right" title="Xtensa" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>