<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SAMV71 Xplained Ultra &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
      <script src="../../../../../_static/jquery.js"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
      <script src="../../../../../_static/doctools.js"></script>
      <script src="../../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../../_static/clipboard.min.js"></script>
      <script src="../../../../../_static/copybutton.js"></script>
      <script src="../../../../../_static/design-tabs.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="ST STM32C0" href="../../../stm32c0/index.html" />
    <link rel="prev" title="same70-xplained" href="../same70-xplained/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../../12.10.0" >12.10.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">ARM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../a1x/index.html">Allwinner A10</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../am335x/index.html">TI/Sitara AM335x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../at32/index.html">Artery AT32</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../bcm2708/index.html">Broadcom BCM2708 (removed)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../c5471/index.html">TI TMS320-C5471</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxd56xx/index.html">Sony CXD56xx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dm320/index.html">TI TMS320-DM320</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../efm32/index.html">SiLabs EFM32</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../eoss3/index.html">EOSS3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fvp-v8r-aarch32/index.html">FVP ARMv8-R Virt Chip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gd32f4/index.html">GD32F4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../goldfish/goldfish_timer.html">GOLDFISH TIMER</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../goldfish/index.html">GOLDFISH</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../imx1/index.html">NXP/Freescale i.MX1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../imx6/index.html">NXP/Freescale i.MX6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../imx9/index.html">NXP i.MX9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../imxrt/index.html">NXP i.MX RT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../kinetis/index.html">NXP/FreeScale Kinetis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../kl/index.html">NXP/FreeScale KLxx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lc823450/index.html">ON Semiconductor LC823450</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc17xx/index.html">NXP LPC17xx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc214x/index.html">NXP LPC214x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc2378/index.html">NXP LPC2378</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc31xx/index.html">NXP LPC31xx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc40xx/index.html">NXP LPC40xx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc43xx/index.html">NXP LPC43xx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lpc54xx/index.html">NXP LPC54xx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../max326xx/index.html">Maxim Integrated MAX32660</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../moxart/index.html">Moxa NP51x0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../mps/index.html">MPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf52/ieee802154.html">Nordic nRF52 IEEE 802.15.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf52/index.html">Nordic nRF52</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf53/index.html">Nordic nRF53</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrf91/index.html">Nordic nRF91</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nuc1xx/index.html">nuvoTon NUC120</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../phy62xx/index.html">PHY+ PHY62</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../qemu/index.html">QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ra4m1/index.html">Renesas RA4M1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rp2040/index.html">Raspberry Pi rp2040</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rp23xx/index.html">Raspberry Pi rp2350</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../s32k1xx/index.html">NXP S32K1XX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../s32k3xx/index.html">NXP S32K3XX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sam34/index.html">Microchip SAM34</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sama5/index.html">Microchip SAMA5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../samd2l2/index.html">Microchip SAMD2x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../samd5e5/index.html">Microchip samd5e5</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">Microchip SAM V7</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../index.html#supported-mcus">Supported MCUs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#data-and-instruction-cache">Data and Instruction Cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#tickless-os">Tickless OS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#peripheral-support">Peripheral Support</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="../pic32czca70-curiosity/index.html">PIC32CZ CA70 Curiosity Evaluation Kit</a></li>
<li class="toctree-l5"><a class="reference internal" href="../same70-qmtech/index.html">same70-qmtech</a></li>
<li class="toctree-l5"><a class="reference internal" href="../same70-xplained/index.html">same70-xplained</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">SAMV71 Xplained Ultra</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32c0/index.html">ST STM32C0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f0/index.html">ST STM32F0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f1/index.html">ST STM32F1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f2/index.html">ST STM32F2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f3/index.html">ST STM32F3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f4/index.html">ST STM32F4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32f7/index.html">ST STM32F7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32g0/index.html">ST STM32G0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32g4/index.html">ST STM32G4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32h5/index.html">ST STM32H5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32h7/index.html">ST STM32H7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l0/index.html">ST STM32L0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l1/index.html">ST STM32L1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l4/index.html">ST STM32L4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32l5/index.html">ST STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32u5/index.html">ST STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32wb/index.html">ST STM32WB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stm32wl5/index.html">ST STM32WL5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../str71x/index.html">ST STR71</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tiva/index.html">TI/Stellaris Tiva</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tms570/index.html">TI/Hercules TMS570xxx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../xmc4/index.html">Infineon XMC4000</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../arm64/index.html">ARM64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">Microchip AVR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ceva/index.html">CEVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../hc/index.html">HC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mips/index.html">MIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misco/index.html">Misoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../or1k/index.html">OpenRISC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../renesas/index.html">Renesas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/index.html">Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/network_linux.html">Network Support on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/network_vpnkit.html">Network support with VPNKit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sparc/index.html">SPARC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tricore/index.html">TriCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86/index.html">Intel 80x86</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86_64/index.html">Intel 80x86_64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z16/index.html">Z16</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z80/index.html">Z80</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">ARM</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Microchip SAM V7</a></li>
      <li class="breadcrumb-item active">SAMV71 Xplained Ultra</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/platforms/arm/samv7/boards/samv71-xult/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="samv71-xplained-ultra">
<h1>SAMV71 Xplained Ultra<a class="headerlink" href="#samv71-xplained-ultra" title="Permalink to this heading"></a></h1>
<p>This entry discusses the port of NuttX to the Atmel SAM V71 Xplained
Ultra Evaluation Kit (SAMV71-XULT).  This board features the ATSAMV71Q21 Cortex-M7
microcontroller.</p>
<p>Additional support of provided for the (optional) maXTouch Xplained Pro LCD.</p>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#board-features" id="id3">Board Features</a></p></li>
<li><p><a class="reference internal" href="#status-open-issues" id="id4">Status/Open Issues</a></p></li>
<li><p><a class="reference internal" href="#serial-console" id="id5">Serial Console</a></p></li>
<li><p><a class="reference internal" href="#sd-card" id="id6">SD Card</a></p></li>
<li><p><a class="reference internal" href="#auto-mounter" id="id7">Auto-Mounter</a></p></li>
<li><p><a class="reference internal" href="#leds-and-buttons" id="id8">LEDs and Buttons</a></p></li>
<li><p><a class="reference internal" href="#at24mac402-serial-eeprom" id="id9">AT24MAC402 Serial EEPROM</a></p></li>
<li><p><a class="reference internal" href="#s25fl116k-quadspi-flash" id="id10">S25FL116K QuadSPI FLASH</a></p></li>
<li><p><a class="reference internal" href="#program-flash-access" id="id11">Program FLASH Access</a></p></li>
<li><p><a class="reference internal" href="#networking" id="id12">Networking</a></p></li>
<li><p><a class="reference internal" href="#usbhs-device-controller-driver" id="id13">USBHS Device Controller Driver</a></p></li>
<li><p><a class="reference internal" href="#audio-interface" id="id14">Audio Interface</a></p></li>
<li><p><a class="reference internal" href="#maxtouch-xplained-pro" id="id15">maXTouch Xplained Pro</a></p></li>
<li><p><a class="reference internal" href="#mcan1-loopback-test" id="id16">MCAN1 Loopback Test</a></p></li>
<li><p><a class="reference internal" href="#spi-slave" id="id17">SPI Slave</a></p></li>
<li><p><a class="reference internal" href="#click-shield" id="id18">Click Shield</a></p></li>
<li><p><a class="reference internal" href="#tickless-os" id="id19">Tickless OS</a></p></li>
<li><p><a class="reference internal" href="#debugging" id="id20">Debugging</a></p></li>
<li><p><a class="reference internal" href="#configurations" id="id21">Configurations</a></p></li>
</ul>
</nav>
<section id="board-features">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Board Features</a><a class="headerlink" href="#board-features" title="Permalink to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>ATSAMV71Q21 microcontroller: Cortex-M7, 300MHz, 2MiB FLASH, 384KiB SRAM,
I/D-caches</p></li>
<li><p>One mechanical reset button</p></li>
<li><p>One power switch button</p></li>
<li><p>Two mechanical user pushbuttons</p></li>
<li><p>Two yellow user LEDs</p></li>
<li><p>Supercap backup</p></li>
<li><p>12.0 MHz crystal</p></li>
<li><p>32.768 kHz crystal</p></li>
<li><p>2 MB SDRAM</p></li>
<li><p>2 MB QSPI Flash</p></li>
<li><p>IEEE 802.3az 10Base-T/100Base-TX Ethernet RMII PHY</p></li>
<li><p>AT24MAC402 256KByte EEPROM with EUI-48 address</p></li>
<li><p>WM8904 stereo audio codec</p></li>
<li><p>ATA6561 CAN Transceiver</p></li>
<li><p>SD Card connector with SDIO support</p></li>
<li><p>Camera interface connector</p></li>
<li><p>MediaLB connector</p></li>
<li><p>Two Xplained Pro extension headers</p></li>
<li><p>One Xplained Pro LCD header</p></li>
<li><p>Coresight 20 connector for 4-bit ETM</p></li>
<li><p>Arduino due compatible shield connectors</p></li>
<li><p>External debugger connector</p></li>
<li><p>USB interface, device and host mode</p></li>
<li><p>Embedded Debugger with Data Gateway Interface and Virtual COM port (CDC)</p></li>
<li><p>External power input (5-14V) or USB powered</p></li>
</ul>
</div></blockquote>
<p>See the Atmel website for further information about this board:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="http://www.atmel.com/tools/atsamv71-xult.aspx">http://www.atmel.com/tools/atsamv71-xult.aspx</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="status-open-issues">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Status/Open Issues</a><a class="headerlink" href="#status-open-issues" title="Permalink to this heading"></a></h2>
<p>I would characterize the general port as very mature and stable.  However,
there are a number of issues, caveats, and unfinished drivers as detailed in
the following paragraphs.</p>
<p>The BASIC nsh configuration is fully function (as described below under <a class="reference internal" href="#configurations">Configurations</a>).
There is also a graphics configuration (mxtxplnd), a
a configuration for network testing (netnsh), a graphics demo (nxwm), and
a sample protected mode build (<code class="docutils literal notranslate"><span class="pre">knsh</span></code>).  There are still open issues that need
to be resolved.  General problems are listed below.  But see the STATUS
section associated with each configuration for additional issues specific
to a particular configuration.</p>
<blockquote>
<div><blockquote>
<div><ol class="arabic">
<li><p>HSCMI. CONFIG_MMCSD_MULTIBLOCK_LIMIT=1 is set to disable multi-block
transfers only because I have not yet had a chance to verify this.  The
is very low priority to me but might be important to you if you are need
very high performance SD card accesses.</p></li>
<li><p>There may also be some issues with removing and re-inserting SD cards
(of course with appropriate mounting and unmounting).  I all not sure
of this and need to do more testing to characterize if the issue.</p></li>
<li><p>There is a port of the SAMA5D4-EK Ethernet driver to the SAMV71-XULT.
This driver appears to be 100% functional with the following caveats:</p>
<ul>
<li><p>There is a compiler optimization issue.  At -O2, there is odd
behavior on pings and ARP messages.  But the behavior is OK with
optimization set to -O2.  This may or may not be a compiler
optimization issue (it could also be a timing issue or a need
for some additional volatile qualifiers).</p>
<p>Update: I have switch toolchains and no longer see this issue.  This
is probably not a driver-related issue.</p>
</li>
<li><p>I- and D-Caches are enabled but the D-Cache must be enabled in
write-through mode.  This is to work around issues with the RX and TX
descriptors with are 8-bytes in size.  But the D-Cache cache line size
is 32-bytes.  That means that you cannot reload, clean or invalidate a
descriptor without also effecting three neighboring descriptors.
Setting write through mode eliminates the need for cleaning the D-Cache.
If only reloading and invalidating are done, then there is no problem.</p></li>
</ul>
</li>
<li><p>The USBHS device controller driver (DCD) is also fully functional.  It
has only be tested with the CDC/ACM driver as described below. Like
the Ethernet driver:</p>
<ul class="simple">
<li><p>This driver does not work reliably with the write back D-Cache.  The
write-through D-Cache must be enabled.</p></li>
<li><p>As of this writing (2015-08-22), the USBHS only works in full speed
mode (aka, USBHS Low-Power mode).  When configured in normal mode,
SETUP packets are no longer received or responded to; the firmware
only detects bus reset events.  This is probably some issue with
480MHZ high speed clock setup, but I have not yet found the issue.</p></li>
</ul>
</li>
<li><p>The full port for audio support is code complete:  WM8904 driver,
SSC/I2C driver, and CS2100-CP driver.  But this code is untested.  The
WM8904 interface was taken directly from the SAMA5D4-EK and may well
need modification due to differences with the physical WM8904
interface.</p></li>
<li><p>An MCAN driver as added and verified on 2015-08-08 using the loopback
test at apps/examples/can.  Like the Ethernet driver, the MCAN driver
does not work if the D-Cache is configured in write-back mode; write-
through mode is required.</p></li>
<li><p>An SPI slave driver as added on 2015-08-09 but has not been verified
as of this writing. See discussion in include/nuttx/spi/slave.h and
in the section entitle “SPI Slave” below.</p></li>
<li><p>A QSPI FLASH driver was added and verified on 2015-11-10.  This driver
operated in the memory mapped Serial Memory Mode (SMM).  See the
“S25FL116K QuadSPI FLASH” section below for further information.</p></li>
<li><p>On-chip FLASH support as added and verified on 2015-11-13.  See the
“Program FLASH Access” section below for further information.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>The knsh “protected mode” configuration was added on 2015-11-18.  The
configuration has not been tested as of this writing.</p></li>
</ol>
</div></blockquote>
</section>
<section id="serial-console">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Serial Console</a><a class="headerlink" href="#serial-console" title="Permalink to this heading"></a></h2>
<p>The SAMV71-XULT has no on-board RS-232 drivers so it will be necessary to
use either the VCOM or an external RS-232 driver.  Here are some options.</p>
<blockquote>
<div><ul>
<li><p>VCOM.  The Virtual Com Port gateway is available on USART1 and it is the
default console.  Besides PB04 is by default connected to debug pin TDI,
both JTAG port and EDBG can only be used in SWD mode in this board.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>SAMV71 Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PB04</p></td>
<td><p>TXD1</p></td>
</tr>
<tr class="row-odd"><td><p>PA21</p></td>
<td><p>RXD1</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>Arduino Serial Shield:  One option is to use an Arduino-compatible
serial shield.  This will use the RXD and TXD signals available at pins
0 an 1, respectively, of the Arduino “Digital Low” connector.  On the
SAMV71-XULT board, this corresponds to UART3:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pin on J503</p></th>
<th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>Arduino Name</p></th>
<th class="head"><p>Arduino Pin</p></th>
<th class="head"><p>SAMV71 Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>PD28</p></td>
<td><p>RX0</p></td>
<td><p>0</p></td>
<td><p>URXD3</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>PD30</p></td>
<td><p>TX0</p></td>
<td><p>1</p></td>
<td><p>UTXD3</p></td>
</tr>
</tbody>
</table>
<p>In this configuration, an external RS232 driver can also be used
instead of the shield.  Simply connect as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Arduino Pin Label</p></th>
<th class="head"><p>RS-232 Connection</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>D0 (RXD)</p></td>
<td><p>RX</p></td>
</tr>
<tr class="row-odd"><td><p>D1 (TXD)</p></td>
<td><p>TX</p></td>
</tr>
<tr class="row-even"><td><p>GND</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><p>5VO</p></td>
<td><p>Vcc</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>Arduino Communications.  Additional UART/USART connections are available
on the Arduino Communications connection J505:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pin on J503</p></th>
<th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>Arduino Name</p></th>
<th class="head"><p>Arduino Pin</p></th>
<th class="head"><p>SAMV71 Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3</p></td>
<td><p>PD18</p></td>
<td><p>RX1</p></td>
<td><p>0</p></td>
<td><p>URXD4</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>PD19</p></td>
<td><p>TX1</p></td>
<td><p>0</p></td>
<td><p>UTXD4</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>PD15</p></td>
<td><p>RX2</p></td>
<td><p>0</p></td>
<td><p>RXD2</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>PD16</p></td>
<td><p>TX2</p></td>
<td><p>0</p></td>
<td><p>TXD2</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>PB0</p></td>
<td><p>RX3</p></td>
<td><p>0</p></td>
<td><p>RXD0</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>PB1</p></td>
<td><p>TX3</p></td>
<td><p>1</p></td>
<td><p>TXD0</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>SAMV7-XULT EXTn connectors.  USART pins are also available the EXTn
connectors.  The following are labelled in the User Guide for USART
functionality:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EXT1 Pin</p></th>
<th class="head"><p>EXTI1 Name</p></th>
<th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>SAMV71 Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>13</p></td>
<td><p>USART_RX</p></td>
<td><p>PB00</p></td>
<td><p>RXD0</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>USART_TX</p></td>
<td><p>PB01</p></td>
<td><p>TXD0</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EXT2 Pin</p></th>
<th class="head"><p>EXTI2 Name</p></th>
<th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>SAMV71 Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>13</p></td>
<td><p>USART_RX</p></td>
<td><p>PA21</p></td>
<td><p>RXD1</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>USART_TX</p></td>
<td><p>PB04</p></td>
<td><p>TXD1</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<p>Any of these options can be selected as the serial console by:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Enabling the UART/USART peripheral in the
<code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">Peripheral</span> <span class="pre">Selection</span></code> menu, then</p></li>
<li><p>Configuring the peripheral in the <code class="docutils literal notranslate"><span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">Serial</span> <span class="pre">Configuration</span></code>
menu.</p></li>
</ol>
</div></blockquote>
</section>
<section id="sd-card">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">SD Card</a><a class="headerlink" href="#sd-card" title="Permalink to this heading"></a></h2>
<section id="card-slot">
<h3>Card Slot<a class="headerlink" href="#card-slot" title="Permalink to this heading"></a></h3>
<p>The SAM V71 Xplained Ultra has one standard SD card connector which is
connected to the High Speed Multimedia Card Interface (HSMCI) of the SAM
V71. SD card connector:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAMV71 Pin</p></th>
<th class="head"><p>SAMV71 Function</p></th>
<th class="head"><p>Shared functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PA30</p></td>
<td><p>MCDA0 (DAT0)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>PA31</p></td>
<td><p>MCDA1 (DAT1)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PA26</p></td>
<td><p>MCDA2 (DAT2)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>PA27</p></td>
<td><p>MCDA3 (DAT3)</p></td>
<td><p>Camera</p></td>
</tr>
<tr class="row-even"><td><p>PA25</p></td>
<td><p>MCCK (CLK)</p></td>
<td><p>Shield</p></td>
</tr>
<tr class="row-odd"><td><p>PA28</p></td>
<td><p>MCCDA (CMD)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PD18</p></td>
<td><p>Card Detect (C/D)</p></td>
<td><p>Shield</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="configuration-settings">
<h3>Configuration Settings<a class="headerlink" href="#configuration-settings" title="Permalink to this heading"></a></h3>
<p>Enabling HSMCI support. The SAMV7-XULT provides a one, full-size SD memory card slots.
The full size SD card slot connects via HSMCI0.  Support for the SD slots can be
enabled with the following settings:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type-&gt;SAMV7</span> <span class="pre">Peripheral</span> <span class="pre">Selection</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_HSMCI0=y                 : To enable HSMCI0 support
CONFIG_SAMV7_XDMAC=y                  : XDMAC is needed by HSMCI0/1
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_GPIO_IRQ=y               : PIO interrupts needed
CONFIG_SAMV7_GPIOD_IRQ=y              : Card detect pin is on PD18
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">MMC/SD</span> <span class="pre">Driver</span> <span class="pre">Support</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MMCSD=y                        : Enable MMC/SD support
CONFIG_MMSCD_NSLOTS=1                 : One slot per driver instance
CONFIG_MMCSD_MULTIBLOCK_LIMIT=1     : (REVISIT)
CONFIG_MMCSD_HAVE_CARDDETECT=y         : Supports card-detect PIOs
CONFIG_MMCSD_MMCSUPPORT=n             : Interferes with some SD cards
CONFIG_MMCSD_SPI=n                    : No SPI-based MMC/SD support
CONFIG_MMCSD_SDIO=y                   : SDIO-based MMC/SD support
CONFIG_SDIO_DMA=y                     : Use SDIO DMA
CONFIG_SDIO_BLOCKSETUP=y              : Needs to know block sizes
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RTOS</span> <span class="pre">Features</span> <span class="pre">-&gt;</span> <span class="pre">Work</span> <span class="pre">Queue</span> <span class="pre">Support</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SCHED_WORKQUEUE=y              : Driver needs work queue support
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">NSH</span> <span class="pre">Library</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NSH_ARCHINIT=y                 : NSH board-initialization, OR
CONFIG_BOARD_LATE_INITIALIZE=y
</pre></div>
</div>
</div></blockquote>
</section>
<section id="using-the-sd-card">
<h3>Using the SD card<a class="headerlink" href="#using-the-sd-card" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>After booting, the HSCMI device will appear as <code class="docutils literal notranslate"><span class="pre">/dev/mmcsd0</span></code>.</p></li>
<li><p>If you try mounting an SD card with nothing in the slot, the mount will
fail:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t vfat /dev/mmcsd0 /mnt/sd0
nsh: mount: mount failed: 19
</pre></div>
</div>
<p>NSH can be configured to provide errors as strings instead of
numbers.  But in this case, only the error number is reported.  The
error numbers can be found in <code class="docutils literal notranslate"><span class="pre">nuttx/include/errno.h</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define ENODEV              19
#define ENODEV_STR          &quot;No such device&quot;
</pre></div>
</div>
<p>So the mount command is saying that there is no device or, more
correctly, that there is no card in the SD card slot.</p>
</li>
<li><p>Inserted the SD card.  Then the mount should succeed.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t vfat /dev/mmcsd0 /mnt/sd0
nsh&gt; ls /mnt/sd1
/mnt/sd1:
 atest.txt
nsh&gt; cat /mnt/sd1/atest.txt
This is a test
</pre></div>
</div>
<p>NOTE:  See the next section entitled “Auto-Mounter” for another way
to mount your SD card.</p>
</li>
<li><p>Before removing the card, you must umount the file system.  This is
equivalent to “ejecting” or “safely removing” the card on Windows:  It
flushes any cached data to an SD card and makes the SD card unavailable
to the applications.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; umount -t /mnt/sd0
</pre></div>
</div>
<p>It is now safe to remove the card.  NuttX provides into callbacks
that can be used by an application to automatically unmount the
volume when it is removed.  But those callbacks are not used in
these configurations.</p>
</li>
</ol>
</section>
</section>
<section id="auto-mounter">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Auto-Mounter</a><a class="headerlink" href="#auto-mounter" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>NuttX implements an auto-mounter than can make working with SD cards
easier.  With the auto-mounter, the file system will be automatically
mounted when the SD card is inserted into the HSMCI slot and automatically
unmounted when the SD card is removed.</p>
<p>Here is a sample configuration for the auto-mounter:</p>
<blockquote>
<div><p>File System Configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_FS_AUTOMOUNTER=y
</pre></div>
</div>
<p>Board-Specific Options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_HSMCI0_AUTOMOUNT=y
CONFIG_SAMV7_HSMCI0_AUTOMOUNT_FSTYPE=&quot;vfat&quot;
CONFIG_SAMV7_HSMCI0_AUTOMOUNT_BLKDEV=&quot;/dev/mmcsd0&quot;
CONFIG_SAMV7_HSMCI0_AUTOMOUNT_MOUNTPOINT=&quot;/mnt/sdcard&quot;
CONFIG_SAMV7_HSMCI0_AUTOMOUNT_DDELAY=1000
CONFIG_SAMV7_HSMCI0_AUTOMOUNT_UDELAY=2000
</pre></div>
</div>
</div></blockquote>
<p>WARNING:  SD cards should never be removed without first unmounting
them.  This is to avoid data and possible corruption of the file
system.  Certainly this is the case if you are writing to the SD card
at the time of the removal.  If you use the SD card for read-only access,
however, then I cannot think of any reason why removing the card without
mounting would be harmful.</p>
</div></blockquote>
</section>
<section id="leds-and-buttons">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">LEDs and Buttons</a><a class="headerlink" href="#leds-and-buttons" title="Permalink to this heading"></a></h2>
<section id="leds">
<h3>LEDs<a class="headerlink" href="#leds" title="Permalink to this heading"></a></h3>
<p>There are two yellow LED available on the SAM V71 Xplained Ultra board that
can be turned on and off.  The LEDs can be activated by driving the
connected I/O line to GND.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Shared functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PA23</p></td>
<td><p>Yellow LED0</p></td>
<td><p>EDBG GPIO</p></td>
</tr>
<tr class="row-odd"><td><p>PC09</p></td>
<td><p>Yellow LED1</p></td>
<td><p>LCD, and Shield</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>These LEDs are not used by the board port unless <code class="docutils literal notranslate"><span class="pre">CONFIG_ARCH_LEDS</span></code> is
defined.  In that case, the usage by the board port is defined in
<code class="docutils literal notranslate"><span class="pre">include/board.h</span></code> and <code class="docutils literal notranslate"><span class="pre">src/sam_autoleds.c</span></code>. The LEDs are used to encode
OS-related events as follows:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>SYMBOL</p></th>
<th class="head" rowspan="2"><p>Meaning</p></th>
<th class="head" colspan="2"><p>LED state</p></th>
</tr>
<tr class="row-even"><th class="head"><p>LED0</p></th>
<th class="head"><p>LED1</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>LED_STARTED</p></td>
<td><p>NuttX has been started</p></td>
<td><p>OFF</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>LED_HEAPALLOCATE</p></td>
<td><p>Heap has been allocated</p></td>
<td><p>OFF</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>LED_IRQSENABLED</p></td>
<td><p>Interrupts enabled</p></td>
<td><p>OFF</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>LED_STACKCREATED</p></td>
<td><p>Idle stack created</p></td>
<td><p>ON</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>LED_INIRQ</p></td>
<td><p>In an interrupt</p></td>
<td colspan="2"><p>No change</p></td>
</tr>
<tr class="row-even"><td><p>LED_SIGNAL</p></td>
<td><p>In a signal handler</p></td>
<td colspan="2"><p>No change</p></td>
</tr>
<tr class="row-odd"><td><p>LED_ASSERTION</p></td>
<td><p>An assertion failed</p></td>
<td colspan="2"><p>No change</p></td>
</tr>
<tr class="row-even"><td><p>LED_PANIC</p></td>
<td><p>The system has crashed</p></td>
<td><p>N/C</p></td>
<td><p>Blinking</p></td>
</tr>
<tr class="row-odd"><td><p>LED_IDLE</p></td>
<td><p>MCU is is sleep mode</p></td>
<td colspan="2"><p>Not used</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Thus if LED0 is statically on, NuttX has successfully booted and is,
apparently, running normally.  If LED1 is flashing at approximately
2Hz, then a fatal error has been detected and the system has halted.</p>
<p>NOTE: That LED0 is not used after completion of booting and may
be used by other board-specific logic.</p>
</section>
<section id="buttons">
<h3>Buttons<a class="headerlink" href="#buttons" title="Permalink to this heading"></a></h3>
<p>SAM V71 Xplained Ultra contains three mechanical buttons. One button is the
RESET button connected to the SAM V71 reset line and the others are generic
user configurable buttons. When a button is pressed it will drive the I/O
line to GND.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAMV71 PIO</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Shared functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RESET</p></td>
<td><p>RESET</p></td>
<td><p>Trace, Shield, and EDBG</p></td>
</tr>
<tr class="row-odd"><td><p>PA09</p></td>
<td><p>SW0</p></td>
<td><p>EDBG GPIO and Camera</p></td>
</tr>
<tr class="row-even"><td><p>PB12</p></td>
<td><p>SW1</p></td>
<td><p>EDBG SWD and Chip Erase</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>NOTES:</p>
<blockquote>
<div><ul class="simple">
<li><p>There are no pull-up resistors connected to the generic user buttons so
it is necessary to enable the internal pull-up in the SAM V71 to use the
button.</p></li>
<li><p>PB12 is set up as a system flash ERASE pin when the firmware boots. To
use the SW1, PB12 has to be configured as a normal regular I/O pin in
the MATRIX module. For more information see the SAM V71 datasheet.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="at24mac402-serial-eeprom">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">AT24MAC402 Serial EEPROM</a><a class="headerlink" href="#at24mac402-serial-eeprom" title="Permalink to this heading"></a></h2>
<section id="ethernet-mac-address">
<h3>Ethernet MAC Address<a class="headerlink" href="#ethernet-mac-address" title="Permalink to this heading"></a></h3>
<p>The SAM V71 Xplained Ultra features one external AT24MAC402 serial EEPROM
with a EIA-48 MAC address connected to the SAM V71 through I2C. This device
contains a MAC address for use with the Ethernet interface.</p>
<p>Connectivity:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAMV71 Pin</p></th>
<th class="head"><p>SAMV71 Function</p></th>
<th class="head"><p>I2C Function</p></th>
<th class="head"><p>Shared Functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PA03</p></td>
<td><p>TWID0</p></td>
<td><p>SDA</p></td>
<td><p>EXT1, EXT2, EDBG I2C, LCD, Camera, Audio, MediaLB, and Shield</p></td>
</tr>
<tr class="row-odd"><td><p>PA04</p></td>
<td><p>TWICK0</p></td>
<td><p>SCL</p></td>
<td><p>EXT1, EXT2, EDBG I2C, LCD, Camera, Audio, MediaLB, and Shield</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>I2C address:</p>
<blockquote>
<div><p>The 7-bit addresses of the AT24 part are <code class="docutils literal notranslate"><span class="pre">0b1010aaa</span></code> for the normal 2Kbit
memory and <code class="docutils literal notranslate"><span class="pre">0b1011aaa</span></code> for the “extended memory” where <code class="docutils literal notranslate"><span class="pre">aaa</span></code> is the state of
the A0, A1, and A3 pins on the part.  On the SAMV71-XULT board, these
are all pulled high so the full, 7-bit address is <code class="docutils literal notranslate"><span class="pre">0x5f</span></code>.</p>
</div></blockquote>
</section>
<section id="config">
<h3>Config<a class="headerlink" href="#config" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>System Type -&gt; SAMV7 Peripheral Support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_TWIHS0=y                : Used to access the EEPROM
CONFIG_SAMV7_TWIHS0_FREQUENCY=100000
</pre></div>
</div>
<p>Device drivers -&gt; Memory Technology Devices:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MTD_AT24XX=y                  : Enable the AT24 device driver
CONFIG_AT24XX_SIZE=2                 : Normal EEPROM is 2Kbit (256b)
CONFIG_AT24XX_ADDR=0x57              : Normal EEPROM address
CONFIG_AT24XX_EXTENDED=y             : Supports an extended memory region
CONFIG_AT24XX_EXTSIZE=160            : Extended address up to 0x9f
</pre></div>
</div>
</div></blockquote>
</section>
<section id="mtd-configuration-data">
<h3>MTD Configuration Data<a class="headerlink" href="#mtd-configuration-data" title="Permalink to this heading"></a></h3>
<p>The AT24 EEPROM can also be used to storage of up to 256 bytes of
configuration data:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">drivers</span> <span class="pre">-&gt;</span> <span class="pre">Memory</span> <span class="pre">Technology</span> <span class="pre">Devices</span></code></p>
</div></blockquote>
<p>The configuration data device will appear at <code class="docutils literal notranslate"><span class="pre">/dev/config</span></code>.</p>
</section>
</section>
<section id="s25fl116k-quadspi-flash">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">S25FL116K QuadSPI FLASH</a><a class="headerlink" href="#s25fl116k-quadspi-flash" title="Permalink to this heading"></a></h2>
<p>A QSPI FLASH driver was added and verified on 2015-11-07.  This driver
operated in the memory mapped Serial Memory Mode (SMM).  These
configuration options were enabled to test QSPI:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_QSPI=y
CONFIG_SAMV7_QSPI_DLYBCT=0
CONFIG_SAMV7_QSPI_DLYBS=0
CONFIG_SAMV7_QSPI_DMA=y
CONFIG_SAMV7_QSPI_DMATHRESHOLD=8
</pre></div>
</div>
<p>The MPU must be enabled to use QSPI:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARCH_USE_MPU=y
CONFIG_ARM_MPU=y
CONFIG_ARM_MPU_NREGIONS=16
</pre></div>
</div>
<p>And there options enable the driver for the on-board S25FL116K QuadSPI
FLASH:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MTD_S25FL1=y
CONFIG_S25FL1_QSPIMODE=0
CONFIG_S25FL1_QSPI_FREQUENCY=108000000
</pre></div>
</div>
<section id="smartfs">
<h3>SmartFS<a class="headerlink" href="#smartfs" title="Permalink to this heading"></a></h3>
<p>The SmartFS file system is selected with the following settings.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_FS_SMARTFS=y
CONFIG_SMARTFS_ERASEDSTATE=0xff
CONFIG_SMARTFS_MAXNAMLEN=16

CONFIG_MTD_SMART=y
CONFIG_MTD_SMART_SECTOR_SIZE=512
CONFIG_MTD_SMART_WEAR_LEVEL=y
</pre></div>
</div>
<p>Upon boot, the on-board S25FL116k flash device will appears as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/dev/smart0
</pre></div>
</div>
<p>Before SmartFS can be used, it must be formatted. So this command
must be used one time the first time that the system boots:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mksmartfs /dev/smart0
</pre></div>
</div>
<p>Then it can be mounted using the following NSH command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t smartfs /dev/smart0 /mnt/qspi
</pre></div>
</div>
<p>The first time that you boot the system, there will be a long delay
before the <code class="docutils literal notranslate"><span class="pre">nsh&gt;</span></code> prompt.  That long delay is SmartFS scanning the
large FLASH part.  Likewise, the when you format the SmartFS, you
also expect a significant delay.</p>
<p>A better application design would perform SmartFS initialization
asynchronously on a separate thread to avoid the delay at the user
interface.</p>
</section>
<section id="nxffs">
<h3>NXFFS<a class="headerlink" href="#nxffs" title="Permalink to this heading"></a></h3>
<p>The NXFFS file system is selected with the following settings.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_FS_NXFFS=y
CONFIG_NXFFS_ERASEDSTATE=0xff
CONFIG_NXFFS_MAXNAMLEN=255
CONFIG_NXFFS_PACKTHRESHOLD=32
CONFIG_NXFFS_PREALLOCATED=y
CONFIG_NXFFS_TAILTHRESHOLD=8192
</pre></div>
</div>
<p>The NXFFS file system is automatically mounted by logic <code class="docutils literal notranslate"><span class="pre">src/sam_bringup.c</span></code> when the system boots:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount
  /mnt/s25fl1 type nxffs
nsh&gt; echo &quot;This is a test&quot; &gt;/mnt/s25fl1/atest.txt
nsh&gt; ls /mnt/s25fl1
/mnt/s25fl1:
 atest.txt
nsh&gt; cat /mnt/s25fl1/atest.txt
This is a test
</pre></div>
</div>
</section>
<section id="character-driver">
<h3>Character Driver<a class="headerlink" href="#character-driver" title="Permalink to this heading"></a></h3>
<p>If neither SmartFS nor NXFFS are defined, then the S25FL1 driver will be
wrapped as a character driver and available as <code class="docutils literal notranslate"><span class="pre">/dev/mtd0</span></code>.</p>
</section>
</section>
<section id="program-flash-access">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Program FLASH Access</a><a class="headerlink" href="#program-flash-access" title="Permalink to this heading"></a></h2>
<p>An on-chip FLASH driver was added and verified on 2015-11-13.  These
configuration options were enabled to test the on-chip FLASH support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MTD_PROGMEM=y
CONFIG_ARCH_RAMFUNCS=y
CONFIG_SAMV7_PROGMEM=y
CONFIG_SAMV7_PROGMEM_NSECTORS=8
</pre></div>
</div>
<p>D-Cache must be configured in write-through mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARMV7M_DCACHE_WRITETHROUGH=y
</pre></div>
</div>
<p>The total FLASH on the SAMV71 is organized as 128KB/sector x 16 sectors
= 2MB.  The sectors are all uniform (except for sector zero which will
never be used by the driver).</p>
<p>The configuration sets aside 8 sectors, or 8 * 128KB = 1MB of the FLASH
for programmable memory (<code class="docutils literal notranslate"><span class="pre">CONFIG_SAMV7_PROGMEM_NSECTORS=8</span></code>).  The exact
number of sectors set aside is optional.</p>
<p>NOTE: Ideally, one should also modify the linker script and reduce the size
of the available FLASH the amount set aside for program usage to avoid
difficult run-time problems.  That would be 1MB in this configuration.  I
did not do that only because I know that my test program is small.</p>
<p>When the system boots, you can see the FLASH driver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NuttShell (NSH) NuttX-7.12
nsh&gt; ls /dev
/dev:
 config
 console
 mmcsd0
 mtd1
 mtdblock1
 null
 ttyS0
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/dev/mtdblock1</span></code> is a block driver that can be used with any file system on
the FLASH; <code class="docutils literal notranslate"><span class="pre">/dev/mtd1</span></code> is the corresponding character driver used by the
<code class="docutils literal notranslate"><span class="pre">apps/examples/media</span></code> test.</p>
<p>Each of the uniform sectors is divided up into 256 512B “pages”.  This is
not really useful, however, because we can only erase a minimum of groups
of 16 pages or 8KB.  In the code, I you will see that I refer to these
groups of 16 pages as “clusters.”  So the cluster is the smallest thing
that you can perform a read/write/modify operation on.</p>
<p>Using 8 sectors yields 16 * 8 = 128 clusters (aka blocks).  You can see
this when the <code class="docutils literal notranslate"><span class="pre">apps/examples/media</span></code> test runs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; media
MTD Geometry:
  blocksize:    8192
  erasesize:    8192
  neraseblocks: 128
Using:
  blocksize:    8192
  nblocks:      128
Write/Verify: Block 0
Write/Verify: Block 1
Write/Verify: Block 2
Write/Verify: Block 3
...
Write/Verify: Block 127
Re-read/Verify: Block 0
Re-read/Verify: Block 1
Re-read/Verify: Block 2
Re-read/Verify: Block 3
...
Re-read/Verify: Block 127
nsh&gt;
</pre></div>
</div>
<p>NOTE: The media test can be added to the NSH configuration with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_MEDIA=y
CONFIG_EXAMPLES_MEDIA_BLOCKSIZE=8192
CONFIG_EXAMPLES_MEDIA_DEVPATH=&quot;/dev/mtd1&quot;
</pre></div>
</div>
</section>
<section id="networking">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Networking</a><a class="headerlink" href="#networking" title="Permalink to this heading"></a></h2>
<section id="ksz8061rnbva-connections">
<h3>KSZ8061RNBVA Connections<a class="headerlink" href="#ksz8061rnbva-connections" title="Permalink to this heading"></a></h3>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAMV71 Pin</p></th>
<th class="head"><p>SAMV71 Function</p></th>
<th class="head"><p>Ethernet Function</p></th>
<th class="head"><p>Shared functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PD00</p></td>
<td><p>GTXCK</p></td>
<td><p>REF_CLK</p></td>
<td><p>Shield</p></td>
</tr>
<tr class="row-odd"><td><p>PD01</p></td>
<td><p>GTXEN</p></td>
<td><p>TXEN</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PD02</p></td>
<td><p>GTX0</p></td>
<td><p>TXD0</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>PD03</p></td>
<td><p>GTX1</p></td>
<td><p>TXD1</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PD04</p></td>
<td><p>GRXDV</p></td>
<td><p>CRS_DV</p></td>
<td><p>Trace</p></td>
</tr>
<tr class="row-odd"><td><p>PD05</p></td>
<td><p>GRX0</p></td>
<td><p>RXD0</p></td>
<td><p>Trace</p></td>
</tr>
<tr class="row-even"><td><p>PD06</p></td>
<td><p>GRX1</p></td>
<td><p>RXD1</p></td>
<td><p>Trace</p></td>
</tr>
<tr class="row-odd"><td><p>PD07</p></td>
<td><p>GRXER</p></td>
<td><p>RXER</p></td>
<td><p>Trace</p></td>
</tr>
<tr class="row-even"><td><p>PD08</p></td>
<td><p>GMDC</p></td>
<td><p>MDC</p></td>
<td><p>Trace</p></td>
</tr>
<tr class="row-odd"><td><p>PD09</p></td>
<td><p>GMDIO</p></td>
<td><p>MDIO</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PA19</p></td>
<td><p>GPIO</p></td>
<td><p>INTERRUPT</p></td>
<td><p>EXT1, Shield</p></td>
</tr>
<tr class="row-odd"><td><p>PA29</p></td>
<td><p>GPIO</p></td>
<td><p>SIGDET</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PC10</p></td>
<td><p>GPIO</p></td>
<td><p>RESET</p></td>
<td></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="selecting-the-gmac-peripheral">
<h3>Selecting the GMAC peripheral<a class="headerlink" href="#selecting-the-gmac-peripheral" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>System Type -&gt; SAMV7 Peripheral Support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_EMAC0=y                 : Enable the GMAC peripheral (aka, EMAC0)
CONFIG_SAMV7_TWIHS0=y                : We will get the MAC address from the AT24 EEPROM
CONFIG_SAMV7_TWIHS0_FREQUENCY=100000
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">EMAC</span> <span class="pre">device</span> <span class="pre">driver</span> <span class="pre">options</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_EMAC0_NRXBUFFERS=16     : Set aside some RS and TX buffers
CONFIG_SAMV7_EMAC0_NTXBUFFERS=8
CONFIG_SAMV7_EMAC0_RMII=y            : The RMII interfaces is used on the board
CONFIG_SAMV7_EMAC0_AUTONEG=y         : Use autonegotiation
CONFIG_SAMV7_EMAC0_PHYADDR=1         : KSZ8061 PHY is at address 1
CONFIG_SAMV7_EMAC0_PHYSR=30          : Address of PHY status register on KSZ8061
CONFIG_SAMV7_EMAC0_PHYSR_ALTCONFIG=y : Needed for KSZ8061
CONFIG_SAMV7_EMAC0_PHYSR_ALTMODE=0x7 : &quot;    &quot; &quot; &quot; &quot;     &quot;
CONFIG_SAMV7_EMAC0_PHYSR_10HD=0x1    : &quot;    &quot; &quot; &quot; &quot;     &quot;
CONFIG_SAMV7_EMAC0_PHYSR_100HD=0x2   : &quot;    &quot; &quot; &quot; &quot;     &quot;
CONFIG_SAMV7_EMAC0_PHYSR_10FD=0x5    : &quot;    &quot; &quot; &quot; &quot;     &quot;
CONFIG_SAMV7_EMAC0_PHYSR_100FD=0x6   : &quot;    &quot; &quot; &quot; &quot;     &quot;
</pre></div>
</div>
<p>PHY selection.  Later in the configuration steps, you will need to select
the KSZ8061 PHY for EMAC (See below)</p>
<p><code class="docutils literal notranslate"><span class="pre">Networking</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NET=y                         : Enable Neworking
CONFIG_NET_SOCKOPTS=y                : Enable socket operations
CONFIG_NET_ETH_PKTSIZE=562           : Maximum packet size 1518 is more standard
CONFIG_NET_ARP=y                     : ARP support should be enabled
CONFIG_NET_ARP_SEND=y                : Use ARP to get peer address before sending
CONFIG_NET_TCP=y                     : Enable TCP/IP networking
CONFIG_NET_TCPBACKLOG=y              : Support TCP/IP backlog
CONFIG_NET_TCP_WRITE_BUFFERS=y       : Enable TCP write buffering
CONFIG_NET_UDP=y                     : Enable UDP networking
CONFIG_NET_BROADCAST=y               : Support UDP broadcast packets
CONFIG_NET_ICMP=y                    : Enable ICMP networking
CONFIG_NET_ICMP_SOCKET=y             : Needed for NSH ping command
                                     : Defaults should be okay for other options
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">drivers</span> <span class="pre">-&gt;</span> <span class="pre">Network</span> <span class="pre">Device/PHY</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NETDEVICES=y                  : Enabled PHY selection
CONFIG_ETH0_PHY_KSZ8061=y            : Select the KSZ8061 PHY used with EMAC0
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">drivers</span> <span class="pre">-&gt;</span> <span class="pre">Memory</span> <span class="pre">Technology</span> <span class="pre">Devices</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MTD_AT24XX=y                  : Enable the AT24 device driver
CONFIG_AT24XX_SIZE=2                 : Normal EEPROM is 2Kbit (256b)
CONFIG_AT24XX_ADDR=0x57              : Normal EEPROM address */
CONFIG_AT24XX_EXTENDED=y             : Supports an extended memory region
CONFIG_AT24XX_EXTSIZE=160            : Extended address up to 0x9f
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RTOS</span> <span class="pre">Features</span> <span class="pre">-&gt;</span> <span class="pre">Work</span> <span class="pre">Queue</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SCHED_WORKQUEUE=y             : Work queue support is needed
CONFIG_SCHED_HPWORK=y
CONFIG_SCHED_HPWORKSTACKSIZE=2048    : Might need to be increased
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">Network</span> <span class="pre">Utilities</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NETDB_DNSCLIENT=y             : Enable host address resolution
CONFIG_NETUTILS_TELNETD=y            : Enable the Telnet daemon
CONFIG_NETUTILS_TFTPC=y              : Enable TFTP data file transfers for get and put commands
CONFIG_NETUTILS_NETLIB=y             : Network library support is needed
CONFIG_NETUTILS_WEBCLIENT=y          : Needed for wget support
                                     : Defaults should be okay for other options
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">NSH</span> <span class="pre">Library</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NSH_TELNET=y                  : Enable NSH session via Telnet
CONFIG_NSH_IPADDR=0x0a000002         : Select an IP address
CONFIG_NSH_DRIPADDR=0x0a000001       : IP address of gateway/host PC
CONFIG_NSH_NETMASK=0xffffff00        : Netmask
CONFIG_NSH_NOMAC=n                   : We will get the IP address from EEPROM
                                     : Defaults should be okay for other options
</pre></div>
</div>
</div></blockquote>
</section>
<section id="samv71-versions">
<h3>SAMV71 Versions<a class="headerlink" href="#samv71-versions" title="Permalink to this heading"></a></h3>
<p>WARNING: The newer SAMV71 have 6 GMAC queues, not 3. All queues must be
configured for the GMAC to work correctly, even the queues that you are not
using (you can just configure these queues with a very small ring buffer.)</p>
<p>The older uses the Cortex-M7 core r0p1 and the newer r1p1 revisions.  The
SAMV71 revisions are called “rev A” (or sometimes “MRLA”) and “rev B”
(“MRLB”). There should be a small “A” or “B” on the chip package just below
the reference and you can also differentiate them at runtime with the
VERSION field in the CHIPID CIDR register.</p>
</section>
<section id="cache-related-issues">
<h3>Cache-Related Issues<a class="headerlink" href="#cache-related-issues" title="Permalink to this heading"></a></h3>
<p>I- and D-Caches can be enabled but the D-Cache must be enabled in write-
through mode.  This is to work around issues with the RX and TX descriptors
which are 8-bytes in size.  But the D-Cache cache line size is 32-bytes.
That means that you cannot reload, clean or invalidate a descriptor without
also affecting three neighboring descriptors.  Setting write through mode
eliminates the need for cleaning the D-Cache.  If only reloading and
invalidating are done, then there is no problem.</p>
</section>
<section id="using-the-network-with-nsh">
<h3>Using the network with NSH<a class="headerlink" href="#using-the-network-with-nsh" title="Permalink to this heading"></a></h3>
<p>So what can you do with this networking support?  First you see that
NSH has several new network related commands:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ifconfig</span></code>, <code class="docutils literal notranslate"><span class="pre">ifdown</span></code>, <code class="docutils literal notranslate"><span class="pre">ifup</span></code>: Commands to help manage your network</p>
<p><code class="docutils literal notranslate"><span class="pre">get</span></code> and <code class="docutils literal notranslate"><span class="pre">put</span></code>: TFTP file transfers</p>
<p><code class="docutils literal notranslate"><span class="pre">wget</span></code>: HTML file transfers</p>
<p><code class="docutils literal notranslate"><span class="pre">ping</span></code>: Check for access to peers on the network</p>
<p>Telnet console: You can access the NSH remotely via telnet.</p>
</div></blockquote>
<p>You can also enable other add on features like full FTP or a Web
Server or XML RPC and others.  There are also other features that
you can enable like DHCP client (or server) or network name
resolution.</p>
<p>By default, the IP address of the SAMV71-XULT will be 10.0.0.2 and
it will assume that your host is the gateway and has the IP address
10.0.0.1.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; ifconfig
eth0    HWaddr 00:e0:de:ad:be:ef at UP
        IPaddr:10.0.0.2 DRaddr:10.0.0.1 Mask:255.255.255.0
</pre></div>
</div>
<p>You can use ping to test for connectivity to the host (Careful,
Window firewalls usually block ping-related ICMP traffic).  On the
target side, you can:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; ping 10.0.0.1
PING 10.0.0.1 56 bytes of data
56 bytes from 10.0.0.1: icmp_seq=1 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=2 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=3 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=4 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=5 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=6 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=7 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=8 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=9 time=0 ms
56 bytes from 10.0.0.1: icmp_seq=10 time=0 ms
10 packets transmitted, 10 received, 0% packet loss, time 10100 ms
</pre></div>
</div>
<p>NOTE: In this configuration is is normal to have packet loss &gt; 0%
the first time you ping due to the default handling of the ARP
table.</p>
<p>On the host side, you should also be able to ping the SAMV71-XULT:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ping 10.0.0.2
</pre></div>
</div>
<p>You can also log into the NSH from the host PC like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ telnet 10.0.0.2
Trying 10.0.0.2...
Connected to 10.0.0.2.
Escape character is &#39;^]&#39;.
sh_telnetmain: Session [3] Started

NuttShell (NSH) NuttX-7.9
nsh&gt; help
help usage:  help [-v] [&lt;cmd&gt;]

  [           echo        ifconfig    mkdir       mw          sleep
  ?           exec        ifdown      mkfatfs     ping        test
  cat         exit        ifup        mkfifo      ps          umount
  cp          free        kill        mkrd        put         usleep
  cmp         get         losetup     mh          rm          wget
  dd          help        ls          mount       rmdir       xd
  df          hexdump     mb          mv          source

Builtin Apps:
nsh&gt;
</pre></div>
</div>
<p>NOTE:  If you enable this feature, you experience a delay on booting.
That is because the start-up logic waits for the network connection
to be established before starting NuttX.  In a real application, you
would probably want to do the network bringup on a separate thread
so that access to the NSH prompt is not delayed.</p>
<p>This delay will be especially long if the board is not connected to
a network.  On the order of a minute!  You will probably think that
NuttX has crashed!  And then, when it finally does come up, the
network will not be available.</p>
</section>
<section id="network-initialization-thread">
<h3>Network Initialization Thread<a class="headerlink" href="#network-initialization-thread" title="Permalink to this heading"></a></h3>
<p>There is a configuration option enabled by <code class="docutils literal notranslate"><span class="pre">CONFIG_NSH_NETINIT_THREAD</span></code>
that will do the NSH network bring-up asynchronously in parallel on
a separate thread.  This eliminates the (visible) networking delay
altogether.  This networking initialization feature by itself has
some limitations:</p>
<blockquote>
<div><ul class="simple">
<li><p>If no network is connected, the network bring-up will fail and
the network initialization thread will simply exit.  There are no
retries and no mechanism to know if the network initialization was
successful.</p></li>
<li><p>Furthermore, there is no support for detecting loss of the network
connection and recovery of networking when the connection is restored.</p></li>
</ul>
</div></blockquote>
<p>Both of these shortcomings can be eliminated by enabling the network
monitor:</p>
</section>
<section id="network-monitor">
<h3>Network Monitor<a class="headerlink" href="#network-monitor" title="Permalink to this heading"></a></h3>
<p>By default the network initialization thread will bring-up the network
then exit, freeing all of the resources that it required.  This is a
good behavior for systems with limited memory.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">CONFIG_NSH_NETINIT_MONITOR</span></code> option is selected, however, then the
network initialization thread will persist forever; it will monitor the
network status.  In the event that the network goes down (for example, if
a cable is removed), then the thread will monitor the link status and
attempt to bring the network back up.  In this case the resources
required for network initialization are never released.</p>
<p>Pre-requisites:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_NSH_NETINIT_THREAD</span></code> as described above.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_NETDEV_PHY_IOCTL</span></code>. Enable PHY IOCTL commands in the Ethernet
device driver. Special IOCTL commands must be provided by the Ethernet
driver to support certain PHY operations that will be needed for link
management. There operations are not complex and are implemented for
the Atmel SAMV7 family.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_ARCH_PHY_INTERRUPT</span></code>. This is not a user selectable option.
Rather, it is set when you select a board that supports PHY interrupts.
In most architectures, the PHY interrupt is not associated with the
Ethernet driver at all. Rather, the PHY interrupt is provided via some
board-specific GPIO and the board-specific logic must provide support
for that GPIO interrupt. To do this, the board logic must do two things:
(1) It must provide the function <code class="docutils literal notranslate"><span class="pre">arch_phy_irq()</span></code> as described and
prototyped in the <code class="docutils literal notranslate"><span class="pre">nuttx/include/nuttx/arch.h</span></code>, and (2) it must select
<code class="docutils literal notranslate"><span class="pre">CONFIG_ARCH_PHY_INTERRUPT</span></code> in the board configuration file to advertise
that it supports <code class="docutils literal notranslate"><span class="pre">arch_phy_irq()</span></code>.  This logic can be found at
<code class="docutils literal notranslate"><span class="pre">nuttx/boards/arm/samv7/samv71-xult/src/sam_ethernet.c</span></code>.</p></li>
<li><p>One other thing: UDP support is required.</p></li>
</ul>
</div></blockquote>
<p>Given those prerequisites, the network monitor can be selected with these
additional settings.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Networking</span> <span class="pre">Support</span> <span class="pre">-&gt;</span> <span class="pre">Networking</span> <span class="pre">Device</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NETDEV_PHY_IOCTL=y             : Enable PHY ioctl support
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">NSH</span> <span class="pre">Library</span> <span class="pre">-&gt;</span> <span class="pre">Networking</span> <span class="pre">Configuration</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NSH_NETINIT_THREAD             : Enable the network initialization thread
CONFIG_NSH_NETINIT_MONITOR=y          : Enable the network monitor
CONFIG_NSH_NETINIT_RETRYMSEC=2000     : Configure the network monitor as you like
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="usbhs-device-controller-driver">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">USBHS Device Controller Driver</a><a class="headerlink" href="#usbhs-device-controller-driver" title="Permalink to this heading"></a></h2>
<p>The USBHS device controller driver is enabled with he following configuration
settings:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">USB</span> <span class="pre">Device</span> <span class="pre">Driver</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_USBDEV=y                           : Enable USB device support
</pre></div>
</div>
<p>For full-speed/low-power mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_USBDEV_DUALSPEED=n                 : Disable High speed support
</pre></div>
</div>
<p>For high-speed/normal mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_USBDEV_DUALSPEED=y                 : Enable High speed support
CONFIG_USBDEV_DMA=y                       : Enable DMA methods
CONFIG_USBDEV_MAXPOWER=100                : Maximum power consumption
CONFIG_USBDEV_SELFPOWERED=y               : Self-powered device
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">SAMV7</span> <span class="pre">Peripheral</span> <span class="pre">Selection</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_USBDEVHS=y
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">SAMV7</span> <span class="pre">USB</span> <span class="pre">High</span> <span class="pre">Sppeed</span> <span class="pre">Device</span> <span class="pre">Controller</span> <span class="pre">(DCD</span> <span class="pre">options)</span></code></p>
<p>For full-speed/low-power mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_USBDEVHS_LOWPOWER=y          : Select low power mode
</pre></div>
</div>
<p>For high-speed/normal mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_USBDEVHS_LOWPOWER=n          : Don&#39;t select low power mode
CONFIG_SAMV7_USBHS_NDTDS=32               : Number of DMA transfer descriptors
CONFIG_SAMV7_USBHS_PREALLOCATE=y          : Pre-allocate descriptors
</pre></div>
</div>
</div></blockquote>
<p>As noted above, this driver will not work correctly if the write back
data cache is enabled. You must have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARMV7M_DCACHE_WRITETHROUGH=y
</pre></div>
</div>
<p>In order to be usable, you must all enabled some class driver(s) for the
USBHS device controller.  Here, for example, is how to configure the CDC/ACM
serial device class:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">USB</span> <span class="pre">Device</span> <span class="pre">Driver</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_CDCACM=y                           : USB Modem (CDC ACM) support
CONFIG_CDCACM_EP0MAXPACKET=64             : Endpoint 0 packet size
CONFIG_CDCACM_EPINTIN=1                   : Interrupt IN endpoint number
CONFIG_CDCACM_EPINTIN_FSSIZE=64           : Full speed packet size
CONFIG_CDCACM_EPINTIN_HSSIZE=64           : High speed packet size
CONFIG_CDCACM_EPBULKOUT=3                 : Bulk OUT endpoint number
CONFIG_CDCACM_EPBULKOUT_FSSIZE=64         : Full speed packet size
CONFIG_CDCACM_EPBULKOUT_HSSIZE=512        : High speed packet size
CONFIG_CDCACM_EPBULKIN=2                  : Bulk IN endpoint number
CONFIG_CDCACM_EPBULKIN_FSSIZE=64          : Full speed packet size
CONFIG_CDCACM_EPBULKIN_HSSIZE=512         : High speed packet size
CONFIG_CDCACM_NWRREQS=4                   : Number of write requests
CONFIG_CDCACM_NRDREQS=8                   : Number of read requests
CONFIG_CDCACM_BULKIN_REQLEN=96            : Size of write request buffer (for full speed)
CONFIG_CDCACM_BULKIN_REQLEN=768           : Size of write request buffer (for high speed)
CONFIG_CDCACM_RXBUFSIZE=257               : Serial read buffer size
CONFIG_CDCACM_TXBUFSIZE=193               : Serial transmit buffer size (for full speed)
CONFIG_CDCACM_TXBUFSIZE=769               : Serial transmit buffer size (for high speed)
CONFIG_CDCACM_VENDORID=0x0525             : Vendor ID
CONFIG_CDCACM_PRODUCTID=0xa4a7            : Product ID
CONFIG_CDCACM_VENDORSTR=&quot;NuttX&quot;           : Vendor string
CONFIG_CDCACM_PRODUCTSTR=&quot;CDC/ACM Serial&quot; : Product string
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">Serial</span> <span class="pre">Driver</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SERIAL_REMOVABLE=y                 : Support for removable serial device
</pre></div>
</div>
</div></blockquote>
<p>The CDC/ACM application provides commands to connect and disconnect the
CDC/ACM serial device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SYSTEM_CDCACM=y                     : Enable connect/disconnect support
CONFIG_SYSTEM_CDCACM_DEVMINOR=0            : Use device /dev/ttyACM0
CONFIG_CDCACM_RXBUFSIZE=???                : A large RX may be needed
</pre></div>
</div>
<p>If you include this CDC/ACM application, then you can connect the CDC/ACM
serial device to the host by entering the command <code class="docutils literal notranslate"><span class="pre">sercon</span></code> and you detach
the serial device with the command <code class="docutils literal notranslate"><span class="pre">serdis</span></code>.  If you do no use this
application, they you will have to write logic in your board initialization
code to initialize and attach the USB device.</p>
</section>
<section id="audio-interface">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Audio Interface</a><a class="headerlink" href="#audio-interface" title="Permalink to this heading"></a></h2>
<section id="wm8904-audio-codec">
<h3>WM8904 Audio Codec<a class="headerlink" href="#wm8904-audio-codec" title="Permalink to this heading"></a></h3>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>SAMV71 Interface</p></th>
<th class="head" colspan="2"><p>WM8904 Interface</p></th>
</tr>
<tr class="row-even"><th class="head"><p>PIO</p></th>
<th class="head"><p>Usage</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>PA3</p></td>
<td><p>TWD0</p></td>
<td><p>SDA</p></td>
<td><p>I2C control interface, data line</p></td>
</tr>
<tr class="row-even"><td><p>PA4</p></td>
<td><p>TWCK0</p></td>
<td><p>SCLK</p></td>
<td><p>I2C control interface, clock line</p></td>
</tr>
<tr class="row-odd"><td><p>PA10</p></td>
<td><p>RD</p></td>
<td><p>ADCDAT</p></td>
<td><p>Digital audio output (microphone)</p></td>
</tr>
<tr class="row-even"><td><p>PB18</p></td>
<td><p>PCK2</p></td>
<td><p>MCLK</p></td>
<td><p>Master clock</p></td>
</tr>
<tr class="row-odd"><td><p>PB0</p></td>
<td><p>TF</p></td>
<td><p>LRCLK</p></td>
<td><p>Left/right data alignment clock</p></td>
</tr>
<tr class="row-even"><td><p>PB1</p></td>
<td><p>TK</p></td>
<td><p>BCLK</p></td>
<td><p>Bit clock, for synchronization</p></td>
</tr>
<tr class="row-odd"><td><p>PD11</p></td>
<td><p>GPIO</p></td>
<td><p>IRQ</p></td>
<td><p>Audio interrupt</p></td>
</tr>
<tr class="row-even"><td><p>PD24</p></td>
<td><p>RF</p></td>
<td><p>LRCLK</p></td>
<td><p>Left/right data alignment clock</p></td>
</tr>
<tr class="row-odd"><td><p>PD26</p></td>
<td><p>TD</p></td>
<td><p>DACDAT</p></td>
<td><p>Digital audio input (headphone)</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="cp2100-cp-fractional-n-clock-multiplier">
<h3>CP2100-CP Fractional-N Clock Multiplier<a class="headerlink" href="#cp2100-cp-fractional-n-clock-multiplier" title="Permalink to this heading"></a></h3>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>SAMV71 Interface</p></th>
<th class="head" colspan="2"><p>CP2100-CP Interface</p></th>
</tr>
<tr class="row-even"><th class="head"><p>PIO</p></th>
<th class="head"><p>Usage</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>PA3</p></td>
<td><p>TWD0</p></td>
<td><p>SDA</p></td>
<td><p>I2C control interface, data line</p></td>
</tr>
<tr class="row-even"><td><p>PA4</p></td>
<td><p>TWCK0</p></td>
<td><p>SCLK</p></td>
<td><p>I2C control interface, clock line</p></td>
</tr>
<tr class="row-odd"><td><p>PD21</p></td>
<td><p>TIOA11</p></td>
<td><p>CLK_IN</p></td>
<td><p>PLL input</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>-</p></td>
<td><p>XTI/XTO</p></td>
<td><p>12.0MHz crystal</p></td>
</tr>
<tr class="row-odd"><td><p>PA22</p></td>
<td><p>RK</p></td>
<td><p>CLK_OUT</p></td>
<td><p>PLL output</p></td>
</tr>
<tr class="row-even"><td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>AUX_OUT</p></td>
<td><p>N/C</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
</section>
<section id="maxtouch-xplained-pro">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">maXTouch Xplained Pro</a><a class="headerlink" href="#maxtouch-xplained-pro" title="Permalink to this heading"></a></h2>
<p>Testing has also been performed using the maXTouch Xplained Pro LCD
(ATMXT-XPRO).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<dl>
<dt>WARNING:</dt><dd><p>The maXTouch chip was not configured on all of the maXTouch Xplained
Pro boards that I have used (which is two).  The maXTouch is
completely non-functional with no configuration in its NV memory!</p>
<p>My understanding is that this configuration can be set on Linux
using the mxp-app program which is available on GitHub.  There is an
(awkward) way to do this with NuttX too. In order to set the
maXTouch configuration with NuttX you need to do these things:</p>
<ul class="simple">
<li><p>Copy the function <code class="docutils literal notranslate"><span class="pre">atmxt_config()</span></code> from the file
<code class="docutils literal notranslate"><span class="pre">boards/arm/samv7/samv71-xult/src/atmxt_config.c</span></code> into the file
<code class="docutils literal notranslate"><span class="pre">drivers/input/mxt.c</span></code></p></li>
<li><p>Add a call to <code class="docutils literal notranslate"><span class="pre">atmxt_config()</span></code> in drivers/input/mxt.c in the
function <code class="docutils literal notranslate"><span class="pre">mxt_register()</span></code> just before the touchscreen device is
registered (i.e, the call to <code class="docutils literal notranslate"><span class="pre">register_driver()</span></code>).</p></li>
<li><p>Run the code one time.  Your maXTouch is configured and should
now work.</p></li>
<li><p>Don’t forget to remove <code class="docutils literal notranslate"><span class="pre">atmxt_config()</span></code> from <code class="docutils literal notranslate"><span class="pre">drivers/input/mxt.c</span></code> and
restore driver as it was.</p></li>
</ul>
</dd>
</dl>
</div>
<section id="maxtouch-xplained-pro-standard-extension-header">
<h3>maXTouch Xplained Pro Standard Extension Header<a class="headerlink" href="#maxtouch-xplained-pro-standard-extension-header" title="Permalink to this heading"></a></h3>
<p>The LCD could be connected either via EXT1 or EXT2 using the 2x10 20-pin
cable and the maXTouch Xplained Pro standard extension header. Access would
then be performed in SPI mode.</p>
<p>NOTE: There is currently no support for use of the LCD in SPI mode.  See
the next paragraph where the LCD/EXT4 connection is discussion.</p>
<p>NOTE the 3 switch mode selector on the back of the maXtouch.  All switches
should be in the ON position to select 4-wire SPI mode.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="7"><p>SAMV71-XULT maxTouch Xplained Pro</p></th>
</tr>
<tr class="row-even"><th class="head"><p>PIN</p></th>
<th class="head"><p>FUNCTION</p></th>
<th class="head"><p>EXT1</p></th>
<th class="head"><p>FUNC</p></th>
<th class="head"><p>EXT2</p></th>
<th class="head"><p>FUNC</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>1</p></td>
<td><p>ID</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Communication line to ID chip</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>N/C</p></td>
<td><p>PC31</p></td>
<td><p>-</p></td>
<td><p>PD30</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>N/C</p></td>
<td><p>PA19</p></td>
<td><p>-</p></td>
<td><p>PC13</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>GPIO</p></td>
<td><p>PB3</p></td>
<td><p>GPIO</p></td>
<td><p>PA6</p></td>
<td><p>GPIO</p></td>
<td><p>Command/Data Select</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>N/C</p></td>
<td><p>PB2</p></td>
<td><p>-</p></td>
<td><p>PD11</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>PWM</p></td>
<td><p>PA0</p></td>
<td><p>PWMC0_PWMH0</p></td>
<td><p>PC19</p></td>
<td><p>PWMC0_PMWH2</p></td>
<td><p>Backlight control</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>N/C</p></td>
<td><p>PC30</p></td>
<td><p>-</p></td>
<td><p>PD26</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>GPIO/IRQ</p></td>
<td><p>PD28</p></td>
<td><p>GPIO</p></td>
<td><p>PA2</p></td>
<td><p>GPIO</p></td>
<td><p>IRQ from maXTouch controller</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>GPIO</p></td>
<td><p>PA5</p></td>
<td><p>GPIO</p></td>
<td><p>PA24</p></td>
<td><p>GPIO</p></td>
<td><p>RESET signal for maXTouch and LCD controller</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>I2C SDA</p></td>
<td><p>PA3</p></td>
<td><p>TWID0</p></td>
<td><p>PA3</p></td>
<td><p>TWID0</p></td>
<td><p>I2C Data line for maXTouch controller</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>I2C SCL</p></td>
<td><p>PA4</p></td>
<td><p>TWICK0</p></td>
<td><p>PA4</p></td>
<td><p>TWICK0</p></td>
<td><p>I2C Clock line for maXTouch controller</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>N/C</p></td>
<td><p>PB0</p></td>
<td><p>-</p></td>
<td><p>PA21</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>N/C</p></td>
<td><p>PB1</p></td>
<td><p>-</p></td>
<td><p>PB4</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>CS</p></td>
<td><p>PD25</p></td>
<td><p>GPIO</p></td>
<td><p>PD27</p></td>
<td><p>GPIO</p></td>
<td><p>CS line for LCD controller</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>SPI MOSI</p></td>
<td><p>PD21</p></td>
<td><p>SPI0_MOSI</p></td>
<td><p>PD21</p></td>
<td><p>SPI0_MOSI</p></td>
<td><p>SPI Data to LCD controller</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>SPI MISO</p></td>
<td><p>PD20</p></td>
<td><p>SPI0_MISO</p></td>
<td><p>PD20</p></td>
<td><p>SPI0_MISO</p></td>
<td><p>SPI Data from LCD controller</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>SPI SCK</p></td>
<td><p>PD22</p></td>
<td><p>SPI0_SPCK</p></td>
<td><p>PD22</p></td>
<td><p>SPI0_SPCK</p></td>
<td><p>SPI Clock line</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>VCC</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Target supply voltage</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>NOTE: Use of EXT1 conflicts with the Arduino RXD pin (PD28).  You cannot
put the maXTouch Xplained in EXT1 and also use the Arduino RXD/TXD pins
as your serial console.</p>
</section>
<section id="maxtouch-xplained-pro-xplained-pro-lcd-connector">
<h3>maXTouch Xplained Pro Xplained Pro LCD Connector<a class="headerlink" href="#maxtouch-xplained-pro-xplained-pro-lcd-connector" title="Permalink to this heading"></a></h3>
<p>It is also possible to connect the LCD via the flat cable to the EXT4 LCD
connector.  In this case, you would use the SMC/EBI to communicate with the
LCD.</p>
<p>NOTE: (1) Only the parallel interface is supported by the SAMV71-XULT and (2)
the 3 switch mode selector on the back of the maXtouch.  These switches should
be in the OFF-ON-OFF positions to select 16-bit color mode.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="2"></th>
<th class="head" colspan="2"></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>Pin</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>Function</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>1</p></td>
<td><p>ID</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Communication line to ID chip on extension board</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>D0</p></td>
<td><p>PC0</p></td>
<td><p>D0</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>D1</p></td>
<td><p>PC1</p></td>
<td><p>D1</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>D2</p></td>
<td><p>PC2</p></td>
<td><p>D2</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>D3</p></td>
<td><p>PC3</p></td>
<td><p>D3</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>D4</p></td>
<td><p>PC4</p></td>
<td><p>D4</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>D5</p></td>
<td><p>PC5</p></td>
<td><p>D5</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>D6</p></td>
<td><p>PC6</p></td>
<td><p>D6</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>D7</p></td>
<td><p>PC7</p></td>
<td><p>D7</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>D8</p></td>
<td><p>PE0</p></td>
<td><p>D8</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>D9</p></td>
<td><p>PE1</p></td>
<td><p>D9</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>D10</p></td>
<td><p>PE2</p></td>
<td><p>D10</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>D11</p></td>
<td><p>PE3</p></td>
<td><p>D11</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>D12</p></td>
<td><p>PE4</p></td>
<td><p>D12</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>D13</p></td>
<td><p>PE5</p></td>
<td><p>D13</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>D14</p></td>
<td><p>PA15</p></td>
<td><p>D14</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>21</p></td>
<td><p>D15</p></td>
<td><p>PA16</p></td>
<td><p>D15</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>D16</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>D17</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Data line</p></td>
</tr>
<tr class="row-odd"><td><p>25</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>26</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>27</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-even"><td><p>28</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>29</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>30</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>31</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>32</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>33</p></td>
<td><p>PCLK/CMD_DATA_SEL</p></td>
<td><p>PC30</p></td>
<td><p>GPIO</p></td>
<td><p>SMC: Pixel clock Display RAM select.
SPI: One address line of the MCU for displays where it is possible to select either the register or the data interface</p></td>
</tr>
<tr class="row-even"><td><p>34</p></td>
<td><p>VSYNC/CS</p></td>
<td><p>PD19</p></td>
<td><p>NCS3</p></td>
<td><p>SMC: Vertical synchronization.
SPI: Chip select</p></td>
</tr>
<tr class="row-odd"><td><p>35</p></td>
<td><p>HSYNC/WE</p></td>
<td><p>PC8</p></td>
<td><p>NWE</p></td>
<td><p>SMC: Horizontal synchronization
SPI: Write enable signal</p></td>
</tr>
<tr class="row-even"><td><p>36</p></td>
<td><p>DATA ENABLE/RE</p></td>
<td><p>PC11</p></td>
<td><p>NRD</p></td>
<td><p>SMC: Data enable signal
SPI: Read enable signal</p></td>
</tr>
<tr class="row-odd"><td><p>37</p></td>
<td><p>SPI SCK</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>SPI: Clock for SPI</p></td>
</tr>
<tr class="row-even"><td><p>38</p></td>
<td><p>SPI MOSI</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>SPI: Master out slave in line of SPI</p></td>
</tr>
<tr class="row-odd"><td><p>39</p></td>
<td><p>SPI MISO</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>SPI: Master in slave out line of SPI</p></td>
</tr>
<tr class="row-even"><td><p>40</p></td>
<td><p>SPI SS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>SPI: Slave select for SPI</p></td>
</tr>
<tr class="row-odd"><td><p>41</p></td>
<td><p>N/C</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>42</p></td>
<td><p>TWI SDA</p></td>
<td><p>PA3</p></td>
<td><p>TWD0</p></td>
<td><p>I2C data line (maXTouch®)</p></td>
</tr>
<tr class="row-odd"><td><p>43</p></td>
<td><p>TWI SCL</p></td>
<td><p>PA4</p></td>
<td><p>TWCK0</p></td>
<td><p>I2C clock line (maXTouch)</p></td>
</tr>
<tr class="row-even"><td><p>44</p></td>
<td><p>IRQ1</p></td>
<td><p>PD28</p></td>
<td><p>WKUP5</p></td>
<td><p>maXTouch interrupt line</p></td>
</tr>
<tr class="row-odd"><td><p>45</p></td>
<td><p>N/C</p></td>
<td><p>PA2</p></td>
<td><p>WKUP2</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>46</p></td>
<td><p>PWM</p></td>
<td><p>PC9</p></td>
<td><p>TIOB7</p></td>
<td><p>Backlight control</p></td>
</tr>
<tr class="row-odd"><td><p>47</p></td>
<td><p>RESET</p></td>
<td><p>PC13</p></td>
<td><p>GPIO</p></td>
<td><p>Reset for both display and maxTouch</p></td>
</tr>
<tr class="row-even"><td><p>48</p></td>
<td><p>VCC</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>3.3V power supply for extension board</p></td>
</tr>
<tr class="row-odd"><td><p>49</p></td>
<td><p>VCC</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>3.3V power supply for extension board</p></td>
</tr>
<tr class="row-even"><td><p>50</p></td>
<td><p>GND</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>Ground</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>NOTE: Use of LCD/EXT4 conflicts with the Arduino RXD pin (PD28).  You cannot
put the maXTouch Xplained in LCD/EXT4 and also use the Arduino RXD/TXD pins
as your serial console.</p>
<p>Connecting the flat cable.  I was embarrassed to say that I did not know how
the connectors worked.  Let me share this so that, perhaps, I can save you
the same embarrassment:</p>
<ul class="simple">
<li><p>The maXTouch Xplained Pro has an Omron XF2M-5015-1A connector.  There is a
black bar at back (toward the board).  Raise that bar and insert the cable
with the contacts away from the board.  Lower that bar to lock the cable
in place.</p></li>
<li><p>The SAMV71-Xult has a TE Connectivity 5-1734839-0 FPC connector that works
differently.  On each side of the connector are two small white tabs.  Pull
these out and away from the board.  Insert the ribbon with the contacts
toward the board.  Lock the cable in place by pushing the tabs back in
place.</p></li>
</ul>
</section>
<section id="mxt-configuration-options">
<h3>MXT Configuration Options<a class="headerlink" href="#mxt-configuration-options" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">SAMV7</span> <span class="pre">Peripheral</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_TWIHS0=y                : Needed by the MaXTouch controller
CONFIG_SAMV7_TWIHS0_FREQUENCY=100000
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Board</span> <span class="pre">Selection</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV71XULT_MXTXPLND=y          : MaXTouch Xplained is connected
CONFIG_SAMV71XULT_MXTXPLND_EXT1=y     : Connected on EXT1, or
CONFIG_SAMV71XULT_MXTXPLND_EXT2=y     : Connected on EXT2, or
CONFIG_SAMV71XULT_MXTXPLND_LCD=y      : Connected on LCD
CONFIG_SAMV71XULT_MXT_DEVMINOR=0      : Register as /dev/input0
CONFIG_SAMV71XULT_MXT_I2CFREQUENCY=400000
</pre></div>
</div>
<p>NOTE: When selecting EXT1 or EXT2, be conscious of possible pin conflicts.
EXT1, for example, will conflict with the use of the Arduino TXD and RXD
pins for the serial console</p>
<p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">Input</span> <span class="pre">Devices</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_INPUT=y                        : Enable support for human input devices
CONFIG_INPUT_MXT=y                    : Enable support for the maXTouch controller
</pre></div>
</div>
<p>The following enables a small built-in application that can be used to
test the touchscreen:</p>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">Examples</span> <span class="pre">-&gt;</span> <span class="pre">Touchscreen</span> <span class="pre">example</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_TOUCHSCREEN=y          : Enables the example
CONFIG_EXAMPLES_TOUCHSCREEN_DEVPATH=&quot;/dev/input0&quot;
CONFIG_EXAMPLES_TOUCHSCREEN_MINOR=0
</pre></div>
</div>
</div></blockquote>
</section>
<section id="ili9488-configuration-options">
<h3>ILI9488 Configuration Options<a class="headerlink" href="#ili9488-configuration-options" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Currently only the parallel mode is supported.  This means that the LCD can
only be used in connected in the LCD (EXT4) connection.</p>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">SAMV7</span> <span class="pre">Peripheral</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_SMC=y                    : Needed by the ILI9466 driver controller
CONFIG_SAMV7_XDMAC=y                  : Needed by the ILI9466 driver
CONFIG_SAMV7_TWIHS0_FREQUENCY=100000
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Board</span> <span class="pre">Selection</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV71XULT_MXTXPLND=y          : MaXTouch Xplained is connected
CONFIG_SAMV71XULT_MXTXPLND_LCD=y      : Must be connected on LCD
</pre></div>
</div>
<p>NOTE: When selecting EXT1 or EXT2, be conscious of possible pin conflicts.
EXT1, for example, will conflict with the use of the Arduino TXD and RXD
pins for the serial console</p>
<p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">LCD</span> <span class="pre">drivers</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_LCD=y                          : Enable support for LCDs
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Graphics</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NX=y                           : Enable Graphics supported
CONFIG_NX_LCDDRIVER=y                 : Enable LCD driver support
CONFIG_NX_DISABLE_*BPP=y              : When * is {1,2,4,8,24, and 32}
CONFIG_NXFONTS_CHARBITS=7
CONFIG_NXFONT_SANS23X27=y             : One font must be enabled
</pre></div>
</div>
<p>There are several graphics examples that can be enabled under <code class="docutils literal notranslate"><span class="pre">apps/examples</span></code>.
<code class="docutils literal notranslate"><span class="pre">nxlines</span></code> is one of these and can be enabled as follows.  See
<code class="docutils literal notranslate"><span class="pre">apps/examples/README.txt</span></code> for information about configuring other graphics
examples.</p>
<p>The following enables a small built-in application that can be used to
test the touchscreen:</p>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">Examples</span> <span class="pre">-&gt;</span> <span class="pre">NX</span> <span class="pre">lines</span> <span class="pre">example</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_NXLINES=y              : Enables the nxlines example
CONFIG_EXAMPLES_NXLINES_VPLANE=0
CONFIG_EXAMPLES_NXLINES_DEVNO=0
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="mcan1-loopback-test">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">MCAN1 Loopback Test</a><a class="headerlink" href="#mcan1-loopback-test" title="Permalink to this heading"></a></h2>
<section id="mcan1">
<h3>MCAN1<a class="headerlink" href="#mcan1" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>SAM V71 Xplained Ultra has two MCAN modules that performs communication according
to ISO11898-1 (Bosch CAN specification 2.0 part A,B) and Bosch CAN FD
specification V1.0.  MCAN1 is connected to an on-board ATA6561 CAN physical-layer
transceiver.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAM V71 Pin</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>ATA6561 Function</p></th>
<th class="head"><p>Shared Functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PC14</p></td>
<td><p>CANTX1</p></td>
<td><p>TXD</p></td>
<td><p>Shield</p></td>
</tr>
<tr class="row-odd"><td><p>PC12</p></td>
<td><p>CANRX1</p></td>
<td><p>RXD</p></td>
<td><p>Shield</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
</section>
<section id="enabling-mcan1">
<h3>Enabling MCAN1<a class="headerlink" href="#enabling-mcan1" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>These modifications may be applied to the <code class="docutils literal notranslate"><span class="pre">samv71-xult:nsh</span></code> configuration in order
to enable MCAN1:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">-&gt;</span> <span class="pre">CAN</span> <span class="pre">Driver</span> <span class="pre">support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_CAN=y                            # Enable the upper-half CAN driver
CONFIG_CAN_TXFIFOSIZE=8
CONFIG_CAN_RXFIFOSIZE=8
CONFIG_CAN_NPENDINGRTR=4
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">SAMV7</span> <span class="pre">Peripheral</span> <span class="pre">Selections</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_MCAN1=y                    # Enable MCAN1 as the lower-half
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">MCAN</span> <span class="pre">device</span> <span class="pre">driver</span> <span class="pre">options</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_MCAN_CLKSRC_MAIN=y         # Use the MAIN clock as the source
CONFIG_SAMV7_MCAN_CLKSRC_PRESCALER=1
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;MCAN</span> <span class="pre">device</span> <span class="pre">driver</span> <span class="pre">options</span> <span class="pre">-&gt;</span> <span class="pre">MCAN1</span> <span class="pre">device</span> <span class="pre">driver</span> <span class="pre">options</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_MCAN1_ISO11899_1=y         # Loopback test only support ISO11899-1
CONFIG_SAMV7_MCAN1_LOOPBACK=y           # Needed for loopback test
CONFIG_SAMV7_MCAN1_BITRATE=500000       # Not critical for loopback test
CONFIG_SAMV7_MCAN1_PROPSEG=2            # Bit timing setup
CONFIG_SAMV7_MCAN1_PHASESEG1=11         # &quot; &quot; &quot;    &quot; &quot;   &quot;
CONFIG_SAMV7_MCAN1_PHASESEG2=11         # &quot; &quot; &quot;    &quot; &quot;   &quot;
CONFIG_SAMV7_MCAN1_FSJW=4               # &quot; &quot; &quot;    &quot; &quot;   &quot;
CONFIG_SAMV7_MCAN1_FBITRATE=2000000     # CAN_FD BTW mode is not used
CONFIG_SAMV7_MCAN1_FPROPSEG=2           # &quot;    &quot; &quot; &quot; &quot;  &quot; &quot;&quot; &quot; &quot; &quot;  &quot;
CONFIG_SAMV7_MCAN1_FPHASESEG1=4         # &quot;    &quot; &quot; &quot; &quot;  &quot; &quot;&quot; &quot; &quot; &quot;  &quot;
CONFIG_SAMV7_MCAN1_FPHASESEG2=4         # &quot;    &quot; &quot; &quot; &quot;  &quot; &quot;&quot; &quot; &quot; &quot;  &quot;
CONFIG_SAMV7_MCAN1_FFSJW=2              # &quot;    &quot; &quot; &quot; &quot;  &quot; &quot;&quot; &quot; &quot; &quot;  &quot;
CONFIG_SAMV7_MCAN1_NSTDFILTERS=0        # Filters are not used in the loopback test
CONFIG_SAMV7_MCAN1_NEXTFILTERS=0        # &quot;     &quot; &quot; &quot; &quot; &quot; &quot;  &quot; &quot;&quot; &quot; &quot; &quot;      &quot; &quot;  &quot;
CONFIG_SAMV7_MCAN1_RXFIFO0_32BYTES=y    # Each RX FIFO0 element is 32 bytes
CONFIG_SAMV7_MCAN1_RXFIFO0_SIZE=8       # There are 8 queue elements
CONFIG_SAMV7_MCAN1_RXFIFO0_32BYTES=y    # Each RX FIFO1 element is 32 bytes
CONFIG_SAMV7_MCAN1_RXFIFO0_SIZE=8       # There are 8 queue elements
CONFIG_SAMV7_MCAN1_RXBUFFER_32BYTES=y   # Each RX BUFFER is 32 bytes
CONFIG_SAMV7_MCAN1_TXBUFFER_32BYTES=y   # Each TX BUFFER is 32 bytes
CONFIG_SAMV7_MCAN1_TXFIFOQ_SIZE=8       # There are 8 queue elements
CONFIG_SAMV7_MCAN1_TXEVENTFIFO_SIZE=0   # The event FIFO is not used
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</section>
<section id="enabling-the-can-loopback-test">
<h3>Enabling the CAN Loopback Test<a class="headerlink" href="#enabling-the-can-loopback-test" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration</span> <span class="pre">-&gt;</span> <span class="pre">Examples</span> <span class="pre">-&gt;</span> <span class="pre">CAN</span> <span class="pre">Example</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_CAN=y                    # Enables the CAN test
</pre></div>
</div>
</div></blockquote>
</section>
<section id="enabling-can-debug-output">
<h3>Enabling CAN Debug Output<a class="headerlink" href="#enabling-can-debug-output" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Setup</span> <span class="pre">-&gt;</span> <span class="pre">Debug</span> <span class="pre">Options</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_DEBUG_FEATURES=y                  # Enables general debug features
CONFIG_DEBUG_INFO=y                      # Enables verbose output
CONFIG_DEBUG_CAN_INFO=y                  # Enables debug output from CAN

CONFIG_STACK_COLORATION=y                # Monitor stack usage
CONFIG_DEBUG_SYMBOLS=y                   # Needed only for use with a debugger
CONFIG_DEBUG_NOOPT=y                     # Disables optimization
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">MCAN</span> <span class="pre">device</span> <span class="pre">driver</span> <span class="pre">options</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_MCAN_REGDEBUG=y              # Super low level register debug output
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="spi-slave">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">SPI Slave</a><a class="headerlink" href="#spi-slave" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>An interrupt driven SPI slave driver as added on 2015-08-09 but has not
been verified as of this writing. See discussion in <code class="docutils literal notranslate"><span class="pre">include/nuttx/spi/slave.h</span></code>
and below.</p>
<p>I do not yet have a design that supports SPI slave DMA.  And, under
certain, very limited conditions, I think it can be done.  Those
certain conditions are:</p>
<ol class="loweralpha simple">
<li><p>The master does not tie the chip select to ground.  The master must
raise chip select at the end of the transfer.  Then I do not need to
know the length of the transfer; I can cancel the DMA when the chip
is de-selected.</p></li>
<li><p>The protocol includes a dummy read after sending the command.  This
is very common in SPI device and should not be an issue if it is
specified.   This dummy read time provides time to set up the DMA.
So the protocol would be:</p>
<ol class="lowerroman simple">
<li><p>Master drops the chip select.</p></li>
<li><p>Master sends the command which will indicate whether the master
is reading, writing, or exchanging data.  The master discards
the garbage return value.</p></li>
<li><p>Slave is interrupted when the command word is received.  The
SPI device then decodes the command word and setups up the
subsequent DMA.</p></li>
<li><p>Master sends a dummy word and discards the return value.
During the bit times to shift the dummy word, the slave has time
to set up the DMA.</p></li>
<li><p>Master then reads or writes (or exchanges) the data  If the DMA
is in place, the transfer should continue normally.</p></li>
<li><p>At the end of the data transfer the master raises the chip select.</p></li>
</ol>
</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple" start="3">
<li><p>There are limitations in the word time, i.e., the time between the
interrupt for each word shifted in from the master.</p></li>
</ol>
</div></blockquote>
<p>The controller driver will get events after the receipt of each word in
ii), iv), and v).  The time between each word will be:</p>
<blockquote>
<div><p>word-time = nbits * bit time + inter-word-gap</p>
</div></blockquote>
<p>So for an 8 bit interface at 20MHz, the words will be received from the
master a 8 * 50nsec = 400 nsec + inter-word-gap.  That is the time
during which the dummy word would be shifted and during which we
receive the interrupt for the command word, interpret the command word,
and to set up the DMA for the remaining word transfer.  I don’t think
that is possible, at least not at 20 MHz.</p>
<p>That is far too fast even for the interrupt driven solution that I have
in place now.  It could not work at 20MHz.  If we suppose that interrupt
processing is around 1 usec, then an 8 bit interface could not have bit
times more than 125 nsec or 8 KHz.  Interrupt handling should be faster
than 1 usec, but not a lot faster.  I have not benchmarked it.  NuttX
also supports special, zero latency interrupts that could bring the
interrupt time down even more.</p>
<p>Note that we would also have a little more processing time if you used
16-bit SPI word size.</p>
<p>Note also that the interrupt driven approach would have this same basic
performance limitation with the additional disadvantage that:</p>
<ol class="loweralpha">
<li><p>The driver will receive two interrupts per word exchanged:</p>
<ol class="lowerroman simple">
<li><p>One interrupt will be received when the word is shifted in from
the master (at the end of 8-bit times).  This is a data received
interrupt.</p></li>
<li><p>And another interrupt when the next words moved to the shift-out
register, freeing up the transmit holding register.  This is the
data sent interrupt.</p></li>
</ol>
<p>The ii) event should be very soon after the i) event.</p>
<p>Without DMA, the only way to reduce the interrupt rate would be to add
interrupt-level polling to detect the when transmit holding register
is available.  That is not really a good idea.</p>
</li>
<li><p>It will hog all of the CPU for the duration of the transfer).</p></li>
</ol>
</div></blockquote>
</section>
<section id="click-shield">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Click Shield</a><a class="headerlink" href="#click-shield" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>In the <code class="docutils literal notranslate"><span class="pre">mrf24j40-starhub</span></code> configuration, a click shield from
MikroElectronika was used along with a Click “Bee” module.  The click
shield supports two click shields and the following tables describe the
relationship between the pins on each click shield, the Arduino
connector and the SAMV71 pins.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>mikroBUS1</p></th>
<th class="head"><p>Arduino</p></th>
<th class="head"><p>SAMV71</p></th>
<th class="head"><p>mikroBUS2</p></th>
<th class="head"><p>Arduino</p></th>
<th class="head"><p>SAMV71</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AN</p></td>
<td><p>HD1 A0  AN0      Pin 1</p></td>
<td><p>AD0 PD26</p></td>
<td><p>AN</p></td>
<td><p>HD1 A1 AN1  Pin 2</p></td>
<td><p>AD1 PC31</p></td>
</tr>
<tr class="row-odd"><td><p>RST</p></td>
<td><p>HD1 A3           Pin 4</p></td>
<td><p>AD3 PA19</p></td>
<td><p>RST</p></td>
<td><p>HD1 A2      Pin 3</p></td>
<td><p>AD2 PD30</p></td>
</tr>
<tr class="row-even"><td><p>CS</p></td>
<td><p>HD4 D10 SPI-SS   Pin 8</p></td>
<td><p>D10 PD25</p></td>
<td><p>CS</p></td>
<td><p>HD4 D9      Pin 9</p></td>
<td><p>D9  PC9</p></td>
</tr>
<tr class="row-odd"><td><p>SCK</p></td>
<td><p>HD4 D13 SPI-SCK  Pin 5</p></td>
<td><p>D13 PD22</p></td>
<td><p>SCK</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>MISO</p></td>
<td><p>HD4 D12 SPI-MISO Pin 6</p></td>
<td><p>D12 PD20</p></td>
<td><p>MISO</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>MOSI</p></td>
<td><p>HD4 D11 SPI-MOSI Pin 7</p></td>
<td><p>D11 PD21</p></td>
<td><p>MOSI</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>3.3V</p></td>
<td><p>N/A</p></td>
<td></td>
<td><p>3.3V</p></td>
<td><p>N/A</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>N/A</p></td>
<td></td>
<td><p>GND</p></td>
<td><p>N/A</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PWM</p></td>
<td><p>HD3 D6 PWMA      Pin 2</p></td>
<td><p>D6  PC19</p></td>
<td><p>PWM</p></td>
<td><p>HD3 D5 PWMB Pin 5</p></td>
<td><p>D5 PD11</p></td>
</tr>
<tr class="row-odd"><td><p>INT</p></td>
<td><p>HD3 D2 INT0      Pin 6</p></td>
<td><p>D2  PA5</p></td>
<td><p>INT</p></td>
<td><p>HD3 D3 INT1 Pin 5</p></td>
<td><p>D3 PA6</p></td>
</tr>
<tr class="row-even"><td><p>RX</p></td>
<td><p>HD3 D0 HDR-RX*   Pin 8</p></td>
<td><p>D0  PD28</p></td>
<td><p>RX</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>TX</p></td>
<td><p>HD3 D1 HDR-TX*   Pin 7</p></td>
<td><p>D1  PD30</p></td>
<td><p>TX</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SCL</p></td>
<td><p>HD1 A5 I2C-SCL   Pin 5</p></td>
<td><p>AD5 PC30</p></td>
<td><p>SDA</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SDA</p></td>
<td><p>HD1 A4 I2C-SDA   Pin 6</p></td>
<td><p>AD4 PC13</p></td>
<td><p>SCL</p></td>
<td><p>Same</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>5V</p></td>
<td><p>N/A</p></td>
<td></td>
<td><p>5V</p></td>
<td><p>N/A</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>N/A</p></td>
<td></td>
<td><p>GND</p></td>
<td><p>N/A</p></td>
<td></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Depends upon setting of SW1, UART vs PROG.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>PIN</p></th>
<th class="head"><p>PORT</p></th>
<th class="head"><p>SHIELD FUNCTION</p></th>
<th class="head"><p>SAMV71PIN CONFIGURATION</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AD0</p></td>
<td><p>PD26</p></td>
<td><p>microBUS2 Analog TD</p></td>
<td><p>PD26 <strong>Not an AFE pin</strong></p></td>
</tr>
<tr class="row-odd"><td><p>AD1</p></td>
<td><p>PC31</p></td>
<td><p>microBUS2 Analog</p></td>
<td><p>PC31 AFE1_AD6   GPIO_AFE1_AD6</p></td>
</tr>
<tr class="row-even"><td><p>AD2</p></td>
<td><p>PD30</p></td>
<td><p>microBUS2 GPIO reset output</p></td>
<td><p>PD30</p></td>
</tr>
<tr class="row-odd"><td><p>AD3</p></td>
<td><p>PA19</p></td>
<td><p>microBUS1 GPIO reset output</p></td>
<td><p>PA19</p></td>
</tr>
<tr class="row-even"><td><p>AD4</p></td>
<td><p>PC13</p></td>
<td><p>(both) I2C-SDA</p></td>
<td><p>PC13 <strong>Does not support I2C SDA</strong></p></td>
</tr>
<tr class="row-odd"><td><p>AD5</p></td>
<td><p>PC30</p></td>
<td><p>(both) I2C-SCL</p></td>
<td><p>PC30 <strong>Does not support I2C SCL</strong></p></td>
</tr>
<tr class="row-even"><td><p>AD6</p></td>
<td><p>PA17</p></td>
<td><p><strong>Not used</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>AD7</p></td>
<td><p>PC12</p></td>
<td><p><strong>Not used</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>D0</p></td>
<td><p>PD28</p></td>
<td><p>(both) HDR_RX</p></td>
<td><p>PD28 URXD3      GPIO_UART3_RXD</p></td>
</tr>
<tr class="row-odd"><td><p>D1</p></td>
<td><p>PD30</p></td>
<td><p>(both) HDR_TX</p></td>
<td><p>PD30 UTXD3      GPIO_UART3_TXD_1</p></td>
</tr>
<tr class="row-even"><td><p>D2</p></td>
<td><p>PA0</p></td>
<td><p>microBUS1 GPIO interrupt input</p></td>
<td><p>PA0</p></td>
</tr>
<tr class="row-odd"><td><p>D3</p></td>
<td><p>PA6</p></td>
<td><p>microBUS2 GPIO interrupt input</p></td>
<td><p>PA6</p></td>
</tr>
<tr class="row-even"><td><p>D4</p></td>
<td><p>PD27</p></td>
<td><p><strong>Not used</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>D5</p></td>
<td><p>PD11</p></td>
<td><p>microBUS2 PWMB</p></td>
<td><p>PD11 PWMC0_H0</p></td>
</tr>
<tr class="row-even"><td><p>D6</p></td>
<td><p>PC19</p></td>
<td><p>microBUS1 PWMA</p></td>
<td><p>PC19 PWMC0_H2</p></td>
</tr>
<tr class="row-odd"><td><p>D7</p></td>
<td><p>PA2</p></td>
<td><p><strong>Not used</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>D8</p></td>
<td><p>PA5</p></td>
<td><p><strong>Not used</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>D9</p></td>
<td><p>PC9</p></td>
<td><p>microBUS2 CS GPIO output</p></td>
<td><p>PC9</p></td>
</tr>
<tr class="row-even"><td><p>D10</p></td>
<td><p>PD25</p></td>
<td><p>microBUS1 CS GPIO output</p></td>
<td><p>PD25 SPI0_NPCS1</p></td>
</tr>
<tr class="row-odd"><td><p>D11</p></td>
<td><p>PD21</p></td>
<td><p>(both) SPI-MOSI</p></td>
<td><p>PD21 SPI0_MOSI  GPIO_SPI0_MOSI</p></td>
</tr>
<tr class="row-even"><td><p>D12</p></td>
<td><p>PD20</p></td>
<td><p>(both) SPI-MISO</p></td>
<td><p>PD20 SPI0_MISO  GPIO_SPI0_MISO</p></td>
</tr>
<tr class="row-odd"><td><p>D13</p></td>
<td><p>PD22</p></td>
<td><p>(both) SPI-SCK</p></td>
<td><p>PD22 SPI0_SPCK  GPIO_SPI0_SPCK</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="tickless-os">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Tickless OS</a><a class="headerlink" href="#tickless-os" title="Permalink to this heading"></a></h2>
<section id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>By default, a NuttX configuration uses a periodic timer interrupt that
drives all system timing. The timer is provided by architecture-specific
code that calls into NuttX at a rate controlled by <code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code>.
The default value of <code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code> is 10000 microseconds which
corresponds to a timer interrupt rate of 100 Hz.</p>
<p>An option is to configure NuttX to operation in a “tickless” mode. Some
limitations of default system timer are, in increasing order of
importance:</p>
<ul class="simple">
<li><p>Overhead: Although the CPU usage of the system timer interrupt at 100Hz
is really very low, it is still mostly wasted processing time. On most
timer interrupts, there is really nothing that needs to be done other than
incrementing the counter.</p></li>
<li><p>Resolution: Resolution of all system timing is also determined by
<code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code>. So nothing that be time with resolution finer than
10 milliseconds be default. To increase this resolution,
<code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code> an be reduced. However, then the system timer
interrupts use more of the CPU bandwidth processing useless interrupts.</p></li>
<li><p>Power Usage: But the biggest issue is power usage. When the system is
IDLE, it enters a light, low-power mode (for ARMs, this mode is entered
with the wfi or wfe instructions for example). But each interrupt
awakens the system from this low power mode. Therefore, higher rates
of interrupts cause greater power consumption.</p></li>
</ul>
<p>The so-called Tickless OS provides one solution to issue. The basic
concept here is that the periodic, timer interrupt is eliminated and
replaced with a one-shot, interval timer. It becomes event driven
instead of polled: The default system timer is a polled design. On
each interrupt, the NuttX logic checks if it needs to do anything
and, if so, it does it.</p>
<p>Using an interval timer, one can anticipate when the next interesting
OS event will occur, program the interval time and wait for it to fire.
When the interval time fires, then the scheduled activity is performed.</p>
</div></blockquote>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>The following configuration options will enable support for the Tickless
OS for the SAMV7 platforms using TC0 channels 0-1 (other timers or
timer channels could be used making the obvious substitutions):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">RTOS</span> <span class="pre">Features</span> <span class="pre">-&gt;</span> <span class="pre">Clocks</span> <span class="pre">and</span> <span class="pre">Timers</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SCHED_TICKLESS=y          : Configures the RTOS in tickless mode
CONFIG_SCHED_TICKLESS_ALARM=n    : (option not implemented)
CONFIG_SCHED_TICKLESS_LIMIT_MAX_SLEEP=y
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">SAMV7</span> <span class="pre">Peripheral</span> <span class="pre">Support</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_TC0=y               : Enable TC0 (TC channels 0-3
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">Timer/counter</span> <span class="pre">Configuration</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_ONESHOT=y           : Enables one-shot timer wrapper
CONFIG_SAMV7_FREERUN=y           : Enabled free-running timer wrapper
CONFIG_SAMV7_TICKLESS_ONESHOT=0  : Selects TC0 channel 0 for the one-shot
CONFIG_SAMV7_TICKLESS_FREERUN=1  : Selects TC0 channel 1 for the free-
                                 : running timer
</pre></div>
</div>
</div></blockquote>
<p>The resolution of the clock is provided by the <code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code>
setting in the configuration file.</p>
<p>NOTE: In most cases, the slow clock will be used as the timer/counter
input.  The 32.768KHz crystal is selected by the definition
<code class="docutils literal notranslate"><span class="pre">BOARD_HAVE_SLOWXTAL</span></code> in the <code class="docutils literal notranslate"><span class="pre">boards/arm/samv7/samv71-xult/board.h</span></code> file.</p>
<p>The slow clock has a resolution of about 30.518 microseconds.  Ideally,
the value of <code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code> should be the exact clock resolution.
Otherwise there will be cumulative timing inaccuracies.  But a choice of:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_USEC_PER_TICK=31
</pre></div>
</div>
<p>will have an error of 0.6%  and will have inaccuracies that will
effect the time due to long term error build-up.</p>
<p>Using the slow clock clock input, the Tickless support is functional,
however, there are inaccuracies  in delays.  For example,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; sleep 10
</pre></div>
</div>
<p>results in a delay of maybe 5.4 seconds.  But the timing accuracy is
correct if all competing uses of the interval timer are disabled (mostly
from the high priority work queue).  Therefore, I conclude that this
inaccuracy is due to the inaccuracies in the representation of the clock
rate.  30.518 usec cannot be represented accurately.   Each timing
calculation results in a small error.  When the interval timer is very
busy, long delays will be divided into many small pieces and each small
piece has a large error in the calculation.  The cumulative error is the
cause of the problem.</p>
<p>Solution:  The <code class="docutils literal notranslate"><span class="pre">samv71-xult/src/sam_boot.c</span></code> file has additional logic
to enable the programmable clock PCK6 as a clock source for the
timer/counters if the Tickless mode is selected.  The ideal frequency
would be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>frequency = 1,000,000 / CONFIG_USEC_PER_TICK
</pre></div>
</div>
<p>The main crystal is selected as the frequency source.  The maximum
prescaler value is 256 so the minimum frequency is 46,875 Hz which
corresponds to a period of 21.3 microseconds.  A value of
<code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK=20</span></code>, or 50 KHz, would give an exact solution with
a divider of 240.</p>
</div></blockquote>
</section>
<section id="samv7-timer-usage">
<h3>SAMV7 Timer Usage<a class="headerlink" href="#samv7-timer-usage" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This current implementation uses two timers:  A one-shot timer to
provide the timed events and a free running timer to provide the current
time.  Since timers are a limited resource, that could be an issue on
some systems.</p>
<p>We could do the job with a single timer if we were to keep the single
timer in a free-running at all times.  The SAMV7 timer/counters have
16-bit counters with the capability to generate a compare interrupt when
the timer matches a compare value but also to continue counting without
stopping (giving another, different interrupt when the timer rolls over
from <code class="docutils literal notranslate"><span class="pre">0xffff</span></code> to zero).  So we could potentially just set the compare at
the number of ticks you want PLUS the current value of timer.  Then you
could have both with a single timer:  An interval timer and a free-
running counter with the same timer!  In this case, you would want to
to set <code class="docutils literal notranslate"><span class="pre">CONFIG_SCHED_TICKLESS_ALARM</span></code> in the NuttX configuration.</p>
<p>Patches are welcome!</p>
</div></blockquote>
</section>
</section>
<section id="debugging">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>The on-board EDBG appears to work only with Atmel Studio.  You can however,
simply connect a SAM-ICE or J-Link to the JTAG/SWD connector on the board
and that works great.  The only tricky thing is getting the correct
orientation of the JTAG connection.</p>
<p>I have been using Atmel Studio to write code to flash then I use the Segger
J-Link GDB server to debug.  I have been using the ‘Device Programming’
available under the Atmel Studio ‘Tool’ menu.  I have to disconnect the
SAM-ICE while programming with the EDBG.</p>
<p>You can also load code into flash directory with J-Link:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>arm-none-eabi-gdb
(gdb) target remote localhost:2331
(gdb) mon reset
(gdb) mon halt
(gdb) load nuttx
</pre></div>
</div>
<p>I run GDB like this from the directory containing the NuttX ELF file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>arm-none-eabi-gdb
(gdb) target remote localhost:2331
(gdb) mon reset
(gdb) file nuttx
(gdb) ... start debugging ...
</pre></div>
</div>
</div></blockquote>
</section>
<section id="configurations">
<span id="id1"></span><h2><a class="toc-backref" href="#id21" role="doc-backlink">Configurations</a><a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<nav class="contents local" id="id2">
<ul class="simple">
<li><p><a class="reference internal" href="#information-common-to-all-configurations" id="id22">Information Common to All Configurations</a></p></li>
<li><p><a class="reference internal" href="#knsh" id="id23">knsh</a></p></li>
<li><p><a class="reference internal" href="#module" id="id24">module</a></p></li>
<li><p><a class="reference internal" href="#mrf24j40-starhub" id="id25">mrf24j40-starhub</a></p></li>
<li><p><a class="reference internal" href="#mxtxplnd" id="id26">mxtxplnd</a></p></li>
<li><p><a class="reference internal" href="#netnsh" id="id27">netnsh</a></p></li>
<li><p><a class="reference internal" href="#nsh" id="id28">nsh</a></p></li>
<li><p><a class="reference internal" href="#nxwm" id="id29">nxwm</a></p></li>
<li><p><a class="reference internal" href="#oa-tc6" id="id30">oa_tc6</a></p></li>
<li><p><a class="reference internal" href="#vnc" id="id31">vnc</a></p></li>
<li><p><a class="reference internal" href="#vnxwm" id="id32">vnxwm</a></p></li>
<li><p><a class="reference internal" href="#mcuboot-loader" id="id33">mcuboot-loader</a></p></li>
<li><p><a class="reference internal" href="#slot-mcuboot-swap-test" id="id34">slot-mcuboot-swap-test</a></p></li>
<li><p><a class="reference internal" href="#mcuboot-update-agent" id="id35">mcuboot-update-agent</a></p></li>
<li><p><a class="reference internal" href="#mcuboot-slot-confirm" id="id36">mcuboot-slot-confirm</a></p></li>
</ul>
</nav>
<section id="information-common-to-all-configurations">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Information Common to All Configurations</a><a class="headerlink" href="#information-common-to-all-configurations" title="Permalink to this heading"></a></h3>
<p>Each SAMV71-XULT configuration is maintained in a sub-directory and
can be selected as follow:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tools/configure.sh [OPTIONS] samv71-xult:&lt;subdir&gt;
</pre></div>
</div>
<p>Where typical options are -l to configure to build on Linux or -c to
configure for Cygwin under Linux.  <code class="docutils literal notranslate"><span class="pre">tools/configure.sh</span> <span class="pre">-h</span></code> will show
you all of the options.</p>
<p>Before building, make sure the PATH environment variable include the
correct path to the directory than holds your toolchain binaries.</p>
<p>And then build NuttX by simply typing the following.  At the conclusion of
the make, the nuttx binary will reside in an ELF file called, simply, nuttx.</p>
<p>NOTES:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>These configurations use the mconf-based configuration tool.  To
change any of these configurations using that tool, you should:</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Build and install the <code class="docutils literal notranslate"><span class="pre">kconfig-mconf</span></code> tool.  See <code class="docutils literal notranslate"><span class="pre">nuttx/README.txt</span></code>
see additional <code class="docutils literal notranslate"><span class="pre">README.txt</span></code> files in the NuttX tools repository.</p></li>
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code> in <code class="docutils literal notranslate"><span class="pre">nuttx/</span></code> in order to start the
reconfiguration process.</p></li>
</ol>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>Unless stated otherwise, all configurations generate console
output on UART3 (i.e., for the Arduino serial shield).</p></li>
<li><p>All of these configurations are set up to build under Windows using the
“GNU Tools for ARM Embedded Processors” that is maintained by ARM
(unless stated otherwise in the description of the configuration).</p>
<blockquote>
<div><p><a class="reference external" href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm">https://developer.arm.com/open-source/gnu-toolchain/gnu-rm</a></p>
</div></blockquote>
<p>That toolchain selection can easily be reconfigured using
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>.  Here are the relevant current settings:</p>
<p><code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Setup:</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_WINDOWS=y               : Window environment
CONFIG_WINDOWS_CYGWIN=y             : Cywin under Windows
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span> <span class="pre">-&gt;</span> <span class="pre">Toolchain:</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARM_TOOLCHAIN_GNU_EABI=y  : GNU ARM EABI toolchain
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</section>
<section id="knsh">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">knsh</a><a class="headerlink" href="#knsh" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is identical to the <code class="docutils literal notranslate"><span class="pre">nsh</span></code> configuration below except that NuttX
is built as a protected mode, monolithic module and the user applications
are built separately.</p>
<blockquote>
<div><p>There are five very similar NSH configurations:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">knsh</span></code>.  This is a somewhat simplified version of the nsh configuration
that builds using the protected build mode (<code class="docutils literal notranslate"><span class="pre">CONFIG_BUILD_PROTECTED=y</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nsh</span></code>.  This configuration is focused on low level, command-line
driver testing.  It has no network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">netnsh</span></code>.  This configuration is focused on network testing and
has only limited command support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module</span></code>.  A simple stripped down configuration that was used for testing
NuttXOS modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mxtxplnd</span></code>.  This configuration is identical to the nsh configuration
but assumes that you have a maXTouch Xplained Pro LCD attached
and includes extra tests for the touchscreen and LCD.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>It is recommends to use a special make command; not just <code class="docutils literal notranslate"><span class="pre">make</span></code> but make
with the following two arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make pass1 pass2
</pre></div>
</div>
<p>In the normal case (just <code class="docutils literal notranslate"><span class="pre">make</span></code>), make will attempt to build both user-
and kernel-mode blobs more or less interleaved.  This actual works!
However, for me it is very confusing so I prefer the above make command:
Make the user-space binaries first (pass1), then make the kernel-space
binaries (pass2)</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>At the end of the build, there will be several files in the top-level
NuttX build directory:</p>
<p>PASS1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nuttx_user.elf    - The pass1 user-space ELF file
nuttx_user.hex    - The pass1 Intel HEX format file (selected in defconfig)
User.map          - Symbols in the user-space ELF file
</pre></div>
</div>
<p>PASS2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nuttx             - The pass2 kernel-space ELF file
nuttx.hex         - The pass2 Intel HEX file (selected in defconfig)
System.map        - Symbols in the kernel-space ELF file
</pre></div>
</div>
<p>The J-Link programmer will accept files in <code class="docutils literal notranslate"><span class="pre">.hex</span></code>, <code class="docutils literal notranslate"><span class="pre">.mot</span></code>, <code class="docutils literal notranslate"><span class="pre">.srec</span></code>, and <code class="docutils literal notranslate"><span class="pre">.bin</span></code>
formats.</p>
</li>
<li><p>Combining <code class="docutils literal notranslate"><span class="pre">.hex</span></code> files.  If you plan to use the <code class="docutils literal notranslate"><span class="pre">.hex</span></code> files with your
debugger or FLASH utility, then you may need to combine the two hex
files into a single <code class="docutils literal notranslate"><span class="pre">.hex</span></code> file.  Here is how you can do that.</p>
<ol class="loweralpha">
<li><p>The <code class="docutils literal notranslate"><span class="pre">tail</span></code> of the <code class="docutils literal notranslate"><span class="pre">nuttx.hex</span></code> file should look something like this
(with my comments added):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tail nuttx.hex
# 00, data records
...
:10 9DC0 00 01000000000800006400020100001F0004
:10 9DD0 00 3B005A0078009700B500D400F300110151
:08 9DE0 00 30014E016D0100008D
# 05, Start Linear Address Record
:04 0000 05 0800 0419 D2
# 01, End Of File record
:00 0000 01 FF
</pre></div>
</div>
<p>Use an editor such as <code class="docutils literal notranslate"><span class="pre">vi</span></code> to remove the 05 and 01 records.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">head</span></code> of the <code class="docutils literal notranslate"><span class="pre">nuttx_user.hex</span></code> file should look something like
this (again with my comments added):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ head nuttx_user.hex
# 04, Extended Linear Address Record
:02 0000 04 0801 F1
# 00, data records
:10 8000 00 BD89 01084C800108C8110208D01102087E
:10 8010 00 0010 00201C1000201C1000203C16002026
:10 8020 00 4D80 01085D80010869800108ED83010829
...
</pre></div>
</div>
<p>Nothing needs to be done here.  The <code class="docutils literal notranslate"><span class="pre">nuttx_user.hex</span></code> file should
be fine.</p>
</li>
<li><p>Combine the edited <code class="docutils literal notranslate"><span class="pre">nuttx.hex</span></code> and un-edited <code class="docutils literal notranslate"><span class="pre">nuttx_user.hex</span></code>
file to produce a single combined hex file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat nuttx.hex nuttx_user.hex &gt;combined.hex
</pre></div>
</div>
</li>
</ol>
<p>Then use the <code class="docutils literal notranslate"><span class="pre">combined.hex</span></code> file with the to write the FLASH image.
If you do this a lot, you will probably want to invest a little time
to develop a tool to automate these steps.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="module">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">module</a><a class="headerlink" href="#module" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>A simple stripped down configuration that was used for testing NuttX
OS modules.</p>
<blockquote>
<div><p>There are five very similar NSH configurations:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">knsh</span></code>.  This is a somewhat simplified version of the nsh configuration
that builds using the protected build mode (<code class="docutils literal notranslate"><span class="pre">CONFIG_BUILD_PROTECTED=y</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nsh</span></code>.  This configuration is focused on low level, command-line
driver testing.  It has no network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">netnsh</span></code>.  This configuration is focused on network testing and
has only limited command support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module</span></code>.  A simple stripped down configuration that was used for testing
NuttXOS modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mxtxplnd</span></code>.  This configuration is identical to the nsh configuration
but assumes that you have a maXTouch Xplained Pro LCD attached
and includes extra tests for the touchscreen and LCD.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>NOTES:</p>
<ol class="arabic">
<li><p>Kernel Modules / Shared Libraries</p>
<p>I intend to use this configuration for testing NuttX kernel modules
in the FLAT build with the following configuration additions to the
configuration file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BOARDCTL_OS_SYMTAB=y
CONFIG_EXAMPLES_MODULE=y
CONFIG_EXAMPLES_MODULE_BINDIR=&quot;/mnt/sdcard&quot;
CONFIG_FS_ROMFS=y
CONFIG_LIBC_ARCH_ELF=y
CONFIG_MODULE=y
CONFIG_LIBC_ELF=y
CONFIG_LIBC_ELF_ALIGN_LOG2=2
CONFIG_LIBC_ELF_BUFFERINCR=32
CONFIG_LIBC_ELF_BUFFERSIZE=128
</pre></div>
</div>
<p>Add the following for testing shared libraries in the FLAT
build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_LIBC_DLFCN=y
CONFIG_EXAMPLES_SOTEST=y
CONFIG_EXAMPLES_SOTEST_BINDIR=&quot;/mnt/sdcard&quot;
</pre></div>
</div>
</li>
</ol>
<p>STATUS:
2017-01-30: Does not yet run correctly.</p>
</div></blockquote>
</section>
<section id="mrf24j40-starhub">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">mrf24j40-starhub</a><a class="headerlink" href="#mrf24j40-starhub" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This configuration implement a hub node in a 6LoWPAN start network.
It is intended for the us the <code class="docutils literal notranslate"><span class="pre">mrf24j40-starpoint</span></code> configuration with
the <code class="docutils literal notranslate"><span class="pre">clicker2-stm32</span></code> configurations.  Essentially, the SAMV71-XULT
plays the role of the hub in the configuration and the clicker2-stm32
boards are the endpoints in the start.</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>The serial console is configured by default for use with and Arduino
serial shield (UART3).  You will need to reconfigure if you will
to use a different U[S]ART.</p></li>
<li><p>This configuration derives from the netnsh configuration, but adds
support for IPv6, 6LoWPAN, and the MRF24J40 IEEE 802.15.4 radio.</p></li>
<li><p>This configuration uses the Mikroe BEE MRF24j40 click boards and
connects to the SAMV71-XULT using a click shield as described above.</p></li>
<li><p>You must must have also have at least two clicker2-stm32 boards each
with an  MRF24J40 BEE click board in order to run these tests.</p></li>
<li><p>The network initialization thread is NOT enabled.  As a result, the
startup will hang if the Ethernet cable is not plugged in.  For more
information, see the paragraphs above entitled “Network Initialization
Thread” and “Network Monitor”.</p></li>
<li><p>This configuration supports logging of debug output to a circular
buffer in RAM.  This feature is discussed fully in this Wiki page:
<a class="reference external" href="https://cwiki.apache.org/confluence/display/NUTTX/SYSLOG">https://cwiki.apache.org/confluence/display/NUTTX/SYSLOG</a> . Relevant
configuration settings are summarized below:</p>
<p>Device Drivers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_RAMLOG=y             : Enable the RAM-based logging feature.
CONFIG_RAMLOG_SYSLOG=y      : This enables the RAM-based logger as the
                            system logger.
CONFIG_RAMLOG_NONBLOCKING=y : Needs to be non-blocking for dmesg
CONFIG_RAMLOG_BUFSIZE=8192  : Buffer size is 8KiB
</pre></div>
</div>
<p>NOTE: This RAMLOG feature is really only of value if debug output
is enabled.  But, by default, no debug output is disabled in this
configuration.  Therefore, there is no logic that will add anything
to the RAM buffer.  This feature is configured and in place only
to support any future debugging needs that you may have.</p>
<p>If you don’t plan on using the debug features, then by all means
disable this feature and save 8KiB of RAM!</p>
<p>NOTE: There is an issue with capturing data in the RAMLOG:  If
the system crashes, all of the crash dump information will go into
the RAMLOG and you will be unable to access it!  You can tell that
the system has crashed because (a) it will be unresponsive and (b)
the LD2 will be blinking at about 2Hz.</p>
<p>You can also reconfigure to use stdout for debug output be disabling
all of the CONFIG_RAMLOG* settings listed above and enabling the
following in the <code class="docutils literal notranslate"><span class="pre">.config</span></code> file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SYSLOG_CONSOLE=y
</pre></div>
</div>
</li>
<li><p>Telnet:  The <code class="docutils literal notranslate"><span class="pre">clicker2-stm32</span></code> star point configuration supports the
Telnet daemon, but not the Telnet client; the star hub configuration
supports the Telnet client, but not the Telnet daemon.  Therefore,
the star hub can Telnet to any point in the star, the star endpoints
cannot initiate telnet sessions.</p></li>
<li><p>TCP and UDP Tests:  The same TCP and UDP tests as described for
the <code class="docutils literal notranslate"><span class="pre">clicker2-stm32</span></code> <code class="docutils literal notranslate"><span class="pre">mrf24j40-starpoint</span></code> configuration are supported on
the star endpoints, but NOT on the star hub.  Therefore, all network
testing is between endpoints with the hub acting, well, only like a
hub.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">nsh&gt;</span> <span class="pre">dmesg</span></code> command can be used at any time on any node to see
any debug output that you have selected.</p>
<p>Telenet sessions may be initiated only from the hub to a star
endpoint:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C: nsh&gt; telnet &lt;server-ip&gt; &lt;-- Runs the Telnet client
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;server-ip&gt;</span></code> is the IP address of either the E1 or I2 endpoints.</p>
</li>
</ol>
<dl>
<dt>STATUS:</dt><dd><dl>
<dt>2017-07-02:</dt><dd><p>Configurations added.  Not yet tested.</p>
</dd>
<dt>2017-07-03:</dt><dd><p>Initial testing, appears to be working, but endpoints
fail to associate; sniffer shows that nothing sent from the star
hub.  I am thinking that there is something wrong with the
GPIO interrupt configuration so that no MRF24J40 interrupt are
being received.</p>
</dd>
<dt>2017-08-15:</dt><dd><p>I think the GPIO interrupts are fixed but there still
seems to be some issue with the SPI communications.</p>
</dd>
<dt>2017-08-16:</dt><dd><p>I believe that there is something interfering with the
MRF24J40 on the SPI0.  There are other things on the bus.  The
MRF24J40 requires sole use of the SPI bus because it holds MISO
low when not selected.</p>
<p>I successfully brought the same logic up on the SAME70-Xplained.
The SPI signals look clean on the board and the MRF24J40 seems
fully functional.</p>
</dd>
<dt>2017-08-26:</dt><dd><p>There was only a single buffer for reassemblying larger
packets.  This could be a problem issue for the hub configuration
which really needs the capability concurrently reassemble multiple
incoming streams.  The design was extended to support multiple
reassembly buffers but additional testing is needed.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</section>
<section id="mxtxplnd">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">mxtxplnd</a><a class="headerlink" href="#mxtxplnd" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Configures the NuttShell (<code class="docutils literal notranslate"><span class="pre">nsh</span></code>) located at <code class="docutils literal notranslate"><span class="pre">examples/nsh</span></code>.</p>
<p>There are five very similar NSH configurations:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">knsh</span></code>.  This is a somewhat simplified version of the nsh configuration
that builds using the protected build mode (<code class="docutils literal notranslate"><span class="pre">CONFIG_BUILD_PROTECTED=y</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nsh</span></code>.  This configuration is focused on low level, command-line
driver testing.  It has no network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">netnsh</span></code>.  This configuration is focused on network testing and
has only limited command support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module</span></code>.  A simple stripped down configuration that was used for testing
NuttXOS modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mxtxplnd</span></code>.  This configuration is identical to the nsh configuration
but assumes that you have a maXTouch Xplained Pro LCD attached
and includes extra tests for the touchscreen and LCD.</p></li>
</ul>
</div></blockquote>
<p>NOTES:</p>
<ol class="arabic">
<li><p>See the notes associated with the nsh configuration below.  Only
differences from that configuration will be addressed here.</p></li>
<li><p>Basic touchscreen/LCD configuration settings are discussed above in
the paragraph entitled, “maXTouch Xplained Pro”.</p></li>
<li><p>Unlike the nsh configuration, this configuration has the serial console
setup to USART0 which is available on EXT1:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Connector</p></th>
<th class="head"><p>PIO</p></th>
<th class="head"><p>Arduino</p></th>
<th class="head"><p>SAMV7</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EXT1 pin 13</p></td>
<td><p>PB0</p></td>
<td><p>RX3</p></td>
<td><p>RXD0</p></td>
</tr>
<tr class="row-odd"><td><p>EXT1 pin 14</p></td>
<td><p>PB1</p></td>
<td><p>TX3</p></td>
<td><p>TXD0</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and also on the Arduino Communications connector (J505):</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Connector</p></th>
<th class="head"><p>PIO</p></th>
<th class="head"><p>Arduino</p></th>
<th class="head"><p>SAMV7</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>J505 pin 7</p></td>
<td><p>PB0</p></td>
<td><p>RX3</p></td>
<td><p>RXD0</p></td>
</tr>
<tr class="row-odd"><td><p>J505 pin 8</p></td>
<td><p>PB1</p></td>
<td><p>TX3</p></td>
<td><p>TXD0</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Use of either the EXT1 or the LCD/EXT4 connectors conflict with the
Arduino RXD pin (UART3, PD28).  You cannot put the maXTouch Xplained
in EXT1 or LCD/EXT4 and also use the Arduino RXD/TXD pins as your
serial console.</p>
<p>The LCD (EXT4) is configured by default because only the parallel LCD
interface is currently supported and that is only available on that
connector.</p>
<p>If you plan to use EXT2 for some reason, you may re-configure the
serial console to use UART3, the standard Arduino RXD/TXD.  You
would also, of course, have to disable the LCD.</p>
<p>NOTE that the USART0 pins PB0 and PB1 conflict with SSC TF and TK
pins as connected to the WM8904 audio CODEC.  So, unless yet a
different U[S]ART option is selected, Audio cannot be used with
this configuration.</p>
</li>
<li><p>SDRAM is NOT enabled in this configuration.</p></li>
<li><p>Support for the ILI8488 LCD is enabled.  Only the parallel mode is
supported at present.  As a consequence, the maXTouch Xplained Pro
must be connected at the LCD (EXT4) connector.  This mode requires:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV71XULT_MXTXPLND_LCD=y : Must be connect in LCD (EXT4)
CONFIG_SAMV7_SMC=y               : SMC/EBI support
CONFIG_SAMV7_XDMAC=y             : XDMAC support
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">appx/examples/nxlines</span></code> is enabled as a built-in application.
This is a test that displays some simple graphics and can be
executed from the NSH command line like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; nxlines
</pre></div>
</div>
</li>
<li><p>When the maXTouch Xplained is connected (in any position), a new I2C
address appears at address <code class="docutils literal notranslate"><span class="pre">0x4a</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; i2c dev 3 77
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- 1a -- -- -- -- --
20: -- -- -- -- -- -- -- -- 28 -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- 37 -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- 4a -- -- -- 4e --
50: -- -- -- -- -- -- -- 57 -- -- -- -- -- -- -- 5f
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --
</pre></div>
</div>
<p>This is the I2C address of the maXTouch touchscreen controller.</p>
<p>(<code class="docutils literal notranslate"><span class="pre">0x1a</span></code> is the address of the WM8904 Audio CODEC, <code class="docutils literal notranslate"><span class="pre">0x28</span></code> is the
address of TWI interface to the EDBG, <code class="docutils literal notranslate"><span class="pre">0x4e</span></code> is the address of the
CP2100CP programmable PLL, and <code class="docutils literal notranslate"><span class="pre">0x57</span></code> and <code class="docutils literal notranslate"><span class="pre">0x5f</span></code> are the addresses of
the AT2 EEPROM. I am not sure what the other address, <code class="docutils literal notranslate"><span class="pre">0x37</span></code>, is).</p>
</li>
<li><p>Support for the touchscreen test is enabled (see <code class="docutils literal notranslate"><span class="pre">apps/examples/touchscreen</span></code>),
however, the maXTouch is not yet working (see STATUS below).</p></li>
</ol>
<dl class="simple">
<dt>STATUS:</dt><dd><dl class="simple">
<dt>2015-04-05:  Partial support for the maXTouch Xplained Pro LCD is in</dt><dd><p>place.  The ILI9488-based LCD is working well with a SMC DMA-based
interface.  Very nice performance.</p>
</dd>
<dt>2015-05-12:  After some difficulties, the maXTouch touchscreen</dt><dd><p>controller is now fully functional as well.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</section>
<section id="netnsh">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">netnsh</a><a class="headerlink" href="#netnsh" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Configures the NuttShell (<code class="docutils literal notranslate"><span class="pre">nsh</span></code>) located at <code class="docutils literal notranslate"><span class="pre">examples/nsh</span></code>.</p>
<blockquote>
<div><p>There are five very similar NSH configurations:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">knsh</span></code>.  This is a somewhat simplified version of the nsh configuration
that builds using the protected build mode (<code class="docutils literal notranslate"><span class="pre">CONFIG_BUILD_PROTECTED=y</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nsh</span></code>.  This configuration is focused on low level, command-line
driver testing.  It has no network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">netnsh</span></code>.  This configuration is focused on network testing and
has only limited command support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module</span></code>.  A simple stripped down configuration that was used for testing
NuttXOS modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mxtxplnd</span></code>.  This configuration is identical to the nsh configuration
but assumes that you have a maXTouch Xplained Pro LCD attached
and includes extra tests for the touchscreen and LCD.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>NOTES:</p>
<ol class="arabic">
<li><p>The serial console is configured by default for use with and Arduino
serial shield (UART3).  You will need to reconfigure if you will
to use a different U[S]ART.</p></li>
<li><p>Default stack sizes are large and should really be tuned to reduce
the RAM footprint:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SCHED_HPWORKSTACKSIZE=2048
CONFIG_IDLETHREAD_STACKSIZE=1024
CONFIG_INIT_STACKSIZE=2048
CONFIG_PTHREAD_STACK_MIN=256
CONFIG_PTHREAD_STACK_DEFAULT=2048
CONFIG_POSIX_SPAWN_DEFAULT_STACKSIZE=2048
CONFIG_SYSTEM_TELNETD_STACKSIZE=2048
CONFIG_SYSTEM_TELNETD_SESSION_STACKSIZE=2048
</pre></div>
</div>
</li>
<li><p>NSH built-in applications are supported.  There are, however, not
enabled built-in applications.</p>
<p>Binary Formats:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BUILTIN=y           : Enable support for built-in programs
</pre></div>
</div>
<p>Application Configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NSH_BUILTIN_APPS=y  : Enable starting apps from NSH command line
</pre></div>
</div>
</li>
<li><p>The network initialization thread and the NSH network monitor are
enabled in this configuration. As a result, networking initialization
is performed asynchronously with NSH bring-up.  For more information,
see the paragraphs above entitled “Network Initialization Thread” and
“Network Monitor”.</p></li>
<li><p>SDRAM is NOT enabled in this configuration.</p></li>
<li><p>TWI/I2C</p>
<p>TWIHS0 is enabled in this configuration.  The SAM V71 Xplained Ultra
supports two devices on the one on-board I2C device on the TWIHS0 bus:
(1) The AT24MAC402 serial EEPROM described above and (2) the Wolfson
WM8904 audio CODEC.  This device contains a MAC address for use with
the Ethernet interface.</p>
<p>Relevant configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_TWIHS0=y
CONFIG_SAMV7_TWIHS0_FREQUENCY=100000

CONFIG_I2C=y
</pre></div>
</div>
</li>
<li><p>TWIHS0 is used to support 256 byte non-volatile storage.  This EEPROM
holds the assigned MAC address which is necessary for networking. The
EEPROM is also available for storage of configuration data using the
MTD configuration as described above under the heading, “MTD
Configuration Data”.</p></li>
<li><p>Support for HSMCI is built-in by default. The SAMV71-XULT provides
one full-size SD memory card slot.  Refer to the section entitled
“SD card” for configuration-related information.</p>
<p>See “Open Issues” above for issues related to HSMCI.</p>
<p>The auto-mounter is not enabled.  See the section above entitled
“Auto-Mounter”.</p>
</li>
<li><p>Performance-related Configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARMV7M_ICACHE=y                : Instruction cache is enabled
CONFIG_ARMV7M_DCACHE=y                : Data cache is enabled
CONFIG_ARMV7M_DCACHE_WRITETHROUGH=y   : Write through mode
CONFIG_ARCH_FPU=y                     : H/W floating point support is enabled
CONFIG_ARCH_DPFPU=y                   : 64-bit H/W floating point support is enabled

# CONFIG_ARMV7M_ITCM is not set       : Support not yet in place
# CONFIG_ARMV7M_DTCM is not set       : Support not yet in place
</pre></div>
</div>
<p>I- and D-Caches are enabled but the D-Cache must be enabled in write-
through mode.  This is to work around issues with the RX and TX
descriptors with are 8-bytes in size.  But the D-Cache cache line
size is 32-bytes.  That means that you cannot reload, clean or
invalidate a descriptor without also effecting three neighboring
descriptors. Setting write through mode eliminates the need for
cleaning the D-Cache.  If only reloading and invalidating are done,
then there is no problem.</p>
<p>Stack sizes are also large to simplify the bring-up and should be
tuned for better memory usages.</p>
</li>
</ol>
<p>STATUS:
2015-03-29:  I- and D-caches are currently enabled, but as noted
above, the D-Cache must be enabled in write-through mode.  Also -Os
optimization is not being used (-O2).  If the cache is enabled in
Write-Back mode or if higher levels of optimization are enabled, then
there are failures when trying to ping the target from a host.</p>
</div></blockquote>
</section>
<section id="nsh">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">nsh</a><a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Configures the NuttShell (<code class="docutils literal notranslate"><span class="pre">nsh</span></code>) located at <code class="docutils literal notranslate"><span class="pre">examples/nsh</span></code>.</p>
<blockquote>
<div><p>There are five very similar NSH configurations:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">knsh</span></code>.  This is a somewhat simplified version of the nsh configuration
that builds using the protected build mode (<code class="docutils literal notranslate"><span class="pre">CONFIG_BUILD_PROTECTED=y</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nsh</span></code>.  This configuration is focused on low level, command-line
driver testing.  It has no network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">netnsh</span></code>.  This configuration is focused on network testing and
has only limited command support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module</span></code>.  A simple stripped down configuration that was used for testing
NuttXOS modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mxtxplnd</span></code>.  This configuration is identical to the nsh configuration
but assumes that you have a maXTouch Xplained Pro LCD attached
and includes extra tests for the touchscreen and LCD.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>NOTES:</p>
<ol class="arabic">
<li><p>The serial console is configured by default for use with and Arduino
serial shield (UART3).  You will need to reconfigure if you will
to use a different U[S]ART.</p></li>
<li><p>Default stack sizes are large and should really be tuned to reduce
the RAM footprint:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARCH_INTERRUPTSTACK=2048
CONFIG_IDLETHREAD_STACKSIZE=1024
CONFIG_INIT_STACKSIZE=2048
CONFIG_PTHREAD_STACK_DEFAULT=2048
... and others ...
</pre></div>
</div>
</li>
<li><p>NSH built-in applications are supported.</p>
<p><code class="docutils literal notranslate"><span class="pre">Binary</span> <span class="pre">Formats:</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BUILTIN=y           : Enable support for built-in programs
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration:</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NSH_BUILTIN_APPS=y  : Enable starting apps from NSH command line
</pre></div>
</div>
</li>
<li><p>SDRAM is enabled in this configuration.  Here are the relevant
configuration settings:</p>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Type</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_SDRAMC=y
CONFIG_SAMV7_SDRAMSIZE=2097152
</pre></div>
</div>
<p>SDRAM is not added to the heap in this configuration.  To do that
you would need to set <code class="docutils literal notranslate"><span class="pre">CONFIG_SAMV7_SDRAMHEAP=y</span></code> and <code class="docutils literal notranslate"><span class="pre">CONFIG_MM_REGIONS=2</span></code>.
Instead, the SDRAM is set up so that is can be used with a destructive
RAM test enabled with this option:</p>
<p><code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Configuration:</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_TESTING_RAMTEST=y
</pre></div>
</div>
<p>The RAM test can be executed as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; ramtest -w 70000000 2097152

NuttShell (NSH) NuttX-7.8
nsh&gt; ramtest -w 70000000 2097152
RAMTest: Marching ones: 70000000 2097152
RAMTest: Marching zeroes: 70000000 2097152
RAMTest: Pattern test: 70000000 2097152 55555555 aaaaaaaa
RAMTest: Pattern test: 70000000 2097152 66666666 99999999
RAMTest: Pattern test: 70000000 2097152 33333333 cccccccc
RAMTest: Address-in-address test: 70000000 2097152
nsh&gt;
</pre></div>
</div>
</li>
<li><p>TWI/I2C</p>
<p>TWIHS0 is enabled in this configuration.  The SAM V71 Xplained Ultra
supports two devices on the one on-board I2C device on the TWIHS0 bus:
(1) The AT24MAC402 serial EEPROM described above and (2) the Wolfson
WM8904 audio CODEC.  This device contains a MAC address for use with
the Ethernet interface.</p>
<p>In this configuration, the I2C tool at <code class="docutils literal notranslate"><span class="pre">apps/system/i2ctool</span></code> is
enabled.  This tools supports interactive access to I2C devices on
the enabled TWIHS bus.  Relevant configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SAMV7_TWIHS0=y
CONFIG_SAMV7_TWIHS0_FREQUENCY=100000

CONFIG_I2C=y

CONFIG_SYSTEM_I2CTOOL=y
CONFIG_I2CTOOL_MINBUS=0
CONFIG_I2CTOOL_MAXBUS=0
CONFIG_I2CTOOL_MINADDR=0x03
CONFIG_I2CTOOL_MAXADDR=0x77
CONFIG_I2CTOOL_MAXREGADDR=0xff
CONFIG_I2CTOOL_DEFFREQ=400000
</pre></div>
</div>
<p>Example usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; i2c
Usage: i2c &lt;cmd&gt; [arguments]
Where &lt;cmd&gt; is one of:

  Show help     : ?
  List buses    : bus
  List devices  : dev [OPTIONS] &lt;first&gt; &lt;last&gt;
  Read register : get [OPTIONS] [&lt;repetitions&gt;]
  Show help     : help
  Write register: set [OPTIONS] &lt;value&gt; [&lt;repetitions&gt;]
  Verify access : verf [OPTIONS] [&lt;value&gt;] [&lt;repetitions&gt;]

Where common &quot;sticky&quot; OPTIONS include:
  [-a addr] is the I2C device address (hex).  Default: 03 Current: 03
  [-b bus] is the I2C bus number (decimal).  Default: 0 Current: 0
  [-r regaddr] is the I2C device register address (hex).  Default: 00 Current: 00
  [-w width] is the data width (8 or 16 decimal).  Default: 8 Current: 8
  [-s|n], send/don&#39;t send start between command and data.  Default: -n Current: -n
  [-i|j], Auto increment|don&#39;t increment regaddr on repetitions.  Default: NO Current: NO
  [-f freq] I2C frequency.  Default: 400000 Current: 400000

NOTES:
o An environment variable like $PATH may be used for any argument.
o Arguments are &quot;sticky&quot;.  For example, once the I2C address is
specified, that address will be reused until it is changed.

WARNING:
o The I2C dev command may have bad side effects on your I2C devices.
Use only at your own risk.

nsh&gt; i2c bus
 BUS   EXISTS?
Bus 0: YES
nsh&gt; i2c dev 3 77
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- 1a -- -- -- -- --
20: -- -- -- -- -- -- -- -- 28 -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- 37 -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- 4e --
50: -- -- -- -- -- -- -- 57 -- -- -- -- -- -- -- 5f
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --
nsh&gt;
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">0x1a</span></code> is the address of the WM8904 Audio CODEC, <code class="docutils literal notranslate"><span class="pre">0x28</span></code> is the
address of TWI interface to the EDBG, <code class="docutils literal notranslate"><span class="pre">0x4e</span></code> is the address of the
CP2100CP programmable PLL, and <code class="docutils literal notranslate"><span class="pre">0x57</span></code> and <code class="docutils literal notranslate"><span class="pre">0x5f</span></code> are the addresses of
the AT2 EEPROM (I am not sure what the other address, <code class="docutils literal notranslate"><span class="pre">0x37</span></code>, is
as this writing).</p>
</li>
<li><p>TWIHS0 is also used to support 256 byte non-volatile storage for
configuration data using the MTD configuration as described above
under the heading, “MTD Configuration Data”.</p></li>
<li><p>Support for HSMCI is built-in by default. The SAMV71-XULT provides
one full-size SD memory card slot.  Refer to the section entitled
“SD card” for configuration-related information.</p>
<p>See “Open Issues” above for issues related to HSMCI.</p>
<p>The auto-mounter is not enabled.  See the section above entitled
“Auto-Mounter”.</p>
</li>
<li><p>Performance-related Configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_ARMV7M_ICACHE=y                : Instruction cache is enabled
CONFIG_ARMV7M_DCACHE=y                : Data cache is enabled
CONFIG_ARMV7M_DCACHE_WRITETHROUGH=n   : Write back mode
CONFIG_ARCH_FPU=y                     : H/W floating point support is enabled
CONFIG_ARCH_DPFPU=y                   : 64-bit H/W floating point support is enabled

# CONFIG_ARMV7M_ITCM is not set       : Support not yet in place
# CONFIG_ARMV7M_DTCM is not set       : Support not yet in place

Stack sizes are also large to simplify the bring-up and should be
tuned for better memory usages.
</pre></div>
</div>
</li>
</ol>
<p>STATUS:
2015-03-28: HSMCI TX DMA is disabled.  There are some issues with the TX
DMA that need to be corrected.</p>
</div></blockquote>
</section>
<section id="nxwm">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">nxwm</a><a class="headerlink" href="#nxwm" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is a special configuration setup for the NxWM window manager
UnitTest.  It provides an interactive windowing experience with the
maXTouch Xplained Pro LCD.</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>The NxWM window manager is a tiny window manager tailored for use
with smaller LCDs.  It supports a task, a start window, and
multiple application windows with toolbars.  However, to make the
best use of the visible LCD space, only one application window is
visible at at time.</p>
<p>The NxWM window manager can be found here:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/graphics/NxWidgets/nxwm
</pre></div>
</div>
<p>The NxWM unit test can be found at:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/graphics/NxWidgets/UnitTests/nxwm
</pre></div>
</div>
</li>
<li><p>Reading from the LCD is not currently functional.  The following
settings are in the configuration that tell the system that this
is a read-only LCD:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_LCD_NOGETRUN=y
CONFIG_NX_WRITEONLY=y
</pre></div>
</div>
</li>
<li><p>Small Icons are selected and can be very difficult to touch.  You
might want to enable larger icons with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NXWM_LARGE_ICONS=y
</pre></div>
</div>
</li>
</ol>
<p>STATUS:
2015-05-13:
- The demo functions and produces displays but is not yet very stable.</p>
<blockquote>
<div><ul>
<li><p>I have two maXTouch  Xplained Pro displays.  One works well, the
other has some issues which I suspect are due to the ribbon cable
connector with fits too snugly on one side.</p>
<p>Here are the symptoms of the LCD that does not work.  I attribute
these problems with problems in the parallel interface due to a
bad connection:</p>
<ul class="simple">
<li><p>The color is wrong; to reddish.  This suggests some issue with color
format or pixel width</p></li>
<li><p>Images are positioned correctly on the display, but all half the
horizontal width that they should be, again suggesting some problem
with the pixel with.</p></li>
<li><p>Some images are simply truncated to half the correct size (such as
the touch circles in the calibration screen).</p></li>
<li><p>Other images are horizontally compressed (such as the initial NX
logo on the background).</p></li>
</ul>
</li>
<li><p>As mentioned above, reading from the LCD is not currently functional.
There are some special settings work work around this but the
bottom line is that transparent operations cannot yet be supported.</p></li>
<li><p>I am seeing some small artifacts with the font used in the HEX
calculator display.</p></li>
<li><p>Line spacing in the NxTerm window is too much.  This is probably
a font-related issue too.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="oa-tc6">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">oa_tc6</a><a class="headerlink" href="#oa-tc6" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This configuration features the network driver for 10BASE-T1S and 10BASE-T1L SPI MAC-PHYs
that follow the <cite>OPEN Alliance 10BASE-T1x MAC-PHY Serial Interface</cite> specification (OA-TC6).</p>
<p>Among such MAC-PHYs are e.g. Microchip LAN865x, Onsemi NCV7410 (NCN26010), Analog Devices ADIN1110.
See the build configuration utility (e.g. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>) to find out which ones are currently supported.</p>
<p>The OA-TC6 defines a 5 signal connection between the MAC-PHY and the host MCU. These are 4 lines for the standard SPI and 1 line for the interrupt signal from the MAC-PHY to the MCU.</p>
<p><strong>Default pinout</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SAVM71 PIO</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PA04</p></td>
<td><p>INT</p></td>
<td><p>MAC-PHY interrupt signal</p></td>
</tr>
<tr class="row-odd"><td><p>PD20</p></td>
<td><p>MISO</p></td>
<td><p>SPI Master In Slave Out</p></td>
</tr>
<tr class="row-even"><td><p>PD21</p></td>
<td><p>MOSI</p></td>
<td><p>SPI Master Out Slave In</p></td>
</tr>
<tr class="row-odd"><td><p>PD22</p></td>
<td><p>CLK</p></td>
<td><p>SPI Clock</p></td>
</tr>
<tr class="row-even"><td><p>PD25</p></td>
<td><p>CS</p></td>
<td><p>SPI Chip Select</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">oa_tc6</span></code> configuration is additionally equipped with the <code class="docutils literal notranslate"><span class="pre">plcatool</span></code> utility. This allows configuration of the Physical Layer Collision Avoidance (PLCA) functionality
in 10BASE-T1S PHYs.</p>
</div></blockquote>
</section>
<section id="vnc">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">vnc</a><a class="headerlink" href="#vnc" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is a special version of an NSH configuration.  It has networking
and graphics enabled.  It is configured to use the VNC server to provide
a remote desktop for use with VNC client on a PC.  It includes the
graphics text at <code class="docutils literal notranslate"><span class="pre">apps/examples/nximage</span></code>.</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>Network configuration:  IP address 10.0.0.2.  The is easily changed
via ‘make menuconfig’.  The VNC server address is 10.0.0.2:5900.</p></li>
<li><p>The default (local) framebuffer configuration is 320x240 with 8-bit
RGB color.</p></li>
<li><p>There are complicated interactions between VNC and the network
configuration.  The <code class="docutils literal notranslate"><span class="pre">CONFIG_VNCSERVER_UPDATE_BUFSIZE</span></code> determines the
size of update messages.  That is 1024 bytes in that configuration
(the full message with the header will be a little larger).  The
<code class="docutils literal notranslate"><span class="pre">CONFIG_NET_ETH_PKTSIZE</span></code> is set to 590 so that a full update will
require several packets.</p>
<p>Write buffering also effects network performance.  This will break
up the large updates into small (196 byte) groups.  When we run out
of read-ahead buffers, then partial updates may be sent causing a
loss of synchronization.</p>
</li>
<li><p>Hint: If you are debugging using the RealVNC client, turn off all
mouse/keyboard inputs in the options/input menu.  That will make
things a little clearer.</p></li>
<li><p>To select 16-bits per pixel RGB15 5:6:5</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NX_DISABLE_8BPP=y
# CONFIG_NX_DISABLE_16BPP is not set

# CONFIG_VNCSERVER_COLORFMT_RGB8 is not set
CONFIG_VNCSERVER_COLORFMT_RGB16=y

CONFIG_EXAMPLES_NXIMAGE_BPP=16
</pre></div>
</div>
<p>To re-select 8-bits per pixel RGB8 3:3:2</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># CONFIG_NX_DISABLE_8BPP is not set
CONFIG_NX_DISABLE_16BPP=y

CONFIG_VNCSERVER_COLORFMT_RGB8=y
# CONFIG_VNCSERVER_COLORFMT_RGB16 is not set

# CONFIG_EXAMPLES_NXIMAGE_GREYSCALE is not set
CONFIG_EXAMPLES_NXIMAGE_BPP=8
</pre></div>
</div>
</li>
</ol>
<dl>
<dt>STATUS:</dt><dd><dl>
<dt>2016-04-21:</dt><dd><p>I have gotten the <code class="docutils literal notranslate"><span class="pre">apps/examples/nximage</span></code> to work with
lots issues with 16-bit RGB and verbose GRAPHICS and UPDATER debug
ON.  There are reliability problems and it hangs at the end of the
test.</p>
</dd>
<dt>2016-04-22:</dt><dd><p>The default configuration now uses RGB8 which needs a lot
less SRAM for the local frame buffer and does not degrade the color
quality in the remote display (since it is also 8 BPP).  At 8
BPP, the remote display is correct even with both GRAPHICS and
UPDATER debug OFF – and there is no hang!</p>
</dd>
<dt>2106-04-23:</dt><dd><p>The NxImage test was selected because it is a very simple
graphics test.  Continued testing, however, requires a more complex
configuration.  Hence, the vnxwm configuration was created.</p>
<p>A memory clobber error was fixed and this probably corrects some of
the reliability problems noted on 2016-04-21.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</section>
<section id="vnxwm">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">vnxwm</a><a class="headerlink" href="#vnxwm" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is a special configuration setup for the NxWM window manager
UnitTest.  It provides an interactive windowing experience via a remote
VNC client window running on your PC.  The SAMV71-XULT is connected to
the PC via Ethernet.</p>
<p>NOTES:</p>
<ol class="arabic">
<li><p>The NxWM window manager is a tiny window manager tailored for use
with smaller LCDs.  It supports a task, a start window, and
multiple application windows with toolbars.  However, to make the
best use of the visible LCD space, only one application window is
visible at at time.</p>
<p>The NxWM window manager can be found here:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/graphics/NxWidgets/nxwm
</pre></div>
</div>
<p>The NxWM unit test can be found at:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/graphics/NxWidgets/UnitTests/nxwm
</pre></div>
</div>
</li>
<li><p>Network configuration:  IP address 10.0.0.2.  The is easily changed
via <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>.  The VNC server address is 10.0.0.2:5900.</p></li>
<li><p>The default (local) framebuffer configuration is 320x240 with 8-bit
RGB color.</p>
<p>I had some problems at 16-bits per pixle (see STATUS below).  To
select 16-bits per pixel RGB15 5:6:5</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_NX_DISABLE_8BPP=y
# CONFIG_NX_DISABLE_16BPP is not set

# CONFIG_VNCSERVER_COLORFMT_RGB8 is not set
CONFIG_VNCSERVER_COLORFMT_RGB16=y

CONFIG_EXAMPLES_NXIMAGE_BPP=16
</pre></div>
</div>
<p>To re-select 8-bits per pixel RGB8 3:3:2</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># CONFIG_NX_DISABLE_8BPP is not set
CONFIG_NX_DISABLE_16BPP=y

CONFIG_VNCSERVER_COLORFMT_RGB8=y
# CONFIG_VNCSERVER_COLORFMT_RGB16 is not set

# CONFIG_EXAMPLES_NXIMAGE_GREYSCALE is not set
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p>There are complicated interactions between VNC and the network
configuration.  The <code class="docutils literal notranslate"><span class="pre">CONFIG_VNCSERVER_UPDATE_BUFSIZE</span></code> determines the
size of update messages.  That is 1024 bytes in that configuration
(the full message with the header will be a little larger).  The
<code class="docutils literal notranslate"><span class="pre">CONFIG_NET_ETH_PKTSIZE</span></code> is set to 590 so that a full update will
require several packets.</p>
<p>Write buffering also effects network performance.  This will break
up the large updates into small (196 byte) groups.  When we run out
of read-ahead buffers, then partial updates may be sent causing a
loss of synchronization.</p>
</li>
</ol>
<dl>
<dt>STATUS:</dt><dd><dl>
<dt>2016-04-23:</dt><dd><p>Configuration created.  See status up to this data in
the vnc configuration.  That probably all applies here as well.</p>
<p>Only some initial testing has been performed:  The configuration
is partially functional.  Menus do appear and mouse input is
probably working correctly.</p>
<p>But there are a lot of instabilities.  I see assertions of
various kinds and the RealVNC client often crashes as well.
Some of the assertions I see are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>while (sem_wait(&amp;session-&gt;queuesem) &lt; 0)
...
rect = (struct vnc_fbupdate_s *)sq_remfirst(&amp;session-&gt;updqueue);
DEBUGASSERT(rect != NULL);
</pre></div>
</div>
<p>I would think that could mean only that the semaphore counting is
out of sync with the number of updates in the queue.</p>
<p>But also the assertion at <code class="docutils literal notranslate"><span class="pre">devif/devif_iobsend.c</span> <span class="pre">line:</span> <span class="pre">102</span></code> which
probably means some kind of memory corruption.</p>
</dd>
<dt>2017-01-30:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">knsh</span></code> configuration does not yet run correctly.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</section>
<section id="mcuboot-loader">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">mcuboot-loader</a><a class="headerlink" href="#mcuboot-loader" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This configuration exercises the port of MCUboot loader to NuttX.</p>
<p>In this configuration both primary, secondary and scratch partitions are
mapped into the internal flash.
Relevant configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BOARD_LATE_INITIALIZE=y

CONFIG_BOOT_MCUBOOT=y
CONFIG_MCUBOOT_BOOTLOADER=y

CONFIG_SAMV7_FORMAT_MCUBOOT=y
CONFIG_INIT_ENTRYPOINT=&quot;mcuboot_loader_main&quot;
</pre></div>
</div>
<p>Flash bootloader using embedded debugger:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openocd -f interface/cmsis-dap.cfg \
        -c &#39;transport select swd&#39; \
        -c &#39;set CHIPNAME atsamv71q21&#39; \
        -f target/atsamv.cfg \
        -c &#39;reset_config srst_only&#39; \
        -c init -c targets \
        -c &#39;reset halt&#39; \
        -c &#39;program nuttx.bin 0x400000&#39; \
        -c &#39;reset halt&#39; \
        -c &#39;atsamv gpnvm set 1&#39; \
        -c &#39;reset run&#39; -c shutdown
</pre></div>
</div>
</div></blockquote>
</section>
<section id="slot-mcuboot-swap-test">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">slot-mcuboot-swap-test</a><a class="headerlink" href="#slot-mcuboot-swap-test" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This configuration exercises the MCUboot compatible application swap image
example. The application is NuttX nsh with some special commands.</p>
<p>Generate signed binaries for MCUboot compatible application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./apps/boot/mcuboot/mcuboot/scripts/imgtool.py sign \
  --key apps/boot/mcuboot/mcuboot/root-rsa-2048.pem --align 8 \
  --version 1.0.0 --header-size 0x200 --pad-header --slot-size 0xe0000 \
  nuttx/nuttx.bin mcuboot_nuttx.app.swap.test.confirm-v1.bin

./apps/boot/mcuboot/mcuboot/scripts/imgtool.py sign \
  --key apps/boot/mcuboot/mcuboot/root-rsa-2048.pem --align 8 \
  --version 2.0.0 --header-size 0x200 --pad-header --slot-size 0xe0000 \
  nuttx/nuttx.bin mcuboot_nuttx.app.swap.test.confirm-v2.bin

Flash application version 1.0.0 at MCUboot Slot-0:

openocd -f interface/cmsis-dap.cfg \
        -c &#39;transport select swd&#39; \
        -c &#39;set CHIPNAME atsamv71q21&#39; \
        -f target/atsamv.cfg \
        -c &#39;reset_config srst_only&#39; \
        -c init -c targets \
        -c &#39;reset halt&#39; \
        -c &#39;program mcuboot_nuttx.app.swap.test.confirm-v1.bin 0x420000&#39; \
        -c &#39;reset halt&#39; \
        -c &#39;atsamv gpnvm set 1&#39; \
        -c &#39;reset run&#39; -c shutdown

Flash version 2.0.0 at MCUboot Slot-1:

openocd -f interface/cmsis-dap.cfg \
        -c &#39;transport select swd&#39; \
        -c &#39;set CHIPNAME atsamv71q21&#39; \
        -f target/atsamv.cfg \
        -c &#39;reset_config srst_only&#39; \
        -c init -c targets \
        -c &#39;reset halt&#39; \
        -c &#39;program mcuboot_nuttx.app.swap.test.confirm-v2.bin 0x500000&#39; \
        -c &#39;reset halt&#39; \
        -c &#39;atsamv gpnvm set 1&#39; \
        -c &#39;reset run&#39; -c shutdown
</pre></div>
</div>
<p>Relevant configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_MCUBOOT_SWAP_TEST=y

CONFIG_SAMV7_FORMAT_MCUBOOT=y
CONFIG_INIT_ENTRYPOINT=&quot;nsh_main&quot;
</pre></div>
</div>
</div></blockquote>
</section>
<section id="mcuboot-update-agent">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">mcuboot-update-agent</a><a class="headerlink" href="#mcuboot-update-agent" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This configuration exercises the MCUboot firmware upgrade example. The
application is NuttX nsh with some special commands.</p>
<p>Generate signed binaries for MCUboot compatible application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./apps/boot/mcuboot/mcuboot/scripts/imgtool.py sign \
  --key apps/boot/mcuboot/mcuboot/root-rsa-2048.pem --align 8 \
  --version 1.0.0 --header-size 0x200 --pad-header --slot-size 0xe0000 \
  --confirm nuttx/nuttx.bin mcuboot_nuttx.update.agent.bin

Flash agent application at MCUboot Slot-0:

openocd -f interface/cmsis-dap.cfg \
        -c &#39;transport select swd&#39; \
        -c &#39;set CHIPNAME atsamv71q21&#39; \
        -f target/atsamv.cfg \
        -c &#39;reset_config srst_only&#39; \
        -c init -c targets \
        -c &#39;reset halt&#39; \
        -c &#39;program mcuboot_nuttx.update.agent.bin 0x420000&#39; \
        -c &#39;reset halt&#39; \
        -c &#39;atsamv gpnvm set 1&#39; \
        -c &#39;reset run&#39; -c shutdown
</pre></div>
</div>
<p>The board is ready to perform an upgrade. However, this example requires
use an image to be used as new application. You can use the Confirm example,
which will be used in the download process.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">mcuboot-slot-confirm</span></code> for more information.</p>
<p>Relevant configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_MCUBOOT_UPDATE_AGENT=y

CONFIG_SAMV7_FORMAT_MCUBOOT=y
CONFIG_INIT_ENTRYPOINT=&quot;nsh_main&quot;
</pre></div>
</div>
</div></blockquote>
</section>
<section id="mcuboot-slot-confirm">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">mcuboot-slot-confirm</a><a class="headerlink" href="#mcuboot-slot-confirm" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Generate signed binaries for MCUboot compatible application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./apps/boot/mcuboot/mcuboot/scripts/imgtool.py sign \
  --key apps/boot/mcuboot/mcuboot/root-rsa-2048.pem --align 8 \
  --version 2.0.0 --header-size 0x200 --pad-header --slot-size 0xe0000 \
  nuttx/nuttx.bin mcuboot_nuttx.slot.confirm.bin
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">mcuboot_nuttx.app.confirm.bin</span></code> would be used at http server in your
network to be downloaded by Agent at MCUboot Slot-1.</p>
<p>Using Python to create a http server at your NuttX workspace:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo python -m http.server 8080 &amp;
</pre></div>
</div>
<p>Test download:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wget &lt;your PC IP&gt;:8080/mcuboot_nuttx.slot.confirm.bin -O test.bin
</pre></div>
</div>
<p>Check MD5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>md5sum mcuboot_nuttx.slot.confirm.bin test.bin
958b523f1049696aba73354615868b7f  mcuboot_nuttx.slot.confirm.bin test.bin
958b523f1049696aba73354615868b7f  test.bin
rm test.bin
</pre></div>
</div>
<p>The OTA config uses DHCP client to get local ip address. This way your board
will have automatically access to your network. Let’s check board.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;your PC IP&gt;
PING xxx.xxx.xxx.xxx 56 bytes of data
56 bytes from xxx.xxx.xxx.xxx: icmp_seq=0 time=0 ms
56 bytes from xxx.xxx.xxx.xxx: icmp_seq=1 time=0 ms
...
56 bytes from xxx.xxx.xxx.xxx: icmp_seq=9 time=0 ms
10 packets transmitted, 10 received, 0% packet loss, time 10100 ms

nsh&gt; mcuboot_agent http://xxx.xxx.xxx.xxx:8080/mcuboot_nuttx.slot.confirm.bin
MCUboot Update Agen192.168.10.104 - - [16/Dec/2021 19:29:08]
&quot;GET /mcuboot_nuttx.slot.confirm.bin HTTP/1.0&quot; 200 -t example
Downloading from http://xxx.xxx.xxx.xxx:8080/signedv2.bin
Firmware Update size: 194464 bytes
Received: 512      of 194464 bytes [0%]
Received: 1024     of 194464 bytes [0%]
...
Received: 194048   of 194464 bytes [99%]
Received: 194468   of 194468 bytes [100%]
Application Image successfully downloaded!
Requested update for next boot. Restarting...
*** Booting MCUboot build 7c890f4b075aed73e4c825ccf875b2fb9ebf2ded ***
Application Image successfully confirmed!
</pre></div>
</div>
<p>Relevant configuration settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_EXAMPLES_MCUBOOT_SLOT_CONFIRM=y

CONFIG_SAMV7_FORMAT_MCUBOOT=y
CONFIG_INIT_ENTRYPOINT=&quot;nsh_main&quot;
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../same70-xplained/index.html" class="btn btn-neutral float-left" title="same70-xplained" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../stm32c0/index.html" class="btn btn-neutral float-right" title="ST STM32C0" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>