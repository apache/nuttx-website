<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SIM &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
      <script src="../../../../../_static/jquery.js"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
      <script src="../../../../../_static/doctools.js"></script>
      <script src="../../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../../_static/clipboard.min.js"></script>
      <script src="../../../../../_static/copybutton.js"></script>
      <script src="../../../../../_static/design-tabs.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Network Support on Linux" href="../../../network_linux.html" />
    <link rel="prev" title="SIM" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../../../12.11.0" >12.11.0</option>
    
    <option value="../../../../../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../arm/index.html">ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../arm64/index.html">ARM64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">Microchip AVR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ceva/index.html">CEVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../hc/index.html">HC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mips/index.html">MIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misco/index.html">Misoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../or1k/index.html">OpenRISC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../renesas/index.html">Renesas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Simulators</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">SIM</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../index.html#toolchain">Toolchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#compiling">Compiling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running">Running</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running-lvgl">Running LVGL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running-vnc-server">Running VNC Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running-simulated-can">Running Simulated CAN</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">SIM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../network_linux.html">Network Support on Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../network_vpnkit.html">Network support with VPNKit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../network_linux.html">Network Support on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../network_vpnkit.html">Network support with VPNKit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sparc/index.html">SPARC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tricore/index.html">TriCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86/index.html">Intel 80x86</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86_64/index.html">Intel 80x86_64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z16/index.html">Z16</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z80/index.html">Z80</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Simulators</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">SIM</a></li>
      <li class="breadcrumb-item active">SIM</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/platforms/sim/sim/boards/sim/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sim">
<h1>SIM<a class="headerlink" href="#sim" title="Permalink to this heading"></a></h1>
<p class="tags"><span>Tags: </span><a class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary reference internal" href="../../../../../_tags/arch-sim.html"><span class="doc">arch:sim</span></a></p>
<p>This documentation page describes the contents of the build configurations
available for the NuttX “sim” target. The sim target is a NuttX port that runs
as a user-space program under Linux, Cygwin, or macOS. It is a very “low
fidelity” embedded system simulation: This environment does not support any kind
of asynchronous events; there are nothing like interrupts in this context.
Therefore, there can be no preempting events.</p>
<p>The sim target is used primarily as a development and test platform for new RTOS
features. It is also of academic interest. However, it has no known real-world
application.</p>
<section id="fake-interrupts">
<h2>Fake Interrupts<a class="headerlink" href="#fake-interrupts" title="Permalink to this heading"></a></h2>
<p>In order to get timed behavior, the system timer “interrupt handler” is called
from the sim target’s IDLE loop. The IDLE runs whenever there is no other
task running. So, for example, if a task calls <code class="docutils literal notranslate"><span class="pre">sleep()</span></code>, then that task will
suspend wanting for the time to elapse. If nothing else is available to run,
then the IDLE loop runs and the timer increments, eventually re-awakening the
sleeping task.</p>
<p>Context switching is based on logic similar to <code class="docutils literal notranslate"><span class="pre">setjmp()</span></code> and <code class="docutils literal notranslate"><span class="pre">longjmp()</span></code>.</p>
</section>
<section id="timing-fidelity">
<h2>Timing Fidelity<a class="headerlink" href="#timing-fidelity" title="Permalink to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sim target’s IDLE loop to delay on each call so that the system “timer
interrupt” is called at a rate approximately correct for the system timer
tick rate. This option can be enabled with <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_WALLTIME_SIGNAL</span></code>
which will drive the entire simulation by using a host timer that ticks at
<code class="docutils literal notranslate"><span class="pre">CONFIG_USEC_PER_TICK</span></code>. This option will no longer deliver ‘tick’ events
from Idle task and it will generate them from the host signal handler.
Another option is to use <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_WALLTIME_SLEEP</span></code> which will enable the
tick events to be delayed from the Idle task by using a host sleep call.</p>
</div>
<section id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h3>
<p>One of the best reasons to use the simulation is that is supports great Linux-
based debugging. Here are the steps to follow in order to use the Linux <code class="docutils literal notranslate"><span class="pre">ddd</span></code>
graphical front-end to GDB:</p>
<ol class="arabic">
<li><p>Enable debug symbols by ensuring <code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_SYMBOLS=y</span></code>. You can enable
this via the Kconfig menu (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>).</p></li>
<li><p>Re-build NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>&lt;NuttX-Directory&gt;
<span class="gp">$ </span>make<span class="w"> </span>clean
<span class="gp">$ </span>make
</pre></div>
</div>
</li>
<li><p>Then start the debugging:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ddd<span class="w"> </span>nuttx<span class="w"> </span><span class="p">&amp;</span>
<span class="go">gdb&gt; b user_start</span>
<span class="go">gdb&gt; r</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This above steps work fine on Linux, Cygwin, and macOS. On Cygwin, you will
need to start the Cygwin-X server before running <code class="docutils literal notranslate"><span class="pre">ddd</span></code>. On macOS, it’s
probably easier to use <code class="docutils literal notranslate"><span class="pre">lldb</span></code> instead of <code class="docutils literal notranslate"><span class="pre">gdb</span></code>.</p>
</div>
</section>
<section id="issues">
<h3>Issues<a class="headerlink" href="#issues" title="Permalink to this heading"></a></h3>
</section>
</section>
<section id="bit-issues">
<h2>64-Bit Issues<a class="headerlink" href="#bit-issues" title="Permalink to this heading"></a></h2>
<p>As mentioned above, context switching is based on logic like <code class="docutils literal notranslate"><span class="pre">setjmp()</span></code> and
<code class="docutils literal notranslate"><span class="pre">longjmp()</span></code>. This context switching is available for 32-bit and 64-bit
targets.</p>
<p>You must, however, set the correct target in the configuration before you build:
<code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64</span></code> or <code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86</span></code> for 64- and 32-bit targets,
respectively. On a 64-bit machine, you can also force the 32-bit build with
<code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=y</span></code> (which does not seem to be supported by more contemporary
x86_64 compilers).</p>
<p>There are other 64-bit issues as well. For example, addresses are retained in
32-bit unsigned integer types in a few places. On a 64-bit machine, the 32- bit
address storage may corrupt 64-bit addressing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is really a bug; addresses should not be retained in <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> types
but rather in <code class="docutils literal notranslate"><span class="pre">uintptr_t</span></code> types to avoid issues just like this.</p>
</div>
</section>
<section id="compiler-differences">
<h2>Compiler differences<a class="headerlink" href="#compiler-differences" title="Permalink to this heading"></a></h2>
<p>Operator new:</p>
<ul class="simple">
<li><p>Problem: ‘operator new’ takes <code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">('...')</span></code> as first parameter</p></li>
<li><p>Workaround: Add <code class="docutils literal notranslate"><span class="pre">-fpermissive</span></code> to the compilation flags</p></li>
</ul>
</section>
<section id="stack-size-issues">
<h2>Stack Size Issues<a class="headerlink" href="#stack-size-issues" title="Permalink to this heading"></a></h2>
<p>When you run the NuttX simulation, it uses stacks allocated by NuttX from the
NuttX heap. The memory management model is exactly the same in the simulation
as in a real, target system. This is good because this produces a higher
fidelity simulation.</p>
<p>However, when the simulation calls into the host OS libraries, it will still
use these small simulation stacks. This happens, for example, when you call
into the system to get and put characters to the console window or when you
make X11 calls into the system. The programming model within those libraries
will assume the host OS environment where the stack size grows dynamically
and not the small, limited stacks of a deeply embedded system.</p>
<p>As a consequence, those system libraries may allocate large data structures on
the stack and overflow the small NuttX stacks. X11, in particular, requires
large stacks. If you are using X11 in the simulation, make sure that you set
aside a “lot” of stack for the X11 library calls (maybe 8 or 16Kb). The stack
size for the thread that begins with user start is controlled by the
configuration setting <code class="docutils literal notranslate"><span class="pre">CONFIG_INIT_STACKSIZE</span></code>; you may need to increase this
value to larger number to survive the X11 library calls.</p>
<p>If you are running X11 applications such as NSH add-on programs, then the stack
size of the add-on program is controlled in another way. Here are the steps for
increasing the stack size in that case:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>../apps/builtin<span class="w">    </span><span class="c1"># Go to the builtin apps directory</span>
<span class="gp">$ </span>vi<span class="w"> </span>builtin_list.h<span class="w">     </span><span class="c1"># Edit this file and increase the stack size of the add-on</span>
<span class="gp">$ </span>rm<span class="w"> </span>.built<span class="w"> </span>*.o<span class="w">         </span><span class="c1"># This will force the builtin apps logic to rebuild</span>
</pre></div>
</div>
</section>
<section id="symbol-collisions">
<h2>Symbol Collisions<a class="headerlink" href="#symbol-collisions" title="Permalink to this heading"></a></h2>
<p>The simulation build is a two pass build:</p>
<ol class="arabic simple">
<li><p>On the first pass, an intermediate, partially relocatable object is created
called <code class="docutils literal notranslate"><span class="pre">nuttx.rel</span></code>. This includes all of the files that are part of the
NuttX “domain.”</p></li>
<li><p>On the second pass, the files which are in the host OS domain are built and
then linked with <code class="docutils literal notranslate"><span class="pre">nuttx.rel</span></code> to generate the simulation program.</p></li>
</ol>
<p>NuttX is a POSIX compliant RTOS and is normally built on a POSIX compliant host
environment (like Linux, Cygwin, or macOS). As a result, the same symbols are
exported by both the NuttX domain and the host domain. How can we keep them
separate?</p>
<p>This is done using the special file <code class="docutils literal notranslate"><span class="pre">nuttx-name.dat</span></code>. This file just contains
a mapping of original function names to new function names. For example, the
NuttX <code class="docutils literal notranslate"><span class="pre">printf()</span></code> will get the new name <code class="docutils literal notranslate"><span class="pre">NXprintf()</span></code>.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">nuttx-names.dat</span></code> file is used by the <code class="docutils literal notranslate"><span class="pre">objcopy</span></code> program between pass 1
and pass 2 to rename all of the symbols in the <code class="docutils literal notranslate"><span class="pre">nuttx.rel</span></code> object so that they
do not collide with names provided by the host OS in the host PC domain.</p>
<p>Occasionally, as you test new functionality, you will find that you need to add
more names to the <code class="docutils literal notranslate"><span class="pre">nuttx-names.dat</span></code> file. If there is a missing name mapping
in <code class="docutils literal notranslate"><span class="pre">nuttx-names.dat</span></code>, the symptoms may be very obscure and difficult to debug.
What happens in this case is that when logic in <code class="docutils literal notranslate"><span class="pre">nuttx.rel</span></code> intended to call
the NuttX domain function, it instead calls into the host OS function of the
same name.</p>
<p>Often you can survive such events. For example, it really should not matter
which version of <code class="docutils literal notranslate"><span class="pre">strlen()</span></code> you call. Other times, it can cause subtle,
mysterious errors. Usually, however, callng the wrong function in the wrong OS
results in a fatal crash.</p>
<p>On macOS, instead of <code class="docutils literal notranslate"><span class="pre">objcopy</span></code>, <code class="docutils literal notranslate"><span class="pre">-unexported_symbols_list</span></code> linker option is
used to hide symbols in the NuttX domain, using the same list of symbols from
<code class="docutils literal notranslate"><span class="pre">nuttx-name.dat</span></code>.</p>
</section>
<section id="networking-issues">
<h2>Networking Issues<a class="headerlink" href="#networking-issues" title="Permalink to this heading"></a></h2>
<p>Please issue these commands to setup the reliable network on Ubuntu:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>net-tools
<span class="gp">$ </span>sudo<span class="w"> </span>nuttx/tools/simbridge.sh<span class="w"> </span>eth0<span class="w"> </span>on
</pre></div>
</div>
<p>Here are some tips you may need:</p>
<ol class="arabic simple">
<li><p>Must launch the executable with the root permission</p></li>
<li><p>Have to use virtual machine if host is in corporation network</p></li>
<li><p>Configure the network adapter in NAT mode if virtual machine is used</p></li>
</ol>
</section>
<section id="x11-issues">
<h2>X11 Issues<a class="headerlink" href="#x11-issues" title="Permalink to this heading"></a></h2>
<p>There is an X11-based framebuffer driver that you can use to exercise the
NuttX graphics subsystem on the simulator (see the sim/nx11 configuration
below). This may require a lot of tinkering to get working, depending upon
where your X11 installation stores libraries and header files and how it names
libraries.</p>
<p>For example, on Ubuntu 9.09, I had to do the following to get a clean build:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>/usr/lib/
<span class="gp">$ </span>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>libXext.so.6.4.0<span class="w"> </span>libXext.so
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I also get a segmentation fault at the conclusion of the NX test; that will
need to get looked into as well.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may need issue this command with the latest Ubuntu before launch:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>xhost<span class="w"> </span>+
</pre></div>
</div>
</div>
</section>
<section id="cygwin64-issues">
<h2>Cygwin64 Issues<a class="headerlink" href="#cygwin64-issues" title="Permalink to this heading"></a></h2>
<p>There are some additional issues using the simulator with Cygwin64. Below is
the summary of the changes that I had to make to get the simulator working in
that environment:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=y</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=n</span></code></p>
<p>Need to select X64_64. Cygwin64 tools do not seem to support any option
to build a 32-bit target.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_CYGWIN_DECORATED=n</span></code></p>
<p>Older versions of Cygwin tools decorated C symbol names by adding an
underscore to the beginning of the symbol name. Newer versions of Cygwin do
not seem to do this. Deselecting <code class="docutils literal notranslate"><span class="pre">`CONFIG_SIM_CYGWIN_DECORATED`</span></code> will
select the symbols without the leading underscore as needed by the Cygwin64
toolchain.</p>
<p>How do you know if you need this option? You could look at the generated
symbol tables to see if there are underscore characters at the beginning
of the symbol names. Or, if you need this option, the simulation will not
run. It will crash early, probably in some function due to the failure to
allocate memory.</p>
<p>In this case, when I tried to run nutt.exe from the command line, it
exited silently. Running with GDB I get the following (before hitting a
breakpoint at <code class="docutils literal notranslate"><span class="pre">main()</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">r</span>
<span class="go">Starting program: /cygdrive/c/Users/Gregory/Documents/projects/nuttx/master/nuttx/nuttx.exe</span>
<span class="go">[New Thread 6512.0xda8]</span>
<span class="go">[New Thread 6512.0x998]</span>
<span class="go">      1 [main] nuttx 6512 C:\Users\Gregory\Documents\projects\nuttx\master\nuttx\nuttx.exe: *** fatal error - Internal error: Out of memory for new path buf.</span>
<span class="go">    736 [main] nuttx 6512 cygwin_exception::open_stackdumpfile: Dumping stack trace to nuttx.exe.stackdump</span>
<span class="go">[Thread 6512.0x998 exited with code 256]</span>
<span class="go">[Inferior 1 (process 6512) exited with code 0400]</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="4">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=n</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=y</span></code></p>
<p>Select Microsoft x64 calling convention.</p>
<p>The Microsoft x64 calling convention is followed on Microsoft Windows and
pre-boot UEFI (for long mode on x86-64). It uses registers <code class="docutils literal notranslate"><span class="pre">RCX</span></code>, <code class="docutils literal notranslate"><span class="pre">RDX</span></code>,
<code class="docutils literal notranslate"><span class="pre">R8</span></code>, R9 for the first four integer or pointer arguments (in that order),
and <code class="docutils literal notranslate"><span class="pre">XMM0</span></code>, <code class="docutils literal notranslate"><span class="pre">XMM1</span></code>, <code class="docutils literal notranslate"><span class="pre">XMM2</span></code>, <code class="docutils literal notranslate"><span class="pre">XMM3</span></code> are used for floating point
arguments. Additional arguments are pushed onto the stack (right to left).
Integer return values (similar to x86) are returned in RAX if 64 bits or
less. Floating point return values are returned in <code class="docutils literal notranslate"><span class="pre">XMM0</span></code>. Parameters less
than 64 bits long are not zero extended; the high bits are not zeroed.</p>
</li>
</ol>
</section>
<section id="smp">
<h2>SMP<a class="headerlink" href="#smp" title="Permalink to this heading"></a></h2>
<p>This configuration has basic support for SMP testing. The simulation supports
the emulation of multiple CPUs by creating multiple pthreads, each running a
copy of the simulation in the same process address space.</p>
<p>You can enable SMP for ostest configuration by enabling these config options:</p>
<p>And you can enable some additional debug output with:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-# CONFIG_DEBUG_SCHED is not set</span>
<span class="gi">+CONFIG_DEBUG_SCHED=y</span>

<span class="gd">-# CONFIG_SCHED_INSTRUMENTATION is not set</span>
<span class="gd">-# CONFIG_SCHED_INSTRUMENTATION_SWITCH is not set</span>
<span class="gi">+CONFIG_SCHED_INSTRUMENTATION=y</span>
<span class="gi">+CONFIG_SCHED_INSTRUMENTATION_SWITCH=y</span>
</pre></div>
</div>
<p>The SMP configuration will run with <code class="docutils literal notranslate"><span class="pre">CONFIG_SMP_NCPUS=1</span></code>. In this case there
is, of course, no multi-CPU processing, but this does verify the correctness of
some of the basic SMP logic.</p>
<section id="basic">
<h3>BASIC<a class="headerlink" href="#basic" title="Permalink to this heading"></a></h3>
<p>I have used the <code class="docutils literal notranslate"><span class="pre">sim:nsh</span></code> configuration to test Michael Haardt’s BASIC
interpreter that you can find at <code class="docutils literal notranslate"><span class="pre">apps/interpreters/bas</span></code>.</p>
<p>Bas is an interpreter for the classic dialect of the programming language BASIC.
It is pretty compatible to typical BASIC interpreters of the 1980s, unlike some
other UNIX BASIC interpreters, that implement a different syntax, breaking
compatibility to existing programs. Bas offers many ANSI BASIC statements for
structured programming, such as procedures, local variables and various loop
types. Further there are matrix operations, automatic LIST indentation and many
statements and functions found in specific classic dialects. Line numbers are
not required.</p>
<p>There is also a test suite for the interpreter that can be found at
<code class="docutils literal notranslate"><span class="pre">apps/examples/bastest</span></code>.</p>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>This setup will initialize the BASIC test (optional). This will mount a ROMFS
file system at <code class="docutils literal notranslate"><span class="pre">/mnt/romfs</span></code> that contains the BASIC test files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; bastest</span>
<span class="go">Registering romdisk at /dev/ram6</span>
<span class="go">Mounting ROMFS filesystem at target=/mnt/romfs with source=/dev/ram6</span>
<span class="go">nsh&gt;</span>
</pre></div>
</div>
<p>The interactive interpreter is started like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; bas</span>
<span class="go">bas 2.4</span>
<span class="go">Copyright 1999-2014 Michael Haardt.</span>
<span class="go">This is free software with ABSOLUTELY NO WARRANTY.</span>
<span class="go">&gt;</span>
</pre></div>
</div>
<p>Ctrl-D exits the interpreter. The test programs can be ran like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; bastest</span>
<span class="go">Registering romdisk at /dev/ram0</span>
<span class="go">Mounting ROMFS filesystem at target=/mnt/romfs with source=/dev/ram0</span>
<span class="go">nsh&gt; bas /mnt/romfs/test01.bas</span>
<span class="go"> 1</span>
<span class="go">hello</span>
<span class="go"> 0.0002</span>
<span class="go"> 0.0000020</span>
<span class="go"> 0.0000002</span>

<span class="go">nsh&gt;</span>
</pre></div>
</div>
<p>Or you can load a test into memory and execute it interactively:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; bas</span>
<span class="go">bas 2.4</span>
<span class="go">Copyright 1999-2014 Michael Haardt.</span>
<span class="go">This is free software with ABSOLUTELY NO WARRANTY.</span>
<span class="go">&gt; load &quot;/mnt/romfs/test01.bas&quot;</span>
<span class="go">&gt; run</span>
<span class="go"> 1</span>
<span class="go">hello</span>
<span class="go"> 0.0002</span>
<span class="go"> 0.0000020</span>
<span class="go"> 0.0000002</span>
<span class="go">&gt;</span>
</pre></div>
</div>
<section id="configurations">
<h3>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h3>
<p>Each configuration is maintained in a sub-directory and can be selected as
follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./tools/configure.sh<span class="w"> </span>sim:&lt;config&gt;
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> is one of the configurations listed below.</p>
<p>Before building, make sure that the configuration is correct for your host
platform.</p>
<ol class="arabic">
<li><p>Linux, 32-bit CPU:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=n</span></code></p></li>
</ul>
</li>
<li><p>Linux, 64-bit CPU, 32-bit build:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=y</span></code></p></li>
</ul>
</li>
<li><p>Linux, 64-bit CPU, 64-bit build:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=n</span></code></p></li>
</ul>
</li>
<li><p>Cygwin, 32-bit:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_WINDOWS_CYGWIN=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=n</span></code></p></li>
</ul>
</li>
<li><p>Cygwin64, 64-bit, 32-bit build</p>
<p>I don’t believe this configuration is supported by Cygwin64.</p>
</li>
<li><p>Cygwin64, 64-bit, 64-bit build:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_WINDOWS_CYGWIN=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=n</span></code></p></li>
</ul>
</li>
<li><p>macOS, 64-bit, 64-bit build:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_MACOS=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=n</span></code></p></li>
</ul>
</li>
<li><p>macOS M1, 64-bit, 64-bit build:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_MACOS=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=n</span></code></p></li>
</ul>
</li>
<li><p>Linux ARM64, 64-bit, 64-bit build:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_LINUX=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_MACOS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_WINDOWS=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_X86_64=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_HOST_ARM64=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_MICROSOFT=n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X8664_SYSTEMV=y</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32=n</span></code></p></li>
</ul>
</li>
</ol>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Not all of the available sim configurations are documented below.</p>
</div>
</section>
</section>
<section id="adb">
<h2>adb<a class="headerlink" href="#adb" title="Permalink to this heading"></a></h2>
<p>A simple demo show how to config adb.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./nuttx
<span class="go">NuttShell (NSH) NuttX-10.2.0</span>
<span class="go">nsh&gt; adbd &amp;</span>
<span class="go">adbd [2:100]</span>
</pre></div>
</div>
<p>You can use the normal adb command from host:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>adb<span class="w"> </span>kill-server
<span class="gp">$ </span>adb<span class="w"> </span>connect<span class="w"> </span>localhost:5555
<span class="gp">$ </span>adb<span class="w"> </span>shell
</pre></div>
</div>
</section>
<section id="alsa">
<h2>alsa<a class="headerlink" href="#alsa" title="Permalink to this heading"></a></h2>
<p>This configuration enables testing audio applications on NuttX by
implementing an audio-like driver that uses ALSA to forward the audio to
the host system. It also enables the <cite>hostfs</cite> to enable direct access to
the host system’s files mounted on the simulator. The ALSA audio driver
allows uncompressed PCM files - as well as MP3 files - to be played.</p>
<p>To check the audio devices:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./nuttx
<span class="go">NuttShell (NSH) NuttX-10.4.0</span>
<span class="go">nsh&gt; ls /dev/audio</span>
<span class="go">/dev/audio:</span>
<span class="go">pcm0c</span>
<span class="go">pcm0p</span>
<span class="go">pcm1c</span>
<span class="go">pcm1p</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pcm0c</span></code> represents the device to capture uncompressed PCM audio</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pcm0p</span></code> represents the device to playback uncompressed PCM files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pcm1c</span></code> represents the device to capture MP3-encoded audio</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pcm1p</span></code> represents the device to playback MP3-encoded files</p></li>
</ul>
<p><strong>Mounting Files from Host System</strong></p>
<p>To mount files from the host system and enable them to be played in the sim:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; mount -t hostfs -o fs=/path/to/audio/files/ /host</span>
<span class="go">nsh&gt; ls /host</span>
<span class="go">/host:</span>
<span class="go">mother.mp3</span>
<span class="go">mother.wav</span>
<span class="go">.</span>
<span class="go">..</span>
</pre></div>
</div>
<p><strong>Playing uncompressed-PCM files</strong></p>
<p>To play uncompressed-PCM files, we can use <code class="docutils literal notranslate"><span class="pre">nxplayer</span></code>’s <code class="docutils literal notranslate"><span class="pre">playraw</span></code> command. We
need 1) select the appropriate audio device to playback this file and 2) know in
advance the file’s parameters (channels, bits/sample and sampling rate):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; nxplayer</span>
<span class="go">NxPlayer version 1.05</span>
<span class="go">h for commands, q to exit</span>

<span class="go">nxplayer&gt; device /dev/audio/pcm0p</span>
<span class="go">nxplayer&gt; playraw /host/mother.wav 2 16 44100</span>
</pre></div>
</div>
<p>In this example, the file <code class="docutils literal notranslate"><span class="pre">mother.wav</span></code> is a stereo (2-channel), 16 bits/sample
and 44,1KHz PCM-encoded file.</p>
<p><strong>Playing MP3-encoded files</strong></p>
<p>To play MP3 files, we can use <code class="docutils literal notranslate"><span class="pre">nxplayer</span></code>’s <code class="docutils literal notranslate"><span class="pre">play</span></code> command directly.
We only need to select the appropriate audio device to playback this file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; nxplayer</span>
<span class="go">NxPlayer version 1.05</span>
<span class="go">h for commands, q to exit</span>

<span class="go">nxplayer&gt; device /dev/audio/pcm1p</span>
<span class="go">nxplayer&gt; play /host/mother.mp3</span>
</pre></div>
</div>
</section>
<section id="bluetooth">
<h2>bluetooth<a class="headerlink" href="#bluetooth" title="Permalink to this heading"></a></h2>
<p>Supports some very limited, primitive, low-level debug of the Bluetooth stack
using the Bluetooth “Swiss Army Knife” at <code class="docutils literal notranslate"><span class="pre">apps/wireless/bluetooth/btsak</span></code> and
the NULL Bluetooth device at <code class="docutils literal notranslate"><span class="pre">drivers/wireless/bluetooth/bt_null.c</span></code>.</p>
<p>There is also support on a Linux Host for attaching the bluetooth hardware from
the host to the NuttX bluetooth stack via the HCI Socket interface over the User
Channel. This is enabled in the bthcisock configuration. In order to use this
you must give the <code class="docutils literal notranslate"><span class="pre">nuttx</span></code> ELF additional capabilities:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>setcap<span class="w"> </span><span class="s1">&#39;cap_net_raw,cap_net_admin=eip&#39;</span><span class="w"> </span>./nuttx
</pre></div>
</div>
<p>You can then monitor the HCI traffic on the host with WireShark or <code class="docutils literal notranslate"><span class="pre">btmon</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>btmon
</pre></div>
</div>
</section>
<section id="configdata">
<h2>configdata<a class="headerlink" href="#configdata" title="Permalink to this heading"></a></h2>
<p>A unit test for the MTD configuration data driver.</p>
</section>
<section id="cxxtest">
<h2>cxxtest<a class="headerlink" href="#cxxtest" title="Permalink to this heading"></a></h2>
<p>The C++ standard library test at <code class="docutils literal notranslate"><span class="pre">apps/testing/cxxtest</span></code> configuration. This
test is used to verify the uClibc++ port to NuttX.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before you can use this example, you must first install the uClibc++ C++
library. This is located outside of the NuttX source tree in the NuttX
uClibc++ GIT repository. See the README.txt file there for instructions on
how to install uClibc++</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At present (2012/11/02), exceptions are disabled in this example
(<code class="docutils literal notranslate"><span class="pre">CONFIG_CXX_EXCEPTION=n</span></code>). It is probably not necessary to disable
exceptions.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unfortunately, this example will not run now.</p>
<p>The reason that the example will not run on the simulator has to do with when
static constructors are enabled: In the simulator it will attempt to execute
the static constructors before <code class="docutils literal notranslate"><span class="pre">main()</span></code> starts. BUT… NuttX is not
initialized and this results in a crash.</p>
<p>To really use this example, I will have to think of some way to postpone
running C++ static initializers until NuttX has been initialized.</p>
</div>
</section>
<section id="fb">
<h2>fb<a class="headerlink" href="#fb" title="Permalink to this heading"></a></h2>
<p>A simple configuration used for some basic (non-graphic) debug of the
framebuffer character drivers using <code class="docutils literal notranslate"><span class="pre">apps/examples/fb</span></code>.</p>
</section>
<section id="ipforward">
<h2>ipforward<a class="headerlink" href="#ipforward" title="Permalink to this heading"></a></h2>
<p>This is an NSH configuration that includes a simple test of the NuttX IP
forwarding logic using <code class="docutils literal notranslate"><span class="pre">apps/examples/ipforward</span></code>. That example uses two TUN
network devices to represent two networks. The test then sends packets from one
network destined for the other network. The NuttX IP forwarding logic will
recognize that the received packets are not destined for it and will forward the
logic to the other TUN network. The application logic then both sends the
packets on one network and receives and verifies the forwarded packet received
on the other network. The received packets differ from the sent packets only in
that the hop limit (TTL) has been decremented.</p>
<p>Be default, this test will forward TCP packets. The test can be modified to
support forwarding of ICMPv6 multicast packets with these changes to the
configuration:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-CONFIG_EXAMPLES_IPFORWARD_TCP=y</span>
<span class="gi">+CONFIG_EXAMPLES_IPFORWARD_ICMPv6=y</span>

<span class="gi">+CONFIG_NET_ICMPv6=y</span>
<span class="gi">+CONFIG_NET_ICMPv6_SOCKET=y</span>
<span class="gi">+CONFIG_NET_ETHERNET=y</span>
<span class="gi">+CONFIG_NET_IPFORWARD_BROADCAST=y</span>
</pre></div>
</div>
<p>Additional required settings will also be selected when you manually select
the above via <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>.</p>
</section>
<section id="loadable">
<h2>loadable<a class="headerlink" href="#loadable" title="Permalink to this heading"></a></h2>
<p>This configuration provides an example of loadable apps. It cannot be used with
any Windows configuration, however, because Windows does not use the ELF format.</p>
<p>This is the key part of the configuration:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gi">+CONFIG_PATH_INITIAL=&quot;/system/bin&quot;</span>
<span class="gi">+CONFIG_INIT_FILEPATH=&quot;/system/bin/nsh&quot;</span>
</pre></div>
</div>
<p>The shell is loaded from the ELF, but you can also run any of the ELFs that are
in <code class="docutils literal notranslate"><span class="pre">/system/bin</span></code> as they are on the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
</section>
<section id="minibasic">
<h2>minibasic<a class="headerlink" href="#minibasic" title="Permalink to this heading"></a></h2>
<p>This configuration was used to test the Mini Basic port at
<code class="docutils literal notranslate"><span class="pre">apps/interpreters/minibasic</span></code>.</p>
</section>
<section id="module">
<h2>module<a class="headerlink" href="#module" title="Permalink to this heading"></a></h2>
<p>This is a configuration to test <code class="docutils literal notranslate"><span class="pre">CONFIG_LIBC_ELF</span></code> with 64-bit modules. This
has <code class="docutils literal notranslate"><span class="pre">apps/examples/module</span></code> enabled. This configuration is intended for 64-bit
host OS.</p>
</section>
<section id="module32">
<h2>module32<a class="headerlink" href="#module32" title="Permalink to this heading"></a></h2>
<p>This is a configuration to test <code class="docutils literal notranslate"><span class="pre">CONFIG_LIBC_ELF</span></code> with <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_M32</span></code> and
32-bit modules. This has <code class="docutils literal notranslate"><span class="pre">apps/examples/module</span></code> enabled. This configuration is
intended for 64-bit host OS.</p>
</section>
<section id="mount">
<h2>mount<a class="headerlink" href="#mount" title="Permalink to this heading"></a></h2>
<p>Configures to use <code class="docutils literal notranslate"><span class="pre">apps/examples/mount</span></code>.</p>
</section>
<section id="mtdpart">
<h2>mtdpart<a class="headerlink" href="#mtdpart" title="Permalink to this heading"></a></h2>
<p>This is the <code class="docutils literal notranslate"><span class="pre">apps/examples/mtdpart</span></code> test using a MTD RAM driver to simulate
the FLASH part.</p>
</section>
<section id="mtdrwb">
<h2>mtdrwb<a class="headerlink" href="#mtdrwb" title="Permalink to this heading"></a></h2>
<p>This is the <code class="docutils literal notranslate"><span class="pre">apps/examples/mtdrwb</span></code> test using a MTD RAM driver to simulate the
FLASH part.</p>
</section>
<section id="nettest">
<h2>nettest<a class="headerlink" href="#nettest" title="Permalink to this heading"></a></h2>
<p>Configures to use <code class="docutils literal notranslate"><span class="pre">apps/examples/nettest</span></code>. This configuration enables
networking using the network TAP device.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of NuttX-5.18, when built on Windows, this test does not try to use the TAP
device (which is not available on Cygwin anyway), but inside will try to use
the Cygwin WPCAP library.  Only the most preliminary testing has been
performed with the Cygwin WPCAP library, however.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The IP address is hard-coded in <code class="docutils literal notranslate"><span class="pre">arch/sim/src/up_wpcap.c</span></code>. You will either
need to edit your configuration files to use 10.0.0.1 on the “target”
(<code class="docutils literal notranslate"><span class="pre">CONFIG_EXAMPLES_NETTEST_*</span></code>) or edit <code class="docutils literal notranslate"><span class="pre">up_wpcap.c</span></code> to select the IP
address that you want to use.</p>
</div>
</section>
<section id="nimble">
<h2>nimble<a class="headerlink" href="#nimble" title="Permalink to this heading"></a></h2>
<p>This is similar to bthcisock configuration, which uses the exposes the real
BLE stack to NuttX, but disables NuttX’s own BLE stack and uses nimBLE stack
instead (built in userspace).</p>
<p>This configuration can be tested by running nimBLE example application “nimble”
as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>setcap<span class="w"> </span><span class="s1">&#39;cap_net_raw,cap_net_admin=eip&#39;</span><span class="w"> </span>nuttx
<span class="gp">$ </span>./nuttx
<span class="go">NuttShell (NSH) NuttX-9.1.0</span>
<span class="go">nsh&gt; ifup bnep0</span>
<span class="go">ifup bnep0...OK</span>
<span class="go">nsh&gt; nimble</span>
<span class="go">hci init</span>
<span class="go">port init</span>
<span class="go">gap init</span>
<span class="go">gatt init</span>
<span class="go">ans init</span>
<span class="go">ias init</span>
<span class="go">lls init</span>
<span class="go">tps init</span>
<span class="go">hci_sock task init</span>
<span class="go">ble_host task init</span>
<span class="go">hci sock task</span>
<span class="go">host task</span>
<span class="go">advertise</span>
</pre></div>
</div>
<p>At this point you should be able to detect a “nimble” BLE device when scanning
for BLE devices. You can use nRFConnect Android application from Nordic to
connect and inspect exposed GATT services.</p>
</section>
<section id="nsh">
<h2>nsh<a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h2>
<p>Configures to use the NuttShell at <code class="docutils literal notranslate"><span class="pre">apps/examples/nsh</span></code>. This version has one
builtin function, <code class="docutils literal notranslate"><span class="pre">apps/examples/hello</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This configuration has BINFS enabled so that the builtin applications can be
made visible in the file system. Because of that, the builtin applications
do not work as other examples.</p>
<p>The binfs filesystem will be mounted at <code class="docutils literal notranslate"><span class="pre">/bin</span></code> when the system starts up:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ls /bin</span>
<span class="go">/bin:</span>
<span class="go">  hello</span>
<span class="go">nsh&gt; echo $PATH</span>
<span class="go">/bin</span>
<span class="go">nsh&gt; hello</span>
<span class="go">Hello, World!!</span>
<span class="go">nsh&gt;</span>
</pre></div>
</div>
<p>Notice that the executable <code class="docutils literal notranslate"><span class="pre">hello</span></code> is found using the value in the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>
variable (which was preset to <cite>/`bin`</cite>).  If the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> variable were not
set then you would have to use <code class="docutils literal notranslate"><span class="pre">/bin/hello</span></code> on the command line.</p>
</div>
</section>
<section id="nsh2">
<h2>nsh2<a class="headerlink" href="#nsh2" title="Permalink to this heading"></a></h2>
<p>This is another example that is configured to use the NuttShell at
<code class="docutils literal notranslate"><span class="pre">apps/examples/nsh</span></code>. Like <code class="docutils literal notranslate"><span class="pre">sim:nsh</span></code>, this version uses NSH built-in
functions. The <code class="docutils literal notranslate"><span class="pre">nx</span></code>, <code class="docutils literal notranslate"><span class="pre">nxhello</span></code>, and <code class="docutils literal notranslate"><span class="pre">nxlines</span></code> examples are included as
built-in functions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>X11 Configuration:</p>
<p>This configuration uses an X11-based framebuffer driver.  Of course, this
configuration can only be used in environments that support X11!  (And it
may not even be usable in all of those environments without some
“tweaking” See discussion below under the nx11 configuration).</p>
<p>For examples, it expects to be able to include X11/Xlib.h.  That
currently fails on my Linux box.</p>
</div>
</section>
<section id="nx">
<h2>nx<a class="headerlink" href="#nx" title="Permalink to this heading"></a></h2>
<p>Configured to use <code class="docutils literal notranslate"><span class="pre">apps/examples/nx</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Special simulated framebuffer configuration options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_FBHEIGHT</span></code>: Height of the framebuffer in pixels</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_FBWIDTH</span></code>: Width of the framebuffer in pixels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_FBBPP</span></code>: Pixel depth in bits</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This version has NO DISPLAY and is only useful for debugging NX internals
in environments where X11 is not supported. There is an additional
configuration that may be added to include an X11-based simulated
framebuffer driver:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X11FB</span></code>: Use X11 window for framebuffer</p></li>
</ul>
<p>See the “nx11” configuration below for more information.</p>
</div>
</section>
<section id="nx11">
<h2>nx11<a class="headerlink" href="#nx11" title="Permalink to this heading"></a></h2>
<p>Configures to use <code class="docutils literal notranslate"><span class="pre">apps/examples/nx</span></code>. This configuration is similar to the nx
configuration except that it adds support for an X11-based framebuffer driver.
Of course, this configuration can only be used in environments that support X11!
(And it may not even be usable in all of those environments without some
“tweaking”).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This configuration uses the same special simulated framebuffer
configuration options as the nx configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* ``CONFIG_SIM_X11FB``: Use X11 window for framebuffer
* ``CONFIG_SIM_FBHEIGHT``: Height of the framebuffer in pixels
* ``CONFIG_SIM_FBWIDTH``: Width of the framebuffer in pixels.
* ``CONFIG_SIM_FBBPP``: Pixel depth in bits
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>But now, since <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_X11FB</span></code> is also selected the following
definitions are needed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_FBBPP</span></code> (must match the resolution of the display)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_FB_CMAP=y</span></code></p></li>
</ul>
<p>My system has 24-bit color, but packed into 32-bit words so the correct
setting of <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_FBBPP</span></code> is 32.</p>
<p>For whatever value of <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_FBBPP</span></code> is selected, the corresponding
<code class="docutils literal notranslate"><span class="pre">CONFIG_NX_DISABLE_*BPP</span></code> setting must not be disabled.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A X11 mouse-based touchscreen simulation can also be enabled by setting:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* ``CONFIG_INPUT=y``
* ``CONFIG_SIM_TOUCHSCREEN=y``
</pre></div>
</div>
<ol class="arabic simple">
<li><p>If you do not have the call to sim_tcinitialize(0), the build will
mysteriously fail claiming that it can’t find up_tcenter() and
up_tcleave().  That is a consequence of the crazy way that the
simulation is built and can only be eliminated by calling
up_simtouchscreen(0) from your application.</p></li>
<li><p>You must first call up_fbinitialize(0) before calling
up_simtouchscreen() or you will get a crash.</p></li>
<li><p>Call sim_tcunininitializee() when you are finished with the simulated
touchscreen.</p></li>
<li><p>Enable CONFIG_DEBUG_INPUT=y for touchscreen debug output.</p></li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To get the system to compile under various X11 installations you may have
to modify a few things. For example, in order to find libXext, I had to
make the following change under Ubuntu 9.09:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>/usr/lib/
<span class="gp">$ </span>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>libXext.so.6.4.0<span class="w"> </span>libXext.so
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This configuration is also set up to use the <code class="docutils literal notranslate"><span class="pre">apps/examples/nxterm</span></code> test
instead of <code class="docutils literal notranslate"><span class="pre">apps/examples/nx</span></code>. To enable this configuration, First,
select Multi-User mode as described above. Then, add the following
definitions to the defconfig file:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-CONFIG_NXTERM=n</span>
<span class="gi">+CONFIG_NXTERM=y</span>

<span class="gd">-CONFIG_EXAMPLES_NX=y</span>
<span class="gi">+CONFIG_EXAMPLES_NX=n</span>

<span class="gd">-CONFIG_EXAMPLES_NXTERM=n</span>
<span class="gi">+CONFIG_EXAMPLES_NXTERM=y</span>
</pre></div>
</div>
</div>
</section>
<section id="nxffs">
<h2>nxffs<a class="headerlink" href="#nxffs" title="Permalink to this heading"></a></h2>
<p>This is a test of the NXFFS file system using the <code class="docutils literal notranslate"><span class="pre">apps/testing/nxffs</span></code> test
with an MTD RAM driver to simulate the FLASH part.</p>
</section>
<section id="nxlines">
<h2>nxlines<a class="headerlink" href="#nxlines" title="Permalink to this heading"></a></h2>
<p>This is the <code class="docutils literal notranslate"><span class="pre">apps/examples/nxlines</span></code> test.</p>
</section>
<section id="nxwm">
<h2>nxwm<a class="headerlink" href="#nxwm" title="Permalink to this heading"></a></h2>
<p>This is a special configuration setup for the NxWM window manager UnitTest. The
NxWM window manager can be found here at <code class="docutils literal notranslate"><span class="pre">apps/graphics/NxWidgets/nxwm</span></code>. The
NxWM unit test can be found at <code class="docutils literal notranslate"><span class="pre">apps/graphics/NxWidgets/UnitTests/nxwm</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is an issue with running this example under the simulation: In the
default configuration, this example will run the NxTerm example which waits on
<code class="docutils literal notranslate"><span class="pre">readline()</span></code> for console input. When it calls <code class="docutils literal notranslate"><span class="pre">readline()</span></code>, the whole
system blocks waiting from input from the host OS. So, in order to get this
example to run, you must comment out the <code class="docutils literal notranslate"><span class="pre">readline()</span></code> call in
<code class="docutils literal notranslate"><span class="pre">apps/nshlib/nsh_consolemain.c</span></code> like:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gh">Index: nsh_consolemain.c</span>
<span class="gh">===================================================================</span>
<span class="gd">--- nsh_consolemain.c   (revision 4681)</span>
<span class="gi">+++ nsh_consolemain.c   (working copy)</span>
<span class="gu">@@ -117,7 +117,8 @@</span>
<span class="w"> </span>  /* Execute the startup script */

<span class="w"> </span>#ifdef CONFIG_ETC_ROMFS
<span class="gd">-  nsh_script(&amp;pstate-&gt;cn_vtbl, &quot;init&quot;, NSH_INITPATH);</span>
<span class="gi">+// REMOVE ME</span>
<span class="gi">+//  nsh_script(&amp;pstate-&gt;cn_vtbl, &quot;init&quot;, NSH_INITPATH);</span>
<span class="w"> </span>#endif

<span class="w"> </span>  /* Then enter the command line parsing loop */
<span class="gu">@@ -130,7 +131,8 @@</span>
<span class="w"> </span>      fflush(pstate-&gt;cn_outstream);

<span class="w"> </span>      /* Get the next line of input */
<span class="gd">-</span>
<span class="gi">+sleep(2); // REMOVE ME</span>
<span class="gi">+#if 0 // REMOVE ME</span>
<span class="w"> </span>      ret = readline(pstate-&gt;cn_line, LINE_MAX,
<span class="w"> </span>                     INSTREAM(pstate), OUTSTREAM(pstate));
<span class="w"> </span>      if (ret &gt; 0)
<span class="gu">@@ -153,6 +155,7 @@</span>
<span class="w"> </span>                  &quot;readline&quot;, NSH_ERRNO_OF(-ret));
<span class="w"> </span>          nsh_exit(&amp;pstate-&gt;cn_vtbl, 1);
<span class="w"> </span>        }
<span class="gi">+#endif // REMOVE ME</span>
<span class="w"> </span>    }

<span class="w"> </span>  /* Clean up */
</pre></div>
</div>
<p>The above workaround should no longer be necessary. However, the above
is left in place until the solution is verified.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>2019-05-04</p>
<p>Something has changed. Today this configuration failed to build because is
requires <code class="docutils literal notranslate"><span class="pre">CONFIG_NX_XYINPUT=y</span></code> in the configuration. That indicates mouse
or touchscreen support. Apparently, the current NxWM will not build without
this support.</p>
</div>
</section>
<section id="ostest">
<h2>ostest<a class="headerlink" href="#ostest" title="Permalink to this heading"></a></h2>
<p>The “standard” NuttX <code class="docutils literal notranslate"><span class="pre">apps/examples/ostest</span></code> configuration.</p>
</section>
<section id="pf-ieee802154">
<h2>pf_ieee802154<a class="headerlink" href="#pf-ieee802154" title="Permalink to this heading"></a></h2>
<p>This is the configuration that used for unit level test of the socket support
for the PF_IEEE802154 address family. It uses the IEEE 802.15.4 loopback network
driver and the test at <code class="docutils literal notranslate"><span class="pre">apps/examples/pf_ieee802154</span></code>.</p>
<p>Basic usage example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; pfserver ab:cd &amp;</span>
<span class="go">nsh&gt; pfclient ab:cd</span>
</pre></div>
</div>
</section>
<section id="pktradio">
<h2>pktradio<a class="headerlink" href="#pktradio" title="Permalink to this heading"></a></h2>
<p>This configuration is identical to the <code class="docutils literal notranslate"><span class="pre">sixlowpan</span></code> configuration described
below EXCEPT that it uses the generic packet radio loopback network device.</p>
</section>
<section id="rpproxy-and-rpserver">
<h2>rpproxy and rpserver<a class="headerlink" href="#rpproxy-and-rpserver" title="Permalink to this heading"></a></h2>
<p>This is an example implementation for OpenAMP based on the share memory.</p>
<p>rpproxy:</p>
<p>Remote slave(client) proxy process. <code class="docutils literal notranslate"><span class="pre">rpproxy</span></code> creates a proxy between client and
server to allow the client to access the hardware resources on different
process.</p>
<p>rpserver:</p>
<p>Remote master (host) server process. <code class="docutils literal notranslate"><span class="pre">rpserver</span></code> contains all the real hardware
configuration, such as:</p>
<ol class="arabic simple">
<li><p>Universal Asynchronous Receiver/Transmitter (UART).</p></li>
<li><p>Specific File System.</p></li>
<li><p>Network protocol stack and real network card device.</p></li>
</ol>
<p>Rpmsg driver used in this example include:</p>
<ol class="arabic simple">
<li><p>Rpmsg Syslog</p></li>
</ol>
<ul class="simple">
<li><p>Redirect log to master core
Linux kernel, NuttX, Freertos …</p></li>
<li><p>Work as early as possible
Two phase initialization</p></li>
<li><p>Never lost the log
Hang during boot or runtime
Full system crash(panic, watchdog …)</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Rpmsg TTY(UART)</p></li>
</ol>
<ul class="simple">
<li><p>Like pseudo terminal but between two CPU</p></li>
<li><p>No different from real tty(open/read/write/close)</p></li>
<li><p>Full duplex communication</p></li>
<li><p>Support multiple channels as need
* Connect RTOS shell
* Make integrated GPS like external(NMEA)
* Make integrated modem like external(ATCMD)</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>RpmsgFS</p></li>
</ol>
<ul class="simple">
<li><p>Like NFS but between two CPU</p></li>
<li><p>Fully access remote(Linux/NuttX) File system
* Save the tuning parameter during manufacture
* Load the tuning parameter file in production
* Save audio dump to file for tuning/debugging
* Dynamic loading module from remote</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Rpmsg Net</p></li>
</ol>
<ul class="simple">
<li><p>Rpmsg UsrSock client</p></li>
<li><p>Rpmsg UsrSock server</p></li>
<li><p>Rpmsg Net driver</p></li>
<li><p>Rpmsg MAC/PHY adapter</p></li>
</ul>
<p>To use this example:</p>
<ol class="arabic">
<li><p>Build images</p>
<blockquote>
<div><ol class="arabic">
<li><p>Build rpserver and backup the image:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./tools/configure.sh<span class="w"> </span>sim:rpserver
<span class="gp">$ </span>make
<span class="gp">$ </span>cp<span class="w"> </span>nuttx<span class="w"> </span>~/rpserver
</pre></div>
</div>
</li>
<li><p>Distclean the build environment.</p></li>
<li><p>Build rpproxy:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./tools/configure.sh<span class="w"> </span>sim:rpproxy
<span class="gp">$ </span>make
<span class="gp">$ </span>cp<span class="w"> </span>nuttx<span class="w"> </span>~/rpproxy
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Test the Rpmsg driver</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Rpmsg Syslog:</p></li>
</ol>
<blockquote>
<div><p>Start rpserver:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">  $ </span>sudo<span class="w"> </span>~/rpserver
<span class="go">  [    0.000000] server: SIM: Initializing</span>

<span class="go">  NuttShell (NSH)</span>
<span class="go">  server&gt;</span>

<span class="go">Start rpproxy:</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>~/rpproxy
</pre></div>
</div>
<p>Check the syslog from rpproxy in rpserver terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server&gt; [    0.000000] proxy: SIM: Initializing</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Rpmsg TTY(UART):</p></li>
</ol>
<blockquote>
<div><p>Use cu switch the current CONSOLE to the proxy:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server&gt; ps</span>
<span class="go">  PID GROUP PRI POLICY   TYPE    NPX STATE    EVENT     SIGMASK   STACK COMMAND</span>
<span class="go">    0     0   0 FIFO     Kthread N-- Ready              00000000 000000 Idle Task</span>
<span class="go">    1     1 224 FIFO     Kthread --- Waiting  Signal    00000000 002032 hpwork</span>
<span class="go">    2     1 100 FIFO     Task    --- Running            00000000 004080 init</span>
<span class="go">    3     3 224 FIFO     Kthread --- Waiting  Signal    00000002 002000 rptun proxy 0x56634fa0</span>
<span class="go">server&gt; cu /dev/ttyproxy</span>
<span class="go">proxy&gt; ps</span>
<span class="go">  PID GROUP PRI POLICY   TYPE    NPX STATE    EVENT     SIGMASK   STACK COMMAND</span>
<span class="go">    0     0   0 FIFO     Kthread N-- Ready              00000000 000000 Idle Task</span>
<span class="go">    1     1 224 FIFO     Kthread --- Waiting  Signal    00000000 002032 hpwork</span>
<span class="go">    3     3 100 FIFO     Task    --- Running            00000000 004080 init</span>
</pre></div>
</div>
<p>To switch back the console, type <code class="docutils literal notranslate"><span class="pre">&quot;~.&quot;</span></code> in the cu session.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p>RpmsgFS:</p>
<p>Mount the remote file system via RPMSGFS, cu to proxy first:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server&gt; cu</span>
<span class="go">proxy&gt; mount -t rpmsgfs -o cpu=server,fs=/proc proc_server</span>
<span class="go">proxy&gt; ls</span>
<span class="go">/:</span>
<span class="go">  dev/</span>
<span class="go">  etc/</span>
<span class="go">  proc/</span>
<span class="go">  proc_server/</span>
<span class="go">  tmp/</span>
</pre></div>
</div>
<p>Check the uptime:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">proxy&gt; cat proc/uptime</span>
<span class="go">  833.21</span>
<span class="go">proxy&gt; cat proc_server/uptime</span>
<span class="go">  821.72</span>
</pre></div>
</div>
</li>
<li><p>Rpmsg UsrSock:</p>
<p>“rptun proxy” kernel thread is running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server&gt; ps</span>
<span class="go">  PID GROUP PRI POLICY   TYPE    NPX STATE    EVENT     SIGMASK   STACK COMMAND</span>
<span class="go">    0     0   0 FIFO     Kthread N-- Ready              00000000 000000 Idle Task</span>
<span class="go">    1     1 224 FIFO     Kthread --- Waiting  Signal    00000000 002032 hpwork</span>
<span class="go">    2     1 100 FIFO     Task    --- Running            00000000 004080 init</span>
<span class="go">    3     3 224 FIFO     Kthread --- Waiting  Signal    00000002 002000 rptun proxy 0x56634fa0</span>
</pre></div>
</div>
<p>Send ICMP ping to network server via rpmsg usrsock:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server&gt; cu</span>
<span class="go">proxy&gt; ping 127.0.0.1</span>
<span class="go">PING 127.0.0.1 56 bytes of data</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=0 time=20 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=1 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=2 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=3 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=4 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=5 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=6 time=20 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=7 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=8 time=10 ms</span>
<span class="go">56 bytes from 127.0.0.1: icmp_seq=9 time=10 ms</span>
<span class="go">10 packets transmitted, 10 received, 0% packet loss, time 10100 ms</span>
</pre></div>
</div>
</li>
</ol>
<p>Please read NETWORK-LINUX.txt if you want to try the real address.</p>
</section>
<section id="sixlowpan">
<h2>sixlowpan<a class="headerlink" href="#sixlowpan" title="Permalink to this heading"></a></h2>
<p>This configuration was intended only for unit-level testing of the 6LoWPAN
stack. It enables networking with 6LoWPAN support and uses only a IEEE802.15.4
MAC loopback network device to supported testing.</p>
<p>This configuration includes <code class="docutils literal notranslate"><span class="pre">apps/examples/nettest</span></code> and
<code class="docutils literal notranslate"><span class="pre">apps/examples/udpblaster</span></code>. Neither are truly functional. The only intent of
this configuration is to verify that the 6LoWPAN stack correctly encodes
IEEE802.15.4 packets on output to the loopback device and correctly decodes the
returned packet.</p>
<p>See also the <code class="docutils literal notranslate"><span class="pre">pktradio</span></code> configuration.</p>
</section>
<section id="rtptools">
<h2>rtptools<a class="headerlink" href="#rtptools" title="Permalink to this heading"></a></h2>
<p><strong>RTP Tools</strong> is a set of small applications that can be used for processing RTP data.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rtpplay</span></code>: playback RTP sessions recorded by <code class="docutils literal notranslate"><span class="pre">rtpdump</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rtpsend</span></code>: generate RTP packets from the textual description, generated by hand or <code class="docutils literal notranslate"><span class="pre">rtpdump</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rtpdump</span></code>: parse and print RTP packets, generating output files suitable for <code class="docutils literal notranslate"><span class="pre">rtpplay</span></code> and <code class="docutils literal notranslate"><span class="pre">rtpsend</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rtptrans</span></code>: RTP translator between unicast and multicast networks</p></li>
</ul>
<p>This configuration is based on the <a class="reference internal" href="../../../../../guides/simulator.html#simulator-accessing-the-network"><span class="std std-ref">sim:tcpblaster</span></a> and
builds the <code class="docutils literal notranslate"><span class="pre">rtpdump</span></code>. This application is able to receive RTP packets and print the contents.
As a real-world application, one could write the received content to a FIFO and play it with
<code class="docutils literal notranslate"><span class="pre">nxplayer</span></code>.</p>
<p>To build it, follow the instructions for <a class="reference internal" href="../../../../../guides/simulator.html#simulator-accessing-the-network"><span class="std std-ref">Accessing the Network</span></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<blockquote>
<div><p>One can use <code class="docutils literal notranslate"><span class="pre">pulseaudio</span></code> to send RTP packets through the network:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pactl<span class="w"> </span>load-module<span class="w"> </span>module-null-sink<span class="w"> </span><span class="nv">sink_name</span><span class="o">=</span>rtp<span class="w"> </span><span class="nv">format</span><span class="o">=</span>s16le<span class="w"> </span><span class="nv">channels</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">rate</span><span class="o">=</span><span class="m">44100</span><span class="w"> </span><span class="nv">sink_properties</span><span class="o">=</span><span class="s2">&quot;device.description=&#39;RTP&#39;&quot;</span>
<span class="gp">$ </span>pactl<span class="w"> </span>load-module<span class="w"> </span>module-rtp-send<span class="w"> </span><span class="nv">source</span><span class="o">=</span>rtp.monitor<span class="w"> </span><span class="nv">format</span><span class="o">=</span>s16le<span class="w"> </span><span class="nv">destination_ip</span><span class="o">=</span><span class="m">10</span>.0.1.2<span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="m">46998</span>
</pre></div>
</div>
</div></blockquote>
<p>The loaded sink <code class="docutils literal notranslate"><span class="pre">RTP</span></code> is used to send PC’s audio to the <code class="docutils literal notranslate"><span class="pre">10.0.1.2:46998</span></code> address (SIM’s IP).</p>
</div>
<p>After being able to access the network through the simulator, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; rtpdump -F short /46998 &amp;</span>
<span class="go">rtpdump [5:100]</span>
<span class="go">nsh&gt; 42949704.930000 1277462397 15308</span>
<span class="go">42949704.930000 1277462714 15309</span>
</pre></div>
</div>
<p>For a real-world application, check <a class="reference internal" href="../../../../xtensa/esp32/boards/esp32-lyrat/index.html#esp32-lyrat-rtptools"><span class="std std-ref">RTP Tools on ESP32-LyraT board</span></a>.</p>
</section>
<section id="spiffs">
<h2>spiffs<a class="headerlink" href="#spiffs" title="Permalink to this heading"></a></h2>
<p>This is a test of the SPIFFS file system using the <code class="docutils literal notranslate"><span class="pre">apps/testing/fstest</span></code> test
with an MTD RAM driver to simulate the FLASH part.</p>
</section>
<section id="sotest">
<h2>sotest<a class="headerlink" href="#sotest" title="Permalink to this heading"></a></h2>
<p>This is a configuration to test <code class="docutils literal notranslate"><span class="pre">CONFIG_LIBC_ELF</span></code> with 64-bit modules. This
has <code class="docutils literal notranslate"><span class="pre">apps/examples/sotest</span></code> enabled. This configuration is intended for 64-bit
host OS.</p>
</section>
<section id="sotest32">
<h2>sotest32<a class="headerlink" href="#sotest32" title="Permalink to this heading"></a></h2>
<p>This is a configuration to test <code class="docutils literal notranslate"><span class="pre">CONFIG_LIBC_ELF</span></code> with <code class="docutils literal notranslate"><span class="pre">`CONFIG_SIM_M32`</span></code>
and 32-bit modules. This has <code class="docutils literal notranslate"><span class="pre">apps/examples/sotest</span></code> enabled. This
configuration is intended for 64-bit host OS.</p>
</section>
<section id="sqlite">
<h2>sqlite<a class="headerlink" href="#sqlite" title="Permalink to this heading"></a></h2>
<p>This configuration is used to test sqlite. Since hostfs does not support
<code class="docutils literal notranslate"><span class="pre">FIOC_FILEPATH</span></code>, it cannot currently be used in hostfs.</p>
<p>Basic usage example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cd tmp</span>
<span class="go">nsh&gt; sqlite3 test.db</span>
<span class="go">SQLite version 3.45.1 2024-01-30 16:01:20</span>
<span class="go">Enter &quot;.help&quot; for usage hints.</span>
<span class="go">sqlite&gt;</span>
<span class="go">CREATE TABLE COMPANY(</span>
<span class="go">  ID INT PRIMARY KEY     sqlite&gt; (x1...&gt; NOT NULL,</span>
<span class="go">  NAME           TEXT    NOT NULL,</span>
<span class="go">  AGE            (x1...&gt; (x1...&gt; INT     NOT NULL,</span>
<span class="go">  ADDRESS        CHAR(50),</span>
<span class="go">  SALARY         (x1...&gt; (x1...&gt; REAL</span>
<span class="go">);(x1...&gt;</span>
<span class="go">sqlite&gt; .quit</span>
<span class="go">sqlite&gt;</span>
<span class="go">nsh&gt;</span>
<span class="go">nsh&gt; ls -l</span>
<span class="go">/tmp:</span>
<span class="go">-rwxrwxrwx       12288 test.db</span>
</pre></div>
</div>
</section>
<section id="tcploop">
<h2>tcploop<a class="headerlink" href="#tcploop" title="Permalink to this heading"></a></h2>
<p>This configuration performs a TCP “performance” test using
<code class="docutils literal notranslate"><span class="pre">apps/examples/tcpblaster</span></code> and the IPv6 local loopback device. Performance is
in quotes because, while that is the intent of the tcpblaster example, this is
not an appropriate configuration for TCP performance testing. Rather, this
configuration is useful only for verifying TCP transfers over the loopback
device.</p>
<p>To use IPv4, modify these settings in the defconfig file:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-# CONFIG_NET_IPv4 is not set</span>
<span class="gd">-CONFIG_NET_IPv6=y</span>
<span class="gd">-CONFIG_NET_IPv6_NCONF_ENTRIES=4</span>
</pre></div>
</div>
</section>
<section id="touchscreen">
<h2>touchscreen<a class="headerlink" href="#touchscreen" title="Permalink to this heading"></a></h2>
<p>This configuration uses the simple touchscreen test at
<code class="docutils literal notranslate"><span class="pre">apps/examples/touchscreen</span></code>. This test will create an empty X11 window and
will print the touchscreen output as it is received from the simulated
touchscreen driver.</p>
<p>Since this example uses the simulated frame buffer driver, most of the
configuration settings discussed for the <code class="docutils literal notranslate"><span class="pre">nx11</span></code> configuration also apply here.
See that discussion above.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">apps/examples/README.txt</span></code> for further information about build
requirements and configuration settings.</p>
</section>
<section id="toywasm">
<h2>toywasm<a class="headerlink" href="#toywasm" title="Permalink to this heading"></a></h2>
<p>This is a configuration with toywasm.</p>
<p>An example usage:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NuttShell (NSH) NuttX-10.4.0</span>
<span class="go">nsh&gt; mount -t hostfs -o fs=/tmp/wasm /mnt</span>
<span class="go">nsh&gt; toywasm --wasi /mnt/hello.wasm</span>
<span class="go">hello</span>
<span class="go">nsh&gt;</span>
</pre></div>
</div>
</section>
<section id="udgram">
<h2>udgram<a class="headerlink" href="#udgram" title="Permalink to this heading"></a></h2>
<p>This is the same as the nsh configuration except that it includes two additional
built in applications: server and client. These applications are provided by the
test at <code class="docutils literal notranslate"><span class="pre">apps/examples/udgram</span></code>. This configuration enables local, Unix domain
sockets and supports the test of the datagram sockets.</p>
<p>To use the test:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; server &amp;</span>
<span class="go">nsh&gt; client</span>
</pre></div>
</div>
</section>
<section id="unionfs">
<h2>unionfs<a class="headerlink" href="#unionfs" title="Permalink to this heading"></a></h2>
<p>This is a version of NSH dedicated to performing the simple test of the Union
File System at <code class="docutils literal notranslate"><span class="pre">apps/examples/unionfs</span></code>. The command <code class="docutils literal notranslate"><span class="pre">unionfs</span></code> will mount the
Union File System at <code class="docutils literal notranslate"><span class="pre">/mnt/unionfs</span></code>. You can than compare what you see at
<code class="docutils literal notranslate"><span class="pre">/mnt/unionfs</span></code> with the content of the ROMFS file systems at
<code class="docutils literal notranslate"><span class="pre">apps/examples/unionfs/atestdir</span></code> and <code class="docutils literal notranslate"><span class="pre">btestdir</span></code>.</p>
<p>Here is some sample output from the test:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NuttShell (NSH)</span>
<span class="go">nsh&gt; unionfs</span>
<span class="go">Mounting ROMFS file system 1 at target=/mnt/a with source=/dev/ram4</span>
<span class="go">Mounting ROMFS file system 2 at target=/mnt/b with source=/dev/ram5</span>
<span class="go">nsh&gt; ls /mnt/unionfs</span>
<span class="go">/mnt/unionfs:</span>
<span class="go"> .</span>
<span class="go"> afile.txt</span>
<span class="go"> offset/</span>
</pre></div>
</div>
<p>When unionfs was created, file system was joined with an offset called “offset”.
Therefore, all of the file system 2 root contents will appear to reside under a
directory called <code class="docutils literal notranslate"><span class="pre">offset/</span></code> (although there is no directory called <code class="docutils literal notranslate"><span class="pre">offset/</span></code>
on file system 2). File system 1 on the other hand does have an actual directory
called <code class="docutils literal notranslate"><span class="pre">offset/</span></code>. If we list the contents of the <code class="docutils literal notranslate"><span class="pre">offset/</span></code> directory in the
unified file system, we see the merged contents of the file system 1 <code class="docutils literal notranslate"><span class="pre">offset/</span></code>
directory and the file system 2 root directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /mnt/unionfs/afile.txt</span>
<span class="go">This is a file in the root directory on file system 1</span>

<span class="go">nsh&gt; ls /mnt/unionfs/offset</span>
<span class="go">/mnt/unionfs/offset:</span>
<span class="go"> afile.txt</span>
<span class="go"> .</span>
<span class="go"> adir/</span>
<span class="go"> bfile.txt</span>
<span class="go"> bdir/</span>
<span class="go">nsh&gt; cat /mnt/unionfs/offset/afile.txt</span>
</pre></div>
</div>
<p>This is a file in the <code class="docutils literal notranslate"><span class="pre">offset/</span></code> directory on file system 1.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /mnt/unionfs/offset/bfile.txt</span>
</pre></div>
</div>
<p>This is another file in the root directory on file system 2.</p>
<p>The directory <code class="docutils literal notranslate"><span class="pre">offset/adir</span></code> exists on file system 1 and the directory
<code class="docutils literal notranslate"><span class="pre">adir/</span></code> exists on file system 2. You can see that these also overlap:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ls /mnt/unionfs/offset/adir</span>
<span class="go">/mnt/unionfs/offset/adir:</span>
<span class="go"> ..</span>
<span class="go"> asubdir/</span>
<span class="go"> adirfile.txt</span>
<span class="go"> bsubdir/</span>
<span class="go"> bdirfile.txt</span>
<span class="go"> .</span>
</pre></div>
</div>
<p>The unified directory listing is showing files from both file systems in their
respective offset <code class="docutils literal notranslate"><span class="pre">adir/</span></code> subdirectories. The file <code class="docutils literal notranslate"><span class="pre">adirfile.txt</span></code> exists in
both file system 1 and file system 2 but the version in file system 2 is
occluded by the version in file system 1. The only way that you can know which
you are looking at is by <code class="docutils literal notranslate"><span class="pre">cat</span></code>’ing the file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /mnt/unionfs/offset/adir/adirfile.txt</span>
</pre></div>
</div>
<p>This is a file in directory <code class="docutils literal notranslate"><span class="pre">offset/adir</span></code> on file system 1.</p>
<p>The file on file system 1 has correctly occluded the file with the same name
on file system 2. <code class="docutils literal notranslate"><span class="pre">bdirfile.txt</span></code>, however, only exists on file system 2, so
it is not occluded:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /mnt/unionfs/offset/adir/bdirfile.txt</span>
</pre></div>
</div>
<p>This is another file in directory <code class="docutils literal notranslate"><span class="pre">adir</span></code> on file system 2.</p>
<p>You can see the files in the two file systems before they were unified at
<code class="docutils literal notranslate"><span class="pre">apps/examples/unionfs/atestdir</span></code> and <code class="docutils literal notranslate"><span class="pre">btestdir</span></code>.</p>
</section>
<section id="userfs">
<h2>userfs<a class="headerlink" href="#userfs" title="Permalink to this heading"></a></h2>
<p>This is another NSH configuration that includes the built-in application of
<code class="docutils literal notranslate"><span class="pre">apps/examples/userfs</span></code> to support test of the UserFS on the simulation
platform.</p>
<p>To use the test:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; userfs                 # Mounts the UserFS test file system at</span>
<span class="gp">                            # </span>/mnt/ufstest
<span class="go">nsh&gt; mount                  # Testing is then performed by exercising the</span>
<span class="gp">                            # </span>file<span class="w"> </span>system<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span><span class="nb">command</span><span class="w"> </span>line
<span class="go">nsh&gt; ls -l /mnt/ufstest</span>
<span class="go">nsh&gt; cat /mnt/ufstest/File1</span>
</pre></div>
</div>
</section>
<section id="ustream">
<h2>ustream<a class="headerlink" href="#ustream" title="Permalink to this heading"></a></h2>
<p>This is the same as the nsh configuration except that it includes two addition
built in applications: server and client. These applications are provided by the
test at <code class="docutils literal notranslate"><span class="pre">apps/examples/ustream</span></code>. This configuration enables local, Unix domain
sockets and supports the test of the stream sockets.</p>
<p>To use the test:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; server &amp;</span>
<span class="go">nsh&gt; client</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The binfs file system is mounted at <code class="docutils literal notranslate"><span class="pre">/bin</span></code> when the system starts up.</p>
</div>
</section>
<section id="vncserver">
<h2>vncserver<a class="headerlink" href="#vncserver" title="Permalink to this heading"></a></h2>
<p>This a simple vnc server test configuration, Remmina is tested and recommended
since there are some compatibility issues. By default SIM will be blocked at
startup to wait client connection, if a client connected, then the fb example
will launch.</p>
</section>
<section id="vpnkit">
<h2>vpnkit<a class="headerlink" href="#vpnkit" title="Permalink to this heading"></a></h2>
<p>This is a configuration with VPNKit support. See NETWORK-VPNKIT.txt.</p>
</section>
<section id="wamr">
<h2>wamr<a class="headerlink" href="#wamr" title="Permalink to this heading"></a></h2>
<p>This is a configuration for WebAssembly sample.</p>
<ol class="arabic">
<li><p>Compile Toolchain</p>
<ol class="arabic">
<li><p>Download WASI sdk and export the <code class="docutils literal notranslate"><span class="pre">WASI_SDK_PATH</span></code> path:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>wget<span class="w"> </span>https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-19/wasi-sdk-19.0-linux.tar.gz
<span class="gp">$ </span>tar<span class="w"> </span>xf<span class="w"> </span>wasi-sdk-19.0-linux.tar.gz
<span class="gp"># </span>Put<span class="w"> </span>wasi-sdk-19.0<span class="w"> </span>to<span class="w"> </span>your<span class="w"> </span>host<span class="w"> </span>WASI_SDK_PATH<span class="w"> </span>environment<span class="w"> </span>variable,<span class="w"> </span>like:
<span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">WASI_SDK_PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/wasi-sdk-19.0
</pre></div>
</div>
</li>
<li><p>Download Wamr “wamrc” AOT compiler and export to the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>:</p></li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkdir<span class="w"> </span>wamrc
<span class="gp">$ </span>wget<span class="w"> </span>https://github.com/bytecodealliance/wasm-micro-runtime/releases/download/WAMR-1.1.2/wamrc-1.1.2-x86_64-ubuntu-20.04.tar.gz
<span class="gp">$ </span>tar<span class="w"> </span>xf<span class="w"> </span>wamrc-1.1.2-x86_64-ubuntu-20.04.tar.gz
<span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$PWD</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Configuring and running</p>
<ol class="arabic">
<li><p>Configuring <code class="docutils literal notranslate"><span class="pre">sim:wamr</span></code> and compile:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./tools/configure.sh<span class="w"> </span>sim:wamr
<span class="gp">$ </span>make
<span class="go">...</span>
<span class="go">Wamrc Generate AoT: /home/archer/code/nuttx/n5/apps/wasm/hello.aot</span>
<span class="go">Wamrc Generate AoT: /home/archer/code/nuttx/n5/apps/wasm/coremark.aot</span>
<span class="go">LD:  nuttx</span>
</pre></div>
</div>
</li>
<li><p>Copy the generated wasm file (Interpreter/AoT)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp<span class="w"> </span>../apps/wasm/hello.aot<span class="w"> </span>.
<span class="gp">$ </span>cp<span class="w"> </span>../apps/wasm/hello.wasm<span class="w"> </span>.
<span class="gp">$ </span>cp<span class="w"> </span>../apps/wasm/coremark.wasm<span class="w"> </span>.
</pre></div>
</div>
</li>
<li><p>Run iwasm</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./nuttx
<span class="go">NuttShell (NSH) NuttX-10.4.0</span>
<span class="go">nsh&gt; iwasm /data/hello.wasm</span>
<span class="go">Hello, World!!</span>
<span class="go">nsh&gt; iwasm /data/hello.aot</span>
<span class="go">Hello, World!!</span>
<span class="go">nsh&gt; iwasm /data/coremark.wasm</span>
<span class="go">2K performance run parameters for coremark.</span>
<span class="go">CoreMark Size    : 666</span>
<span class="go">Total ticks      : 12000</span>
<span class="go">Total time (secs): 12.000000</span>
<span class="go">Iterations/Sec   : 5.000000</span>
<span class="go">Iterations       : 60</span>
<span class="go">Compiler version : Clang 15.0.7</span>
<span class="go">Compiler flags   : Using NuttX compilation options</span>
<span class="go">Memory location  : Defined by the NuttX configuration</span>
<span class="go">seedcrc          : 0xe9f5</span>
<span class="go">[0]crclist       : 0xe714</span>
<span class="go">[0]crcmatrix     : 0x1fd7</span>
<span class="go">[0]crcstate      : 0x8e3a</span>
<span class="go">[0]crcfinal      : 0xa14c</span>
<span class="go">Correct operation validated. See README.md for run and reporting rules.</span>
<span class="go">CoreMark 1.0 : 5.000000 / Clang 15.0.7 Using NuttX compilation options / Defined by the NuttX configuration</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</section>
<section id="usbdev">
<h2>usbdev<a class="headerlink" href="#usbdev" title="Permalink to this heading"></a></h2>
<p>This is a configuration with sim usbdev support.</p>
<ol class="arabic simple">
<li><p>Raw Gadget setup</p></li>
</ol>
<blockquote>
<div><p>Get Raw Gadget code at <a class="reference external" href="https://github.com/xairy/raw-gadget">https://github.com/xairy/raw-gadget</a>.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">make</span></code> in the <code class="docutils literal notranslate"><span class="pre">raw_gadget</span></code> and <code class="docutils literal notranslate"><span class="pre">dummy_hcd</span></code> directory. If
<code class="docutils literal notranslate"><span class="pre">raw_gadget</span></code> build fail, you need to check which register interface meets
your kernel version, <code class="docutils literal notranslate"><span class="pre">usb_gadget_probe_driver</span></code> or
<code class="docutils literal notranslate"><span class="pre">usb_gadget_register_driver</span></code>.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">./insmod.sh</span></code> in the <code class="docutils literal notranslate"><span class="pre">raw_gadget</span></code> and <code class="docutils literal notranslate"><span class="pre">dummy_hcd</span></code> directory.</p>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>Configuration</p>
<p><code class="docutils literal notranslate"><span class="pre">sim:usbdev</span></code> contains two different sets of composite devices:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">conn0</span></code>: <code class="docutils literal notranslate"><span class="pre">adb</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">rndis</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conn1</span></code>: <code class="docutils literal notranslate"><span class="pre">cdcacm</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">cdcecm</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conn2</span></code>: <code class="docutils literal notranslate"><span class="pre">cdcncm</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conn3</span></code>: <code class="docutils literal notranslate"><span class="pre">cdcmbim</span></code></p></li>
</ul>
</li>
</ol>
<blockquote>
<div><p>You can use the <code class="docutils literal notranslate"><span class="pre">sim:usbdev</span></code> configuration.</p>
</div></blockquote>
<ol class="arabic" start="3">
<li><p>How to run</p>
<p>Run nuttx with root mode. Then, run ADB.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conn<span class="w"> </span><span class="m">0</span>
<span class="gp">$ </span>adbd<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>Enter the ADB command on the host machine:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>adb<span class="w"> </span>kill-server
<span class="gp">$ </span>adb<span class="w"> </span>devices
<span class="go">List of devices attached</span>
<span class="go">* daemon not running; starting now at tcp:5037</span>
<span class="go">* daemon started successfully</span>
<span class="go">0101        device</span>
</pre></div>
</div>
<p>If the ADB connection fails, make sure the udev rule is added correctly.
Edit <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/51-android.rules</span></code> file and add the following to it:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>SUBSYSTEM==&quot;usb&quot;, ATTR{idVendor}==&quot;1630&quot;, ATTR{idProduct}==&quot;0042&quot;, MODE=&quot;0666&quot;, GROUP=&quot;plugdev&quot;
</pre></div>
</div>
<p>Then you can use commands such as adb shell, adb push, adb pull as normal.</p>
<p>Next, run RNDIS:</p>
<p>On NuttX, enter command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conn<span class="w"> </span><span class="m">0</span>
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 00:00:00:00:00:00 at UP</span>
<span class="go">        inet addr:0.0.0.0 DRaddr:0.0.0.0 Mask:0.0.0.0</span>
<span class="gp">$ </span>dhcpd_start<span class="w"> </span>eth0
<span class="go">eth0    Link encap:Ethernet HWaddr 00:00:00:00:00:00 at UP</span>
<span class="go">      inet addr:10.0.0.1 DRaddr:10.0.0.1 Mask:255.255.255.0</span>
</pre></div>
</div>
<p>On the host machine, you can see the network device named <code class="docutils literal notranslate"><span class="pre">usb0</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifconfig
<span class="go">usb0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 602</span>
<span class="go">        inet 10.0.0.4  netmask 255.255.255.0  broadcast 10.0.0.255</span>
<span class="go">        ether 36:50:3d:62:b5:80  txqueuelen 1000  (以太网)</span>
<span class="go">        RX packets 0  bytes 0 (0.0 B)</span>
<span class="go">        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">        TX packets 43  bytes 8544 (8.5 KB)</span>
<span class="go">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
</pre></div>
</div>
<p>Then you can test the network connection using the ping command or telnet.</p>
<p>Next, run CDCACM:</p>
<p>On NuttX, enter the command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conn<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>If the connection is successful, you can see <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM</span></code> devices on both
NuttX and host PC.</p>
<p>Then you can use <code class="docutils literal notranslate"><span class="pre">echo</span></code> and <code class="docutils literal notranslate"><span class="pre">cat</span></code> command to test. On NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">  nsh&gt; echo hello &gt; /dev/ttyACM0</span>

<span class="go">On the host machine:</span>

<span class="go">.. code:: console</span>

<span class="gp">   $ </span>cat<span class="w"> </span>/dev/ttyACM0
<span class="go">   hello</span>
</pre></div>
</div>
<p>Next, run CDCECM:</p>
<p>On NuttX, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conn<span class="w"> </span><span class="m">1</span>
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 00:e0:de:ad:be:ef at UP</span>
<span class="go">        inet addr:0.0.0.0 DRaddr:0.0.0.0 Mask:0.0.0.0</span>
<span class="gp">$ </span>dhcpd_start<span class="w"> </span>eth0
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 00:e0:de:ad:be:ef at UP</span>
<span class="go">         inet addr:10.0.0.1 DRaddr:10.0.0.1 Mask:255.255.255.0</span>
</pre></div>
</div>
<p>On the host, you can see the network device named <code class="docutils literal notranslate"><span class="pre">`enx020000112233`</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifconfig
<span class="go">enx020000112233: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 576</span>
<span class="go">        inet 10.0.0.4  netmask 255.255.255.0  broadcast 10.0.0.255</span>
<span class="go">        ether 02:00:00:11:22:33  txqueuelen 1000  (以太网)</span>
<span class="go">        RX packets 0  bytes 0 (0.0 B)</span>
<span class="go">        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">        TX packets 58  bytes 9143 (9.1 KB)</span>
<span class="go">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
</pre></div>
</div>
<p>Then you can test the network connection using the <code class="docutils literal notranslate"><span class="pre">ping</span></code> command or <code class="docutils literal notranslate"><span class="pre">telnet</span></code>.</p>
<p>Next, run CDCNCM:</p>
<p>On NuttX, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conn<span class="w"> </span><span class="m">2</span>
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 42:67:c6:69:73:51 at UP</span>
<span class="go">        inet addr:10.0.1.2 DRaddr:10.0.1.1 Mask:255.255.255.0</span>
<span class="go">eth1    Link encap:Ethernet HWaddr 00:e0:de:ad:be:ef at UP</span>
<span class="go">        inet addr:0.0.0.0 DRaddr:0.0.0.0 Mask:0.0.0.0</span>
<span class="gp">$ </span>dhcpd_start<span class="w"> </span>eth1
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 42:67:c6:69:73:51 at UP</span>
<span class="go">        inet addr:10.0.1.2 DRaddr:10.0.1.1 Mask:255.255.255.0</span>
<span class="go">eth1    Link encap:Ethernet HWaddr 00:e0:de:ad:be:ef at UP</span>
<span class="go">        inet addr:10.0.0.1 DRaddr:10.0.0.1 Mask:255.255.255.0</span>
</pre></div>
</div>
<p>On the host, you can see the network device named <code class="docutils literal notranslate"><span class="pre">enx020000112233</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifconfig
<span class="go">enx020000112233: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 576</span>
<span class="go">        inet 10.0.0.2  netmask 255.255.255.0  broadcast 10.0.0.255</span>
<span class="go">        ether 02:00:00:11:22:33  txqueuelen 1000  (以太网)</span>
<span class="go">        RX packets 0  bytes 0 (0.0 B)</span>
<span class="go">        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">        TX packets 58  bytes 9143 (9.1 KB)</span>
<span class="go">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
</pre></div>
</div>
<p>Then you can test the network connection using the <code class="docutils literal notranslate"><span class="pre">ping</span></code> command or <code class="docutils literal notranslate"><span class="pre">telnet</span></code>.</p>
<p>Next, run CDCMBIM:</p>
<p>On NuttX, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conn<span class="w"> </span><span class="m">3</span>
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 42:67:c6:69:73:51 at RUNNING mtu 1500</span>
<span class="go">        inet addr:10.0.1.2 DRaddr:10.0.1.1 Mask:255.255.255.0</span>
<span class="go">wwan0   Link encap:UNSPEC at RUNNING mtu 1200</span>
<span class="go">        inet addr:0.0.0.0 DRaddr:0.0.0.0 Mask:0.0.0.0</span>
<span class="gp">$ </span>ifconfig<span class="w"> </span>wwan0<span class="w"> </span><span class="m">10</span>.0.0.1<span class="w"> </span>netmask<span class="w"> </span><span class="m">255</span>.255.255.0
<span class="gp">$ </span>ifconfig
<span class="go">eth0    Link encap:Ethernet HWaddr 42:67:c6:69:73:51 at RUNNING mtu 1500</span>
<span class="go">        inet addr:10.0.1.2 DRaddr:10.0.1.1 Mask:255.255.255.0</span>
<span class="go">wwan0   Link encap:UNSPEC at RUNNING mtu 1200</span>
<span class="go">        inet addr:10.0.0.1 DRaddr:10.0.0.1 Mask:255.255.255.0</span>

<span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;hello from nuttx&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/cdc-wdm2
<span class="gp">$ </span>cat<span class="w"> </span>/dev/cdc-wdm2
<span class="go">hello from linux</span>
</pre></div>
</div>
<p>On the host, you can see the network device named <code class="docutils literal notranslate"><span class="pre">wwx020000112233</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>ifconfig<span class="w"> </span>wwx020000112233
<span class="gp">$ </span>sudo<span class="w"> </span>ifconfig<span class="w"> </span>wwx020000112233<span class="w"> </span><span class="m">10</span>.0.0.2<span class="w"> </span>netmask<span class="w"> </span><span class="m">255</span>.255.255.0
<span class="gp">$ </span>ifconfig
<span class="go">wwx020000112233: flags=4226&lt;BROADCAST,NOARP,MULTICAST&gt;  mtu 1500</span>
<span class="go">        inet 10.0.0.2  netmask 255.255.255.0  broadcast 10.0.0.255</span>
<span class="go">        ether 02:00:00:11:22:33  txqueuelen 1000  (以太网)</span>
<span class="go">        RX packets 0  bytes 0 (0.0 B)</span>
<span class="go">        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">        TX packets 58  bytes 9143 (9.1 KB)</span>
<span class="go">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>

<span class="gp">$ </span>sudo<span class="w"> </span>cat<span class="w"> </span>/dev/cdc-wdm1
<span class="go">hello from nuttx</span>
<span class="gp">$ </span>sudo<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo -n hello from linux &gt; /dev/cdc-wdm1&quot;</span>
</pre></div>
</div>
<p>Then you can test the network connection using the <code class="docutils literal notranslate"><span class="pre">ping</span></code> command or <code class="docutils literal notranslate"><span class="pre">telnet</span></code>.</p>
</li>
</ol>
</section>
<section id="usbhost">
<h2>usbhost<a class="headerlink" href="#usbhost" title="Permalink to this heading"></a></h2>
<p>This is a configuration with sim usbhost support.</p>
<ol class="arabic">
<li><p>Libusb1.0 setup:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>libusb-1.0-0-dev
<span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>libusb-1.0-0-dev:i386
</pre></div>
</div>
</li>
<li><p>Configuration</p>
<p><code class="docutils literal notranslate"><span class="pre">sim:usbhost</span></code> supports CDCACM.</p>
<p>Configure the device you want to connect:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_USB_PID=0x0042</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_USB_VID=0x1630</span></code></p></li>
</ul>
</li>
<li><p>How to run</p>
<p>Run sim usbhost with root mode, run sim usbdev or plug-in cdcacm usb device.
Then you can use <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM</span></code> to transfer data.</p>
<p>Here we will demonstrate an example of interaction between sim usbhost and
sim usbdev. Build two executable files using the configurations <code class="docutils literal notranslate"><span class="pre">sim:usbdev</span></code>
and <code class="docutils literal notranslate"><span class="pre">sim:usbhost</span></code> respectively.</p>
<p>Run each executable files as root in different terminals.
Terminal 1 (run nuttx binary from sim:usbhost):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>./nuttx
</pre></div>
</div>
<p>Terminal 2  (run nuttx binary from sim:usbdev):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>./nuttx
</pre></div>
</div>
<p>Then, run CDCACM in usbdev.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; conn 1</span>
</pre></div>
</div>
<p>Enter commands to read CDCACM on the usbhost:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /dev/ttyACM0 &amp;</span>
</pre></div>
</div>
<p>Enter commands to write CDCACM on the usbdev:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; echo hello &gt; /dev/ttyACM0</span>
</pre></div>
</div>
<p>You can see the data on the usbhost: <code class="docutils literal notranslate"><span class="pre">hello</span></code>.</p>
</li>
</ol>
</section>
<section id="login">
<h2>login<a class="headerlink" href="#login" title="Permalink to this heading"></a></h2>
<p>This is a configuration with login password protection for NSH.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This config has password protection enabled. The login info is:</p>
<ul class="simple">
<li><p>USERNAME: admin</p></li>
<li><p>PASSWORD: Administrator</p></li>
</ul>
<p>The encrypted password is retained in <code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code>. I am sure that you
will find this annoying. You can disable the password protection by
de-selecting <code class="docutils literal notranslate"><span class="pre">CONFIG_NSH_CONSOLE_LOGIN=y</span></code>.</p>
</div>
</section>
<section id="can">
<h2>can<a class="headerlink" href="#can" title="Permalink to this heading"></a></h2>
<p>This is a configuration with simulated CAN support. Both CAN character driver
and SocketCAN are enabled and use the host <code class="docutils literal notranslate"><span class="pre">vcan0</span></code> interface.
The <code class="docutils literal notranslate"><span class="pre">vcan0</span></code> host interface must be available when NuttX is started.</p>
<p>For the CAN character device, there is <code class="docutils literal notranslate"><span class="pre">examples/can</span></code> application enabled in
read-only mode.</p>
<p>Additionally, SocketCAN <code class="docutils literal notranslate"><span class="pre">candump</span></code> and <code class="docutils literal notranslate"><span class="pre">cansend</span></code> utils are enabled.</p>
<p>Below is an example of receiving CAN frames from host to NuttX.
Requirement: <code class="docutils literal notranslate"><span class="pre">cansequence</span></code> tool from <code class="docutils literal notranslate"><span class="pre">linux-can/can-utils</span></code></p>
<ol class="arabic">
<li><p>Create virtual CAN on the host:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ip<span class="w"> </span>link<span class="w"> </span>add<span class="w"> </span>dev<span class="w"> </span>can0<span class="w"> </span><span class="nb">type</span><span class="w"> </span>vcan
<span class="gp">$ </span>ifconfig<span class="w"> </span>can0<span class="w"> </span>up
</pre></div>
</div>
</li>
<li><p>Run NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./nuttx
</pre></div>
</div>
</li>
<li><p>Bring up <code class="docutils literal notranslate"><span class="pre">can0</span></code> on NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ifup can0</span>
<span class="go">ifup can0...OK</span>
</pre></div>
</div>
</li>
<li><p>Read CAN messages from SocketCAN on NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; candump can0</span>
</pre></div>
</div>
</li>
<li><p>Send CAN messages from the host to NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cansequence<span class="w"> </span>can0
</pre></div>
</div>
</li>
<li><p>Frames from the host should be received on NuttX:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; candump can0</span>
<span class="go">can0  002   [1]  00</span>
<span class="go">can0  002   [1]  01</span>
<span class="go">can0  002   [1]  02</span>
<span class="go">can0  002   [1]  03</span>
<span class="go">can0  002   [1]  04</span>
<span class="go">can0  002   [1]  05</span>
<span class="go">can0  002   [1]  06</span>
<span class="go">can0  002   [1]  07</span>
<span class="go">can0  002   [1]  08</span>
<span class="go">can0  002   [1]  09</span>
<span class="go">can0  002   [1]  0A</span>
<span class="go">can0  002   [1]  0B</span>
<span class="go">can0  002   [1]  0C</span>
<span class="go">can0  002   [1]  0D</span>
<span class="go">can0  002   [1]  0E</span>
<span class="go">can0  002   [1]  0F</span>
<span class="go">can0  002   [1]  10</span>
<span class="go">can0  002   [1]  11</span>
<span class="go">can0  002   [1]  12</span>
</pre></div>
</div>
</li>
</ol>
<section id="romfs-system-init">
<h3>ROMFS System-Init<a class="headerlink" href="#romfs-system-init" title="Permalink to this heading"></a></h3>
<p>This directory contains logic to support a custom ROMFS system-init script and
start-up script. These scripts are used by by the NSH when it starts <code class="docutils literal notranslate"><span class="pre">provided</span>
<span class="pre">that</span> <span class="pre">CONFIG_ETC_ROMFS=y</span></code>. These scripts provide a ROMFS volume that will be
mounted at <code class="docutils literal notranslate"><span class="pre">/etc</span></code> and will look like this at run-time:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NuttShell (NSH) NuttX-12.10.0</span>
<span class="go">nsh&gt; ls -Rl /etc</span>
<span class="go">/etc:</span>
<span class="go"> dr-xr-xr-x       0 .</span>
<span class="go"> -r--r--r--      20 group</span>
<span class="go"> dr-xr-xr-x       0 init.d/</span>
<span class="go"> -r--r--r--      35 passwd</span>
<span class="go">/etc/init.d:</span>
<span class="go"> dr-xr-xr-x       0 ..</span>
<span class="go"> -r--r--r--     110 rcS</span>
<span class="go"> -r--r--r--     110 rc.sysinit</span>
<span class="go">nsh&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/etc/init.d/rc.sysinit</span></code> is system init script; <code class="docutils literal notranslate"><span class="pre">/etc/init.d/rcS</span></code> is the
start-up script; <code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code> is a the password file. It supports a single
user:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>USERNAME:  admin
PASSWORD:  Administrator
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /etc/passwd</span>
<span class="go">admin:8Tv+Hbmr3pLVb5HHZgd26D:0:0:/</span>
</pre></div>
</div>
<p>The encrypted passwords in the provided passwd file are only valid if the
TEA key is set to: 012345678 9abcdef0 012345678 9abcdef0.</p>
<p>Changes to either the key or the password word will require regeneration of the
<code class="docutils literal notranslate"><span class="pre">nsh_romfimg.h</span></code> header file.</p>
<p>The format of the password file is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>user:x:uid:gid:home
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p>user: User name</p></li>
<li><p>x: Encrypted password</p></li>
<li><p>uid: User ID (0 for now)</p></li>
<li><p>gid: Group ID (0 for now)</p></li>
<li><p>home: Login directory (/ for now)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">/etc/group</span></code> is a group file. It is not currently used.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /etc/group</span>
<span class="go">root:*:0:root,admin</span>
</pre></div>
</div>
<p>The format of the group file is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>group:x:gid:users
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p>group: The group name</p></li>
<li><p>x: Group password</p></li>
<li><p>gid: Group ID</p></li>
<li><p>users: A comma separated list of members of the group</p></li>
</ul>
</section>
</section>
<section id="updating-the-romfs-file-system">
<h2>Updating the ROMFS File System<a class="headerlink" href="#updating-the-romfs-file-system" title="Permalink to this heading"></a></h2>
<p>The content on the <code class="docutils literal notranslate"><span class="pre">nsh_romfsimg.h</span></code> header file is generated from a sample
directory structure. You can directly modify files under <code class="docutils literal notranslate"><span class="pre">etc/</span></code> folder, The
build system will regenerate <code class="docutils literal notranslate"><span class="pre">nsh_romfsimg.h</span></code> automatically.</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">sim:nsh</span></code> configuration for an example of the use of this file system.</p>
</section>
<section id="replacing-the-password-file">
<h2>Replacing the Password File<a class="headerlink" href="#replacing-the-password-file" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sim:nsh</span></code> configuration can also be used to create a new password file.</p>
<p>First, make these configuration changes:</p>
<ol class="arabic">
<li><p>Disable logins</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- CONFIG_NSH_CONSOLE_LOGIN=y</span>
<span class="gi">+ # CONFIG_NSH_CONSOLE_LOGIN is not set</span>
<span class="w"> </span> # CONFIG_NSH_TELNET_LOGIN is not set
</pre></div>
</div>
</li>
<li><p>Move the password file to a write-able file system:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- CONFIG_FSUTILS_PASSWD_PATH=&quot;/etc/passwd&quot;</span>
<span class="gi">+ CONFIG_FSUTILS_PASSWD_PATH=&quot;/tmp/passwd&quot;</span>
</pre></div>
</div>
</li>
<li><p>Make the password file modifiable</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- CONFIG_FSUTILS_PASSWD_READONLY=y</span>
# CONFIG_FSUTILS_PASSWD_READONLY is not set
</pre></div>
</div>
</li>
</ol>
<p>Now rebuild the simulation. No login should be required to enter the shell and
you should find the <code class="docutils literal notranslate"><span class="pre">useradd</span></code>, <code class="docutils literal notranslate"><span class="pre">userdel</span></code>, and <code class="docutils literal notranslate"><span class="pre">passwd</span></code> commands available
in the help summary, provided that they are enabled. Make certain that the
<code class="docutils literal notranslate"><span class="pre">useradd</span></code> command is not disabled:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># CONFIG_NSH_DISABLE_USERADD is not set
</pre></div>
</div>
<p>Use the NSH <code class="docutils literal notranslate"><span class="pre">useradd</span></code> command to add new uses with new user passwords like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; useradd &lt;username&gt; &lt;password&gt;</span>
</pre></div>
</div>
<p>Do this as many times as you would like. Each time that you do this a new entry
with an encrypted password will be added to the <code class="docutils literal notranslate"><span class="pre">passwd</span></code> file at
<code class="docutils literal notranslate"><span class="pre">/tmp/passwd</span></code>. You can see the <code class="docutils literal notranslate"><span class="pre">passwd</span></code> file like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; cat /tmp/passwd</span>
</pre></div>
</div>
<p>When you are finished, you can simply copy the <code class="docutils literal notranslate"><span class="pre">/tmp/passwd</span></code> content from the
<code class="docutils literal notranslate"><span class="pre">cat</span></code> command and paste it into an editor. Make sure to remove any carriage
returns that may have ended up on the file if you are using Windows.</p>
<p>Then recreate the <code class="docutils literal notranslate"><span class="pre">nsh_romfsimg.h</span></code> file as described above. In step 2, simply
replace the old <code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code> file with the one in your editor. When you are
finished, the new passwd file will be in the ROMFS file system at the path
<code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code>. When you restore the original NSH sim configuration, these are
the passwords that will be used.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../index.html" class="btn btn-neutral float-left" title="SIM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../network_linux.html" class="btn btn-neutral float-right" title="Network Support on Linux" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>