<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SIM &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="SPARC" href="../../../../sparc/index.html" />
    <link rel="prev" title="SIM" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../../12.5.1" >12.5.1</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../arm/index.html">ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../arm64/index.html">ARM64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">Microchip AVR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ceva/index.html">CEVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../hc/index.html">HC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mips/index.html">MIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misco/index.html">Misoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../or1k/index.html">OpenRISC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../renesas/index.html">Renesas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Simulators</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">SIM</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../index.html#toolchain">Toolchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#compiling">Compiling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running">Running</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running-lvgl">Running LVGL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#running-vnc-server">Running VNC Server</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">SIM</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sparc/index.html">SPARC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tricore/index.html">TriCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86/index.html">Intel 80x86</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86_64/index.html">Intel 80x86_64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z16/index.html">Z16</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z80/index.html">Z80</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../logos/index.html">NuttX Logos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Simulators</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">SIM</a></li>
      <li class="breadcrumb-item active">SIM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/platforms/sim/sim/boards/sim/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sim">
<h1>SIM<a class="headerlink" href="#sim" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this heading"></a></h3>
<p>This README file describes the contents of the build configurations available
for the NuttX “sim” target.  The sim target is a NuttX port that runs as a
user-space program under Linux, Cygwin, or macOS.  It is a very “low fidelity”
embedded system simulation:  This environment does not support any kind of
asynchronous events – there are nothing like interrupts in this context.
Therefore, there can be no pre-empting events.</p>
</section>
<section id="fake-interrupts">
<h3>Fake Interrupts<a class="headerlink" href="#fake-interrupts" title="Permalink to this heading"></a></h3>
<p>In order to get timed behavior, the system timer “interrupt handler” is called
from the sim target’s IDLE loop.  The IDLE runs whenever there is no other
task running.  So, for example, if a task calls sleep(), then that task will
suspend wanting for the time to elapse.  If nothing else is available to run,
then the IDLE loop runs and the timer increments, eventually re-awakening the
sleeping task.</p>
<p>Context switching is based on logic similar to setjmp() and longjmp().</p>
<p>The sim target is used primarily as a development and test platform for new
RTOS features.  It is also of academic interest.  But it has no real-world
application that I know of.</p>
</section>
<section id="timing-fidelity">
<h3>Timing Fidelity<a class="headerlink" href="#timing-fidelity" title="Permalink to this heading"></a></h3>
<p>NOTE: The sim target’s IDLE loop to delay on each call so that the system
“timer interrupt” is called at a rate approximately correct for the system
timer tick rate.  This option can be enabled with CONFIG_SIM_WALLTIME_SIGNAL
which will drive the entire simulation by using a host timer that ticks at
CONFIG_USEC_PER_TICK.  This option will no longer deliver ‘tick’ events
from Idle task and it will generate them from the host signal handler.
Another option is to use CONFIG_SIM_WALLTIME_SLEEP which will enable the
tick events to be delayed from the Idle task by using a host sleep call.</p>
</section>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h2>
<p>One of the best reasons to use the simulation is that is supports great Linux-
based debugging.  Here are the steps that I following to use the Linux ddd
graphical front-end to GDB:</p>
<ol class="arabic">
<li><p>Modify the top-level configuration file.  Enable debug symbols by defining
the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd &lt;NuttX-Directory&gt;
CONFIG_DEBUG_SYMBOLS=y
</pre></div>
</div>
</li>
<li><p>Re-build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd &lt;NuttX-Directory&gt;
make clean
make
</pre></div>
</div>
</li>
<li><p>Then start the debugging:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ddd nuttx &amp;
gdb&gt; b user_start
gdb&gt; r
</pre></div>
</div>
</li>
</ol>
<p>NOTE:  This above steps work fine on Linux, Cygwin, and macOS.
On Cygwin, you will need to start the Cygwin-X server before running ddd.
On macOS, it’s probably easier to use lldb instead of gdb.</p>
</section>
<section id="issues">
<h2>Issues<a class="headerlink" href="#issues" title="Permalink to this heading"></a></h2>
<section id="bit-issues">
<h3>64-Bit Issues<a class="headerlink" href="#bit-issues" title="Permalink to this heading"></a></h3>
<p>As mentioned above, context switching is based on logic like setjmp() and
longjmp().  This context switching is available for 32-bit and 64-bit targets.
You must, however, set the correct target in the configuration before you
build: CONFIG_HOST_X86_64 or CONFIG_HOST_X86 for 64- and 32-bit targets,
respectively.  On a 64-bit machine, you can also force the 32-bit build with
CONFIG_SIM_M32=y (which does not seem to be supported by more contemporary
x86_64 compilers).</p>
<p>There are other 64-bit issues as well.  For example, addresses are retained in
32-bit unsigned integer types in a few places.  On a 64-bit machine, the 32-
bit address storage may corrupt 64-bit addressing.  NOTE:  This is really a
bug – addresses should not be retained in uint32_t types but rather in
uintptr_t types to avoid issues just like this.</p>
</section>
<section id="compiler-differences">
<h3>Compiler differences<a class="headerlink" href="#compiler-differences" title="Permalink to this heading"></a></h3>
<p>operator new:</p>
<blockquote>
<div><p>Problem:     “‘operator new’ takes size_t (’…’) as first parameter”</p>
<p>Workaround:   Add -fpermissive to the compilation flags</p>
</div></blockquote>
</section>
<section id="stack-size-issues">
<h3>Stack Size Issues<a class="headerlink" href="#stack-size-issues" title="Permalink to this heading"></a></h3>
<p>When you run the NuttX simulation, it uses stacks allocated by NuttX from the
NuttX heap.  The memory management model is exactly the same in the simulation
as in a real, target system.  This is good because this produces a higher
fidelity simulation.</p>
<p>However, when the simulation calls into the host OS libraries, it will still
use these small simulation stacks.  This happens, for example, when you call
into the system to get and put characters to the console window or when you
make X11 calls into the system.  The programming model within those libraries
will assume the host OS environment where the stack size grows dynamically
and not the small, limited stacks of a deeply embedded system.</p>
<p>As a consequence, those system libraries may allocate large data structures on
the stack and overflow the small NuttX stacks.  X11, in particular, requires
large stacks.  If you are using X11 in the simulation, make sure that you set
aside a “lot” of stack for the X11 library calls (maybe 8 or 16Kb). The stack
size for the thread that begins with user start is controlled by the
configuration setting CONFIG_INIT_STACKSIZE; you may need to increase this
value to larger number to survive the X11 library calls.</p>
<p>If you are running X11 applications such as NSH add-on programs, then the
stack size of the add-on program is controlled in another way.  Here are the
steps for increasing the stack size in that case:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ../apps/builtin    # Go to the builtin apps directory
vi builtin_list.h     # Edit this file and increase the stack size of the add-on
rm .built *.o         # This will force the builtin apps logic to rebuild
</pre></div>
</div>
</section>
<section id="symbol-collisions">
<h3>Symbol Collisions<a class="headerlink" href="#symbol-collisions" title="Permalink to this heading"></a></h3>
<p>The simulation build is a two pass build:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>On the first pass, an intermediate, partially relocatable object is
created called nuttx.rel.  This includes all of the files that are part
of the NuttX “domain.”</p></li>
<li><p>On the second pass, the files which are in the host OS domain are built
and then linked with nuttx.rel to generate the simulation program.</p></li>
</ol>
</div></blockquote>
<p>NuttX is a POSIX compliant RTOS and is normally built on a POSIX compliant
host environment (like Linux, Cygwin, or macOS).  As a result, the same
symbols are exported by both the NuttX domain and the host domain.  How can
we keep them separate?</p>
<p>This is done using the special file nuttx-name.dat.  This file just contains a
mapping of original function names to new function names.  For example, the
NuttX printf() will get the new name NXprintf().</p>
<p>This nuttx-names.dat file is used by the objcopy program between pass1 and
pass2 to rename all of the symbols in the nuttx.rel object so that they do not
collide with names provided by the host OS in the host PC domain.</p>
<p>Occasionally, as you test new functionality, you will find that you need to
add more names to the nuttx-names.dat file.  If there is a missing name
mapping in nuttx-names.dat, the symptoms may be very obscure and difficult to
debug.  What happens in this case is that when logic in nuttx.rel intended to
call the NuttX domain function, it instead calls into the host OS function of
the same name.</p>
<p>Often you can survive such events.  For example, it really should not matter
which version of strlen() you call.  Other times, it can cause subtle,
mysterious errors.  Usually, however, callng the wrong function in the wrong
OS results in a fatal crash.</p>
<p>On macOS, instead of objcopy, -unexported_symbols_list linker option is used
to hide symbols in the NuttX domain, using the same list of symbols from
nuttx-name.dat.</p>
</section>
<section id="networking-issues">
<h3>Networking Issues<a class="headerlink" href="#networking-issues" title="Permalink to this heading"></a></h3>
<p>I never did get networking to work on the sim target.  It tries to use the tap
device (/dev/net/tun) to emulate an Ethernet NIC, but I never got it correctly
integrated with the NuttX networking. (I probably should try using raw sockets
instead.)</p>
<p>Update:  Max Holtzberg reports to me that the tap device actually does work
properly, but not in an NSH configuration because stdio operations freeze the
simulation.</p>
<p>REVISIT: This may not long be an issue even with NSH because of the recent
redesign of how the stdio devices are handled in the simulation (they should
no longer freeze the simulation).</p>
<p>Update: Please issue these commands to setup the reliable network on Ubuntu:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get -y install net-tools
sudo nuttx/tools/simbridge.sh eth0 on
</pre></div>
</div>
<p>Here are some tips you may need:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Must launch the executable with the root permission</p></li>
<li><p>Have to use virtual machine if host is in corporation network</p></li>
<li><p>Configure the network adapter in NAT mode if virtual machine is used</p></li>
</ol>
</div></blockquote>
</section>
<section id="x11-issues">
<h3>X11 Issues<a class="headerlink" href="#x11-issues" title="Permalink to this heading"></a></h3>
<p>There is an X11-based framebuffer driver that you can use to exercise the
NuttX graphics subsystem on the simulator (see the sim/nx11 configuration
below). This may require a lot of tinkering to get working, depending upon
where your X11 installation stores libraries and header files and how it names
libraries.</p>
<p>For example, on Ubuntu 9.09, I had to do the following to get a clean build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd /usr/lib/
sudo ln -s libXext.so.6.4.0 libXext.so
</pre></div>
</div>
<p>(I also get a segmentation fault at the conclusion of the NX test – that will
need to get looked into as well.)</p>
<p>The X11 examples builds on Cygwin, but does not run.  The last time I tried
it, XOpenDisplay() aborted the program.  UPDATE:  This was caused by the small
stack size and can be fixed by increasing the size of the NuttX stack that
calls into X11.  See the discussion “Stack Size Issues” above.</p>
<p>Update: You may need issue this command with the latest Ubuntu before launch:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo xhost +
</pre></div>
</div>
</section>
<section id="cygwin64-issues">
<h3>Cygwin64 Issues<a class="headerlink" href="#cygwin64-issues" title="Permalink to this heading"></a></h3>
<p>There are some additional issues using the simulator with Cygwin64.  Below is
the summary of the changes that I had to make to get the simulator working in
that environment:</p>
<blockquote>
<div><p>CONFIG_HOST_X86_64=y, CONFIG_SIM_M32=n</p>
<blockquote>
<div><p>Need to select X64_64.  Cygwin64 tools do not seem to support any option
to build a 32-bit target.</p>
</div></blockquote>
<p>CONFIG_SIM_CYGWIN_DECORATED=n</p>
<blockquote>
<div><p>Older versions of Cygwin tools decorated C symbol names by adding an
underscore to the beginning of the symbol name.  Newer versions of Cygwin
do not seem to do this.  Deselecting CONFIG_SIM_CYGWIN_DECORATED will
select the symbols without the leading underscore as needed by the
Cygwin64 toolchain.</p>
<p>How do you know if you need this option?  You could look at the generated
symbol tables to see if there are underscore characters at the beginning
of the symbol names.  Or, if you need this option, the simulation will not
run:  It will crash early, probably in some function due to the failure to
allocate memory.</p>
<p>In this case, when I tried to run nutt.exe from the command line, it
exited silently.  Running with GDB I get the following (before hitting a
breakpoint at main()):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) r
Starting program: /cygdrive/c/Users/Gregory/Documents/projects/nuttx/master/nuttx/nuttx.exe
[New Thread 6512.0xda8]
[New Thread 6512.0x998]
      1 [main] nuttx 6512 C:\Users\Gregory\Documents\projects\nuttx\master\nuttx\nuttx.exe: *** fatal error - Internal error: Out of memory for new path buf.
    736 [main] nuttx 6512 cygwin_exception::open_stackdumpfile: Dumping stack trace to nuttx.exe.stackdump
[Thread 6512.0x998 exited with code 256]
[Inferior 1 (process 6512) exited with code 0400]
</pre></div>
</div>
</div></blockquote>
<p>CONFIG_SIM_X8664_SYSTEMV=n, CONFIG_SIM_X8664_MICROSOFT=y</p>
<blockquote>
<div><p>Select Microsoft x64 calling convention.</p>
<p>The Microsoft x64 calling convention is followed on Microsoft Windows and
pre-boot UEFI (for long mode on x86-64). It uses registers RCX, RDX, R8,
R9 for the first four integer or pointer arguments (in that order), and
XMM0, XMM1, XMM2, XMM3 are used for floating point arguments. Additional
arguments are pushed onto the stack (right to left). Integer return values
(similar to x86) are returned in RAX if 64 bits or less. Floating point
return values are returned in XMM0. Parameters less than 64 bits long are
not zero extended; the high bits are not zeroed.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="smp">
<h3>SMP<a class="headerlink" href="#smp" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This configuration has basic support for SMP testing.  The simulation
supports the emulation of multiple CPUs by creating multiple pthreads, each
running a copy of the simulation in the same process address space.</p>
<p>At present, the SMP simulation is not fully functional:  It does operate on
the simulated CPU threads for a few context switches then fails during a
setjmp() operation.  I suspect that this is not an issue with the NuttX SMP
logic but more likely some chaos in the pthread controls. I have seen
similar such strange behavior other times that I have tried to use
setjmp/longmp from a signal handler! Like when I tried to implement
simulated interrupts using signals.</p>
<p>Apparently, if longjmp is invoked from the context of a signal handler, the
result is undefined:
<a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1318.htm">http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1318.htm</a></p>
<p>Update: The dead lock is due to up_testset call pthread API for synchronization
inside the signal handler. After switching to atomic API, the problem get resolved.</p>
<p>You can enable SMP for ostest configuration by enabling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+CONFIG_SPINLOCK=y
+CONFIG_SMP=y
+CONFIG_SMP_NCPUS=2
</pre></div>
</div>
<p>And you can enable some additional debug output with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-# CONFIG_DEBUG_SCHED is not set
+CONFIG_DEBUG_SCHED=y

-# CONFIG_SCHED_INSTRUMENTATION is not set
-# CONFIG_SCHED_INSTRUMENTATION_SWITCH is not set
+CONFIG_SCHED_INSTRUMENTATION=y
+CONFIG_SCHED_INSTRUMENTATION_SWITCH=y
</pre></div>
</div>
<p>The SMP configuration will run with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SMP_NCPUS=1
</pre></div>
</div>
<p>In this case there is, of course, no multi-CPU processing, but this does
verify the correctness of some of the basic SMP logic.</p>
<p>The NSH configuration can also be forced to run SMP, but suffers from the
same quirky behavior.  It can be made reliable if you modify
arch/sim/src/up_idle.c so that the IDLE loop only runs for CPU0. Otherwise,
often simuart_post() will be called from CPU1 and it will try to restart NSH
on CPU0 and, again, the same quirkiness occurs.</p>
<p>Update: Only CPU0 call up_idle now, other CPUs have a simple idle loop:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* The idle Loop */

for (; ; )
  {
    /* Give other pthreads/CPUs a shot */

    pthread_yield();
  }
</pre></div>
</div>
<p>So it isn’t a problem any more.</p>
<p>But for example, this command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; sleep 1 &amp;
</pre></div>
</div>
<p>will execute the sleep command on CPU1 which has worked every time that I
have tried it (which is not too many times).</p>
</div></blockquote>
</section>
</section>
<section id="basic">
<h2>BASIC<a class="headerlink" href="#basic" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>I have used the sim/nsh configuration to test Michael Haardt’s BASIC
interpreter that you can find at apps/interpreters/bas.</p>
<blockquote>
<div><p>Bas is an interpreter for the classic dialect of the programming language
BASIC.  It is pretty compatible to typical BASIC interpreters of the
1980s, unlike some other UNIX BASIC interpreters, that implement a
different syntax, breaking compatibility to existing programs.  Bas offers
many ANSI BASIC statements for structured programming, such as procedures,
local variables and various loop types.  Further there are matrix
operations, automatic LIST indentation and many statements and functions
found in specific classic dialects.  Line numbers are not required.</p>
</div></blockquote>
<p>There is also a test suite for the interpreter that can be found at
apps/examples/bastest.</p>
</div></blockquote>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Below are the recommended configuration changes to use BAS with the
stm32f4discovery/nsh configuration:</p>
<p>Dependencies:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_LIBC_EXECFUNCS=y      : exec*() functions are required
CONFIG_LIBM=y                : Some floating point library is required
CONFIG_LIBC_FLOATINGPOINT=y  : Floating point printing support is required
CONFIG_LIBC_TMPDIR=&quot;/tmp&quot;    : Writeable temporary files needed for some commands
</pre></div>
</div>
<p>Enable the BASIC interpreter.  Other default options should be okay:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_INTERPRETERS_BAS=y    : Enables the interpreter
CONFIG_INTERPRETER_BAS_VT100=y
</pre></div>
</div>
<p>The BASIC test suite can be included:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_FS_ROMFS=y           : ROMFS support is needed
CONFIG_EXAMPLES_BASTEST=y   : Enables the BASIC test setup
CONFIG_EXAMPLES_BASTEST_DEVMINOR=6
CONFIG_EXAMPLES_BASTEST_DEVPATH=&quot;/dev/ram6&quot;
</pre></div>
</div>
</div></blockquote>
</section>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This setup will initialize the BASIC test (optional):  This will mount a
ROMFS file system at /mnt/romfs that contains the BASIC test files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; bastest
Registering romdisk at /dev/ram6
Mounting ROMFS filesystem at target=/mnt/romfs with source=/dev/ram6
nsh&gt;
</pre></div>
</div>
<p>The interactive interpreter is started like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; bas
bas 2.4
Copyright 1999-2014 Michael Haardt.
This is free software with ABSOLUTELY NO WARRANTY.
&gt;

Ctrl-D exits the interpreter.

The test programs can be ran like this:

nsh&gt; bastest
Registering romdisk at /dev/ram0
Mounting ROMFS filesystem at target=/mnt/romfs with source=/dev/ram0
nsh&gt; bas /mnt/romfs/test01.bas
 1
hello
 0.0002
 0.0000020
 0.0000002

nsh&gt;
</pre></div>
</div>
<p>Or you can load a test into memory and execute it interactively:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; bas
bas 2.4
Copyright 1999-2014 Michael Haardt.
This is free software with ABSOLUTELY NO WARRANTY.
&gt; load &quot;/mnt/romfs/test01.bas&quot;
&gt; run
 1
hello
 0.0002
 0.0000020
 0.0000002
&gt;
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="common-configuration-information">
<h2>Common Configuration Information<a class="headerlink" href="#common-configuration-information" title="Permalink to this heading"></a></h2>
<blockquote>
<div><ol class="arabic">
<li><p>Each configuration is maintained in a sub-directory and can be selected
as follow:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tools/configure.sh sim:&lt;subdir&gt;
</pre></div>
</div>
<p>Where &lt;subdir&gt; is one of the following sub-directories.</p>
</li>
<li><p>All configurations uses the mconf-based configuration tool.  To change
this configuration using that tool, you should:</p>
<ol class="loweralpha simple">
<li><p>Build and install the kconfig mconf tool.  See nuttx/README.txt and
see additional README.txt files in the NuttX tools repository.</p></li>
<li><p>Execute ‘make menuconfig’ in nuttx/ in order to start the
reconfiguration process.</p></li>
</ol>
</li>
<li><p>Before building, make sure that the configuration is correct for your
host platform:</p>
<ol class="loweralpha">
<li><p>Linux, 32-bit CPU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=y
CONFIG_HOST_WINDOWS=n
CONFIG_HOST_X86=y
CONFIG_HOST_X86_64=n
CONFIG_HOST_ARM64=n
</pre></div>
</div>
</li>
<li><p>Linux, 64-bit CPU, 32-bit build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=y
CONFIG_HOST_WINDOWS=n
CONFIG_HOST_X86=n
CONFIG_HOST_X86_64=y
CONFIG_HOST_ARM64=n
CONFIG_SIM_X8664_MICROSOFT=n
CONFIG_SIM_X8664_SYSTEMV=y
CONFIG_SIM_M32=y
</pre></div>
</div>
</li>
<li><p>Linux, 64-bit CPU, 64-bit build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=y
CONFIG_HOST_WINDOWS=n
CONFIG_HOST_X86=n
CONFIG_HOST_X86_64=y
CONFIG_HOST_ARM64=n
CONFIG_SIM_X8664_MICROSOFT=n
CONFIG_SIM_X8664_SYSTEMV=y
CONFIG_SIM_M32=n
</pre></div>
</div>
</li>
<li><p>Cygwin, 32-bit:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=n
CONFIG_HOST_WINDOWS=y
CONFIG_WINDOWS_CYGWIN=y
CONFIG_HOST_X86=y
CONFIG_HOST_X86_64=n
CONFIG_HOST_ARM64=n
</pre></div>
</div>
</li>
<li><p>Cygwin64, 64-bit, 32-bit build</p>
<p>I don’t believe this configuration is supported by Cygwin64</p>
</li>
<li><p>Cygwin64, 64-bit, 64-bit build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=n
CONFIG_HOST_WINDOWS=y
CONFIG_WINDOWS_CYGWIN=y
CONFIG_HOST_X86=n
CONFIG_HOST_X86_64=y
CONFIG_HOST_ARM64=n
CONFIG_SIM_X8664_MICROSOFT=y
CONFIG_SIM_X8664_SYSTEMV=n
CONFIG_SIM_M32=n
</pre></div>
</div>
</li>
<li><p>macOS, 64-bit, 64-bit build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=n
CONFIG_HOST_MACOS=y
CONFIG_HOST_WINDOWS=n
CONFIG_HOST_X86=n
CONFIG_HOST_X86_64=y
CONFIG_HOST_ARM64=n
CONFIG_SIM_X8664_MICROSOFT=n
CONFIG_SIM_X8664_SYSTEMV=y
CONFIG_SIM_M32=n
</pre></div>
</div>
</li>
<li><p>macOS M1, 64-bit, 64-bit build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=n
CONFIG_HOST_MACOS=y
CONFIG_HOST_WINDOWS=n
CONFIG_HOST_X86=n
CONFIG_HOST_X86_64=n
CONFIG_HOST_ARM64=y
CONFIG_SIM_X8664_MICROSOFT=n
CONFIG_SIM_X8664_SYSTEMV=y
CONFIG_SIM_M32=n
</pre></div>
</div>
</li>
<li><p>Linux ARM64, 64-bit, 64-bit build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_HOST_LINUX=y
CONFIG_HOST_MACOS=n
CONFIG_HOST_WINDOWS=n
CONFIG_HOST_X86=n
CONFIG_HOST_X86_64=n
CONFIG_HOST_ARM64=y
CONFIG_SIM_X8664_MICROSOFT=n
CONFIG_SIM_X8664_SYSTEMV=y
CONFIG_SIM_M32=n
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</div></blockquote>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<section id="adb">
<h3>adb<a class="headerlink" href="#adb" title="Permalink to this heading"></a></h3>
<p>A simple demo show how to config adb:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./nuttx
NuttShell (NSH) NuttX-10.2.0
nsh&gt; adbd &amp;
adbd [2:100]
</pre></div>
</div>
<p>You can use the normal adb command from host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>adb kill-server
adb connect localhost:5555
adb shell
</pre></div>
</div>
</section>
<section id="alsa">
<h3>alsa<a class="headerlink" href="#alsa" title="Permalink to this heading"></a></h3>
<p>This configuration enables testing audio applications on NuttX by
implementing an audio-like driver that uses ALSA to forward the audio to
the host system. It also enables the <cite>hostfs</cite> to enable direct access to
the host system’s files mounted on the simulator. The ALSA audio driver
allows uncompressed PCM files - as well as MP3 files - to be played.</p>
<p>To check the audio devices:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./nuttx
NuttShell (NSH) NuttX-10.4.0
nsh&gt; ls /dev/audio
/dev/audio:
pcm0c
pcm0p
pcm1c
pcm1p
</pre></div>
</div>
<ul class="simple">
<li><p><cite>pcm0c</cite> represents the device to capture uncompressed PCM audio;</p></li>
<li><p><cite>pcm0p</cite> represents the device to playback uncompressed PCM files;</p></li>
<li><p><cite>pcm1c</cite> represents the device to capture MP3-encoded audio;</p></li>
<li><p><cite>pcm1p</cite> represents the device to playback MP3-encoded files;</p></li>
</ul>
<section id="mounting-files-from-host-system">
<h4>Mounting Files from Host System<a class="headerlink" href="#mounting-files-from-host-system" title="Permalink to this heading"></a></h4>
<p>To mount files from the host system and enable them to be played in the sim:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t hostfs -o fs=/path/to/audio/files/ /host
nsh&gt; ls /host
/host:
mother.mp3
mother.wav
.
..
</pre></div>
</div>
</section>
<section id="playing-uncompressed-pcm-files">
<h4>Playing uncompressed-PCM files<a class="headerlink" href="#playing-uncompressed-pcm-files" title="Permalink to this heading"></a></h4>
<p>To play uncompressed-PCM files, we can use <cite>nxplayer</cite>’s <cite>playraw</cite> command.
We need 1) select the appropriate audio device to playback this file and
1) know in advance the file’s parameters (channels, bits/sample and
sampling rate):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; nxplayer
NxPlayer version 1.05
h for commands, q to exit

nxplayer&gt; device /dev/audio/pcm0p
nxplayer&gt; playraw /host/mother.wav 2 16 44100
</pre></div>
</div>
<p>In this example, the file <cite>mother.wav</cite> is a stereo (2-channel),
16 bits/sample and 44,1KHz PCM-encoded file.</p>
</section>
<section id="playing-mp3-encoded-files">
<h4>Playing MP3-encoded files<a class="headerlink" href="#playing-mp3-encoded-files" title="Permalink to this heading"></a></h4>
<p>To play MP3 files, we can use <cite>nxplayer</cite>’s <cite>play</cite> command directly.
We only need to select the appropriate audio device to playback this file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; nxplayer
NxPlayer version 1.05
h for commands, q to exit

nxplayer&gt; device /dev/audio/pcm1p
nxplayer&gt; play /host/mother.mp3
</pre></div>
</div>
</section>
</section>
<section id="bluetooth">
<h3>bluetooth<a class="headerlink" href="#bluetooth" title="Permalink to this heading"></a></h3>
<p>Supports some very limited, primitive, low-level debug of the Bluetooth
stack using the Bluetooth “Swiss Army Knife” at
apps/wireless/bluetooth/btsak and the NULL Bluetooth device at
drivers/wireless/bluetooth/bt_null.c</p>
<p>There is also support on a Linux Host for attaching the bluetooth hardware
from the host to the NuttX bluetooth stack via the HCI Socket interface
over the User Channel.  This is enabled in the bthcisock configuration.
In order to use this you must give the nuttx elf additional capabilities:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo setcap &#39;cap_net_raw,cap_net_admin=eip&#39; ./nuttx
</pre></div>
</div>
<p>You can then monitor the HCI traffic on the host with wireshark or btmon:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo btmon
</pre></div>
</div>
</section>
<section id="configdata">
<h3>configdata<a class="headerlink" href="#configdata" title="Permalink to this heading"></a></h3>
<p>A unit test for the MTD configuration data driver.</p>
</section>
<section id="cxxtest">
<h3>cxxtest<a class="headerlink" href="#cxxtest" title="Permalink to this heading"></a></h3>
<p>The C++ standard library test at apps/testing/cxxtest configuration.  This
test is used to verify the uClibc++ port to NuttX.</p>
<p>NOTES</p>
<blockquote>
<div><ol class="arabic">
<li><p>Before you can use this example, you must first install the uClibc++ C++
library.  This is located outside of the NuttX source tree in the NuttX
uClibc++ GIT repository.  See the README.txt file there for instructions
on how to install uClibc++</p></li>
<li><p>At present (2012/11/02), exceptions are disabled in this example
(CONFIG_CXX_EXCEPTION=n).  It is probably not necessary to disable
exceptions.</p></li>
<li><p>Unfortunately, this example will not run now.</p>
<p>The reason that the example will not run on the simulator has to do with
when static constructors are enabled:  In the simulator it will attempt
to execute the static constructors before main() starts. BUT… NuttX is
not initialized and this results in a crash.</p>
<p>To really use this example, I will have to think of some way to postpone
running C++ static initializers until NuttX has been initialized.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="fb">
<h3>fb<a class="headerlink" href="#fb" title="Permalink to this heading"></a></h3>
<p>A simple configuration used for some basic (non-graphic) debug of the
framebuffer character drivers using apps/examples/fb.</p>
</section>
<section id="ipforward">
<h3>ipforward<a class="headerlink" href="#ipforward" title="Permalink to this heading"></a></h3>
<p>This is an NSH configuration that includes a simple test of the NuttX IP
forwarding logic using apps/examples/ipforward.  That example uses two TUN
network devices to represent two networks.  The test then sends packets from
one network destined for the other network.  The NuttX IP forwarding logic
will recognize that the received packets are not destined for it and will
forward the logic to the other TUN network.  The application logic then both
sends the packets on one network and receives and verifies the forwarded
packet received on the other network.  The received packets differ from the
sent packets only in that the hop limit (TTL) has been decremented.</p>
<p>Be default, this test will forward TCP packets.  The test can be modified to
support forwarding of ICMPv6 multicast packets with these changes to the
.config file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-CONFIG_EXAMPLES_IPFORWARD_TCP=y
+CONFIG_EXAMPLES_IPFORWARD_ICMPv6=y

+CONFIG_NET_ICMPv6=y
+CONFIG_NET_ICMPv6_SOCKET=y
+CONFIG_NET_ETHERNET=y
+CONFIG_NET_IPFORWARD_BROADCAST=y
</pre></div>
</div>
<p>Additional required settings will also be selected when you manually select
the above via ‘make menuconfig’.</p>
</section>
<section id="loadable">
<h3>loadable<a class="headerlink" href="#loadable" title="Permalink to this heading"></a></h3>
<p>This configuration provides an example of loadable apps.  It cannot be used
with any Windows configuration, however, because Windows does not use the
ELF format.</p>
<p>This is the key part of the configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+CONFIG_PATH_INITIAL=&quot;/system/bin&quot;
+CONFIG_INIT_FILEPATH=&quot;/system/bin/nsh&quot;
</pre></div>
</div>
<p>The shell is loaded from the elf, but you can also run any of the ELFs that are in /system/bin as they are on the “PATH”</p>
</section>
<section id="minibasic">
<h3>minibasic<a class="headerlink" href="#minibasic" title="Permalink to this heading"></a></h3>
<p>This configuration was used to test the Mini Basic port at
apps/interpreters/minibasic.</p>
</section>
<section id="module">
<h3>module<a class="headerlink" href="#module" title="Permalink to this heading"></a></h3>
<p>This is a configuration to test CONFIG_LIBC_MODLIB with 64-bit modules.
This has apps/examples/module enabled.
This configuration is intended for 64-bit host OS.</p>
</section>
<section id="module32">
<h3>module32<a class="headerlink" href="#module32" title="Permalink to this heading"></a></h3>
<p>This is a configuration to test CONFIG_LIBC_MODLIB with CONFIG_SIM_M32
and 32-bit modules.
This has apps/examples/module enabled.
This configuration is intended for 64-bit host OS.</p>
</section>
<section id="mount">
<h3>mount<a class="headerlink" href="#mount" title="Permalink to this heading"></a></h3>
<p>Configures to use apps/examples/mount.</p>
</section>
<section id="mtdpart">
<h3>mtdpart<a class="headerlink" href="#mtdpart" title="Permalink to this heading"></a></h3>
<p>This is the apps/examples/mtdpart test using a MTD RAM driver to
simulate the FLASH part.</p>
</section>
<section id="mtdrwb">
<h3>mtdrwb<a class="headerlink" href="#mtdrwb" title="Permalink to this heading"></a></h3>
<p>This is the apps/examples/mtdrwb test using a MTD RAM driver to
simulate the FLASH part.</p>
</section>
<section id="nettest">
<h3>nettest<a class="headerlink" href="#nettest" title="Permalink to this heading"></a></h3>
<p>Configures to use apps/examples/nettest.  This configuration enables
networking using the network TAP device.</p>
<p>NOTES:</p>
<blockquote>
<div><ol class="arabic">
<li><p>The NuttX network is not, however, functional on the Linux TAP device
yet.</p>
<p>UPDATE:  The TAP device does apparently work according to a NuttX user
(provided that it is not used with NSH: NSH waits on readline() for
console input.  When it calls readline(), the whole system blocks waiting
from input from the host OS).  My failure to get the TAP device working
appears to have been a cockpit error.</p>
</li>
<li><p>As of NuttX-5.18, when built on Windows, this test does not try to use
the TAP device (which is not available on Cygwin anyway), but inside will
try to use the Cygwin WPCAP library.  Only the most preliminary testing
has been performed with the Cygwin WPCAP library, however.</p>
<p>NOTE that the IP address is hard-coded in arch/sim/src/up_wpcap.c. You
will either need to edit your configuration files to use 10.0.0.1 on the
“target” (CONFIG_EXAMPLES_NETTEST_*) or edit up_wpcap.c to select the IP
address that you want to use.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="nimble">
<h3>nimble<a class="headerlink" href="#nimble" title="Permalink to this heading"></a></h3>
<p>This is similar to bthcisock configuration, which uses the exposes the real
BLE stack to NuttX, but disables NuttX’s own BLE stack and uses nimBLE stack
instead (built in userspace).</p>
<p>This configuration can be tested by running nimBLE example application “nimble”
as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo setcap &#39;cap_net_raw,cap_net_admin=eip&#39; nuttx
$ ./nuttx
NuttShell (NSH) NuttX-9.1.0
nsh&gt; ifup bnep0
ifup bnep0...OK
nsh&gt; nimble
hci init
port init
gap init
gatt init
ans init
ias init
lls init
tps init
hci_sock task init
ble_host task init
hci sock task
host task
advertise
</pre></div>
</div>
<p>At this point you should be able to detect a “nimble” BLE device when scanning
for BLE devices. You can use nRFConnect Android application from Nordic to connect
and inspect exposed GATT services.</p>
</section>
<section id="nsh">
<h3>nsh<a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h3>
<p>Configures to use the NuttShell at apps/examples/nsh.</p>
<p>NOTES:</p>
<blockquote>
<div><ol class="arabic">
<li><p>This version has one builtin function:  This configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/examples/hello.
</pre></div>
</div>
</li>
<li><p>This version has password protection enabled.  Here is the login info:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>USERNAME:  admin
PASSWORD:  Administrator
</pre></div>
</div>
<p>The encrypted password is retained in /etc/passwd.  I am sure that
you will find this annoying.  You can disable the password protection
by de-selecting CONFIG_NSH_CONSOLE_LOGIN=y.</p>
</li>
<li><p>This configuration has BINFS enabled so that the builtin applications can
be made visible in the file system.  Because of that, the builtin
applications do not work as other examples.</p>
<p>The binfs filesystem will be mounted at /bin when the system starts up:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; ls /bin
/bin:
  hello
nsh&gt; echo $PATH
/bin
nsh&gt; hello
Hello, World!!
nsh&gt;
</pre></div>
</div>
<p>Notice that the executable ‘hello’ is found using the value in the PATH
variable (which was preset to “/bin”).  If the PATH variable were not set
then you would have to use /bin/hello on the command line.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="nsh2">
<h3>nsh2<a class="headerlink" href="#nsh2" title="Permalink to this heading"></a></h3>
<p>This is another example that configures to use the NuttShell at
apps/examples/nsh. Like nsh, this version uses NSH built-in functions:  The
nx, nxhello, and nxlines examples are included as built-in functions.</p>
<p>NOTES:</p>
<blockquote>
<div><ol class="arabic">
<li><p>X11 Configuration</p>
<p>This configuration uses an X11-based framebuffer driver.  Of course, this
configuration can only be used in environments that support X11!  (And it
may not even be usable in all of those environments without some
“tweaking” See discussion below under the nx11 configuration).</p>
<p>For examples, it expects to be able to include X11/Xlib.h.  That
currently fails on my Linux box.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="nx">
<h3>nx<a class="headerlink" href="#nx" title="Permalink to this heading"></a></h3>
<p>Configures to use apps/examples/nx.</p>
<p>NOTES:</p>
<blockquote>
<div><ol class="arabic">
<li><p>Special Framebuffer Configuration</p>
<p>Special simulated framebuffer configuration options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SIM_FBHEIGHT - Height of the framebuffer in pixels
CONFIG_SIM_FBWIDTH  - Width of the framebuffer in pixels.
CONFIG_SIM_FBBPP    - Pixel depth in bits
</pre></div>
</div>
</li>
<li><p>No Display!</p>
<p>This version has NO DISPLAY and is only useful for debugging NX internals
in environments where X11 is not supported.  There is an additional
configuration that may be added to include an X11-based simulated
framebuffer driver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SIM_X11FB    - Use X11 window for framebuffer
</pre></div>
</div>
<p>See the “nx11” configuration below for more information.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="nx11">
<h3>nx11<a class="headerlink" href="#nx11" title="Permalink to this heading"></a></h3>
<p>Configures to use apps/examples/nx.  This configuration is similar to the nx
configuration except that it adds support for an X11-based framebuffer
driver.  Of course, this configuration can only be used in environments that
support X11!  (And it may not even be usable in all of those environments
without some “tweaking”).</p>
<blockquote>
<div><ol class="arabic">
<li><p>Special Framebuffer Configuration</p>
<p>This configuration uses the same special simulated framebuffer
configuration options as the nx configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SIM_X11FB    - Use X11 window for framebuffer
CONFIG_SIM_FBHEIGHT - Height of the framebuffer in pixels
CONFIG_SIM_FBWIDTH  - Width of the framebuffer in pixels.
CONFIG_SIM_FBBPP    - Pixel depth in bits
</pre></div>
</div>
</li>
<li><p>X11 Configuration</p>
<p>But now, since CONFIG_SIM_X11FB is also selected the following
definitions are needed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SIM_FBBPP (must match the resolution of the display).
CONFIG_FB_CMAP=y
</pre></div>
</div>
<p>My system has 24-bit color, but packed into 32-bit words so the correct
setting of CONFIG_SIM_FBBPP is 32.</p>
<p>For whatever value of CONFIG_SIM_FBBPP is selected, the corresponding
CONFIG_NX_DISABLE_*BPP setting must not be disabled.</p>
</li>
<li><p>Touchscreen Support</p>
<p>A X11 mouse-based touchscreen simulation can also be enabled by setting:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_INPUT=y
CONFIG_SIM_TOUCHSCREEN=y
</pre></div>
</div>
<p>NOTES:</p>
<ol class="loweralpha simple">
<li><p>If you do not have the call to sim_tcinitialize(0), the build will
mysteriously fail claiming that it can’t find up_tcenter() and
up_tcleave().  That is a consequence of the crazy way that the
simulation is built and can only be eliminated by calling
up_simtouchscreen(0) from your application.</p></li>
<li><p>You must first call up_fbinitialize(0) before calling
up_simtouchscreen() or you will get a crash.</p></li>
<li><p>Call sim_tcunininitializee() when you are finished with the simulated
touchscreen.</p></li>
<li><p>Enable CONFIG_DEBUG_INPUT=y for touchscreen debug output.</p></li>
</ol>
</li>
<li><p>X11 Build Issues</p>
<p>To get the system to compile under various X11 installations you may have
to modify a few things.  For example, in order to find libXext, I had to
make the following change under Ubuntu 9.09:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd /usr/lib/
sudo ln -s libXext.so.6.4.0 libXext.so
</pre></div>
</div>
</li>
<li><p>apps/examples/nxterm</p>
<p>This configuration is also set up to use the apps/examples/nxterm test
instead of apps/examples/nx.  To enable this configuration, First,
select Multi-User mode as described above.  Then, add the following
definitions to the defconfig file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-CONFIG_NXTERM=n
+CONFIG_NXTERM=y

-CONFIG_EXAMPLES_NX=y
+CONFIG_EXAMPLES_NX=n

-CONFIG_EXAMPLES_NXTERM=n
+CONFIG_EXAMPLES_NXTERM=y
</pre></div>
</div>
<p>See apps/examples/README.txt for further details.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="nxffs">
<h3>nxffs<a class="headerlink" href="#nxffs" title="Permalink to this heading"></a></h3>
<p>This is a test of the NXFFS file system using the apps/testing/nxffs test
with an MTD RAM driver to simulate the FLASH part.</p>
</section>
<section id="nxlines">
<h3>nxlines<a class="headerlink" href="#nxlines" title="Permalink to this heading"></a></h3>
<p>This is the apps/examples/nxlines test.</p>
</section>
<section id="nxwm">
<h3>nxwm<a class="headerlink" href="#nxwm" title="Permalink to this heading"></a></h3>
<p>This is a special configuration setup for the NxWM window manager UnitTest.
The NxWM window manager can be found here:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/graphics/NxWidgets/nxwm
</pre></div>
</div>
<p>The NxWM unit test can be found at:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apps/graphics/NxWidgets/UnitTests/nxwm
</pre></div>
</div>
<p>NOTES</p>
<blockquote>
<div><ol class="arabic">
<li><p>There is an issue with running this example under the simulation:  In the
default configuration, this example will run the NxTerm example which
waits on readline() for console input.  When it calls readline(), the
whole system blocks waiting from input from the host OS.  So, in order to
get this example to run, you must comment out the readline() call in
apps/nshlib/nsh_consolemain.c like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index: nsh_consolemain.c
===================================================================
--- nsh_consolemain.c   (revision 4681)
+++ nsh_consolemain.c   (working copy)
@@ -117,7 +117,8 @@
   /* Execute the startup script */

 #ifdef CONFIG_ETC_ROMFS
-  nsh_script(&amp;pstate-&gt;cn_vtbl, &quot;init&quot;, NSH_INITPATH);
+// REMOVE ME
+//  nsh_script(&amp;pstate-&gt;cn_vtbl, &quot;init&quot;, NSH_INITPATH);
 #endif

   /* Then enter the command line parsing loop */
@@ -130,7 +131,8 @@
       fflush(pstate-&gt;cn_outstream);

       /* Get the next line of input */
-
+sleep(2); // REMOVE ME
+#if 0 // REMOVE ME
       ret = readline(pstate-&gt;cn_line, CONFIG_NSH_LINELEN,
                      INSTREAM(pstate), OUTSTREAM(pstate));
       if (ret &gt; 0)
@@ -153,6 +155,7 @@
                   &quot;readline&quot;, NSH_ERRNO_OF(-ret));
           nsh_exit(&amp;pstate-&gt;cn_vtbl, 1);
         }
+#endif // REMOVE ME
     }

   /* Clean up */
</pre></div>
</div>
<p>UPDATE:  I recently implemented a good UART simulation to drive the
serial console.  So I do not believe that problem exists and I think that
the above workaround should no longer be necessary. However, I will leave
the above text in place until I get the opportunity to verify that the
new UART simulation fixes the problem.</p>
</li>
</ol>
<dl class="simple">
<dt>2019-05-04:  Something has changed.  Today this configuration failed to</dt><dd><p>build because is requires CONFIG_NX_XYINPUT=y in the configuration. That
indicates mouse or touchscreen support.  Apparently, the current NxWM
will not build without this support.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="ostest">
<h3>ostest<a class="headerlink" href="#ostest" title="Permalink to this heading"></a></h3>
<p>The “standard” NuttX apps/examples/ostest configuration.</p>
</section>
<section id="pf-ieee802154">
<h3>pf_ieee802154<a class="headerlink" href="#pf-ieee802154" title="Permalink to this heading"></a></h3>
<p>This is the configuration that used for unit level test of the socket
support for the PF_IEEE802154 address family.  It uses the IEEE 802.15.4
loopback network driver and the test at apps/examples/pf_ieee802154.</p>
<p>Basic usage example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; pfserver ab:cd &amp;
nsh&gt; pfclient ab:cd
</pre></div>
</div>
</section>
<section id="pktradio">
<h3>pktradio<a class="headerlink" href="#pktradio" title="Permalink to this heading"></a></h3>
<p>This configuration is identical to the ‘sixlowpan configuration described
below EXCEPT that it uses the generic packet radio loopback network device.</p>
</section>
<section id="rpproxy-and-rpserver">
<h3>rpproxy and rpserver<a class="headerlink" href="#rpproxy-and-rpserver" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is an example implementation for OpenAMP based on the share memory.</p>
<dl class="simple">
<dt>rpproxy:  Remote slave(client) proxy process.</dt><dd><p>rpproxy created a proxy between client and server to allow
the client to access the hardware resources on different
process.</p>
</dd>
<dt>rpserver: Remote master(host) server process.</dt><dd><dl class="simple">
<dt>rpserver contains all the real hardware configuration, such as:</dt><dd><ol class="arabic simple">
<li><p>Universal Asynchronous Receiver/Transmitter (UART).</p></li>
<li><p>Specific File System.</p></li>
<li><p>Network protocol stack and real network card device.</p></li>
<li><p>…</p></li>
</ol>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>Rpmsg driver used in this example include:</p>
<ol class="arabic">
<li><p>Rpmsg Syslog</p>
<blockquote>
<div><p>Source:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>include/nuttx/syslog/syslog_rpmsg.h
drivers/syslog/syslog_rpmsg_server.c
drivers/syslog/syslog_rpmsg.c
</pre></div>
</div>
<p>Describe:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1&gt;Redirect log to master core
  Linux kernel, NuttX, Freertos ...
2&gt;Work as early as possible
  Two phase initialization
3&gt;Never lost the log
  Hang during boot or runtime
  Full system crash(panic, watchdog ...)
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Rpmsg TTY(UART)</p>
<blockquote>
<div><p>Source:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>include/nuttx/serial/uart_rpmsg.h
drivers/serial/uart_rpmsg.c
</pre></div>
</div>
<p>Describe:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1&gt;Like pseudo terminal but between two CPU
2&gt;No different from real tty(open/read/write/close)
3&gt;Full duplex communication
4&gt;Support multiple channels as need
  1)Connect RTOS shell
  2)Make integrated GPS like external(NMEA)
  3)Make integrated modem like external(ATCMD)
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>RpmsgFS</p>
<blockquote>
<div><p>Source:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fs/rpmsgfs/rpmsgfs.h
fs/rpmsgfs/rpmsgfs.c
fs/rpmsgfs/rpmsgfs_client.c
fs/rpmsgfs/rpmsgfs_server.c
</pre></div>
</div>
<p>Describe:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1.Like NFS but between two CPU
2.Fully access remote(Linux/NuttX) File system
  1)Save the tuning parameter during manufacture
  2)Load the tuning parameter file in production
  3)Save audio dump to file for tuning/debugging
  4)Dynamic loading module from remote
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Rpmsg Net</p>
<blockquote>
<div><p>Source:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>include/nuttx/net/rpmsg.h
include/nuttx/net/rpmsgdrv.h
drivers/net/rpmsgdrv.c
drivers/usrsock/usrsock_rpmsg.h
drivers/usrsock/usrsock_rpmsg.c
drivers/usrsock/usrsock_rpmsg_server.c
</pre></div>
</div>
<p>Describe:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1)Rpmsg UsrSock client
2)Rpmsg UsrSock server
3)Rpmsg Net driver
4)Rpmsg MAC/PHY adapter
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>To use this example:</p>
<ol class="arabic">
<li><p>Build images</p>
<blockquote>
<div><ol class="arabic">
<li><p>Build rpserver and backup the image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./tools/configure.sh sim:rpserver
make
cp nuttx ~/rpserver
</pre></div>
</div>
</li>
<li><p>Distclean the build environment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make distclean
</pre></div>
</div>
</li>
<li><p>Build rpproxy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./tools/configure.sh sim:rpproxy
make
cp nuttx ~/rpproxy
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Test the Rpmsg driver</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Rpmsg Syslog:</p></li>
</ol>
<blockquote>
<div><p>Start rpserver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo ~/rpserver
[    0.000000] server: SIM: Initializing

NuttShell (NSH)
server&gt;

Start rpproxy:

$ sudo ~/rpproxy

Check the syslog from rpproxy in rpserver terminal:

server&gt; [    0.000000] proxy: SIM: Initializing
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Rpmsg TTY(UART):</p></li>
</ol>
<blockquote>
<div><p>Use cu switch the current CONSOLE to the proxy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>server&gt; ps
  PID GROUP PRI POLICY   TYPE    NPX STATE    EVENT     SIGMASK   STACK COMMAND
    0     0   0 FIFO     Kthread N-- Ready              00000000 000000 Idle Task
    1     1 224 FIFO     Kthread --- Waiting  Signal    00000000 002032 hpwork
    2     1 100 FIFO     Task    --- Running            00000000 004080 init
    3     3 224 FIFO     Kthread --- Waiting  Signal    00000002 002000 rptun proxy 0x56634fa0
server&gt; cu /dev/ttyproxy
proxy&gt; ps
  PID GROUP PRI POLICY   TYPE    NPX STATE    EVENT     SIGMASK   STACK COMMAND
    0     0   0 FIFO     Kthread N-- Ready              00000000 000000 Idle Task
    1     1 224 FIFO     Kthread --- Waiting  Signal    00000000 002032 hpwork
    3     3 100 FIFO     Task    --- Running            00000000 004080 init
</pre></div>
</div>
<p>To switch back the console, type <code class="docutils literal notranslate"><span class="pre">&quot;~.&quot;</span></code> in the cu session.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p>RpmsgFS:</p>
<p>Mount the remote file system via RPMSGFS, cu to proxy first:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>server&gt; cu
proxy&gt; mount -t rpmsgfs -o cpu=server,fs=/proc proc_server
proxy&gt; ls
/:
  dev/
  etc/
  proc/
  proc_server/
  tmp/
</pre></div>
</div>
<p>Check the uptime:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proxy&gt; cat proc/uptime
  833.21
proxy&gt; cat proc_server/uptime
  821.72
</pre></div>
</div>
</li>
<li><p>Rpmsg UsrSock:</p>
<p>“rptun proxy” kernel thread is running:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>server&gt; ps
  PID GROUP PRI POLICY   TYPE    NPX STATE    EVENT     SIGMASK   STACK COMMAND
    0     0   0 FIFO     Kthread N-- Ready              00000000 000000 Idle Task
    1     1 224 FIFO     Kthread --- Waiting  Signal    00000000 002032 hpwork
    2     1 100 FIFO     Task    --- Running            00000000 004080 init
    3     3 224 FIFO     Kthread --- Waiting  Signal    00000002 002000 rptun proxy 0x56634fa0

send ICMP ping to network server via rpmsg usrsock:

server&gt; cu
proxy&gt; ping 127.0.0.1
PING 127.0.0.1 56 bytes of data
56 bytes from 127.0.0.1: icmp_seq=0 time=20 ms
56 bytes from 127.0.0.1: icmp_seq=1 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=2 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=3 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=4 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=5 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=6 time=20 ms
56 bytes from 127.0.0.1: icmp_seq=7 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=8 time=10 ms
56 bytes from 127.0.0.1: icmp_seq=9 time=10 ms
10 packets transmitted, 10 received, 0% packet loss, time 10100 ms
</pre></div>
</div>
</li>
</ol>
<p>Please read NETWORK-LINUX.txt if you want to try the real address.</p>
</section>
<section id="sixlowpan">
<h3>sixlowpan<a class="headerlink" href="#sixlowpan" title="Permalink to this heading"></a></h3>
<p>This configuration was intended only for unit-level testing of the 6LoWPAN
stack.  It enables networking with 6LoWPAN support and uses only a
IEEE802.15.4 MAC loopback network device to supported testing.</p>
<p>This configuration includes apps/examples/nettest and
apps/examples/udpblaster. Neither are truly functional.  The only intent of
this configuration is to verify that the 6LoWPAN stack correctly encodes
IEEE802.15.4 packets on output to the loopback device and correctly decodes
the returned packet.</p>
<p>See also the ‘pktradio’ configuration.</p>
</section>
<section id="rtptools">
<h3>rtptools<a class="headerlink" href="#rtptools" title="Permalink to this heading"></a></h3>
<p><strong>RTP Tools</strong> is a set of small applications that can be used for processing RTP data.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rtpplay</span></code>: playback RTP sessions recorded by <code class="docutils literal notranslate"><span class="pre">rtpdump</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rtpsend</span></code>: generate RTP packets from the textual description, generated by hand or <code class="docutils literal notranslate"><span class="pre">rtpdump</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rtpdump</span></code>: parse and print RTP packets, generating output files suitable for <code class="docutils literal notranslate"><span class="pre">rtpplay</span></code> and <code class="docutils literal notranslate"><span class="pre">rtpsend</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rtptrans</span></code>: RTP translator between unicast and multicast networks</p></li>
</ul>
<p>This configuration is based on the <a class="reference internal" href="../../../../../guides/simulator.html#simulator-accessing-the-network"><span class="std std-ref">sim:tcpblaster</span></a> and
builds the <code class="docutils literal notranslate"><span class="pre">rtpdump</span></code>. This application is able to receive RTP packets and print the contents.
As a real-world application, one could write the received content to a FIFO and play it with
<code class="docutils literal notranslate"><span class="pre">nxplayer</span></code>.</p>
<p>To build it, follow the instructions for <a class="reference internal" href="../../../../../guides/simulator.html#simulator-accessing-the-network"><span class="std std-ref">Accessing the Network</span></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>One can use <code class="docutils literal notranslate"><span class="pre">pulseaudio</span></code> to send RTP packets through the network:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pactl load-module module-null-sink sink_name=rtp format=s16le channels=2 rate=44100 sink_properties=&quot;device.description=&#39;RTP&#39;&quot;
pactl load-module module-rtp-send source=rtp.monitor format=s16le destination_ip=10.0.1.2 port=46998
</pre></div>
</div>
<p>The loaded sink <code class="docutils literal notranslate"><span class="pre">RTP</span></code> is used to send PC’s audio to the <code class="docutils literal notranslate"><span class="pre">10.0.1.2:46998</span></code> address (SIM’s IP).</p>
</div>
<p>After being able to access the network through the simulator, run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; rtpdump -F short /46998 &amp;
rtpdump [5:100]
nsh&gt; 42949704.930000 1277462397 15308
42949704.930000 1277462714 15309
</pre></div>
</div>
<p>For a real-world application, check <a class="reference internal" href="../../../../xtensa/esp32/boards/esp32-lyrat/index.html#esp32-lyrat-rtptools"><span class="std std-ref">RTP Tools on ESP32-LyraT board</span></a>.</p>
</section>
<section id="spiffs">
<h3>spiffs<a class="headerlink" href="#spiffs" title="Permalink to this heading"></a></h3>
<p>This is a test of the SPIFFS file system using the apps/testing/fstest test
with an MTD RAM driver to simulate the FLASH part.</p>
</section>
<section id="sotest">
<h3>sotest<a class="headerlink" href="#sotest" title="Permalink to this heading"></a></h3>
<p>This is a configuration to test CONFIG_LIBC_MODLIB with 64-bit modules.
This has apps/examples/sotest enabled.
This configuration is intended for 64-bit host OS.</p>
</section>
<section id="sotest32">
<h3>sotest32<a class="headerlink" href="#sotest32" title="Permalink to this heading"></a></h3>
<p>This is a configuration to test CONFIG_LIBC_MODLIB with CONFIG_SIM_M32
and 32-bit modules.
This has apps/examples/sotest enabled.
This configuration is intended for 64-bit host OS.</p>
</section>
<section id="tcploop">
<h3>tcploop<a class="headerlink" href="#tcploop" title="Permalink to this heading"></a></h3>
<p>This configuration performs a TCP “performance” test using
apps/examples/tcpblaster and the IPv6 local loopback device.  Performance
is in quotes because, while that is the intent of the tcpblaster example,
this is not an appropriate configuration for TCP performance testing.
Rather, this configurat is useful only for verifying TCP transfers over
the loopback device.</p>
<p>To use IPv4, modify these settings in the defconfig file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-# CONFIG_NET_IPv4 is not set
-CONFIG_NET_IPv6=y
-CONFIG_NET_IPv6_NCONF_ENTRIES=4
</pre></div>
</div>
</section>
<section id="touchscreen">
<h3>touchscreen<a class="headerlink" href="#touchscreen" title="Permalink to this heading"></a></h3>
<p>This configuration uses the simple touchscreen test at
apps/examples/touchscreen.  This test will create an empty X11 window and
will print the touchscreen output as it is received from the simulated
touchscreen driver.</p>
<p>Since this example uses the simulated frame buffer driver, most of the
configuration settings discussed for the “nx11” configuration also apply
here.  See that discussion above.</p>
<p>See apps/examples/README.txt for further information about build
requirements and configuration settings.</p>
</section>
<section id="toywasm">
<h3>toywasm<a class="headerlink" href="#toywasm" title="Permalink to this heading"></a></h3>
<p>This is a configuration with toywasm.</p>
<p>An example usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NuttShell (NSH) NuttX-10.4.0
nsh&gt; mount -t hostfs -o fs=/tmp/wasm /mnt
nsh&gt; toywasm --wasi /mnt/hello.wasm
hello
nsh&gt;
</pre></div>
</div>
</section>
<section id="udgram">
<h3>udgram<a class="headerlink" href="#udgram" title="Permalink to this heading"></a></h3>
<p>This is the same as the nsh configuration except that it includes two
additional built in applications:  server and client.  These applications
are provided by the test at apps/examples/udgram. This configuration enables
local, Unix domain sockets and supports the test of the datagram sockets.</p>
<p>To use the test:</p>
<blockquote>
<div><p>nsh&gt; server &amp;
nsh&gt; client</p>
</div></blockquote>
</section>
<section id="unionfs">
<h3>unionfs<a class="headerlink" href="#unionfs" title="Permalink to this heading"></a></h3>
<p>This is a version of NSH dedicated to performing the simple test of the
Union File System at apps/examples/unionfs.  The command ‘unionfs’ will mount
the Union File System at /mnt/unionfs.  You can than compare what you see at
/mnt/unionfs with the content of the ROMFS file systems at
apps/examples/unionfs/atestdir and btestdir.</p>
<p>Here is some sample output from the test:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NuttShell (NSH)
nsh&gt; unionfs
Mounting ROMFS file system 1 at target=/mnt/a with source=/dev/ram4
Mounting ROMFS file system 2 at target=/mnt/b with source=/dev/ram5
nsh&gt; ls /mnt/unionfs
/mnt/unionfs:
 .
 afile.txt
 offset/
</pre></div>
</div>
<p>When unionfs was created, file system was joined with an offset called
“offset”.  Therefore, all of the file system 2 root contents will appear to
reside under a directory called offset/ (although there is no directory
called offset/ on file system 2).  File system 1 on the other hand does
have an actual directory called offset/.  If we list the contents of the
offset/ directory in the unified file system, we see the merged contents of
the file system 1 offset/ directory and the file system 2 root directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; cat /mnt/unionfs/afile.txt
This is a file in the root directory on file system 1

nsh&gt; ls /mnt/unionfs/offset
/mnt/unionfs/offset:
 afile.txt
 .
 adir/
 bfile.txt
 bdir/
nsh&gt; cat /mnt/unionfs/offset/afile.txt
This is a file in the offset/ directory on file system 1

nsh&gt; cat /mnt/unionfs/offset/bfile.txt
This is another file in the root directory on file system 2
</pre></div>
</div>
<p>The directory offset/adir exists on file system 1 and the directory adir/
exists on file system 2.  You can see that these also overlap:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; ls /mnt/unionfs/offset/adir
/mnt/unionfs/offset/adir:
 ..
 asubdir/
 adirfile.txt
 bsubdir/
 bdirfile.txt
 .
</pre></div>
</div>
<p>The unified directory listing is showing files from both file systems in
their respective offset adir/ subdirectories.  The file adirfile.txt exists
in both file system 1 and file system 2 but the version in file system 2 is
occluded by the version in file system 1.  The only way that you can know
which you are looking at is by cat’ing the file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; cat /mnt/unionfs/offset/adir/adirfile.txt
This is a file in directory offset/adir on file system 1
</pre></div>
</div>
<p>The file on file system 1 has correctly occluded the file with the same name
on file system 2.  bdirfile.txt, however, only exists on file system 2, so
it is not occluded:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; cat /mnt/unionfs/offset/adir/bdirfile.txt
This is another file in directory adir on file system 2
</pre></div>
</div>
<p>You can see the files in the two file systems before they were unified at
apps/examples/unionfs/atestdir and btestdir.</p>
</section>
<section id="userfs">
<h3>userfs<a class="headerlink" href="#userfs" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is another NSH configuration that includes the built-in application of
apps/examples/userfs to support test of the UserFS on the simulation
platform.</p>
<p>To use the test:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; userfs                 # Mounts the UserFS test file system at
                            # /mnt/ufstest
nsh&gt; mount                  # Testing is then performed by exercising the
                            # file system from the command line
nsh&gt; ls -l /mnt/ufstest
nsh&gt; cat /mnt/ufstest/File1
etc.
</pre></div>
</div>
</div></blockquote>
</section>
<section id="ustream">
<h3>ustream<a class="headerlink" href="#ustream" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is the same as the nsh configuration except that it includes two
addition built in applications:  server and client.  These applications are
provided by the test at apps/examples/ustream. This configuration enables
local, Unix domain sockets and supports the test of the stream sockets.</p>
<p>To use the test:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; server &amp;
nsh&gt; client
</pre></div>
</div>
<p>Note that the binfs file system is mounted at /bin when the system starts
up.</p>
</div></blockquote>
</section>
<section id="vncserver">
<h3>vncserver<a class="headerlink" href="#vncserver" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This a simple vnc server test configuration, Remmina is tested and recommended since
there are some compatibility issues. By default SIM will be blocked at startup to
wait client connection, if a client connected, then the fb example will launch.</p>
</div></blockquote>
</section>
<section id="vpnkit">
<h3>vpnkit<a class="headerlink" href="#vpnkit" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>This is a configuration with VPNKit support.  See NETWORK-VPNKIT.txt.</p>
</div></blockquote>
</section>
<section id="wamr">
<h3>wamr<a class="headerlink" href="#wamr" title="Permalink to this heading"></a></h3>
<p>This is a configuration for WebAssembly sample.</p>
<ol class="arabic">
<li><p>Compile Toolchain</p>
<ol class="arabic simple">
<li><p>Download WASI sdk and export the WASI_SDK_PATH path</p></li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wget https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-19/wasi-sdk-19.0-linux.tar.gz</span>
<span class="go">tar xf wasi-sdk-19.0-linux.tar.gz</span>
<span class="gp"># </span>Put<span class="w"> </span>wasi-sdk-19.0<span class="w"> </span>to<span class="w"> </span>your<span class="w"> </span>host<span class="w"> </span>WASI_SDK_PATH<span class="w"> </span>environment<span class="w"> </span>variable,<span class="w"> </span>like:
<span class="go">export WASI_SDK_PATH=`pwd`/wasi-sdk-19.0</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Download Wamr “wamrc” AOT compiler and export to the PATH</p></li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir wamrc</span>
<span class="go">wget https://github.com/bytecodealliance/wasm-micro-runtime/releases/download/WAMR-1.1.2/wamrc-1.1.2-x86_64-ubuntu-20.04.tar.gz</span>
<span class="go">tar xf wamrc-1.1.2-x86_64-ubuntu-20.04.tar.gz</span>
<span class="go">export PATH=$PATH:$PWD</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Configuring and running</p>
<ol class="arabic simple">
<li><p>Configuring sim/wamr and compile</p></li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./tools/configure.sh  sim/wamr</span>
<span class="go">make</span>
<span class="go">...</span>
<span class="go">Wamrc Generate AoT: /home/archer/code/nuttx/n5/apps/wasm/hello.aot</span>
<span class="go">Wamrc Generate AoT: /home/archer/code/nuttx/n5/apps/wasm/coremark.aot</span>
<span class="go">LD:  nuttx</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Copy the generated wasm file(Interpreter/AoT)</p></li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cp ../apps/wasm/hello.aot .</span>
<span class="go">cp ../apps/wasm/hello.wasm .</span>
<span class="go">cp ../apps/wasm/coremark.wasm .</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Run iwasm</p></li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./nuttx</span>
<span class="go">NuttShell (NSH) NuttX-10.4.0</span>
<span class="go">nsh&gt; iwasm /data/hello.wasm</span>
<span class="go">Hello, World!!</span>
<span class="go">nsh&gt; iwasm /data/hello.aot</span>
<span class="go">Hello, World!!</span>
<span class="go">nsh&gt; iwasm /data/coremark.wasm</span>
<span class="go">2K performance run parameters for coremark.</span>
<span class="go">CoreMark Size    : 666</span>
<span class="go">Total ticks      : 12000</span>
<span class="go">Total time (secs): 12.000000</span>
<span class="go">Iterations/Sec   : 5.000000</span>
<span class="go">Iterations       : 60</span>
<span class="go">Compiler version : Clang 15.0.7</span>
<span class="go">Compiler flags   : Using NuttX compilation options</span>
<span class="go">Memory location  : Defined by the NuttX configuration</span>
<span class="go">seedcrc          : 0xe9f5</span>
<span class="go">[0]crclist       : 0xe714</span>
<span class="go">[0]crcmatrix     : 0x1fd7</span>
<span class="go">[0]crcstate      : 0x8e3a</span>
<span class="go">[0]crcfinal      : 0xa14c</span>
<span class="go">Correct operation validated. See README.md for run and reporting rules.</span>
<span class="go">CoreMark 1.0 : 5.000000 / Clang 15.0.7 Using NuttX compilation options / Defined by the NuttX configuration</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="usbdev">
<h3>usbdev<a class="headerlink" href="#usbdev" title="Permalink to this heading"></a></h3>
<p>This is a configuration with sim usbdev support.</p>
<ol class="arabic simple">
<li><p>Raw Gadget setup</p></li>
</ol>
<blockquote>
<div><p>Get Raw Gadget:
Get Raw Gadget code at <a class="reference external" href="https://github.com/xairy/raw-gadget">https://github.com/xairy/raw-gadget</a>.</p>
<p>Make Raw Gadget:
Run make in the raw_gadget and dummy_hcd directory. If raw_gadget build
fail, you need to check which register interface meets your kernel version,
usb_gadget_probe_driver or usb_gadget_register_driver.</p>
<p>Install Raw Gadget:
Run ./insmod.sh in the raw_gadget and dummy_hcd directory.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Configuration</p></li>
</ol>
<blockquote>
<div><p>sim:usbdev contains two different sets of composite devices:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conn0: adb &amp; rndis
conn1: cdcacm &amp; cdcecm
</pre></div>
</div>
<p>You can use the sim:usbdev configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./tools/configure.sh sim:usbdev
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>How to run</p></li>
</ol>
<blockquote>
<div><p>Run nuttx with root mode, then you can use it as the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1&gt; Run ADB:
</pre></div>
</div>
<p>NuttX enter command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ conn 0
$ adbd &amp;
</pre></div>
</div>
<p>Host PC enter the ADB command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ adb kill-server
$ adb devices
List of devices attached
* daemon not running; starting now at tcp:5037
* daemon started successfully
0101        device
</pre></div>
</div>
<p>If ADB connection fails, make sure the udev rule is added correctly.
Edit /etc/udev/rules.d/51-android.rules file and add the following to it:
SUBSYSTEM==”usb”, ATTR{idVendor}==”1630”, ATTR{idProduct}==”0042”, MODE=”0666”, GROUP=”plugdev”</p>
<p>Then you can use commands such as adb shell, adb push, adb pull as normal.</p>
<blockquote>
<div><p>2&gt; Run RNDIS:</p>
</div></blockquote>
<p>NuttX enter command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ conn 0
$ ifconfig
eth0    Link encap:Ethernet HWaddr 00:00:00:00:00:00 at UP
        inet addr:0.0.0.0 DRaddr:0.0.0.0 Mask:0.0.0.0
$ dhcpd_start eth0
eth0    Link encap:Ethernet HWaddr 00:00:00:00:00:00 at UP
      inet addr:10.0.0.1 DRaddr:10.0.0.1 Mask:255.255.255.0
</pre></div>
</div>
<p>Host PC, you can see the network device named usb0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ifconfig
usb0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 602
        inet 10.0.0.4  netmask 255.255.255.0  broadcast 10.0.0.255
        ether 36:50:3d:62:b5:80  txqueuelen 1000  (以太网)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 43  bytes 8544 (8.5 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</pre></div>
</div>
<p>Then you can test the network connection using the ping command or telnet.</p>
<blockquote>
<div><p>3&gt; Run CDCACM:</p>
</div></blockquote>
<p>NuttX enter command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ conn 1
</pre></div>
</div>
<p>If the connection is successful, you can see /dev/ttyACM devices on both NuttX
and host PC.</p>
<p>Then you can use echo and cat command to test:</p>
<p>NuttX:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; echo hello &gt; /dev/ttyACM0
</pre></div>
</div>
<p>Host PC:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  $ cat /dev/ttyACM0
  hello

3&gt; Run CDCECM:
</pre></div>
</div>
<p>NuttX enter command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ conn 1
$ ifconfig
eth0    Link encap:Ethernet HWaddr 00:e0:de:ad:be:ef at UP
        inet addr:0.0.0.0 DRaddr:0.0.0.0 Mask:0.0.0.0
$ dhcpd_start eth0
$ ifconfig
eth0    Link encap:Ethernet HWaddr 00:e0:de:ad:be:ef at UP
        inet addr:10.0.0.1 DRaddr:10.0.0.1 Mask:255.255.255.0
</pre></div>
</div>
<p>Host PC, you can see the network device named enx020000112233:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ifconfig
enx020000112233: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 576
        inet 10.0.0.4  netmask 255.255.255.0  broadcast 10.0.0.255
        ether 02:00:00:11:22:33  txqueuelen 1000  (以太网)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 58  bytes 9143 (9.1 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</pre></div>
</div>
<p>Then you can test the network connection using the ping command or telnet.</p>
</div></blockquote>
</section>
<section id="usbhost">
<h3>usbhost<a class="headerlink" href="#usbhost" title="Permalink to this heading"></a></h3>
<p>This is a configuration with sim usbhost support.</p>
<ol class="arabic">
<li><p>Libusb1.0 setup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get -y install libusb-1.0-0-dev
$ sudo apt-get -y install libusb-1.0-0-dev:i386
</pre></div>
</div>
</li>
<li><p>Configuration</p>
<p>sim:usbhost support cdcacm.</p>
<p>You can use the sim:usbdev configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./tools/configure.sh sim:usbhost
</pre></div>
</div>
<p>Configure the device you want to connet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SIM_USB_PID=0x0042
CONFIG_SIM_USB_VID=0x1630
</pre></div>
</div>
</li>
<li><p>How to run</p>
<p>Run sim usbhost with root mode, run sim usbdev or plug-in cdcacm usb device.
Then you can use /dev/ttyACM to transfer data.</p>
</li>
</ol>
</section>
</section>
<section id="readme-txt">
<h2>README.txt<a class="headerlink" href="#readme-txt" title="Permalink to this heading"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>README
======

  Overview
  --------
  This directory contains logic to support a custom ROMFS system-init script
  and start-up script.  These scripts are used by by the NSH when it starts
  provided that CONFIG_ETC_ROMFS=y.  These scripts provide a ROMFS volume
  that will be mounted at /etc and will look like this at run-time:

    NuttShell (NSH) NuttX-7.31
    MOTD: username=admin password=Administrator
    nsh&gt; ls -Rl /etc
    /etc:
     dr-xr-xr-x       0 .
     -r--r--r--      20 group
     dr-xr-xr-x       0 init.d/
     -r--r--r--      35 passwd
    /etc/init.d:
     dr-xr-xr-x       0 ..
     -r--r--r--     110 rcS
     -r--r--r--     110 rc.sysinit
    nsh&gt;

  /etc/init.d/rc.sysinit is system init script; /etc/init.d/rcS is the start-up
  script; /etc/passwd is a the password file.  It supports a single user:

    USERNAME:  admin
    PASSWORD:  Administrator

    nsh&gt; cat /etc/passwd
    admin:8Tv+Hbmr3pLVb5HHZgd26D:0:0:/

  The encrypted passwords in the provided passwd file are only valid if the
  TEA key is set to:  012345678 9abcdef0 012345678 9abcdef0.  Changes to either
  the key or the password word will require regeneration of the nsh_romfimg.h
  header file.

  The format of the password file is:

    user:x:uid:gid:home

  Where:
    user:  User name
    x:     Encrypted password
    uid:   User ID (0 for now)
    gid:   Group ID (0 for now)
    home:  Login directory (/ for now)

  /etc/group is a group file.  It is not currently used.

    nsh&gt; cat /etc/group
    root:*:0:root,admin

  The format of the group file is:

    group:x:gid:users

  Where:
    group:  The group name
    x:      Group password
    gid:    Group ID
    users:  A comma separated list of members of the group

  Updating the ROMFS File System
  ------------------------------
  The content on the nsh_romfsimg.h header file is generated from a sample
  directory structure. You can directly modify files under etc/ folder,
  The build system will regenerate nsh_romfsimg.h automatically.

  See the sim/nsh configuration for an example of the use of this file
  system.

  Replacing the Password File
  ---------------------------
  The sim/nsh configuration can also be used to create a new password file.
  First, make these configuration changes:

    1. Disable logins

       - CONFIG_NSH_CONSOLE_LOGIN=y
       + # CONFIG_NSH_CONSOLE_LOGIN is not set
         # CONFIG_NSH_TELNET_LOGIN is not set

    2. Move the password file to a write-able file system:

       - CONFIG_FSUTILS_PASSWD_PATH=&quot;/etc/passwd&quot;
       + CONFIG_FSUTILS_PASSWD_PATH=&quot;/tmp/passwd&quot;

    3. make the password file modifiable

       - CONFIG_FSUTILS_PASSWD_READONLY=y
       # CONFIG_FSUTILS_PASSWD_READONLY is not set

  Now rebuild the simulation.  No login should be required to enter the
  shell and you should find the &#39;useradd&#39;, &#39;userdel&#39;, and &#39;passwd&#39; commands
  available in the help summary, provided that they are enabled.  Make
  certain that the &#39;useradd&#39; command is not disabled:

      # CONFIG_NSH_DISABLE_USERADD is not set

  Use the NSH &#39;useradd&#39; command to add new uses with new user passwords like:

    nsh&gt; useradd &lt;username&gt; &lt;password&gt;

  Do this as many times as you would like.  Each time that you do this a new
  entry with an encrypted password will be added to the passwd file at
  /tmp/passwd.  You can see the passwd file like:

    nsh&gt; cat /tmp/passwd

  When you are finished, you can simply copy the /tmp/passwd content from the
  &#39;cat&#39; command and paste it into an editor.  Make sure to remove any
  carriage returns that may have ended up on the file if you are using
  Windows.

  Then recreate the nsh_romfsimg.h file as described above.  In step 2,
  simply replace the old /etc/passwd file with the one in your editor.
  When you are finished, the new passwd file will be in the ROMFS file
  system at the path /etc/passwd.  When you restore the original NSH
  sim configuration, these are the passwords that will be used.
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../index.html" class="btn btn-neutral float-left" title="SIM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../../sparc/index.html" class="btn btn-neutral float-right" title="SPARC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>