<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building NuttX with Applications Outside the Source Tree &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
      <script src="../_static/doctools.js"></script>
      <script src="../_static/sphinx_highlight.js"></script>
      <script src="../_static/clipboard.min.js"></script>
      <script src="../_static/copybutton.js"></script>
      <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building uClibc++" href="building_uclibcpp.html" />
    <link rel="prev" title="ELF Programs – No Symbol Tables" href="fully_linked_elf.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../latest" selected="selected">latest</option>
    
    <option value="../../10.0.0" >10.0.0</option>
    
    <option value="../../10.0.1" >10.0.1</option>
    
    <option value="../../10.1.0" >10.1.0</option>
    
    <option value="../../10.2.0" >10.2.0</option>
    
    <option value="../../10.3.0" >10.3.0</option>
    
    <option value="../../11.0.0" >11.0.0</option>
    
    <option value="../../12.0.0" >12.0.0</option>
    
    <option value="../../12.1.0" >12.1.0</option>
    
    <option value="../../12.2.0" >12.2.0</option>
    
    <option value="../../12.2.1" >12.2.1</option>
    
    <option value="../../12.3.0" >12.3.0</option>
    
    <option value="../../12.4.0" >12.4.0</option>
    
    <option value="../../12.5.0" >12.5.0</option>
    
    <option value="../../12.5.1" >12.5.1</option>
    
    <option value="../../12.6.0" >12.6.0</option>
    
    <option value="../../12.7.0" >12.7.0</option>
    
    <option value="../../12.8.0" >12.8.0</option>
    
    <option value="../../12.9.0" >12.9.0</option>
    
    <option value="../../12.10.0" >12.10.0</option>
    
    <option value="../../12.11.0" >12.11.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/index.html">Debugging</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nfs.html">NFS Client How-To</a></li>
<li class="toctree-l2"><a class="reference internal" href="nix_flake.html">Nix Flake for Reproducible Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="usbtrace.html">USB Device Trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulator.html">Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="rndis.html">How to use RNDIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="drivers.html">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_cmake.html">C++ Example using CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysimcoder.html">pysimCoder integration with NuttX</a></li>
<li class="toctree-l2"><a class="reference internal" href="customboards.html">Custom Boards How-To</a></li>
<li class="toctree-l2"><a class="reference internal" href="customapps.html">Custom Apps How-to</a></li>
<li class="toctree-l2"><a class="reference internal" href="citests.html">Running CI Test Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="zerolatencyinterrupts.html">High Performance: Zero Latency Interrupts, Maskable Nested Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="fortify.html">Fortify</a></li>
<li class="toctree-l2"><a class="reference internal" href="nestedinterrupts.html">Nested Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="ofloader.html">Open Flash Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="testingtcpip.html">Testing TCP/IP Network Stacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="automounter.html">Auto-Mounter</a></li>
<li class="toctree-l2"><a class="reference internal" href="stm32nullpointer.html">STM32 Null Pointer Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="stm32ccm.html">STM32 CCM Allocator</a></li>
<li class="toctree-l2"><a class="reference internal" href="etcromfs.html">etc romfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_local_storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="devicetree.html">Device Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="changing_systemclockconfig.html">Changing the System Clock Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingkernelthreads.html">Using Kernel Threads</a></li>
<li class="toctree-l2"><a class="reference internal" href="armv7m_runtimestackcheck.html">ARMv7-M Run Time Stack Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_files_board_h.html">Including Files in board.h</a></li>
<li class="toctree-l2"><a class="reference internal" href="specialstuff_in_nuttxheaderfiles.html">Why can’t I put my special stuff in NuttX header files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_threads_with_custom_stacks.html">Kernel Threads with Custom Stacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning_and_task_names.html">Versioning and Task Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging_rambuffer.html">Logging to a RAM Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrate_newlib.html">Integrating with Newlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="protected_build.html">NuttX Protected Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="platform_directories.html">Platform Directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="port_drivers_to_stm32f7.html">Porting Drivers to the STM32 F7</a></li>
<li class="toctree-l2"><a class="reference internal" href="semihosting.html">Semihosting</a></li>
<li class="toctree-l2"><a class="reference internal" href="renode.html">Run NuttX on Renode</a></li>
<li class="toctree-l2"><a class="reference internal" href="signal_events_interrupt_handlers.html">Signaling Events from Interrupt Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="signaling_sem_priority_inheritance.html">Signaling Semaphores and Priority Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="smaller_vector_tables.html">Smaller Vector Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="port.html">How to port</a></li>
<li class="toctree-l2"><a class="reference internal" href="updating_release_system_elf.html">Updating a Release System with ELF Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="partially_linked_elf.html">ELF Programs – With Symbol Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="fully_linked_elf.html">ELF Programs – No Symbol Tables</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building NuttX with Applications Outside the Source Tree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#q-has-anyone-come-up-with-a-tidy-way-to-build-nuttx-with-board-specific-pieces-outside-the-source-tree">Q: Has anyone come up with a tidy way to build NuttX with board-specific pieces outside the source tree?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-here-are-four-approaches">A: Here are four approaches:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#make-export">1. Make export</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replace-the-apps-directory">1. Replace the apps/ Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extend-the-apps-directory">1. Extend the apps/ Directory</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#makefile-and-make-defs">Makefile and Make.defs</a></li>
<li class="toctree-l5"><a class="reference internal" href="#automatic-sub-directory-inclusion">Automatic Sub-directory Inclusion</a></li>
<li class="toctree-l5"><a class="reference internal" href="#kconfig">Kconfig</a></li>
<li class="toctree-l5"><a class="reference internal" href="#install-script">Install script</a></li>
<li class="toctree-l5"><a class="reference internal" href="#special-apps-external-directory">Special <code class="docutils literal notranslate"><span class="pre">apps/external</span></code> Directory</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#contain-the-apps-directory">4. Contain the apps/ Directory</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#kconfig-and-makefile">Kconfig and Makefile</a></li>
<li class="toctree-l5"><a class="reference internal" href="#library-issues">Library Issues</a></li>
<li class="toctree-l5"><a class="reference internal" href="#relative-effort-and-benefits">Relative Effort and Benefits</a></li>
<li class="toctree-l5"><a class="reference internal" href="#out-of-tree-builds">Out-of-tree Builds</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#hooking-external-applications-into-the-configuration-system">Hooking External Applications into the Configuration System</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="building_uclibcpp.html">Building uClibc++</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_app_directories.html">Custom Application Directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_nsh_sessions.html">Multiple NSH Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="nsh_network_link_management.html">NSH Network Link Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="ram_rom_disks.html">RAM Disks and ROM Disks</a></li>
<li class="toctree-l2"><a class="reference internal" href="reading_can_msgs.html">Reading CAN Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="remove_device_drivers_nsh.html">Removing Device Drivers with NSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">Rust in NuttX</a></li>
<li class="toctree-l2"><a class="reference internal" href="optee.html">Interfacing with OP-TEE</a></li>
<li class="toctree-l2"><a class="reference internal" href="qemu_tips.html">QEMU Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="lwl.html">Console over Lightweight Link</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Guides</a></li>
      <li class="breadcrumb-item active">Building NuttX with Applications Outside the Source Tree</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/guides/building_nuttx_with_app_out_of_src_tree.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-nuttx-with-applications-outside-the-source-tree">
<h1>Building NuttX with Applications Outside the Source Tree<a class="headerlink" href="#building-nuttx-with-applications-outside-the-source-tree" title="Permalink to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Migrated from:
<a class="reference external" href="https://cwiki.apache.org/confluence/display/NUTTX/Building+NuttX+with+Applications+Outside+of+the+Source+Tree">https://cwiki.apache.org/confluence/display/NUTTX/Building+NuttX+with+Applications+Outside+of+the+Source+Tree</a></p>
</div>
<section id="q-has-anyone-come-up-with-a-tidy-way-to-build-nuttx-with-board-specific-pieces-outside-the-source-tree">
<h2>Q: Has anyone come up with a tidy way to build NuttX with board-specific pieces outside the source tree?<a class="headerlink" href="#q-has-anyone-come-up-with-a-tidy-way-to-build-nuttx-with-board-specific-pieces-outside-the-source-tree" title="Permalink to this heading"></a></h2>
</section>
<section id="a-here-are-four-approaches">
<h2>A: Here are four approaches:<a class="headerlink" href="#a-here-are-four-approaches" title="Permalink to this heading"></a></h2>
<section id="make-export">
<h3>1. Make export<a class="headerlink" href="#make-export" title="Permalink to this heading"></a></h3>
<p>There is a make target called <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">export</span></code>. It will build NuttX, then bundle
all of the header files, libraries, startup objects, and other build components
into a <code class="docutils literal notranslate"><span class="pre">.zip</span></code> file. You can move that <code class="docutils literal notranslate"><span class="pre">.zip</span></code> file into any build environment
you want. You can even build NuttX under a DOS CMD window.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">target</span></code> is documented in the top-level
<a class="reference internal" href="../introduction/resources.html"><span class="doc">Legacy README</span></a>. Search for <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Targets</span></code></p>
</section>
<section id="replace-the-apps-directory">
<h3>1. Replace the apps/ Directory<a class="headerlink" href="#replace-the-apps-directory" title="Permalink to this heading"></a></h3>
<p>You can replace the entire <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory. It is not a critical part of the
OS. The <code class="docutils literal notranslate"><span class="pre">apps/</span></code> is simply provided for you to help with your application
development. It should not dictate anything that you do.</p>
<p>To use a different <code class="docutils literal notranslate"><span class="pre">apps</span></code> directory, simply execute <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code> in the
top-level <code class="docutils literal notranslate"><span class="pre">nuttx/</span></code> directory and redefine <code class="docutils literal notranslate"><span class="pre">CONFIG_APPS_DIR</span></code> in your
<code class="docutils literal notranslate"><span class="pre">.config</span></code> file so that it points to a different, custom application directory.
Note that <code class="docutils literal notranslate"><span class="pre">CONFIG_APPS_DIR</span></code> is a <cite>relative</cite> path from the top-level
<code class="docutils literal notranslate"><span class="pre">nuttx/</span></code> directory.</p>
<p>You can copy any pieces that you like from the old <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory to your
custom <code class="docutils literal notranslate"><span class="pre">apps</span></code> directory as necessary. This is documented in
the <a class="reference external" href="https://cwiki.apache.org/confluence/display/NUTTX/Porting+Guide">NuttX Porting Guide</a>
and in the <a class="reference external" href="https://github.com/apache/nuttx-apps/blob/master/README.md">apps/README.md</a> file.</p>
</section>
<section id="extend-the-apps-directory">
<h3>1. Extend the apps/ Directory<a class="headerlink" href="#extend-the-apps-directory" title="Permalink to this heading"></a></h3>
<p>If you like the random collection of stuff in the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory but just
want to expand the existing components with your own, external sub-directory,
then there is an easy way to do that too: Create a symbolic link in the
<code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory that redirects to your application sub-directory (or copy
your code into a sub-directory of <code class="docutils literal notranslate"><span class="pre">apps/</span></code>).</p>
<img alt="../_images/custom_app_dir_through_extension.png" src="../_images/custom_app_dir_through_extension.png" />
<section id="makefile-and-make-defs">
<h4>Makefile and Make.defs<a class="headerlink" href="#makefile-and-make-defs" title="Permalink to this heading"></a></h4>
<p>In order to be incorporated into the build, the directory that you link under
the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory should contain:</p>
<ol class="arabic simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> that supports the <code class="docutils literal notranslate"><span class="pre">clean</span></code> and <code class="docutils literal notranslate"><span class="pre">distclean</span></code> targets (see
other Makefiles for examples).</p></li>
<li><p>A tiny <code class="docutils literal notranslate"><span class="pre">Make.defs</span></code> make file fragment that simply adds the build
directories to the variable <code class="docutils literal notranslate"><span class="pre">CONFIGURED_APPS</span></code> like:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">CONFIGURED_APPS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>my_directory1<span class="w"> </span>my_directory2
</pre></div>
</div>
</section>
<section id="automatic-sub-directory-inclusion">
<h4>Automatic Sub-directory Inclusion<a class="headerlink" href="#automatic-sub-directory-inclusion" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">apps/Makefile</span></code> will always automatically check for the existence of
sub-directories containing a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and a <code class="docutils literal notranslate"><span class="pre">Make.defs</span></code> file. The
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code> will be used only to support cleaning operations. The
<code class="docutils literal notranslate"><span class="pre">Make.defs</span></code> file provides the set of relative paths to directories to be
built; these directories must also contain a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. That <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> can
build the sources and add the object files to the <code class="docutils literal notranslate"><span class="pre">apps/libapps.a</span></code> archive
(see other Makefiles for examples). It should support the <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">install</span></code>,
<code class="docutils literal notranslate"><span class="pre">context</span></code>, and <code class="docutils literal notranslate"><span class="pre">depend</span></code> targets.</p>
<p><code class="docutils literal notranslate"><span class="pre">apps/Makefile</span></code> does not depend on any hard-coded lists of directories.
Instead, it does a wildcard search to find all appropriate directories. This
means that to install a new application, you simply have to copy the directory
(or link it) into the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory. If the new directory includes a
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and a <code class="docutils literal notranslate"><span class="pre">Make.defs</span></code> file, then it will be automatically discovered
and included in the build at <code class="docutils literal notranslate"><span class="pre">make</span></code> time.</p>
</section>
<section id="kconfig">
<h4>Kconfig<a class="headerlink" href="#kconfig" title="Permalink to this heading"></a></h4>
<p>If the directory that you add also includes a <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file, then it will be
automatically included in the NuttX configuration system as well.
<code class="docutils literal notranslate"><span class="pre">apps/Makefile</span></code> uses a tool at <code class="docutils literal notranslate"><span class="pre">apps/tools/mkkconfig.sh</span></code> that dynamically
builds the <code class="docutils literal notranslate"><span class="pre">apps/Kconfig</span></code> file at pre-configuration time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The native Windows build will use a corresponding tool called
<code class="docutils literal notranslate"><span class="pre">apps/tools/mkconfig.bat</span></code>.</p>
</div>
</section>
<section id="install-script">
<h4>Install script<a class="headerlink" href="#install-script" title="Permalink to this heading"></a></h4>
<p>You could, for example, create a script called <code class="docutils literal notranslate"><span class="pre">install.sh</span></code> that installs a
custom application, configuration, and board-specific directory:</p>
<ol class="arabic simple">
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">MyBoard</span></code> directory to <code class="docutils literal notranslate"><span class="pre">boards/MyBoard</span></code>.</p></li>
<li><p>Add a symbolic link to <code class="docutils literal notranslate"><span class="pre">MyApplication</span></code> at <code class="docutils literal notranslate"><span class="pre">apps/external</span></code></p></li>
<li><p>Configure NuttX:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tools/configure.sh<span class="w"> </span>MyBoard:MyConfiguration
</pre></div>
</div>
</section>
<section id="special-apps-external-directory">
<h4>Special <code class="docutils literal notranslate"><span class="pre">apps/external</span></code> Directory<a class="headerlink" href="#special-apps-external-directory" title="Permalink to this heading"></a></h4>
<p>Use of the name <code class="docutils literal notranslate"><span class="pre">apps/external</span></code> is suggested because that name is included in
the <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file and will save you some nuisance when working with GIT.</p>
</section>
</section>
<section id="contain-the-apps-directory">
<h3>4. Contain the apps/ Directory<a class="headerlink" href="#contain-the-apps-directory" title="Permalink to this heading"></a></h3>
<p>A simple, minimally invasive approach would be to contain the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> GIT
clone within your custom application directory. In this case, <code class="docutils literal notranslate"><span class="pre">apps/</span></code> would
appear as a directory under your custom application directory instead of your
application directories being inserted as sub-directories of <code class="docutils literal notranslate"><span class="pre">apps/</span></code>. It may
even be implemented as a sub-module of your custom application directory.</p>
<img alt="../_images/custom_app_dir_through_containment.png" src="../_images/custom_app_dir_through_containment.png" />
<section id="kconfig-and-makefile">
<h4>Kconfig and Makefile<a class="headerlink" href="#kconfig-and-makefile" title="Permalink to this heading"></a></h4>
<p>There are only a few minimal requirements of your custom application directory.
It needs to have only its own <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file. That
<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> would need to include the <code class="docutils literal notranslate"><span class="pre">apps/Kconfig</span></code>. The <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> would
similarly need to invoke the <code class="docutils literal notranslate"><span class="pre">apps/Makefile</span></code> for all of the relevant build
targets. For example, the <code class="docutils literal notranslate"><span class="pre">clean</span></code> target:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">$(</span>MAKE<span class="k">)</span><span class="w"> </span>-c<span class="w"> </span>apps<span class="w"> </span>clean<span class="w"> </span><span class="nv">TOPDIR</span><span class="o">=</span><span class="k">$(</span>TOPDIR<span class="k">)</span>
</pre></div>
</div>
</section>
<section id="library-issues">
<h4>Library Issues<a class="headerlink" href="#library-issues" title="Permalink to this heading"></a></h4>
<p>The contained directory will create and install a static library called
<code class="docutils literal notranslate"><span class="pre">libapps($LIBEXT)</span></code> in the <code class="docutils literal notranslate"><span class="pre">nuttx/staging</span></code> directory. Your custom logic must
also appear in the <code class="docutils literal notranslate"><span class="pre">nuttx/staging</span></code> directory. Here are two ways that you might
do that:</p>
<ol class="arabic simple">
<li><p><strong>Merge with ``libapps($LIBEXT)``.</strong>
The custom application directory’s <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> could create and install the
final <code class="docutils literal notranslate"><span class="pre">libapps($LIBEXT)</span></code> in the <code class="docutils literal notranslate"><span class="pre">nuttx/staging</span></code> directory.
<code class="docutils literal notranslate"><span class="pre">&lt;custom-dir&gt;/apps/libapps($LIBEXT)</span></code> could merge its custom object files
with <code class="docutils literal notranslate"><span class="pre">&lt;custom-dir&gt;/libapps($LIBEXT)</span></code> and then re-install the library at
<code class="docutils literal notranslate"><span class="pre">nuttx/staging</span></code>.</p></li>
<li><p><strong>Use the EXTRA_LIBS Feature.</strong>
The build system supports two special make-related variables called
<code class="docutils literal notranslate"><span class="pre">EXTRA_LIBS</span></code> and <code class="docutils literal notranslate"><span class="pre">EXTRA_LIBPATHS</span></code>. These may be defined in your
board-specific <code class="docutils literal notranslate"><span class="pre">Make.defs</span></code> file. <code class="docutils literal notranslate"><span class="pre">EXTRA_LIBS</span></code> provides the name of your
custom library. If you create <code class="docutils literal notranslate"><span class="pre">&lt;custom-dir&gt;/libcustom.a</span></code>, then the value
of <code class="docutils literal notranslate"><span class="pre">EXTRA_LIBS</span></code> would be <code class="docutils literal notranslate"><span class="pre">-lcustom</span></code> and the value of <code class="docutils literal notranslate"><span class="pre">EXTRA_LIBPATHS</span></code>
would be <code class="docutils literal notranslate"><span class="pre">-L</span> <span class="pre">&lt;custom-dir&gt;</span></code> (assuming the GNU ld linker).</p></li>
</ol>
</section>
<section id="relative-effort-and-benefits">
<h4>Relative Effort and Benefits<a class="headerlink" href="#relative-effort-and-benefits" title="Permalink to this heading"></a></h4>
<p>The contained <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory approach requires some more effort than the
extended <code class="docutils literal notranslate"><span class="pre">apps/</span></code> approach, but has the advantage that there will be no strange
behavior due to issues with <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> and, hence, a cleaner user
experience.</p>
</section>
<section id="out-of-tree-builds">
<h4>Out-of-tree Builds<a class="headerlink" href="#out-of-tree-builds" title="Permalink to this heading"></a></h4>
<p>This configuration also has the possibility of supporting out-of-tree builds
using <code class="docutils literal notranslate"><span class="pre">fusefs</span></code>. Suppose, for example, that you have a project directory with
the contained <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory and, say, three platform build directories.
Using <code class="docutils literal notranslate"><span class="pre">fusefs</span></code>, you can overlay one of the platform build directories on top
of the project directory. Then all files generated by the build will be written
into the overlaid platform build directory. When the <code class="docutils literal notranslate"><span class="pre">fusefs</span></code> is torn down,
the project directory will still be clean, and the build result will still be in
the platform build directory. This can then be repeated for the other two
platform build directories.</p>
<p>In this case, you would probably also want to contain the <code class="docutils literal notranslate"><span class="pre">nuttx/</span></code> directory
in the project directory as well so that the entire system is built out-of-tree.</p>
</section>
</section>
<section id="hooking-external-applications-into-the-configuration-system">
<h3>Hooking External Applications into the Configuration System<a class="headerlink" href="#hooking-external-applications-into-the-configuration-system" title="Permalink to this heading"></a></h3>
<p>Suppose you have opted to extend the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory with your custom
external application directories and would also like to support configuration
variables in your external application. No problem! Thanks to Sebastien Lorquet,
any external application that you install into the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> (whether via a
symbolic link or via a directory copy) <cite>will</cite> be included in the NuttX
configuration system.</p>
<p>The top-level <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file in the <code class="docutils literal notranslate"><span class="pre">apps/</span></code> directory is automatically
generated based on the contents of each <code class="docutils literal notranslate"><span class="pre">apps/</span></code> sub-directory. If your
installed sub-directory contains <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>, <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, and <code class="docutils literal notranslate"><span class="pre">Make.defs</span></code>
files, then it will be incorporated into the NuttX configuration system when the
top-level <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file is generated.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fully_linked_elf.html" class="btn btn-neutral float-left" title="ELF Programs – No Symbol Tables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="building_uclibcpp.html" class="btn btn-neutral float-right" title="Building uClibc++" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>