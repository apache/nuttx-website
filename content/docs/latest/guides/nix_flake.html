<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nix Flake for Reproducible Development &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
      <script src="../_static/doctools.js"></script>
      <script src="../_static/sphinx_highlight.js"></script>
      <script src="../_static/clipboard.min.js"></script>
      <script src="../_static/copybutton.js"></script>
      <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="USB Device Trace" href="usbtrace.html" />
    <link rel="prev" title="NFS Client How-To" href="nfs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../latest" selected="selected">latest</option>
    
    <option value="../../10.0.0" >10.0.0</option>
    
    <option value="../../10.0.1" >10.0.1</option>
    
    <option value="../../10.1.0" >10.1.0</option>
    
    <option value="../../10.2.0" >10.2.0</option>
    
    <option value="../../10.3.0" >10.3.0</option>
    
    <option value="../../11.0.0" >11.0.0</option>
    
    <option value="../../12.0.0" >12.0.0</option>
    
    <option value="../../12.1.0" >12.1.0</option>
    
    <option value="../../12.2.0" >12.2.0</option>
    
    <option value="../../12.2.1" >12.2.1</option>
    
    <option value="../../12.3.0" >12.3.0</option>
    
    <option value="../../12.4.0" >12.4.0</option>
    
    <option value="../../12.5.0" >12.5.0</option>
    
    <option value="../../12.5.1" >12.5.1</option>
    
    <option value="../../12.6.0" >12.6.0</option>
    
    <option value="../../12.7.0" >12.7.0</option>
    
    <option value="../../12.8.0" >12.8.0</option>
    
    <option value="../../12.9.0" >12.9.0</option>
    
    <option value="../../12.10.0" >12.10.0</option>
    
    <option value="../../12.11.0" >12.11.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/index.html">Debugging</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nfs.html">NFS Client How-To</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Nix Flake for Reproducible Development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-development-environment">Setting up the Development Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-documentation-environment">Setting up the Documentation Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benefits">Benefits</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contents-of-the-nix-flake">Contents of the Nix Flake</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="usbtrace.html">USB Device Trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulator.html">Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="rndis.html">How to use RNDIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="drivers.html">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_cmake.html">C++ Example using CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysimcoder.html">pysimCoder integration with NuttX</a></li>
<li class="toctree-l2"><a class="reference internal" href="customboards.html">Custom Boards How-To</a></li>
<li class="toctree-l2"><a class="reference internal" href="customapps.html">Custom Apps How-to</a></li>
<li class="toctree-l2"><a class="reference internal" href="citests.html">Running CI Test Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="zerolatencyinterrupts.html">High Performance: Zero Latency Interrupts, Maskable Nested Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="fortify.html">Fortify</a></li>
<li class="toctree-l2"><a class="reference internal" href="nestedinterrupts.html">Nested Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="ofloader.html">Open Flash Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="testingtcpip.html">Testing TCP/IP Network Stacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="automounter.html">Auto-Mounter</a></li>
<li class="toctree-l2"><a class="reference internal" href="stm32nullpointer.html">STM32 Null Pointer Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="stm32ccm.html">STM32 CCM Allocator</a></li>
<li class="toctree-l2"><a class="reference internal" href="etcromfs.html">etc romfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_local_storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="devicetree.html">Device Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="changing_systemclockconfig.html">Changing the System Clock Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingkernelthreads.html">Using Kernel Threads</a></li>
<li class="toctree-l2"><a class="reference internal" href="armv7m_runtimestackcheck.html">ARMv7-M Run Time Stack Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_files_board_h.html">Including Files in board.h</a></li>
<li class="toctree-l2"><a class="reference internal" href="specialstuff_in_nuttxheaderfiles.html">Why can’t I put my special stuff in NuttX header files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_threads_with_custom_stacks.html">Kernel Threads with Custom Stacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning_and_task_names.html">Versioning and Task Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging_rambuffer.html">Logging to a RAM Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrate_newlib.html">Integrating with Newlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="protected_build.html">NuttX Protected Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="platform_directories.html">Platform Directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="port_drivers_to_stm32f7.html">Porting Drivers to the STM32 F7</a></li>
<li class="toctree-l2"><a class="reference internal" href="semihosting.html">Semihosting</a></li>
<li class="toctree-l2"><a class="reference internal" href="renode.html">Run NuttX on Renode</a></li>
<li class="toctree-l2"><a class="reference internal" href="signal_events_interrupt_handlers.html">Signaling Events from Interrupt Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="signaling_sem_priority_inheritance.html">Signaling Semaphores and Priority Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="smaller_vector_tables.html">Smaller Vector Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="port.html">How to port</a></li>
<li class="toctree-l2"><a class="reference internal" href="updating_release_system_elf.html">Updating a Release System with ELF Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="partially_linked_elf.html">ELF Programs – With Symbol Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="fully_linked_elf.html">ELF Programs – No Symbol Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_nuttx_with_app_out_of_src_tree.html">Building NuttX with Applications Outside the Source Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_uclibcpp.html">Building uClibc++</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_app_directories.html">Custom Application Directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_nsh_sessions.html">Multiple NSH Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="nsh_network_link_management.html">NSH Network Link Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="ram_rom_disks.html">RAM Disks and ROM Disks</a></li>
<li class="toctree-l2"><a class="reference internal" href="reading_can_msgs.html">Reading CAN Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="remove_device_drivers_nsh.html">Removing Device Drivers with NSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">Rust in NuttX</a></li>
<li class="toctree-l2"><a class="reference internal" href="optee.html">Interfacing with OP-TEE</a></li>
<li class="toctree-l2"><a class="reference internal" href="qemu_tips.html">QEMU Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Guides</a></li>
      <li class="breadcrumb-item active">Nix Flake for Reproducible Development</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/guides/nix_flake.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nix-flake-for-reproducible-development">
<h1>Nix Flake for Reproducible Development<a class="headerlink" href="#nix-flake-for-reproducible-development" title="Permalink to this heading"></a></h1>
<p>This guide explains how to use the Nix flake to set up a reproducible
development environment for NuttX. The Nix flake ensures that all required
build tools and dependencies are consistently available, simplifying
onboarding and reducing “works on my machine” issues.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://nixos.org/download/">Nix</a> installed on your system.</p></li>
<li><p>Nix flakes enabled (add <code class="docutils literal notranslate"><span class="pre">experimental-features</span> <span class="pre">=</span> <span class="pre">nix-command</span> <span class="pre">flakes</span></code>
to your <code class="docutils literal notranslate"><span class="pre">nix.conf</span></code>).</p></li>
</ul>
</section>
<section id="setting-up-the-development-environment">
<h2>Setting up the Development Environment<a class="headerlink" href="#setting-up-the-development-environment" title="Permalink to this heading"></a></h2>
<p>To enter the <strong>NuttX build</strong> development shell, navigate to the root of
the NuttX directory and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nix<span class="w"> </span>develop<span class="w"> </span>./tools/nix
</pre></div>
</div>
<p>This command will:</p>
<ul class="simple">
<li><p>Download and set up all necessary build tools and dependencies, including:</p>
<ul>
<li><p>CMake, Ninja, GNU Make</p></li>
<li><p>Clang tools</p></li>
<li><p>ARM toolchain (gcc-arm-embedded)</p></li>
<li><p>Automake, Bison, Flex, Genromfs, Gettext, Gperf</p></li>
<li><p>Kconfig-frontends, libelf, expat, gmp, isl, libmpc, mpfr, ncurses, zlib</p></li>
<li><p>Python with kconfiglib</p></li>
</ul>
</li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">CMAKE_EXPORT_COMPILE_COMMANDS</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p></li>
<li><p>Display a welcome message.</p></li>
</ul>
<p>Once inside the development shell, you can proceed with building NuttX as usual.</p>
</section>
<section id="setting-up-the-documentation-environment">
<h2>Setting up the Documentation Environment<a class="headerlink" href="#setting-up-the-documentation-environment" title="Permalink to this heading"></a></h2>
<p>The flake also provides a <strong>documentation</strong> development shell that includes
Sphinx and all required extensions for building the NuttX documentation.</p>
<p>To enter the documentation shell, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nix<span class="w"> </span>develop<span class="w"> </span>./tools/nix#docs
</pre></div>
</div>
<p>This command will:</p>
<ul class="simple">
<li><p>Provide Python 3.13 with Sphinx and extensions, including:</p>
<ul>
<li><p>sphinx-rtd-theme</p></li>
<li><p>myst-parser</p></li>
<li><p>sphinx-tabs</p></li>
<li><p>sphinx-autobuild</p></li>
<li><p>sphinx-copybutton</p></li>
<li><p>sphinx-togglebutton</p></li>
<li><p>sphinx-design</p></li>
<li><p>sphinx-tags</p></li>
<li><p>sphinx-collapse</p></li>
<li><p>pytz, importlib-metadata</p></li>
</ul>
</li>
<li><p>Allow you to build and preview the documentation without installing
anything globally.</p></li>
</ul>
<p>Example usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build HTML docs (has to but run in Documentation/ directory)</span>
make<span class="w"> </span>html
</pre></div>
</div>
<p>See the <a class="reference internal" href="../contributing/documentation.html"><span class="doc">Documentation</span></a> guide for more details.</p>
</section>
<section id="benefits">
<h2>Benefits<a class="headerlink" href="#benefits" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Reproducibility:</strong> Ensures a consistent build environment across all
developers and machines.</p></li>
<li><p><strong>Simplified Onboarding:</strong> New contributors can quickly set up their
development environment with a single command.</p></li>
<li><p><strong>Dependency Management:</strong> All dependencies are managed by Nix, avoiding
conflicts with system-wide packages.</p></li>
<li><p><strong>Separate Environments:</strong> Keep firmware build tools and documentation
tools isolated, or combine them if needed.</p></li>
</ul>
</section>
<section id="contents-of-the-nix-flake">
<h2>Contents of the Nix Flake<a class="headerlink" href="#contents-of-the-nix-flake" title="Permalink to this heading"></a></h2>
<p>The <cite>flake.nix</cite> file defines two <cite>devShells</cite>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">devShells.default</span></code> - NuttX build environment:</p></li>
</ul>
<div class="highlight-nix notranslate"><div class="highlight"><pre><span></span><span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1"># Build tools</span>
  pkgs<span class="o">.</span>cmake
  pkgs<span class="o">.</span>ninja
  pkgs<span class="o">.</span>gnumake
  pkgs<span class="o">.</span>clang-tools

  <span class="c1"># ARM toolchain</span>
  pkgs<span class="o">.</span>gcc-arm-embedded

  <span class="c1"># NuttX dependencies</span>
  pkgs<span class="o">.</span>automake
  pkgs<span class="o">.</span>bison
  pkgs<span class="o">.</span>flex
  pkgs<span class="o">.</span>genromfs
  pkgs<span class="o">.</span>gettext
  pkgs<span class="o">.</span>gperf
  pkgs<span class="o">.</span>kconfig-frontends
  pkgs<span class="o">.</span>libelf
  pkgs<span class="o">.</span>expat<span class="o">.</span>dev
  pkgs<span class="o">.</span>gmp<span class="o">.</span>dev
  pkgs<span class="o">.</span>isl
  pkgs<span class="o">.</span>libmpc
  pkgs<span class="o">.</span>mpfr<span class="o">.</span>dev
  pkgs<span class="o">.</span>ncurses<span class="o">.</span>dev
  pkgs<span class="o">.</span>zlib
  pkgs<span class="o">.</span>python313Packages<span class="o">.</span>kconfiglib
<span class="p">];</span>

<span class="ss">shellHook</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  export CMAKE_EXPORT_COMPILE_COMMANDS=ON</span>
<span class="s s-Multiline">  echo &quot;Welcome to NuttX devShell&quot;</span>
<span class="s s-Multiline">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">devShells.docs</span></code> - Documentation environment (from <cite>Documentation/flake.nix</cite>):</p></li>
</ul>
<div class="highlight-nix notranslate"><div class="highlight"><pre><span></span>python<span class="o">.</span>withPackages <span class="p">(</span>ps<span class="p">:</span> <span class="k">with</span> ps<span class="p">;</span> <span class="p">[</span>
  sphinx
  sphinx_rtd_theme
  myst-parser
  sphinx-tabs
  sphinx-autobuild
  sphinx-copybutton
  sphinx-togglebutton
  sphinx-design
  sphinx-tags
  sphinx-collapse
  pytz
  importlib-metadata
<span class="p">]);</span>
</pre></div>
</div>
<p>This setup ensures that both firmware development and documentation building
are fully reproducible and isolated.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nfs.html" class="btn btn-neutral float-left" title="NFS Client How-To" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="usbtrace.html" class="btn btn-neutral float-right" title="USB Device Trace" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>