<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>minidumpserver &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../latest" selected="selected">latest</option>
    
    <option value="../../10.0.0" >10.0.0</option>
    
    <option value="../../10.0.1" >10.0.1</option>
    
    <option value="../../10.1.0" >10.1.0</option>
    
    <option value="../../10.2.0" >10.2.0</option>
    
    <option value="../../10.3.0" >10.3.0</option>
    
    <option value="../../11.0.0" >11.0.0</option>
    
    <option value="../../12.0.0" >12.0.0</option>
    
    <option value="../../12.1.0" >12.1.0</option>
    
    <option value="../../12.2.0" >12.2.0</option>
    
    <option value="../../12.2.1" >12.2.1</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">minidumpserver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/minidumpserver.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="minidumpserver">
<h1>minidumpserver<a class="headerlink" href="#minidumpserver" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This tool can utilize a crash log on a PC to simulate a set of GDB server functionalities,
enabling the use of GDB to debug the context of a NuttX crash.
The script directory is located in <cite>tools/minidumpserver.py</cite>.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>We can use <cite>-h</cite> to get help information:
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>bash
$usage: minidumpserver.py [-h] -e ELFFILE -l LOGFILE [-a {arm,arm-a,arm-t,riscv,esp32s3,xtensa}] [-p PORT] [–debug]</p>
<dl>
<dt>options:</dt><dd><dl class="option-list">
<dt><kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></dt>
<dd><p>show this help message and exit</p>
</dd>
<dt><kbd><span class="option">-e <var>ELFFILE</var></span>, <span class="option">--elffile <var>ELFFILE</var></span></kbd></dt>
<dd><p>elffile</p>
</dd>
<dt><kbd><span class="option">-l <var>LOGFILE</var></span>, <span class="option">--logfile <var>LOGFILE</var></span></kbd></dt>
<dd><p>logfile</p>
</dd>
</dl>
<dl class="simple">
<dt>-a {arm,arm-a,arm-t,riscv,esp32s3,xtensa}, –arch {arm,arm-a,arm-t,riscv,esp32s3,xtensa}</dt><dd><p>select architecture,if not use this options, The architecture will be inferred from the logfile</p>
</dd>
</dl>
<dl class="option-list">
<dt><kbd><span class="option">-p <var>PORT</var></span>, <span class="option">--port <var>PORT</var></span></kbd></dt>
<dd><p>gdbport</p>
</dd>
</dl>
<p>–debug</p>
</dd>
</dl>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Use ./tools/configure.sh esp32s3-devkit:nsh and disable <cite>CONFIG_NSH_DISABLE_MW</cite>.</p></li>
<li><p><cite>make -j</cite></p></li>
<li><p>Flash image to esp32s3-devkit.</p></li>
<li><p>Run <cite>minicom -D /dev/ttyUSB0 -b 115200</cite> and reset esp32s3-devkit.</p></li>
<li><p>Use <cite>mw -1</cite> on nsh to trigger a crash.</p></li>
</ol>
<p>6. Get the crash log from minicom and save it to <cite>crash.log</cite>.
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">up_dump_register:</span>&#160;&#160;&#160; <span class="pre">PC:</span> <span class="pre">42009cd8</span>&#160;&#160;&#160; <span class="pre">PS:</span> <span class="pre">00060820</span>
<span class="pre">up_dump_register:</span>&#160;&#160;&#160; <span class="pre">A0:</span> <span class="pre">82007d71</span>&#160;&#160;&#160; <span class="pre">A1:</span> <span class="pre">3fc8b6d0</span>&#160;&#160;&#160; <span class="pre">A2:</span> <span class="pre">3fc8b8e0</span>&#160;&#160;&#160; <span class="pre">A3:</span> <span class="pre">00000000</span>
<span class="pre">up_dump_register:</span>&#160;&#160;&#160; <span class="pre">A4:</span> <span class="pre">ffffffff</span>&#160;&#160;&#160; <span class="pre">A5:</span> <span class="pre">00000000</span>&#160;&#160;&#160; <span class="pre">A6:</span> <span class="pre">00000001</span>&#160;&#160;&#160; <span class="pre">A7:</span> <span class="pre">00000000</span>
<span class="pre">up_dump_register:</span>&#160;&#160;&#160; <span class="pre">A8:</span> <span class="pre">ffffffff</span>&#160;&#160;&#160; <span class="pre">A9:</span> <span class="pre">3fc8b690</span>&#160;&#160; <span class="pre">A10:</span> <span class="pre">ffffffff</span>&#160;&#160; <span class="pre">A11:</span> <span class="pre">00000000</span>
<span class="pre">up_dump_register:</span>&#160;&#160; <span class="pre">A12:</span> <span class="pre">0000002d</span>&#160;&#160; <span class="pre">A13:</span> <span class="pre">0000002d</span>&#160;&#160; <span class="pre">A14:</span> <span class="pre">3fc8bb6d</span>&#160;&#160; <span class="pre">A15:</span> <span class="pre">0fffffff</span>
<span class="pre">up_dump_register:</span>&#160;&#160; <span class="pre">SAR:</span> <span class="pre">00000000</span> <span class="pre">CAUSE:</span> <span class="pre">0000001c</span> <span class="pre">VADDR:</span> <span class="pre">ffffffff</span>
<span class="pre">up_dump_register:</span>&#160; <span class="pre">LBEG:</span> <span class="pre">40055499</span>&#160; <span class="pre">LEND:</span> <span class="pre">400554a9</span>&#160; <span class="pre">LCNT:</span> <span class="pre">fffffffc</span>
<span class="pre">dump_stack:</span> <span class="pre">User</span> <span class="pre">Stack:</span>
<span class="pre">dump_stack:</span>&#160;&#160; <span class="pre">base:</span> <span class="pre">0x3fc8b0e0</span>
<span class="pre">dump_stack:</span>&#160;&#160; <span class="pre">size:</span> <span class="pre">00002000</span>
<span class="pre">dump_stack:</span>&#160;&#160;&#160;&#160; <span class="pre">sp:</span> <span class="pre">0x3fc8b6d0</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b6c0:</span> <span class="pre">82007770</span> <span class="pre">3fc8b700</span> <span class="pre">3fc8b8e0</span> <span class="pre">00000002</span> <span class="pre">ffffffff</span> <span class="pre">3fc89f54</span> <span class="pre">00060e20</span> <span class="pre">00000000</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b6e0:</span> <span class="pre">3fc8b8e0</span> <span class="pre">3fc8b778</span> <span class="pre">00000000</span> <span class="pre">3fc8b750</span> <span class="pre">82007850</span> <span class="pre">3fc8b720</span> <span class="pre">3fc8b8e0</span> <span class="pre">00000002</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b700:</span> <span class="pre">3fc8b720</span> <span class="pre">42009c84</span> <span class="pre">3fc8bb68</span> <span class="pre">3fc8b8e0</span> <span class="pre">82006b04</span> <span class="pre">3fc8b7d0</span> <span class="pre">3fc8b8e0</span> <span class="pre">3fc8bb68</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b720:</span> <span class="pre">3fc8bb68</span> <span class="pre">3fc8bb6b</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b740:</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b760:</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">3fc8bb69</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b780:</span> <span class="pre">82006ad5</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000040</span> <span class="pre">00000040</span> <span class="pre">3fc8bb6e</span> <span class="pre">3fc8adf8</span> <span class="pre">0000002c</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b7a0:</span> <span class="pre">ffffffff</span> <span class="pre">00000005</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">3fc8bae0</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b7c0:</span> <span class="pre">820068a2</span> <span class="pre">3fc8b800</span> <span class="pre">3fc8b8e0</span> <span class="pre">3c020837</span> <span class="pre">00000001</span> <span class="pre">3fc8b800</span> <span class="pre">3fc8b8e0</span> <span class="pre">3c020837</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b7e0:</span> <span class="pre">0000000a</span> <span class="pre">3fc8bae0</span> <span class="pre">00000001</span> <span class="pre">3fc8bb68</span> <span class="pre">82006865</span> <span class="pre">3fc8b820</span> <span class="pre">00000001</span> <span class="pre">3fc8b0c0</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b800:</span> <span class="pre">00000001</span> <span class="pre">3fc8bb68</span> <span class="pre">00000000</span> <span class="pre">3fc8ae1c</span> <span class="pre">82003618</span> <span class="pre">3fc8b840</span> <span class="pre">00000001</span> <span class="pre">3fc8b0c0</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b820:</span> <span class="pre">3fc8b8e0</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">820019dc</span> <span class="pre">3fc8b870</span> <span class="pre">42006834</span> <span class="pre">00000001</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b840:</span> <span class="pre">00000064</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">3c0225d8</span> <span class="pre">3fc89590</span> <span class="pre">00000000</span> <span class="pre">3fc880cc</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b860:</span> <span class="pre">00000000</span> <span class="pre">3fc8b890</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">3fc8b0c0</span> <span class="pre">00000002</span> <span class="pre">00000000</span> <span class="pre">3fc8ad98</span>
<span class="pre">stack_dump:</span> <span class="pre">0x3fc8b880:</span> <span class="pre">00000000</span> <span class="pre">3fc8b8b0</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span> <span class="pre">00000000</span>
<span class="pre">`</span></code>
7. Run <cite>./tools/minidumpserver.py -e nuttx -l crash.log -p 1234 -a esp32s3</cite>
8. Run <cite>xtensa-esp32s3-elf-gdb nuttx -ex “target remote 127.0.0.1:1234”</cite></p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>bash
GNU gdb (esp-gdb) 12.1_20221002
Copyright (C) 2022 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;<a class="reference external" href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a>&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type “show copying” and “show warranty” for details.
This GDB was configured as “–host=x86_64-linux-gnu –target=xtensa-esp-elf”.
Type “show configuration” for configuration details.
For bug reporting instructions, please see:
&lt;<a class="reference external" href="https://www.gnu.org/software/gdb/bugs/">https://www.gnu.org/software/gdb/bugs/</a>&gt;.
Find the GDB manual and other documentation resources online at:</p>
<blockquote>
<div><p>&lt;<a class="reference external" href="http://www.gnu.org/software/gdb/documentation/">http://www.gnu.org/software/gdb/documentation/</a>&gt;.</p>
</div></blockquote>
<p>For help, type “help”.
Type “apropos word” to search for commands related to “word”…
Reading symbols from nuttx…
Remote debugging using 127.0.0.1:1234
0x42009cd8 in cmd_mw (vtbl=0x3fc8b8e0, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at nsh_dbgcmds.c:259
259               nsh_output(vtbl, ”  %p = 0x%08” PRIx32, ptr, <a href="#id13"><span class="problematic" id="id14">*</span></a>ptr);
(gdb) bt
#0  0x42009cd8 in cmd_mw (vtbl=0x3fc8b8e0, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at nsh_dbgcmds.c:259
#1  0x42007d71 in nsh_command (vtbl=0x3fc8b8e0, argc=2, argv=0x3fc8b720) at nsh_command.c:1154
#2  0x42007770 in nsh_execute (oflags=&lt;optimized out&gt;, redirfile=0x0, argv=0x3fc8b720, argc=2, vtbl=0x3fc8b8e0)</p>
<blockquote>
<div><p>at nsh_parse.c:845</p>
</div></blockquote>
<p>#3  nsh_parse_command (vtbl=0x3fc8b8e0, cmdline=&lt;optimized out&gt;) at nsh_parse.c:2744
#4  0x42007850 in nsh_parse (vtbl=0x3fc8b8e0,</p>
<blockquote>
<div><p>cmdline=0x3fc8bb68 &lt;error: Cannot access memory at address 0x3fc8bb68&gt;) at nsh_parse.c:2828</p>
</div></blockquote>
<dl class="simple">
<dt>#5  0x42006b04 in nsh_session (pstate=0x3fc8b8e0, login=&lt;optimized out&gt;, argc=1, argv=&lt;optimized out&gt;)</dt><dd><p>at nsh_session.c:245</p>
</dd>
</dl>
<p>#6  0x420068a2 in nsh_consolemain (argc=1, argv=0x3fc8b0c0) at nsh_consolemain.c:71
#7  0x42006865 in nsh_main (argc=1, argv=0x3fc8b0c0) at nsh_main.c:74
#8  0x42003618 in nxtask_startup (entrypt=0x42006834 &lt;nsh_main&gt;, argc=1, argv=0x3fc8b0c0)</p>
<blockquote>
<div><p>at sched/task_startup.c:70</p>
</div></blockquote>
<p>#9  0x420019dc in nxtask_start () at task/task_start.c:134
(gdb)
<a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id17"><span class="problematic" id="id18">``</span></a></p>
</section>
<section id="how-to-add-new-architecture">
<h2>How to add new architecture<a class="headerlink" href="#how-to-add-new-architecture" title="Permalink to this heading"></a></h2>
<p>The main objective is to establish the sequence of registers in GDB,
aligning the register names in the crash log with the order of registers in GDB.
This alignment will facilitate the creation of a new architecture’s GDB server.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>