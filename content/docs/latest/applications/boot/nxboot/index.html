<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nxboot NuttX Bootloader &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
      <script src="../../../_static/doctools.js"></script>
      <script src="../../../_static/sphinx_highlight.js"></script>
      <script src="../../../_static/clipboard.min.js"></script>
      <script src="../../../_static/copybutton.js"></script>
      <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Benchmark Applications" href="../../benchmarks/index.html" />
    <link rel="prev" title="miniboot Minimal bootloader" href="../miniboot/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../12.10.0" >12.10.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/index.html">OS Components</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../audioutils/index.html">Audio Utility libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Bootloader Utilities</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../mcuboot/index.html"><code class="docutils literal notranslate"><span class="pre">mcuboot</span></code> MCUboot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miniboot/index.html"><code class="docutils literal notranslate"><span class="pre">miniboot</span></code> Minimal bootloader</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">nxboot</span></code> NuttX Bootloader</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#algorithm-description">Algorithm Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware-requirements">Hardware Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-creation">Image Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#public-api">Public API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../benchmarks/index.html">Benchmark Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canutils/index.html">CAN Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Cryptography Library Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fsutils/index.html">File System Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../games/index.html">Games</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../graphics/index.html">Graphics Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../industry/index.html">Industrial Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../inertial/index.html">Inertial Libraries Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../interpreters/index.html">Interpreters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lte/index.html">LTE Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math/index.html">Math Library Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mlearing/index.html">Machine Learning Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../netutils/index.html">Network Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nsh/index.html">NuttShell (NSH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdr/index.html">Software Defined Radio Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../system/index.html">System Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/index.html">Host Side Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wireless/index.html">Wireless Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Bootloader Utilities</a></li>
      <li class="breadcrumb-item active"><code class="docutils literal notranslate"><span class="pre">nxboot</span></code> NuttX Bootloader</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/applications/boot/nxboot/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nxboot-nuttx-bootloader">
<h1><code class="docutils literal notranslate"><span class="pre">nxboot</span></code> NuttX Bootloader<a class="headerlink" href="#nxboot-nuttx-bootloader" title="Permalink to this heading"></a></h1>
<p>NuttX Bootloader (nxboot) can be used to provide update and recovery
capabilities for NuttX based devices. The bootloader implements an
algorithm that uses three partitions/areas: primary, secondary and
tertiary. Primary area is used to run the image and thus is usually
located in a program memory. Secondary and tertiary areas are used
to store update image or recovery image and can be located on
external flash memory for example.</p>
<p>The images for the bootloader have version located in their headers. Note
that bootloader/image characteristics may differ for different version
and a portable application should take this into account.</p>
<section id="algorithm-description">
<h2>Algorithm Description<a class="headerlink" href="#algorithm-description" title="Permalink to this heading"></a></h2>
<p>The update is performed with a simple copy from update area to primary
area with recovery being created in recovery area if not already present.
Once image is confirmed by the user, the image in update area is
confirmed as well, update area becomes recovery area and vice versa.
This means the recovery is always present (except for the first update)
and subsequent updates just copy image from update to primary. This
makes the update significantly faster and more considerable to flash
wear while keeping the recovery/revert possibility.</p>
<p>Not confirmed image is reverted to recovery image if reboot occurs.</p>
<p>The bootable image consists of a header <a class="reference internal" href="#c.nxboot_img_header" title="nxboot_img_header"><code class="xref c c-struct docutils literal notranslate"><span class="pre">nxboot_img_header</span></code></a>
containing magic value, header version, header size, CRC32 of the image
including some parts of the header, size of the image excluding the header,
platform identifier, pointer to extended headers and and firmware version.
The header is located prior to the image itself and has a configurable size
<code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_HEADER_SIZE</span></code>. The CRC is calculated from the entire image
including header except for magic, header version and header size fields.
Extended headers are currently not supported, but the header already has
a reserved space for a pointer to it.</p>
<p>The image compatible with nxboot bootloader can be uploaded both directly
to the primary area via physical programmer as STlink or JTAG and to the
update partition via some external application (over Ethernet, USB, CAN, etc.).
The update and recovery slots can be located in the the primary flash as
well, but this halts the program execution during write operations, so it is
not recommended if external flash can be used. The uploaded image is detected
by the bootloader during the next boot and update occurs.</p>
<p>Bootloader has an internal magic value that is used to detect updated images.
Once update occurs, the image is copied from update to primary partition with
the internal magic value and the first erase page of the update slot is erased.
The image with internal magic value is considered valid only if its recovery
exists, therefore the image confirmation is done by writing the first erase
page (copying by write page size from primary) back to the update slot. It is
recommended to use <a class="reference internal" href="#c.nxboot_confirm" title="nxboot_confirm"><code class="xref c c-func docutils literal notranslate"><span class="pre">nxboot_confirm()</span></code></a> API to confirm the image. This
approach wears the first sector of the update partition a bit more, but
avoids image’s tails completely and simplifies both internal and API logic.</p>
<p>The application can use function <a class="reference internal" href="#c.nxboot_get_state" title="nxboot_get_state"><code class="xref c c-func docutils literal notranslate"><span class="pre">nxboot_get_state()</span></code></a> to determine
what partition is update and recovery and thus where the update image
should be stored. It is also possible to use function <a class="reference internal" href="#c.nxboot_open_update_partition" title="nxboot_open_update_partition"><code class="xref c c-func docutils literal notranslate"><span class="pre">nxboot_open_update_partition()</span></code></a>
that determines the correct partition for updates and returns the opened
file descriptor. This is a recommended approach as it avoids possible mistakes.</p>
</section>
<section id="hardware-requirements">
<h2>Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Permalink to this heading"></a></h2>
<p>As mentioned above, the bootloader utilizes three partitions with the
first one typically located in program flash.</p>
<p>The bootloader itself requires the minimal knowledge about characteristics
of the underlying storage device. This is achieved by means of the <code class="docutils literal notranslate"><span class="pre">BCH</span></code>
and <code class="docutils literal notranslate"><span class="pre">FTL</span></code> subsystems, which enable the bootloader to manage MTD partitions
via character device drivers using standard POSIX filesystem operations
(e.g. <code class="docutils literal notranslate"><span class="pre">open()</span></code> / <code class="docutils literal notranslate"><span class="pre">close()</span></code> / <code class="docutils literal notranslate"><span class="pre">read()</span></code> / <code class="docutils literal notranslate"><span class="pre">write()</span></code>).</p>
<p>It is currently required to access the partitions via mentioned <code class="docutils literal notranslate"><span class="pre">BCH</span></code>
and <code class="docutils literal notranslate"><span class="pre">FTL</span></code> subsystems, but future enhancement could provide a direct access
with <code class="docutils literal notranslate"><span class="pre">MTD</span></code> layer.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>Following configuration options are available:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_BOOT_NXBOOT</span></code>: Enables NuttX Bootloader build.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_PRIMARY_SLOT_PATH</span></code>:</dt><dd><p>The path to the application firmware image primary slot character
device driver. The image runs from this location. Default is <code class="docutils literal notranslate"><span class="pre">dev/ota0</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_SECONDARY_SLOT_PATH</span></code>:</dt><dd><p>The path to the application firmware image primary slot character device
driver. This is either update or recovery slot.. Default is <code class="docutils literal notranslate"><span class="pre">dev/ota1</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_TERTIARY_SLOT_PATH</span></code>:</dt><dd><p>The path to the application firmware image primary slot character device
driver. This is either update or recovery slot.. Default is <code class="docutils literal notranslate"><span class="pre">dev/ota2</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_HEADER_SIZE</span></code>:</dt><dd><p>Size of the image header. Note that this size should be aligned with the
program memory write page size!</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_PLATFORM_IDENTIFIER`</span></code>:</dt><dd><p>64 bits large platform identifier. This is a unique platform identifier
used by the bootloader to verify whether the image should be run on a
given platform. An update (or even a firmware uploaded via a programmer)
is rejected if the value in image’s header doesn’t match this option.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_BOOTLOADER</span></code>:</dt><dd><p>This option builds and links a bootloader application. This application
should be an entry function for NuttX. It checks for possible
update/revert operation, performs it and boot the correct image.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NXBOOT_SWRESET_ONLY</span></code>:</dt><dd><p>This option ensures the update/revert is performed only for software
reset. This way the board can keep its image (even if not confirmed)
during for example power shutdown and perform update/revert only if
expected based on user/maintainer input. Following reset causes
are considered as software resets.</p>
<p><code class="docutils literal notranslate"><span class="pre">BOARDIOC_RESETCAUSE_CPU_SOFT</span></code>: software reset</p>
<p><code class="docutils literal notranslate"><span class="pre">BOARDIOC_RESETCAUSE_CPU_RWDT</span></code>: watchdog error</p>
<p><code class="docutils literal notranslate"><span class="pre">BOARDIOC_RESETCAUSE_PIN</span></code>: reset button</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">NXBOOT_PREVENT_DOWNGRADE</span></code> :</dt><dd><p>NXboot uses Semantic Version 2.0.0 (without build metadata). By default,
the update is performed for every version that doesn’t match the
currently running one. If NXBOOT_PREVENT_DOWNGRADE selected, update is
performed only for newer versions (according to Semantic Version
preference rules).</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">WARNING</span></code>: NXboot currently implements preferences only for
<code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code> and ignores prerelease.</p>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</section>
<section id="image-creation">
<h2>Image Creation<a class="headerlink" href="#image-creation" title="Permalink to this heading"></a></h2>
<p>The image intended to be booted by nxboot bootloader must have prepended header
to be recognized and worked with correctly. A Python script <code class="docutils literal notranslate"><span class="pre">nximage.py</span></code>
located in <code class="docutils literal notranslate"><span class="pre">apps/boot/nxboot/tools</span></code> directory can be used to generate
nxboot compatible image.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>apps/boot/nxboot/tools/nximage.py<span class="w">  </span><span class="se">\</span>
<span class="w">              </span>--version<span class="w"> </span><span class="s2">&quot;VERSION&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">              </span>--header_size<span class="w"> </span>CONFIG_NXBOOT_HEADER_SIZE<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>--identifier<span class="w"> </span>CONFIG_NXBOOT_PLATFORM_IDENTIFIER<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>nuttx.bin<span class="w"> </span>image.img
</pre></div>
</div>
<p>It takes input parameters <code class="docutils literal notranslate"><span class="pre">--version</span></code> with your image’s version,
<code class="docutils literal notranslate"><span class="pre">--header_size</span></code> with the configured size of the header and <code class="docutils literal notranslate"><span class="pre">--identifier</span></code>.
with the platform identifier. The input file is a binary <code class="docutils literal notranslate"><span class="pre">nuttx.bin</span></code>, output
with added header is <code class="docutils literal notranslate"><span class="pre">image.img</span></code>.</p>
<p>Image version adheres to <a class="reference external" href="https://semver.org/spec/v2.0.0.html">Semantic Versioning 2.0.0</a>
without the usage of build metadata. The used format is
MAJOR.MINOR:PATCH-prerelease. The image version is important for the update
to occur as the bootloader automatically rejects update firmware that
has the same version as the already running firmware.
Configuration options:</p>
</section>
<section id="public-api">
<h2>Public API<a class="headerlink" href="#public-api" title="Permalink to this heading"></a></h2>
<p>Enabling <code class="docutils literal notranslate"><span class="pre">CONFIG_BOOT_NXBOOT</span></code> option provides following NXboot API.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nxboot.h&gt;</span>
</pre></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nxboot_img_version">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_img_version</span></span></span><a class="headerlink" href="#c.nxboot_img_version" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define NXBOOT_HEADER_PRERELEASE_MAXLEN 94</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">nxboot_img_version</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* MAJOR version */</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">major</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* MINOR version */</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">minor</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* PATCH version */</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">patch</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Additional pre-release version */</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">pre_release</span><span class="p">[</span><span class="n">NXBOOT_HEADER_PRERELEASE_MAXLEN</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nxboot_hdr_version">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_hdr_version</span></span></span><a class="headerlink" href="#c.nxboot_hdr_version" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">nxboot_hdr_version</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* Header major version */</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">major</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Header minor version */</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">minor</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nxboot_img_header">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_img_header</span></span></span><a class="headerlink" href="#c.nxboot_img_header" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define NXBOOT_HEADER_MAGIC     0x534f584e</span>
<span class="cp">#define NXBOOT_HEADER_MAGIC_INT 0xaca0abb0</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">nxboot_img_header</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* Header magic */</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Version of the header */</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nxboot_hdr_version</span><span class="w"> </span><span class="n">hdr_version</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Size of the header */</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">header_size</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* CRC of the image, exceluding the previous header fields. */</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">crc</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Image size (excluding the header) */</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Platform identifier */</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">identifier</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Address of optional extended headers */</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">extd_hdr_ptr</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Image version */</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nxboot_img_version</span><span class="w"> </span><span class="n">img_version</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.nxboot_update_type">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_update_type</span></span></span><a class="headerlink" href="#c.nxboot_update_type" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">nxboot_update_type</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* No action to do */</span>
<span class="w">  </span><span class="n">NXBOOT_UPDATE_TYPE_NONE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* Update will take place upon reboot */</span>
<span class="w">  </span><span class="n">NXBOOT_UPDATE_TYPE_UPDATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="cm">/* Revert will take place upon reboot */</span>
<span class="w">  </span><span class="n">NXBOOT_UPDATE_TYPE_REVERT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nxboot_state">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_state</span></span></span><a class="headerlink" href="#c.nxboot_state" title="Permalink to this definition"></a><br /></dt>
<dd></dd></dl>

<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define NXBOOT_PRIMARY_SLOT_NUM 0</span>
<span class="cp">#define NXBOOT_SECONDARY_SLOT_NUM 1</span>
<span class="cp">#define NXBOOT_TERTIARY_SLOT_NUM 2</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">nxboot_state</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* Number of update slot */</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">update</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* Number of recovery slot */</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">recovery</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* True if recovery image contains valid recovery */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">recovery_valid</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* True if image in a primary slot has a recovery (even non valid) */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">recovery_present</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* True if primary slot is confirmed */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">primary_confirmed</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/* True if update slot has a valid image */</span>
<span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="n">nxboot_update_type</span><span class="w"> </span><span class="n">next_boot</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.nxboot_get_state">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_get_state</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nxboot_state" title="nxboot_state"><span class="n"><span class="pre">nxboot_state</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">state</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nxboot_get_state" title="Permalink to this definition"></a><br /></dt>
<dd><p>This function can be used to determine whether primary image is
confirmed or not. This provides more direct access to confirm
state compared to nxboot_get_state function that returns the full
state of the bootloader.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – A pointer to <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">nxboot_state</span></code> structure.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0 on success, -1 and sets errno on failure.</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nxboot_open_update_partition">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_open_update_partition</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nxboot_open_update_partition" title="Permalink to this definition"></a><br /></dt>
<dd><p>Gets the current bootloader state and opens the partition to which an
update image should be stored. It returns the valid file descriptor to
this partition, the user is responsible for writing to it and closing
if afterwards.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Valid file descriptor on success, -1 and sets errno on failure.</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nxboot_get_confirm">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_get_confirm</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nxboot_get_confirm" title="Permalink to this definition"></a><br /></dt>
<dd><p>Confirms the image currently located in primary partition and marks
its copy in update partition as a recovery.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>1 means confirmed, 0 not confirmed, -1 and sets errno on failure.</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nxboot_confirm">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_confirm</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nxboot_confirm" title="Permalink to this definition"></a><br /></dt>
<dd><p>Confirms the image currently located in primary partition and marks
its copy in update partition as a recovery.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>0 on success, -1 and sets errno on failure.</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nxboot_perform_update">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nxboot_perform_update</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">check_only</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nxboot_perform_update" title="Permalink to this definition"></a><br /></dt>
<dd><p>Checks for the possible firmware update and performs it by copying
update image to primary slot or recovery image to primary slot in case
of the revert. In any situation, this function ends with the valid
image in primary slot.</p>
<p>This is an entry point function that should be called from the
bootloader application.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>check_only</strong> – Only repairs corrupted update.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0 on success, -1 and sets errno on failure.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../miniboot/index.html" class="btn btn-neutral float-left" title="miniboot Minimal bootloader" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../benchmarks/index.html" class="btn btn-neutral float-right" title="Benchmark Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>