<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ptpd PTP daemon commands &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
      <script src="../../../_static/doctools.js"></script>
      <script src="../../../_static/sphinx_highlight.js"></script>
      <script src="../../../_static/clipboard.min.js"></script>
      <script src="../../../_static/copybutton.js"></script>
      <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="readline readline() Support" href="../readline/index.html" />
    <link rel="prev" title="psmq Publish Subscribe Message Queue" href="../psmq/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../12.11.0" >12.11.0</option>
    
    <option value="../../../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/index.html">OS Components</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../audioutils/index.html">Audio Utility libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boot/index.html">Bootloader Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../benchmarks/index.html">Benchmark Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canutils/index.html">CAN Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Cryptography Library Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fsutils/index.html">File System Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../games/index.html">Games</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../graphics/index.html">Graphics Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../industry/index.html">Industrial Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../inertial/index.html">Inertial Libraries Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../interpreters/index.html">Interpreters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lte/index.html">LTE Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math/index.html">Math Library Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mlearing/index.html">Machine Learning Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../netutils/index.html">Network Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nsh/index.html">NuttShell (NSH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdr/index.html">Software Defined Radio Libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">System Libraries and NSH Add-Ons</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adb/index.html"><code class="docutils literal notranslate"><span class="pre">adb</span></code> ADB daemon application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../argtable3/index.html"><code class="docutils literal notranslate"><span class="pre">argtable3</span></code> ARGTABLE3 library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cdcacm/index.html"><code class="docutils literal notranslate"><span class="pre">cdcacm</span></code> USB CDC/ACM Device Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cfgdata/index.html"><code class="docutils literal notranslate"><span class="pre">cfgdata</span></code> Cfgdata Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cle/index.html"><code class="docutils literal notranslate"><span class="pre">cle</span></code> EMACS-like Command Line Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../composite/index.html"><code class="docutils literal notranslate"><span class="pre">composite</span></code> USB Composite Device Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../coredump/index.html"><code class="docutils literal notranslate"><span class="pre">coredump</span></code> Coredump tool capture system status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crimon/index.html"><code class="docutils literal notranslate"><span class="pre">critmon</span></code> Critical Section Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cu/index.html"><code class="docutils literal notranslate"><span class="pre">cu</span></code> CU minimal serial terminal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dd/index.html"><code class="docutils literal notranslate"><span class="pre">dd</span></code> system ‘dd’ command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debugpoint/index.html"><code class="docutils literal notranslate"><span class="pre">debugpoint</span></code> Debug Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dhcp6c/index.html"><code class="docutils literal notranslate"><span class="pre">dhcp6c</span></code> DHCP IPv6 Address Renewal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dhcpc/index.html"><code class="docutils literal notranslate"><span class="pre">dhcpc</span></code> DHCP Address Renewal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dumpstack/index.html"><code class="docutils literal notranslate"><span class="pre">dumpstack</span></code> dumpstack tool for show the task backtrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fastboot/index.html"><code class="docutils literal notranslate"><span class="pre">fastboot</span></code> fastbootd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fdt/index.html"><code class="docutils literal notranslate"><span class="pre">fdt</span></code> fdt utility tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../flash_eraseall/index.html"><code class="docutils literal notranslate"><span class="pre">flash_eraseall</span></code> FLASH Erase-all Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gcov/index.html"><code class="docutils literal notranslate"><span class="pre">gcov</span></code> gcov tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gdbstub/index.html"><code class="docutils literal notranslate"><span class="pre">gdbstub</span></code> GDBSTUB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gprof/index.html"><code class="docutils literal notranslate"><span class="pre">gprof</span></code> GNU Profile tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hex2bin/index.html"><code class="docutils literal notranslate"><span class="pre">hex2bin</span></code> Intel HEX to binary conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hexed/index.html"><code class="docutils literal notranslate"><span class="pre">hexed</span></code> Hex editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hostname/index.html"><code class="docutils literal notranslate"><span class="pre">hostname</span></code> “hostname” command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c/index.html"><code class="docutils literal notranslate"><span class="pre">i2c</span></code> I2C Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../input/index.html"><code class="docutils literal notranslate"><span class="pre">input</span></code> input tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iptables/index.html"><code class="docutils literal notranslate"><span class="pre">iptables</span></code> “iptables” command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../libuv/index.html"><code class="docutils literal notranslate"><span class="pre">libuv</span></code> libuv asynchronous I/O Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lm75/index.html"><code class="docutils literal notranslate"><span class="pre">lm75</span></code> LM75 Temperature</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lzf/index.html"><code class="docutils literal notranslate"><span class="pre">lzf</span></code> LZF compression tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mdio/index.html"><code class="docutils literal notranslate"><span class="pre">mdio</span></code> PHY MDIO tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../netdb/index.html"><code class="docutils literal notranslate"><span class="pre">netdb</span></code> netdb interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nsh/index.html"><code class="docutils literal notranslate"><span class="pre">nsh</span></code> NuttShell (NSH) example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ntpc/index.html"><code class="docutils literal notranslate"><span class="pre">ntpc</span></code> NTP Daemon Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nxcamera/index.html"><code class="docutils literal notranslate"><span class="pre">nxcamera</span></code> NxCamera video test application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nxcodec/index.html"><code class="docutils literal notranslate"><span class="pre">nxcodec</span></code> NxCodec video codec test application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nxdiag/index.html"><code class="docutils literal notranslate"><span class="pre">nxdiag</span></code> NuttX Diagnostic Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nxlooper/index.html"><code class="docutils literal notranslate"><span class="pre">nxlooper</span></code> NxLooper audio test application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nxplayer/index.html"><code class="docutils literal notranslate"><span class="pre">nxplayer</span></code> NxPlayer Media Player</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nxrecorder/index.html"><code class="docutils literal notranslate"><span class="pre">nxrecorder</span></code> NxRecorder pcm raw data Recorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ofloader/index.html"><code class="docutils literal notranslate"><span class="pre">ofloader</span></code> Open flash loader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ping/index.html"><code class="docutils literal notranslate"><span class="pre">ping</span></code> ICMP “ping” command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ping6/index.html"><code class="docutils literal notranslate"><span class="pre">ping6</span></code> ICMPv6 “ping6” command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../popen/index.html"><code class="docutils literal notranslate"><span class="pre">popen</span></code> popen()/pclose() Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../psmq/index.html"><code class="docutils literal notranslate"><span class="pre">psmq</span></code> Publish Subscribe Message Queue</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">ptpd</span></code> PTP daemon commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#features">Features</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#architecture">Architecture</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#upper-layer-netutils-ptpd">Upper Layer (<code class="docutils literal notranslate"><span class="pre">netutils/ptpd/</span></code>)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#lower-layer-system-ptpd">Lower Layer (<code class="docutils literal notranslate"><span class="pre">system/ptpd/</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-options">Configuration Options</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#domain-and-priority">Domain and Priority</a></li>
<li class="toctree-l5"><a class="reference internal" href="#clock-quality">Clock Quality</a></li>
<li class="toctree-l5"><a class="reference internal" href="#timing-parameters">Timing Parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="#adjustment-thresholds">Adjustment Thresholds</a></li>
<li class="toctree-l5"><a class="reference internal" href="#path-delay">Path Delay</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#command-line-interface">Command Line Interface</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l5"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#start-as-ptp-client-slave">Start as PTP Client (Slave)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#start-as-ptp-master-server">Start as PTP Master (Server)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#layer-2-ethernet-transport">Layer 2 Ethernet Transport</a></li>
<li class="toctree-l5"><a class="reference internal" href="#ptp-clock-device-integration">PTP Clock Device Integration</a></li>
<li class="toctree-l5"><a class="reference internal" href="#query-daemon-status">Query Daemon Status</a></li>
<li class="toctree-l5"><a class="reference internal" href="#stop-daemon">Stop Daemon</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#status-information">Status Information</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#clock-source-information">Clock Source Information</a></li>
<li class="toctree-l5"><a class="reference internal" href="#synchronization-status">Synchronization Status</a></li>
<li class="toctree-l5"><a class="reference internal" href="#activity-timestamps">Activity Timestamps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#api-functions">API Functions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#ptpd-start">ptpd_start()</a></li>
<li class="toctree-l5"><a class="reference internal" href="#ptpd-status">ptpd_status()</a></li>
<li class="toctree-l5"><a class="reference internal" href="#ptpd-stop">ptpd_stop()</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-details">Implementation Details</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#synchronization-algorithm">Synchronization Algorithm</a></li>
<li class="toctree-l5"><a class="reference internal" href="#hardware-timestamping">Hardware Timestamping</a></li>
<li class="toctree-l5"><a class="reference internal" href="#ptp-clock-device-support">PTP Clock Device Support</a></li>
<li class="toctree-l5"><a class="reference internal" href="#transport-modes">Transport Modes</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#synchronization-accuracy">Synchronization Accuracy</a></li>
<li class="toctree-l5"><a class="reference internal" href="#cpu-and-memory-usage">CPU and Memory Usage</a></li>
<li class="toctree-l5"><a class="reference internal" href="#network-requirements">Network Requirements</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#common-issues">Common Issues</a></li>
<li class="toctree-l5"><a class="reference internal" href="#debug-output">Debug Output</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#related-documentation">Related Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../readline/index.html"><code class="docutils literal notranslate"><span class="pre">readline</span></code> readline() Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sched_note/index.html"><code class="docutils literal notranslate"><span class="pre">sched_note</span></code> Scheduler monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../setlogmask/index.html"><code class="docutils literal notranslate"><span class="pre">setlogmask</span></code> “setlogmask” command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi/index.html"><code class="docutils literal notranslate"><span class="pre">spi</span></code> SPI Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stackmonitor/index.html"><code class="docutils literal notranslate"><span class="pre">stackmonitor</span></code> Stack Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../syslogd/index.html"><code class="docutils literal notranslate"><span class="pre">syslogd</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../system/index.html"><code class="docutils literal notranslate"><span class="pre">system</span></code> System Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../taskset/index.html"><code class="docutils literal notranslate"><span class="pre">taskset</span></code> Taskset Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tcpdump/index.html"><code class="docutils literal notranslate"><span class="pre">tcpdump</span></code> tcpdump command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tee/index.html"><code class="docutils literal notranslate"><span class="pre">tee</span></code> Tee Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../telnet/index.html"><code class="docutils literal notranslate"><span class="pre">telnet</span></code> Telnet chat daemon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../telnetd/index.html"><code class="docutils literal notranslate"><span class="pre">telnetd</span></code> Telnet daemon application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../termcurses/index.html"><code class="docutils literal notranslate"><span class="pre">termcurses</span></code> Terminal Curses control support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trace/index.html"><code class="docutils literal notranslate"><span class="pre">trace</span></code> Trace command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubloxmodem/index.html"><code class="docutils literal notranslate"><span class="pre">ubloxmodem</span></code> u-blox modem configuration tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../uniqueid/index.html"><code class="docutils literal notranslate"><span class="pre">uniqueid</span></code> “uniqueid” command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../uorb/index.html"><code class="docutils literal notranslate"><span class="pre">uorb</span></code> uorb(micro object request broker)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usbmsc/index.html"><code class="docutils literal notranslate"><span class="pre">usbmsc</span></code> USB Mass Storage Device Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vi/index.html"><code class="docutils literal notranslate"><span class="pre">vi</span></code> VI Work-Alike Text Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ymodem/index.html"><code class="docutils literal notranslate"><span class="pre">ymodem</span></code> YMODEM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zlib/index.html"><code class="docutils literal notranslate"><span class="pre">zlib</span></code> zlib data compression library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zmodem/index.html"><code class="docutils literal notranslate"><span class="pre">zmodem</span></code> Zmodem Commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/index.html">Host Side Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wireless/index.html">Wireless Libraries and NSH Add-Ons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="../index.html">System Libraries and NSH Add-Ons</a></li>
      <li class="breadcrumb-item active"><code class="docutils literal notranslate"><span class="pre">ptpd</span></code> PTP daemon commands</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/applications/system/ptpd/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ptpd-ptp-daemon-commands">
<h1><code class="docutils literal notranslate"><span class="pre">ptpd</span></code> PTP daemon commands<a class="headerlink" href="#ptpd-ptp-daemon-commands" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ptpd</span></code> application provides a complete IEEE 1588-2008 Precision Time
Protocol (PTPv2) implementation for NuttX. This daemon enables sub-microsecond
time synchronization across networked systems, supporting both client (slave)
and server (master) modes.</p>
<p>The PTP daemon can synchronize the system clock to a remote PTP master with
accuracy better than 1 microsecond when using software timestamps, or better
than 500 nanoseconds with hardware timestamping support.</p>
<section id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>IEEE 1588-2008 PTPv2 compliant</strong> implementation</p></li>
<li><p><strong>Dual role support</strong>: operates as both PTP master and slave</p></li>
<li><p><strong>Multiple transport options</strong>:</p>
<ul>
<li><p>UDP over IPv4 (default)</p></li>
<li><p>UDP over IPv6</p></li>
<li><p>IEEE 802.3 Ethernet (Layer 2)</p></li>
</ul>
</li>
<li><p><strong>Hardware timestamping</strong> support for enhanced accuracy</p></li>
<li><p><strong>PTP clock device integration</strong> via <code class="docutils literal notranslate"><span class="pre">/dev/ptp*</span></code> devices</p></li>
<li><p><strong>BMCA (Best Master Clock Algorithm)</strong> for automatic master selection</p></li>
<li><p><strong>Two delay mechanisms</strong>:</p>
<ul>
<li><p>End-to-End (E2E) delay measurement</p></li>
<li><p>Peer-to-Peer (P2P) delay measurement</p></li>
</ul>
</li>
<li><p><strong>gPTP support</strong> with switch path delay correction</p></li>
<li><p><strong>Clock drift compensation</strong> with automatic frequency adjustment</p></li>
<li><p><strong>Client-only mode</strong> for dedicated slave operation</p></li>
</ul>
</section>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this heading"></a></h2>
<p>The ptpd implementation consists of two main components:</p>
<section id="upper-layer-netutils-ptpd">
<h3>Upper Layer (<code class="docutils literal notranslate"><span class="pre">netutils/ptpd/</span></code>)<a class="headerlink" href="#upper-layer-netutils-ptpd" title="Permalink to this heading"></a></h3>
<p>Provides the core PTP protocol implementation:</p>
<ul class="simple">
<li><p>PTP packet encoding/decoding (Announce, Sync, Follow-Up, Delay_Req, Delay_Resp)</p></li>
<li><p>BMCA (Best Master Clock Algorithm) for master selection</p></li>
<li><p>Clock synchronization and adjustment algorithms</p></li>
<li><p>Path delay measurement and compensation</p></li>
<li><p>Network socket management (multicast, unicast)</p></li>
<li><p>Hardware and software timestamping support</p></li>
</ul>
</section>
<section id="lower-layer-system-ptpd">
<h3>Lower Layer (<code class="docutils literal notranslate"><span class="pre">system/ptpd/</span></code>)<a class="headerlink" href="#lower-layer-system-ptpd" title="Permalink to this heading"></a></h3>
<p>Provides the command-line interface and daemon management:</p>
<ul class="simple">
<li><p>Command-line argument parsing</p></li>
<li><p>Configuration management</p></li>
<li><p>Daemon lifecycle control (start, stop, status)</p></li>
<li><p>Status reporting and monitoring</p></li>
</ul>
</section>
</section>
<section id="configuration-options">
<h2>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this heading"></a></h2>
<p>The PTP daemon can be configured through Kconfig options in
<code class="docutils literal notranslate"><span class="pre">apps/netutils/ptpd/Kconfig</span></code>. Key configuration parameters include:</p>
<section id="domain-and-priority">
<h3>Domain and Priority<a class="headerlink" href="#domain-and-priority" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_DOMAIN</span></code> (default: 0)</dt><dd><p>PTP domain number (0-127). Isolates different PTP domains on the same network.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_PRIORITY1</span></code> (default: 128)</dt><dd><p>Primary priority field (0-255). Lower value = higher priority in BMCA.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_PRIORITY2</span></code> (default: 128)</dt><dd><p>Secondary priority field (0-255). Used when priority1 values are equal.</p>
</dd>
</dl>
</section>
<section id="clock-quality">
<h3>Clock Quality<a class="headerlink" href="#clock-quality" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_CLASS</span></code> (default: 248)</dt><dd><p>Clock class value (0-255):</p>
<ul class="simple">
<li><p>6: Primary reference (e.g., GPS)</p></li>
<li><p>13: Application-specific time source</p></li>
<li><p>52: Degraded mode</p></li>
<li><p>248: Default (unknown)</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_ACCURACY</span></code> (default: 254)</dt><dd><p>Clock accuracy on logarithmic scale:</p>
<ul class="simple">
<li><p>32: ±25 ns</p></li>
<li><p>35: ±1 μs</p></li>
<li><p>39: ±100 μs</p></li>
<li><p>41: ±1 ms</p></li>
<li><p>47: ±1 s</p></li>
<li><p>254: Unknown</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_CLOCKSOURCE</span></code> (default: 160)</dt><dd><p>Time source type:</p>
<ul class="simple">
<li><p>32: GPS</p></li>
<li><p>64: PTP</p></li>
<li><p>80: NTP</p></li>
<li><p>160: Internal oscillator</p></li>
</ul>
</dd>
</dl>
</section>
<section id="timing-parameters">
<h3>Timing Parameters<a class="headerlink" href="#timing-parameters" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_SYNC_INTERVAL_MSEC</span></code> (default: 1000)</dt><dd><p>Interval between Sync messages when acting as master (milliseconds).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_ANNOUNCE_INTERVAL_MSEC</span></code> (default: 10000)</dt><dd><p>Interval between Announce messages when acting as master (milliseconds).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_TIMEOUT_MS</span></code> (default: 60000)</dt><dd><p>Timeout for switching to alternate clock source (milliseconds).</p>
</dd>
</dl>
</section>
<section id="adjustment-thresholds">
<h3>Adjustment Thresholds<a class="headerlink" href="#adjustment-thresholds" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_SETTIME_THRESHOLD_MS</span></code> (default: 1000)</dt><dd><p>Clock offset threshold for using <code class="docutils literal notranslate"><span class="pre">settimeofday()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">adjtime()</span></code>.
If offset exceeds this value, time is stepped rather than slewed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_ADJTIME_THRESHOLD_NS</span></code> (default: 500)</dt><dd><p>Threshold for using current PPB instead of accumulated PPB to accelerate
adjustment (nanoseconds).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_DRIFT_AVERAGE_S</span></code> (default: 600)</dt><dd><p>Time period for averaging clock drift rate (seconds, 10-86400).</p>
</dd>
</dl>
</section>
<section id="path-delay">
<h3>Path Delay<a class="headerlink" href="#path-delay" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_MAX_PATH_DELAY_NS</span></code> (default: 100000)</dt><dd><p>Maximum acceptable path delay (nanoseconds). Longer delays are ignored.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_DELAYREQ_AVGCOUNT</span></code> (default: 100)</dt><dd><p>Number of samples for path delay averaging.</p>
</dd>
</dl>
</section>
</section>
<section id="command-line-interface">
<h2>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this heading"></a></h2>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ptpd [options]</span>
</pre></div>
</div>
<p>The daemon must be run in background mode using the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator.</p>
</section>
<section id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this heading"></a></h3>
<p><strong>Mode Selection</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-s</span></code></dt><dd><p>Enable client-only mode (slave only, no master capability)</p>
</dd>
</dl>
<p><strong>Network Transport</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-2</span></code></dt><dd><p>Use IEEE 802.3 Ethernet transport (Layer 2, raw sockets)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-4</span></code></dt><dd><p>Use UDP over IPv4 (default)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-6</span></code></dt><dd><p>Use UDP over IPv6</p>
</dd>
</dl>
<p><strong>Time Stamping</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-H</span></code></dt><dd><p>Use hardware timestamping (default if <code class="docutils literal notranslate"><span class="pre">CONFIG_NET_TIMESTAMP</span></code> is enabled)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-S</span></code></dt><dd><p>Use software timestamping (fallback mode)</p>
</dd>
</dl>
<p><strong>Protocol Options</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-B</span></code></dt><dd><p>Enable Best Master Clock Algorithm messages</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-E</span></code></dt><dd><p>Use End-to-End (E2E) delay mechanism (supports Delay_Req/Delay_Resp)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-r</span></code></dt><dd><p>Synchronize system realtime clock (instead of PTP clock device)</p>
</dd>
</dl>
<p><strong>Device Configuration</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">[device]</span></code></dt><dd><p>Network interface to use (e.g., <code class="docutils literal notranslate"><span class="pre">eth0</span></code>, <code class="docutils literal notranslate"><span class="pre">eth1</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">[device]</span></code></dt><dd><p>PTP clock device to use (e.g., <code class="docutils literal notranslate"><span class="pre">ptp0</span></code>). If not specified, uses <code class="docutils literal notranslate"><span class="pre">realtime</span></code>.</p>
</dd>
</dl>
<p><strong>Daemon Control</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">[pid]</span></code></dt><dd><p>Query and display status of running PTP daemon</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">[pid]</span></code></dt><dd><p>Stop PTP daemon with given PID</p>
</dd>
</dl>
</section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h2>
<section id="start-as-ptp-client-slave">
<h3>Start as PTP Client (Slave)<a class="headerlink" href="#start-as-ptp-client-slave" title="Permalink to this heading"></a></h3>
<p>Basic client synchronization using IPv4 UDP:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -i eth0 &amp;</span>
<span class="go">[PTP] Starting ptpd on interface eth0</span>
<span class="go">[PTP] Operating in client+server mode</span>
<span class="go">[PTP] Using software timestamps</span>
</pre></div>
</div>
<p>Client-only mode with hardware timestamping:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -s -H -i eth0 &amp;</span>
<span class="go">[PTP] Starting ptpd on interface eth0</span>
<span class="go">[PTP] Client-only mode</span>
<span class="go">[PTP] Using hardware timestamps</span>
</pre></div>
</div>
</section>
<section id="start-as-ptp-master-server">
<h3>Start as PTP Master (Server)<a class="headerlink" href="#start-as-ptp-master-server" title="Permalink to this heading"></a></h3>
<p>Act as PTP master using BMCA:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -B -i eth0 &amp;</span>
<span class="go">[PTP] Starting ptpd on interface eth0</span>
<span class="go">[PTP] BMCA enabled</span>
</pre></div>
</div>
</section>
<section id="layer-2-ethernet-transport">
<h3>Layer 2 Ethernet Transport<a class="headerlink" href="#layer-2-ethernet-transport" title="Permalink to this heading"></a></h3>
<p>Use IEEE 802.3 Ethernet transport for gPTP:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -2 -i eth0 &amp;</span>
<span class="go">[PTP] Starting ptpd on interface eth0</span>
<span class="go">[PTP] Using Ethernet transport (raw socket)</span>
</pre></div>
</div>
</section>
<section id="ptp-clock-device-integration">
<h3>PTP Clock Device Integration<a class="headerlink" href="#ptp-clock-device-integration" title="Permalink to this heading"></a></h3>
<p>Synchronize PTP hardware clock instead of system clock:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -i eth0 -p ptp0 &amp;</span>
<span class="go">[PTP] Starting ptpd on interface eth0</span>
<span class="go">[PTP] Using PTP clock device /dev/ptp0</span>
</pre></div>
</div>
</section>
<section id="query-daemon-status">
<h3>Query Daemon Status<a class="headerlink" href="#query-daemon-status" title="Permalink to this heading"></a></h3>
<p>Check synchronization status of running daemon:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -t 42</span>
<span class="go">PTPD (PID 42) status:</span>
<span class="go">- clock_source_valid: 1</span>
<span class="go">|- id: 00 1a 2b 3c 4d 5e 6f 70</span>
<span class="go">|- utcoffset: 37</span>
<span class="go">|- priority1: 128</span>
<span class="go">|- class: 6</span>
<span class="go">|- accuracy: 32</span>
<span class="go">|- variance: 4321</span>
<span class="go">|- priority2: 128</span>
<span class="go">|- gm_id: 00 1a 2b 3c 4d 5e 6f 70</span>
<span class="go">|- stepsremoved: 0</span>
<span class="go">&#39;- timesource: 32</span>
<span class="go">- last_clock_update: 2025-12-15T10:30:45.123456789</span>
<span class="go">- last_delta_ns: 234</span>
<span class="go">- last_adjtime_ns: -123</span>
<span class="go">- drift_ppb: 1234</span>
<span class="go">- path_delay_ns: 5678</span>
<span class="go">- last_received_multicast: 0 s ago</span>
<span class="go">- last_received_announce: 2 s ago</span>
<span class="go">- last_received_sync: 0 s ago</span>
</pre></div>
</div>
</section>
<section id="stop-daemon">
<h3>Stop Daemon<a class="headerlink" href="#stop-daemon" title="Permalink to this heading"></a></h3>
<p>Stop running PTP daemon:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ptpd -d 42</span>
<span class="go">Stopped ptpd</span>
</pre></div>
</div>
</section>
</section>
<section id="status-information">
<h2>Status Information<a class="headerlink" href="#status-information" title="Permalink to this heading"></a></h2>
<p>When querying status with <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">[pid]</span></code>, the following information is displayed:</p>
<section id="clock-source-information">
<h3>Clock Source Information<a class="headerlink" href="#clock-source-information" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>clock_source_valid</strong>: Whether a valid PTP master has been selected</p></li>
<li><p><strong>id</strong>: PTP clock identity (EUI-64 format)</p></li>
<li><p><strong>utcoffset</strong>: Offset between TAI and UTC (seconds)</p></li>
<li><p><strong>priority1/priority2</strong>: BMCA priority fields</p></li>
<li><p><strong>class</strong>: Clock class (6=GPS, 13=application, 248=default)</p></li>
<li><p><strong>accuracy</strong>: Accuracy specification (32=±25ns, 254=unknown)</p></li>
<li><p><strong>variance</strong>: Clock variance estimate</p></li>
<li><p><strong>gm_id</strong>: Grandmaster clock identity</p></li>
<li><p><strong>stepsremoved</strong>: Hops from grandmaster</p></li>
<li><p><strong>timesource</strong>: Source type (32=GPS, 64=PTP, 80=NTP, 160=internal)</p></li>
</ul>
</section>
<section id="synchronization-status">
<h3>Synchronization Status<a class="headerlink" href="#synchronization-status" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>last_clock_update</strong>: Timestamp of last clock adjustment</p></li>
<li><p><strong>last_delta_ns</strong>: Latest measured clock offset (nanoseconds)</p></li>
<li><p><strong>last_adjtime_ns</strong>: Previously applied adjustment offset</p></li>
<li><p><strong>drift_ppb</strong>: Averaged clock drift rate (parts per billion)</p></li>
<li><p><strong>path_delay_ns</strong>: Network path delay estimate (nanoseconds)</p></li>
</ul>
</section>
<section id="activity-timestamps">
<h3>Activity Timestamps<a class="headerlink" href="#activity-timestamps" title="Permalink to this heading"></a></h3>
<p>Time since last received/transmitted PTP message:</p>
<ul class="simple">
<li><p><strong>last_received_multicast</strong>: Any PTP multicast packet</p></li>
<li><p><strong>last_received_announce</strong>: Announce message from any master</p></li>
<li><p><strong>last_received_sync</strong>: Sync message from selected master</p></li>
<li><p><strong>last_transmitted_sync</strong>: Sync message (when acting as master)</p></li>
<li><p><strong>last_transmitted_announce</strong>: Announce message (when acting as master)</p></li>
<li><p><strong>last_transmitted_delayresp</strong>: Delay response (when acting as master)</p></li>
<li><p><strong>last_transmitted_delayreq</strong>: Delay request (when acting as slave)</p></li>
</ul>
</section>
</section>
<section id="api-functions">
<h2>API Functions<a class="headerlink" href="#api-functions" title="Permalink to this heading"></a></h2>
<p>The ptpd library provides C API functions for programmatic control:</p>
<section id="ptpd-start">
<h3>ptpd_start()<a class="headerlink" href="#ptpd-start" title="Permalink to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">ptpd_start</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ptpd_config_s</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>
</pre></div>
</div>
<p>Start PTP daemon with specified configuration.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">config</span></code>: Pointer to configuration structure</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>Does not return on success (runs as daemon)</p></li>
<li><p>Negative errno value on error</p></li>
</ul>
<p><strong>Configuration Structure:</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">ptpd_config_s</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">interface</span><span class="p">;</span><span class="w">  </span><span class="cm">/* Network interface (e.g., &quot;eth0&quot;) */</span>
<span class="w">  </span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">clock</span><span class="p">;</span><span class="w">       </span><span class="cm">/* Clock device (e.g., &quot;ptp0&quot;, &quot;realtime&quot;) */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">client_only</span><span class="p">;</span><span class="w">            </span><span class="cm">/* Client-only mode flag */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">hardware_ts</span><span class="p">;</span><span class="w">            </span><span class="cm">/* Hardware timestamping flag */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">delay_e2e</span><span class="p">;</span><span class="w">              </span><span class="cm">/* E2E delay mechanism flag */</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">bmca</span><span class="p">;</span><span class="w">                   </span><span class="cm">/* BMCA enable flag */</span>
<span class="w">  </span><span class="n">sa_family_t</span><span class="w"> </span><span class="n">af</span><span class="p">;</span><span class="w">              </span><span class="cm">/* Address family (AF_INET, AF_INET6, AF_PACKET) */</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="ptpd-status">
<h3>ptpd_status()<a class="headerlink" href="#ptpd-status" title="Permalink to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">ptpd_status</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">FAR</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ptpd_status_s</span><span class="w"> </span><span class="o">*</span><span class="n">status</span><span class="p">);</span>
</pre></div>
</div>
<p>Query status of running PTP daemon.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pid</span></code>: Process ID of ptpd daemon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code>: Pointer to status structure to fill</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code> on success</p></li>
<li><p>Negative errno value on error</p></li>
</ul>
</section>
<section id="ptpd-stop">
<h3>ptpd_stop()<a class="headerlink" href="#ptpd-stop" title="Permalink to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">ptpd_stop</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
</pre></div>
</div>
<p>Stop running PTP daemon.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pid</span></code>: Process ID of ptpd daemon to stop</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code> on success</p></li>
<li><p>Negative errno value on error</p></li>
</ul>
</section>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<section id="synchronization-algorithm">
<h3>Synchronization Algorithm<a class="headerlink" href="#synchronization-algorithm" title="Permalink to this heading"></a></h3>
<p>The PTP daemon uses a multi-stage synchronization approach:</p>
<ol class="arabic simple">
<li><p><strong>Clock Selection (BMCA)</strong></p>
<ul class="simple">
<li><p>Evaluates Announce messages from all masters</p></li>
<li><p>Selects best clock source based on priority, class, accuracy</p></li>
<li><p>Switches sources if current master times out</p></li>
</ul>
</li>
<li><p><strong>Offset Measurement</strong></p>
<ul class="simple">
<li><p>Measures clock offset using Sync and Follow-Up messages</p></li>
<li><p>Compensates for network path delay using Delay_Req/Delay_Resp</p></li>
<li><p>Averages measurements to reduce jitter</p></li>
</ul>
</li>
<li><p><strong>Clock Adjustment</strong></p>
<ul class="simple">
<li><p>Small offsets (&lt;1ms): uses <code class="docutils literal notranslate"><span class="pre">adjtime()</span></code> for smooth slewing</p></li>
<li><p>Large offsets (&gt;1ms): uses <code class="docutils literal notranslate"><span class="pre">settimeofday()</span></code> for immediate step</p></li>
<li><p>Tracks clock drift rate and applies frequency compensation</p></li>
</ul>
</li>
<li><p><strong>Path Delay Measurement</strong></p>
<ul class="simple">
<li><p>Continuously measures round-trip network delay</p></li>
<li><p>Averages over configurable sample count</p></li>
<li><p>Detects and rejects outliers (&gt;MAX_PATH_DELAY)</p></li>
</ul>
</li>
</ol>
</section>
<section id="hardware-timestamping">
<h3>Hardware Timestamping<a class="headerlink" href="#hardware-timestamping" title="Permalink to this heading"></a></h3>
<p>When hardware timestamping is enabled (<code class="docutils literal notranslate"><span class="pre">-H</span></code> option):</p>
<ul class="simple">
<li><p>TX timestamps captured at MAC layer on packet transmission</p></li>
<li><p>RX timestamps captured at MAC layer on packet reception</p></li>
<li><p>Eliminates kernel and network stack processing delays</p></li>
<li><p>Achieves sub-microsecond synchronization accuracy</p></li>
</ul>
<p>Requires network driver support for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SO_TIMESTAMPNS</span></code> socket option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MSG_TRUNC</span></code> flag in <code class="docutils literal notranslate"><span class="pre">recvmsg()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCM_TIMESTAMPNS</span></code> control message</p></li>
</ul>
</section>
<section id="ptp-clock-device-support">
<h3>PTP Clock Device Support<a class="headerlink" href="#ptp-clock-device-support" title="Permalink to this heading"></a></h3>
<p>When using PTP clock devices (<code class="docutils literal notranslate"><span class="pre">/dev/ptp*</span></code>):</p>
<ul class="simple">
<li><p>Synchronizes hardware PTP clock instead of system clock</p></li>
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">clock_adjtime()</span></code> via CLOCKFD mechanism</p></li>
<li><p>Supports frequency and phase adjustments</p></li>
<li><p>Maintains separation between system and PTP time domains</p></li>
</ul>
<p>Requires kernel support for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_PTP_CLOCK</span></code> in NuttX kernel</p></li>
<li><p>PTP clock driver implementation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_CLOCK_ADJTIME</span></code> system call</p></li>
</ul>
</section>
<section id="transport-modes">
<h3>Transport Modes<a class="headerlink" href="#transport-modes" title="Permalink to this heading"></a></h3>
<p><strong>UDP IPv4 (default)</strong></p>
<ul class="simple">
<li><p>Multicast address: 224.0.1.129</p></li>
<li><p>Event port: 319, General port: 320</p></li>
<li><p>Firewall-friendly, router-compatible</p></li>
</ul>
<p><strong>UDP IPv6</strong></p>
<ul class="simple">
<li><p>Multicast address: FF0E::181</p></li>
<li><p>Same port numbers as IPv4</p></li>
<li><p>IPv6-only network support</p></li>
</ul>
<p><strong>IEEE 802.3 Ethernet</strong></p>
<ul class="simple">
<li><p>Multicast MAC: 01:1B:19:00:00:00 (PTP) or 01:80:C2:00:00:0E (gPTP)</p></li>
<li><p>EtherType: 0x88F7</p></li>
<li><p>No IP/UDP overhead</p></li>
<li><p>Required for gPTP compliance</p></li>
</ul>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permalink to this heading"></a></h2>
<section id="synchronization-accuracy">
<h3>Synchronization Accuracy<a class="headerlink" href="#synchronization-accuracy" title="Permalink to this heading"></a></h3>
<p>Typical accuracy achievable:</p>
<ul class="simple">
<li><p><strong>Software timestamps</strong>: 10-100 μs</p></li>
<li><p><strong>Hardware timestamps</strong>: 100-500 ns</p></li>
<li><p><strong>With PTP clock device</strong>: 50-200 ns</p></li>
</ul>
<p>Factors affecting accuracy:</p>
<ul class="simple">
<li><p>Network jitter and asymmetry</p></li>
<li><p>Interrupt latency</p></li>
<li><p>Clock crystal quality</p></li>
<li><p>Temperature variations</p></li>
</ul>
</section>
<section id="cpu-and-memory-usage">
<h3>CPU and Memory Usage<a class="headerlink" href="#cpu-and-memory-usage" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>CPU overhead</strong>: ~1-3% on ARM Cortex-M4 &#64; 168MHz</p></li>
<li><p><strong>Memory footprint</strong>: ~45KB code, ~8KB RAM</p></li>
<li><p><strong>Network bandwidth</strong>: ~10-20 packets/second (typical)</p></li>
</ul>
</section>
<section id="network-requirements">
<h3>Network Requirements<a class="headerlink" href="#network-requirements" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Multicast support</strong>: Required for PTP operation</p></li>
<li><p><strong>IGMP</strong>: Must be enabled for IPv4 multicast</p></li>
<li><p><strong>Switch compatibility</strong>: PTP-aware switches recommended for best results</p></li>
<li><p><strong>Bandwidth</strong>: Minimal (&lt;100 Kbps)</p></li>
</ul>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h2>
<section id="common-issues">
<h3>Common Issues<a class="headerlink" href="#common-issues" title="Permalink to this heading"></a></h3>
<p><strong>No synchronization occurring</strong></p>
<ul class="simple">
<li><p>Check network interface is up and has IP address</p></li>
<li><p>Verify multicast routing is enabled</p></li>
<li><p>Ensure firewall allows UDP ports 319/320</p></li>
<li><p>Check PTP master is on same network/VLAN</p></li>
</ul>
<p><strong>Large clock offsets</strong></p>
<ul class="simple">
<li><p>Verify network path delay is reasonable (&lt;100μs typical)</p></li>
<li><p>Check for asymmetric network delays</p></li>
<li><p>Enable hardware timestamping if available</p></li>
<li><p>Review BMCA priority settings</p></li>
</ul>
<p><strong>Frequent master switches</strong></p>
<ul class="simple">
<li><p>Increase <code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_TIMEOUT_MS</span></code></p></li>
<li><p>Check network stability and packet loss</p></li>
<li><p>Verify all masters have unique clock identities</p></li>
</ul>
<p><strong>High CPU usage</strong></p>
<ul class="simple">
<li><p>Increase sync interval (<code class="docutils literal notranslate"><span class="pre">CONFIG_NETUTILS_PTPD_SYNC_INTERVAL_MSEC</span></code>)</p></li>
<li><p>Use hardware timestamping to reduce processing</p></li>
<li><p>Check for excessive packet errors/retries</p></li>
</ul>
</section>
<section id="debug-output">
<h3>Debug Output<a class="headerlink" href="#debug-output" title="Permalink to this heading"></a></h3>
<p>Enable PTP debug messages in kernel configuration:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_PTP_ERROR</span></code>: Error messages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_PTP_WARN</span></code>: Warning messages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_PTP_INFO</span></code>: Informational messages</p></li>
</ul>
<p>Monitor debug output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; dmesg | grep PTP</span>
</pre></div>
</div>
</section>
</section>
<section id="related-documentation">
<h2>Related Documentation<a class="headerlink" href="#related-documentation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../../components/drivers/special/ptp.html"><span class="doc">PTP Clock Driver Framework</span></a> - PTP Clock Driver Framework</p></li>
<li><p><a class="reference internal" href="../../netutils/index.html"><span class="doc">Network Utilities</span></a> - Network Utilities Overview</p></li>
<li><p>IEEE 1588-2008 Standard - Precision Time Protocol specification</p></li>
<li><p>IEEE 802.1AS Standard - Timing and Synchronization for Time-Sensitive Applications (gPTP)</p></li>
</ul>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>IEEE 1588-2008: “IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems”</p></li>
<li><p>IEEE 802.1AS-2020: “IEEE Standard for Local and Metropolitan Area Networks - Timing and Synchronization for Time-Sensitive Applications”</p></li>
<li><p>Linux PTP Project: <a class="reference external" href="https://linuxptp.sourceforge.net/">https://linuxptp.sourceforge.net/</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apps/netutils/ptpd/</span></code> - PTP protocol implementation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apps/system/ptpd/</span></code> - PTP daemon command interface</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include/netutils/ptpd.h</span></code> - PTP API header</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../psmq/index.html" class="btn btn-neutral float-left" title="psmq Publish Subscribe Message Queue" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../readline/index.html" class="btn btn-neutral float-right" title="readline readline() Support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>