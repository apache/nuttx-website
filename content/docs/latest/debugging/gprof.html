<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GNU gprof Profiling Tool &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
      <script src="../_static/doctools.js"></script>
      <script src="../_static/sphinx_highlight.js"></script>
      <script src="../_static/clipboard.min.js"></script>
      <script src="../_static/copybutton.js"></script>
      <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Core Dump" href="coredump.html" />
    <link rel="prev" title="The Kernel Address Sanitizer (KASAN)" href="kasan.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../latest" selected="selected">latest</option>
    
    <option value="../../10.0.0" >10.0.0</option>
    
    <option value="../../10.0.1" >10.0.1</option>
    
    <option value="../../10.1.0" >10.1.0</option>
    
    <option value="../../10.2.0" >10.2.0</option>
    
    <option value="../../10.3.0" >10.3.0</option>
    
    <option value="../../11.0.0" >11.0.0</option>
    
    <option value="../../12.0.0" >12.0.0</option>
    
    <option value="../../12.1.0" >12.1.0</option>
    
    <option value="../../12.2.0" >12.2.0</option>
    
    <option value="../../12.2.1" >12.2.1</option>
    
    <option value="../../12.3.0" >12.3.0</option>
    
    <option value="../../12.4.0" >12.4.0</option>
    
    <option value="../../12.5.0" >12.5.0</option>
    
    <option value="../../12.5.1" >12.5.1</option>
    
    <option value="../../12.6.0" >12.6.0</option>
    
    <option value="../../12.7.0" >12.7.0</option>
    
    <option value="../../12.8.0" >12.8.0</option>
    
    <option value="../../12.9.0" >12.9.0</option>
    
    <option value="../../12.10.0" >12.10.0</option>
    
    <option value="../../12.11.0" >12.11.0</option>
    
    <option value="../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Debugging</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gdbwithpython.html">GDB with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="qemugdb.html">How to debug NuttX using QEMU and GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="gdbserver.html">gdbserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_elf_loadable_modules.html">Debugging ELF Loadable Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasktrace.html">Task Trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="kasan.html">The Kernel Address Sanitizer (KASAN)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">GNU gprof Profiling Tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#required-configuration-options">Required Configuration Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-configuration">Optional Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-details">Configuration Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage">Basic Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-coremark-performance-analysis">Example: CoreMark Performance Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-call-graph-analysis">Example: Call Graph Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profiling-individual-modules">Profiling Individual Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recovering-data-from-serial-console">Recovering Data from Serial Console</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#real-board-examples">Real Board Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#qemu-aarch64-example">QEMU aarch64 Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#esp32-s3-example-with-ymodem-transfer">ESP32-S3 Example with Ymodem Transfer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#important-notes">Important Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coredump.html">Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="coresight.html">Coresight - HW Assisted Tracing on ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="stackcheck.html">Stack Overflow Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="stackrecord.html">Run time stack statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="disabling_stackdumpdebug.html">Disabling the Stack Dump During Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="debuggingflash_nuttxonarm.html">Debugging / flashing NuttX on ARM with hardware debugger (JTAG/SWD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cortexmhardfaults.html">Analyzing Cortex-M Hardfaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="mte.html">ATM64 MTE extension</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Debugging</a></li>
      <li class="breadcrumb-item active">GNU gprof Profiling Tool</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/debugging/gprof.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gnu-gprof-profiling-tool">
<h1>GNU gprof Profiling Tool<a class="headerlink" href="#gnu-gprof-profiling-tool" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>gprof is a performance profiling tool that helps developers analyze runtime performance,
identify performance hotspots, and understand function call relationships in their programs.
NuttX integrates gprof support through sampling and function call tracing to generate
detailed performance analysis reports.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<p>gprof provides the following key capabilities:</p>
<ol class="arabic simple">
<li><p><strong>Flat Profile</strong>: Displays execution time distribution across functions</p></li>
<li><p><strong>Call Graph</strong>: Shows call relationships and time distribution between functions</p></li>
<li><p><strong>Function Statistics</strong>: Provides detailed metrics including call counts, cumulative time, and self time</p></li>
</ol>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<section id="required-configuration-options">
<h3>Required Configuration Options<a class="headerlink" href="#required-configuration-options" title="Permalink to this heading"></a></h3>
<p>To enable gprof functionality, add the following options to your kernel configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_FRAME_POINTER=y
CONFIG_PROFILE_MINI=y
CONFIG_SYSTEM_GPROF=y
</pre></div>
</div>
</section>
<section id="optional-configuration">
<h3>Optional Configuration<a class="headerlink" href="#optional-configuration" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_PROFILE_ALL=y</span></code>: Enables full profiling with call graph information</p></li>
</ul>
</section>
<section id="configuration-details">
<h3>Configuration Details<a class="headerlink" href="#configuration-details" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_FRAME_POINTER</span></code>: Enables frame pointer for stack unwinding</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_PROFILE_MINI</span></code>: Enables lightweight profiling based on timer sampling, recording only function execution time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SYSTEM_GPROF</span></code>: Enables the gprof command-line tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_PROFILE_ALL</span></code>: Enables complete function call graph analysis (optional, increases performance overhead). Records function call relationships. If you only need call graph analysis for specific modules, you can skip this option and instead add the <code class="docutils literal notranslate"><span class="pre">-pg</span></code> compiler flag to the module’s Makefile or CMakeLists.txt</p></li>
</ul>
</section>
</section>
<section id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this heading"></a></h2>
<section id="example-coremark-performance-analysis">
<h3>Example: CoreMark Performance Analysis<a class="headerlink" href="#example-coremark-performance-analysis" title="Permalink to this heading"></a></h3>
<p>The following demonstrates profiling the CoreMark benchmark test.</p>
<p><strong>Step 1: Configure and Build</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./tools/configure.sh qemu-armv7a/nsh
$ make -j
$ qemu-system-arm -cpu cortex-a7 -nographic \
 -machine virt,virtualization=off,gic-version=2 \
 -net none -chardev stdio,id=con,mux=on -serial chardev:con \
 -mon chardev=con,mode=readline -kernel ./nuttx -s | tee gprof.log
</pre></div>
</div>
<p><strong>Step 2: Run Profiling</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; gprof start
nsh&gt; coremark
nsh&gt; gprof stop
nsh&gt; gprof dump /tmp/gmon.out
nsh&gt; hexdump /tmp/gmon.out
</pre></div>
</div>
<p><strong>Step 3: Analyze on Host</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ grep -E &quot;^[0-9a-f]+:&quot; gprof.log | xxd -r &gt; gmon.out
$ arm-none-eabi-gprof nuttx gmon.out -b

Flat profile:

Each sample counts as 0.001 seconds.
  %   cumulative   self              self     total
 time   seconds   seconds    calls  Ts/call  Ts/call  name
 41.90     16.93    16.93                             up_idle
 20.61     25.26     8.33                             core_state_transition
  5.21     27.36     2.11                             core_list_find
  4.61     29.22     1.86                             core_list_reverse
  4.49     31.04     1.81                             core_bench_list
  3.64     34.18     1.47                             matrix_mul_matrix
  3.16     35.46     1.28                             coremark_crcu8
  ...
</pre></div>
</div>
<p><strong>Interpreting the Results:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">up_idle</span></code> accounts for 41.90% of execution time, indicating the system spends most time in idle state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">core_state_transition</span></code> consumes 20.61%, representing the most time-intensive function in CoreMark</p></li>
<li><p>Other performance hotspots include list operations (<code class="docutils literal notranslate"><span class="pre">core_list_find</span></code>, <code class="docutils literal notranslate"><span class="pre">core_list_reverse</span></code>) and matrix operations (<code class="docutils literal notranslate"><span class="pre">matrix_mul_matrix</span></code>)</p></li>
</ul>
</section>
<section id="example-call-graph-analysis">
<h3>Example: Call Graph Analysis<a class="headerlink" href="#example-call-graph-analysis" title="Permalink to this heading"></a></h3>
<p>The following demonstrates call graph analysis with <code class="docutils literal notranslate"><span class="pre">CONFIG_PROFILE_ALL</span></code> enabled.</p>
<p><strong>Step 1: Configure and Build</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./tools/configure.sh mps2-an500/nsh
$ make -j
$ qemu-system-arm -M mps2-an500 -cpu cortex-m7 -nographic -kernel ./nuttx -s | tee gprof.log
</pre></div>
</div>
<p><strong>Step 2: Run Profiling</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; gprof start
nsh&gt; sleep 1
nsh&gt; gprof stop
nsh&gt; gprof dump /tmp/gmon.out
nsh&gt; hexdump /tmp/gmon.out
</pre></div>
</div>
<p><strong>Step 3: Analyze on Host</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ grep -E &quot;^[0-9a-f]+:&quot; gprof.log | xxd -r &gt; gmon.out
$ arm-none-eabi-gprof nuttx/nuttx gmon.out -b
Call graph

granularity: each sample hit covers 4 byte(s) for 0.10% of 1.00 seconds

index % time    self  children    called     name
-----------------------------------------------
                0.00    0.00    2066/2066        irq_dispatch [9]
[5]      0.0    0.00    0.00    2066         perf_gettime [5]
                0.00    0.00    2066/2066        up_perf_gettime [6]
-----------------------------------------------
                0.00    0.00    2066/2066        perf_gettime [5]
[6]      0.0    0.00    0.00    2066         up_perf_gettime [6]
-----------------------------------------------
                0.00    0.00    1007/2017        systick_interrupt [21]
                0.00    0.00    1010/2017        systick_getstatus [13]
[7]      0.0    0.00    0.00    2017         systick_is_running [7]
-----------------------------------------------
</pre></div>
</div>
<p><strong>Interpreting the Call Graph:</strong></p>
<p>The example above shows the complete call chain:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>irq_dispatch [9]
  └─&gt; perf_gettime [5]
        └─&gt; up_perf_gettime [6]
</pre></div>
</div>
<p>For detailed call graph output interpretation, refer to the gprof manual: <a class="reference external" href="https://sourceware.org/binutils/docs/gprof/Call-Graph.html">https://sourceware.org/binutils/docs/gprof/Call-Graph.html</a></p>
</section>
<section id="profiling-individual-modules">
<h3>Profiling Individual Modules<a class="headerlink" href="#profiling-individual-modules" title="Permalink to this heading"></a></h3>
<p>If you prefer not to enable <code class="docutils literal notranslate"><span class="pre">CONFIG_PROFILE_ALL</span></code> system-wide (to reduce performance overhead),
you can profile specific modules by adding the <code class="docutils literal notranslate"><span class="pre">-pg</span></code> compiler flag to the module’s build configuration.</p>
<p><strong>Adding -pg to Makefile</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Enable -pg for the entire directory
CFLAGS += -pg
</pre></div>
</div>
<p><strong>Adding -pg to CMakeLists.txt</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>target_compile_options(mymodule PRIVATE -pg)
</pre></div>
</div>
<p>This approach allows precise profiling of critical modules while maintaining overall system performance.</p>
</section>
<section id="recovering-data-from-serial-console">
<h3>Recovering Data from Serial Console<a class="headerlink" href="#recovering-data-from-serial-console" title="Permalink to this heading"></a></h3>
<p>If you cannot directly export files from the device, you can recover the data through
serial console xxd output and reconstruct it on the host:</p>
<p><strong>Step 1: Display hexadecimal data on device</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; hexdump /tmp/gmon.out
</pre></div>
</div>
<p><strong>Step 2:</strong> Save the serial console output to a log file (e.g., <code class="docutils literal notranslate"><span class="pre">gprof.log</span></code>)</p>
<p><strong>Step 3: Convert xxd output to binary using xxd -r</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ grep -E &quot;^[0-9a-f]+:&quot; gprof.log | xxd -r &gt; gmon.out
</pre></div>
</div>
<p><strong>Step 4: Analyze the converted file with gprof</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arm-none-eabi-gprof nuttx/nuttx gmon.out -b
</pre></div>
</div>
</section>
</section>
<section id="real-board-examples">
<h2>Real Board Examples<a class="headerlink" href="#real-board-examples" title="Permalink to this heading"></a></h2>
<section id="qemu-aarch64-example">
<h3>QEMU aarch64 Example<a class="headerlink" href="#qemu-aarch64-example" title="Permalink to this heading"></a></h3>
<p>This example uses <strong>QEMU</strong> and <strong>aarch64-none-elf-gcc</strong> with the <strong>qemu-armv8a</strong> board.</p>
<p><strong>Step 1: Configure and Build</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./tools/configure.sh -E qemu-armv8a:nsh
# Ensure CONFIG_SYSTEM_GPROF and CONFIG_PROFILE_MINI are enabled
$ make -j
</pre></div>
</div>
<p><strong>Step 2: Launch QEMU</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ qemu-system-aarch64 -cpu cortex-a53 -smp 4 -nographic \
  -machine virt,virtualization=on,gic-version=3 \
  -chardev stdio,id=con,mux=on -serial chardev:con \
  -mon chardev=con,mode=readline -semihosting -kernel ./nuttx
</pre></div>
</div>
<p><strong>Step 3: Mount hostfs for saving data</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t hostfs -o fs=. /mnt
</pre></div>
</div>
<p><strong>Step 4: Run profiling</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; gprof start
# Do some test here
nsh&gt; gprof stop
nsh&gt; gprof dump /mnt/gmon.out
</pre></div>
</div>
<p><strong>Step 5: Analyze on host</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aarch64-none-elf-gprof nuttx gmon.out -b
</pre></div>
</div>
</section>
<section id="esp32-s3-example-with-ymodem-transfer">
<h3>ESP32-S3 Example with Ymodem Transfer<a class="headerlink" href="#esp32-s3-example-with-ymodem-transfer" title="Permalink to this heading"></a></h3>
<p>This example demonstrates profiling on <strong>esp32s3-devkit</strong> with data transfer via Ymodem.</p>
<p><strong>Step 1: Configure and Build</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./tools/configure.sh -E esp32s3-devkit:nsh
# Enable the following options:
# CONFIG_PROFILE_MINI=y
# CONFIG_SYSTEM_GPROF=y
# CONFIG_FS_TMPFS=y
# CONFIG_SYSTEM_YMODEM=y
$ make flash ESPTOOL_PORT=/dev/ttyUSB0 -j
</pre></div>
</div>
<p><strong>Step 2: Connect to board</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ minicom -D /dev/ttyUSB0 -b 115200
</pre></div>
</div>
<p><strong>Step 3: Run profiling on device</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; gprof start
# Do some test here, such as ostest
nsh&gt; gprof stop
nsh&gt; gprof dump /tmp/gmon.out
nsh&gt; sb /tmp/gmon.out
</pre></div>
</div>
<p><strong>Step 4: Receive file and analyze on host</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Receive file via Ymodem in minicom, then:
$ cp nuttx nuttx_prof
$ xtensa-esp32s3-elf-objcopy -I elf32-xtensa-le --rename-section .flash.text=.text nuttx_prof
$ xtensa-esp32s3-elf-gprof nuttx_prof gmon.out
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Xtensa targets, the <code class="docutils literal notranslate"><span class="pre">objcopy</span> <span class="pre">--rename-section</span></code> step is required
because the text section has a different name (<code class="docutils literal notranslate"><span class="pre">.flash.text</span></code>).</p>
</div>
</section>
</section>
<section id="important-notes">
<h2>Important Notes<a class="headerlink" href="#important-notes" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_PROFILE_ALL</span></code> significantly increases performance overhead and memory usage. Enable only when call graph analysis is required.</p></li>
<li><p>For simulator environments, use <code class="docutils literal notranslate"><span class="pre">CONFIG_SIM_PROFILE</span></code> to enable gprof functionality.</p></li>
<li><p>On ARM Cortex-M v6/v7/v8, the Flat Profile functionality has limitations and requires modification of <code class="docutils literal notranslate"><span class="pre">_vectors</span></code> to capture the thread PC pointer during interrupts.</p></li>
</ul>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>GNU gprof Manual: <a class="reference external" href="https://sourceware.org/binutils/docs/gprof/">https://sourceware.org/binutils/docs/gprof/</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="kasan.html" class="btn btn-neutral float-left" title="The Kernel Address Sanitizer (KASAN)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="coredump.html" class="btn btn-neutral float-right" title="Core Dump" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>