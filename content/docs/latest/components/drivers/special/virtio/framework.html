<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VirtIO Framework &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
      <script src="../../../../_static/jquery.js"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
      <script src="../../../../_static/doctools.js"></script>
      <script src="../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../_static/clipboard.min.js"></script>
      <script src="../../../../_static/copybutton.js"></script>
      <script src="../../../../_static/design-tabs.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Video Device Drivers" href="../video.html" />
    <link rel="prev" title="VirtIO" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../../12.11.0" >12.11.0</option>
    
    <option value="../../../../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">OS Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../binfmt.html">Binary Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concurrency/index.html">Concurrency</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Device Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../character/index.html">Character Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../block/index.html">Block Device Drivers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Specialized Device Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../audio.html">Audio Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../clk.html">Clock management (CLK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devicetree.html">Device Tree support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devmem.html">DEVMEM Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dma.html">DMA Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../framebuffer.html">Frame Buffer Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html">I2C Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html#i2c-bit-bang-driver">I2C Bit-Bang Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html#i2c-slave-device-drivers">I2C Slave Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i3c.html">I3C Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ioexpander.html">IO Expander Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../lcd.html">LCD Character Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mtd/index.html">Memory Technology Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../regmap.html">drivers/regmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reset.html">Reset Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rpmsg/index.html">RPMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rptun/index.html">RPTUN (Remoteproc Tunnel)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rwbuffer.html"><code class="docutils literal notranslate"><span class="pre">rwbuffer.c</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../sensors.html">Sensor Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../segger.html">Segger RTT drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../spi.html">SPI Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../syslog.html">SYSLOG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sdio.html">SDIO Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbdev.html">USB Device-Side Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbhost.html">USB Host-Side Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbmisc.html">USB Miscellaneous Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbmonitor.html">USB Monitor support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usrsock.html">Usrsock Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmcsd.html">MMCSD Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../net/index.html">Network interface drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pci/index.html">PCI(e) Bus Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pinctrl.html">Pinctrl Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipes.html">FIFO and named pipe drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../power/index.html">Power-related Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ptp.html">PTP Clock Driver Framework</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">VirtIO</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">VirtIO Framework</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../video.html">Video Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../wireless.html">Wireless Drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../thermal/index.html">Thermal Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#lower-half-and-upper-half">Lower-half and upper-half</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#subdirectories-of-nuttx-drivers">Subdirectories of <code class="docutils literal notranslate"><span class="pre">nuttx/drivers</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#skeleton-files">Skeleton Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#drivers-early-initialization">Drivers Early Initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxflat.html">NXFLAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxgraphics/index.html">NX Graphics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../paging.html">On-Demand Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../audio/index.html">Audio Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../filesystem/index.html">NuttX File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../libs/index.html">NuttX libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../net/index.html">Network Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../syscall.html">Syscall Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/index.html">Host Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arch/index.html">Architecture-Specific Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../boards.html">Boards Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cmake.html">CMake Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openamp.html">OpenAMP Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../video.html">Video Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../crypto.html">Crypto API Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wireless.html">Wireless Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">OS Components</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Specialized Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="index.html">VirtIO</a></li>
      <li class="breadcrumb-item active">VirtIO Framework</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/components/drivers/special/virtio/framework.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="virtio-framework">
<h1>VirtIO Framework<a class="headerlink" href="#virtio-framework" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>NuttX implements a complete VirtIO framework based on OpenAMP. The framework
supports various VirtIO drivers compatible with the VirtIO standard (such as
VirtIO-Net, VirtIO-Block, etc.) at the upper layer, and different VirtIO
transport layer implementations (including VirtIO-MMIO, VirtIO-PCI,
VirtIO-Remoteproc, etc.) at the lower layer.</p>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this heading"></a></h2>
<section id="framework-overview">
<h3>Framework Overview<a class="headerlink" href="#framework-overview" title="Permalink to this heading"></a></h3>
<p>The VirtIO framework consists of three main layers:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+------------------------------------------------------------------+
|                      VirtIO Driver Layer                         |
|  +----------+ +----------+ +----------+ +-----+ +-------------+  |
|  | VirtIO   | | VirtIO   | | VirtIO   | | ... | | VirtIO      |  |
|  | Sock     | | Net      | | Blk      | |     | | Rpmsg       |  |
|  +----------+ +----------+ +----------+ +-----+ +-------------+  |
+------------------------------------------------------------------+
                               |
                               v
+------------------------------------------------------------------+
|                     VirtIO Framework Layer                       |
|                       VirtIO Framework                           |
+------------------------------------------------------------------+
                               |
         +---------------------+---------------------+
         |                     |                     |
         v                     v                     v
+----------------+    +----------------+    +----------------+
|  VirtIO MMIO   |    |  VirtIO PCI    |    |  VirtIO Rptun  |
+----------------+    +----------------+    +----------------+
|  Memory Map    |    | PCI Framework  |    |     Rptun      |
+----------------+    +----------------+    +----------------+
         |            | PCI Controller |    |  Rptun Driver  |
         |            +----------------+    +----------------+
         |                     |                     |                   +----------------------+
         |                     |                     +-----------------&gt; | Remoteproc Processor |
         v                     v                                         +----------------------+
+------------------------------------------------------------------+
|                         Hypervisor                               |
+------------------------------------------------------------------+
</pre></div>
</div>
<p>The framework can be divided into the following three parts:</p>
<ol class="arabic simple">
<li><p><strong>VirtIO Driver Layer</strong>: The driver layer is responsible for interfacing
VirtIO with the NuttX driver framework. The driver layer completes device
initialization and data interaction by calling the unified interfaces
provided by VirtIO.</p></li>
<li><p><strong>VirtIO Framework Layer</strong>: The VirtIO layer provides unified interfaces
for drivers, supporting registration, unregistration, and matching
mechanisms for Drivers and Devices.</p></li>
<li><p><strong>VirtIO Transport Layer</strong>: The transport layer provides support for
different transport methods, including MMIO, RemoteProc, and PCI.</p></li>
</ol>
</section>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Permalink to this heading"></a></h3>
<p>The following describes the matching process and calling relationship between
VirtIO Device and VirtIO Driver:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+------------------------------------------------------------------+
| VirtIO Drivers                                                   |
| +--------+ +--------+ +--------+ +--------+ +--------+ +-------+ |
| |VirtIO  | |VirtIO  | |VirtIO  | |VirtIO  | |VirtIO  | |  ...  | |
| |Net     | |Sock    | |Blk     | |Serial  | |Sound   | |       | |
| +--------+ +--------+ +--------+ +--------+ +--------+ +-------+ |
+------------------------------------------------------------------+
                           |
                           | virtio_register_driver()
                           v
+------------------------------------------------------------------+
|                        VirtIO Bus                                |
+------------------------------------------------------------------+
                           ^
                           | virtio_register_device()
                           |
+------------------------------------------------------------------+
| Transport Layer                                                  |
| +----------------+ +----------------+ +----------------+         |
| | VirtIO-MMIO    | | VirtIO-PCI     | | VirtIO-Rptun   |         |
| | Device Memory  | | PCI Framework  | | Resource Table |         |
| | and IRQ        | | Device in PCI  | |                |         |
| +----------------+ +----------------+ +----------------+         |
+------------------------------------------------------------------+

                           ||
                           || Match Success
                           vv

+------------------------------------------------------------------+
|                    virtio_xxx_probe()                            |
|    Reset, configure, feature negotiation, memory allocation      |
+------------------------------------------------------------------+
                           |
                           | VirtIO API
                           v
+------------------------------------------------------------------+
|              Port to NuttX Various Frameworks                    |
|           Normal Driver/Socket etc operations                    |
+------------------------------------------------------------------+
                           |
                           v
+------------------------------------------------------------------+
|                           VFS                                    |
+------------------------------------------------------------------+
</pre></div>
</div>
<ol class="arabic">
<li><p><strong>Driver Registration</strong>:
During NuttX initialization, <code class="docutils literal notranslate"><span class="pre">virtio_register_drivers()</span></code> is called to
register all supported VirtIO Drivers to the VirtIO bus.</p></li>
<li><p><strong>Device Registration</strong>:
The registration process is initiated by the transport layer:</p>
<ul class="simple">
<li><p>MMIO transport layer calls <code class="docutils literal notranslate"><span class="pre">virtio_register_mmio_device()</span></code></p></li>
<li><p>REMOTEPROC transport layer calls <code class="docutils literal notranslate"><span class="pre">rptun_register_device()</span></code></p></li>
<li><p>PCI transport layer calls <code class="docutils literal notranslate"><span class="pre">virtio_pci_probe()</span></code></p></li>
</ul>
<p>After the transport layer completes initialization, it calls
<code class="docutils literal notranslate"><span class="pre">virtio_register_device()</span></code> to register the VirtIO Device to the VirtIO bus.</p>
</li>
<li><p><strong>Driver and Device Matching</strong>:
When a device is registered to the bus, the system attempts to match Driver
and Device. If the match is successful, the <code class="docutils literal notranslate"><span class="pre">probe</span></code> function implemented
by the Driver is executed. In the <code class="docutils literal notranslate"><span class="pre">probe</span></code> function, the driver initializes,
configures, and performs feature negotiation on the VirtIO Device. Depending
on the complexity and type of the device, it may also need to initialize
private structures or perform additional operations.</p></li>
<li><p><strong>Register NuttX Driver</strong>:
Call the API provided by the NuttX driver framework to register the driver
to the Virtual File System (VFS) for user access.</p></li>
<li><p><strong>Runtime</strong>:
During runtime, the Driver calls the <code class="docutils literal notranslate"><span class="pre">virtqueue</span></code> common interfaces provided
by OpenAMP to exchange data and notifications in VirtIO standard format,
thereby implementing driver functionality.</p></li>
</ol>
</section>
</section>
<section id="source-code">
<h2>Source Code<a class="headerlink" href="#source-code" title="Permalink to this heading"></a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>nuttx/
├── drivers/
│   └── virtio/
│       └── virtio.c       # VirtIO framework core implementation
├── include/
│   └── nuttx/
│       └── virtio/
│           └── virtio.h   # VirtIO header file
└── openamp/
    └── open-amp/          # OpenAMP repository
</pre></div>
</div>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this heading"></a></h2>
<p>This section describes the interfaces that need to be called during VirtIO
driver adaptation.</p>
<section id="nuttx-log-interfaces">
<h3>NuttX Log Interfaces<a class="headerlink" href="#nuttx-log-interfaces" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vrtinfo(...)</span></code></dt><dd><p>INFO level VirtIO system log interface.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vrtwarn(...)</span></code></dt><dd><p>WARNING level VirtIO system log interface.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vrterr(...)</span></code></dt><dd><p>ERROR level VirtIO system log interface.</p>
</dd>
</dl>
</section>
<section id="nuttx-virtio-framework-interface">
<h3>NuttX VirtIO Framework Interface<a class="headerlink" href="#nuttx-virtio-framework-interface" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.virtio_register_driver">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">virtio_register_driver</span></span></span><span class="sig-paren">(</span><span class="pre">FAR</span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtio_driver</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">driver</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.virtio_register_driver" title="Permalink to this definition"></a><br /></dt>
<dd><p>Register a VirtIO Driver to the VirtIO bus. When a corresponding device
already exists in the bus, it will immediately match and call the <code class="docutils literal notranslate"><span class="pre">probe</span></code>
function implemented by the driver. If there is no corresponding device in
the bus, the driver’s <code class="docutils literal notranslate"><span class="pre">probe</span></code> function will be called back after a
corresponding VirtIO device is registered to the VirtIO bus to complete
driver initialization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>driver</strong> – Pointer to the virtio_driver structure</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0 on success, negative errno on failure</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="openamp-interfaces">
<h3>OpenAMP Interfaces<a class="headerlink" href="#openamp-interfaces" title="Permalink to this heading"></a></h3>
<section id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Driver TX virtqueue</strong>:
The driver’s transmit queue. Get a buffer from the <code class="docutils literal notranslate"><span class="pre">used</span> <span class="pre">ring</span></code> of <code class="docutils literal notranslate"><span class="pre">txvq</span></code>,
fill in the data to be sent, and then add it to the <code class="docutils literal notranslate"><span class="pre">avail</span> <span class="pre">ring</span></code> of <code class="docutils literal notranslate"><span class="pre">txvq</span></code>
to complete the data transmission process.</p></li>
<li><p><strong>Driver RX virtqueue</strong>:
The driver’s receive queue. Get a buffer from the <code class="docutils literal notranslate"><span class="pre">used</span> <span class="pre">ring</span></code> of <code class="docutils literal notranslate"><span class="pre">rxvq</span></code>,
read the data from it, and then return it to the <code class="docutils literal notranslate"><span class="pre">avail</span> <span class="pre">ring</span></code> of <code class="docutils literal notranslate"><span class="pre">rxvq</span></code>
to complete the data reception process.</p></li>
</ul>
</section>
<section id="interface-description">
<h4>Interface Description<a class="headerlink" href="#interface-description" title="Permalink to this heading"></a></h4>
<dl class="c function">
<dt class="sig sig-object c" id="c.virtqueue_get_buffer">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">virtqueue_get_buffer</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtqueue</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vq</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">len</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">idx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.virtqueue_get_buffer" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get a buffer from the <code class="docutils literal notranslate"><span class="pre">used</span> <span class="pre">ring</span></code> of virtqueue.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vq</strong> – Pointer to the virtqueue</p></li>
<li><p><strong>len</strong> – Length of the obtained buffer</p></li>
<li><p><strong>idx</strong> – Index of the obtained buffer in the <code class="docutils literal notranslate"><span class="pre">used</span> <span class="pre">ring</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pointer to the buffer, or NULL if no buffer available</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.virtqueue_add_buffer">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">virtqueue_add_buffer</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtqueue</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vq</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtqueue_buf</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf_list</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">readable</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">writable</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cookie</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.virtqueue_add_buffer" title="Permalink to this definition"></a><br /></dt>
<dd><p>Add a buffer to the <code class="docutils literal notranslate"><span class="pre">avail</span> <span class="pre">ring</span></code> of virtqueue.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vq</strong> – Pointer to the virtqueue</p></li>
<li><p><strong>buf_list</strong> – Array of buffers to be added</p></li>
<li><p><strong>readable</strong> – Number of readable buffers in <code class="docutils literal notranslate"><span class="pre">buf_list</span></code>, indicating the
part that the Device should read</p></li>
<li><p><strong>writable</strong> – Number of writable buffers in <code class="docutils literal notranslate"><span class="pre">buf_list</span></code>, indicating the
part that the Device should fill</p></li>
<li><p><strong>cookie</strong> – Cache pointer, this value will be returned when calling
<code class="docutils literal notranslate"><span class="pre">virtqueue_get_buffer</span></code> to get the buffer</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>0 on success, negative errno on failure</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.virtqueue_kick">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">virtqueue_kick</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtqueue</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.virtqueue_kick" title="Permalink to this definition"></a><br /></dt>
<dd><p>Notify the Device. Usually called after sending data to the device side or
returning a buffer to the device side to notify the device that it can
proceed to the next operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vq</strong> – Pointer to the virtqueue</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.virtqueue_enable_cb">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">virtqueue_enable_cb</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtqueue</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.virtqueue_enable_cb" title="Permalink to this definition"></a><br /></dt>
<dd><p>Enable virtqueue interrupt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vq</strong> – Pointer to the virtqueue</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.virtqueue_disable_cb">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">virtqueue_disable_cb</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">virtqueue</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.virtqueue_disable_cb" title="Permalink to this definition"></a><br /></dt>
<dd><p>Disable virtqueue interrupt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vq</strong> – Pointer to the virtqueue</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://ozlabs.org/~rusty/virtio-spec/virtio-paper.pdf">virtio: Towards a De-Facto Standard For Virtual I/O Devices</a></p></li>
<li><p><a class="reference external" href="https://docs.oasis-open.org/virtio/virtio/v1.2/csd01/virtio-v1.2-csd01.pdf">Virtual I/O Device (VIRTIO) Version 1.2</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="VirtIO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../video.html" class="btn btn-neutral float-right" title="Video Device Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>