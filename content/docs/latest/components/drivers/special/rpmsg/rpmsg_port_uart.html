<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RPMsg Port UART &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
      <script src="../../../../_static/jquery.js"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
      <script src="../../../../_static/doctools.js"></script>
      <script src="../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../_static/clipboard.min.js"></script>
      <script src="../../../../_static/copybutton.js"></script>
      <script src="../../../../_static/design-tabs.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="RPMsg Ping" href="rpmsg_ping.html" />
    <link rel="prev" title="RPMsg Port Transport Layer" href="rpmsg_port.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../../12.11.0" >12.11.0</option>
    
    <option value="../../../../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">OS Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../binfmt.html">Binary Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concurrency/index.html">Concurrency</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Device Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../character/index.html">Character Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../block/index.html">Block Device Drivers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Specialized Device Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../audio.html">Audio Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../clk.html">Clock management (CLK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devicetree.html">Device Tree support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devmem.html">DEVMEM Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dma.html">DMA Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../framebuffer.html">Frame Buffer Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html">I2C Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html#i2c-bit-bang-driver">I2C Bit-Bang Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html#i2c-slave-device-drivers">I2C Slave Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i3c.html">I3C Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ioexpander.html">IO Expander Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../lcd.html">LCD Character Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mtd/index.html">Memory Technology Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../regmap.html">drivers/regmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reset.html">Reset Driver</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">RPMsg</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="concepts.html">RPMsg Core Concepts</a></li>
<li class="toctree-l5"><a class="reference internal" href="rpmsg_port.html">RPMsg Port Transport Layer</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">RPMsg Port UART</a></li>
<li class="toctree-l5"><a class="reference internal" href="rpmsg_ping.html">RPMsg Ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="rpmsg_dump.html">RPMsg Dump</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../rptun/index.html">RPTUN (Remoteproc Tunnel)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rwbuffer.html"><code class="docutils literal notranslate"><span class="pre">rwbuffer.c</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../sensors.html">Sensor Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../segger.html">Segger RTT drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../spi.html">SPI Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../syslog.html">SYSLOG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sdio.html">SDIO Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbdev.html">USB Device-Side Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbhost.html">USB Host-Side Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbmisc.html">USB Miscellaneous Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbmonitor.html">USB Monitor support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usrsock.html">Usrsock Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmcsd.html">MMCSD Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../net/index.html">Network interface drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pci/index.html">PCI(e) Bus Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pinctrl.html">Pinctrl Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipes.html">FIFO and named pipe drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../power/index.html">Power-related Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ptp.html">PTP Clock Driver Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vhost/index.html">Vhost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../virtio/index.html">VirtIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../video.html">Video Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../wireless.html">Wireless Drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../thermal/index.html">Thermal Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#lower-half-and-upper-half">Lower-half and upper-half</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#subdirectories-of-nuttx-drivers">Subdirectories of <code class="docutils literal notranslate"><span class="pre">nuttx/drivers</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#skeleton-files">Skeleton Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#drivers-early-initialization">Drivers Early Initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxflat.html">NXFLAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxgraphics/index.html">NX Graphics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../paging.html">On-Demand Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../audio/index.html">Audio Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../filesystem/index.html">NuttX File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../libs/index.html">NuttX libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../net/index.html">Network Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../syscall.html">Syscall Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/index.html">Host Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arch/index.html">Architecture-Specific Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../boards.html">Boards Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cmake.html">CMake Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openamp.html">OpenAMP Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../video.html">Video Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../crypto.html">Crypto API Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wireless.html">Wireless Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">OS Components</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Specialized Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="index.html">RPMsg</a></li>
      <li class="breadcrumb-item active">RPMsg Port UART</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/components/drivers/special/rpmsg/rpmsg_port_uart.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rpmsg-port-uart">
<h1>RPMsg Port UART<a class="headerlink" href="#rpmsg-port-uart" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>RPMsg Port UART is a transport layer implementation that enables RPMsg
communication between two SoCs connected via UART. This is useful when
shared memory is not available between chips, such as two separate chips
on the same PCB.</p>
</section>
<section id="hardware-requirements">
<h2>Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Permalink to this heading"></a></h2>
<p>The UART interface requires four signals with hardware flow control support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>┌─────────────┐               ┌─────────────┐
│   SoC A     │               │   SoC B     │
│             │  TX ────────&gt; │             │
│    UART     │  RX &lt;──────── │    UART     │
│             │ RTS ────────&gt; │             │
│             │ CTS &lt;──────── │             │
└─────────────┘               └─────────────┘
</pre></div>
</div>
<p>Requirements:</p>
<ul class="simple">
<li><p>Hardware flow control (RTS/CTS) must be supported to prevent data loss</p></li>
<li><p>RX pin should support wake-up for low power mode</p></li>
<li><p>Data corruption during wake-up is not allowed, but data loss is acceptable
(handled by software)</p></li>
</ul>
</section>
<section id="software-architecture">
<h2>Software Architecture<a class="headerlink" href="#software-architecture" title="Permalink to this heading"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>┌────────────────────────────────────────┐
│           RPMsg Framework              │
├────────────────────────────────────────┤
│              RPMsg Port                │
│   (Buffer Management, Name Service)    │
├────────────────────────────────────────┤
│           RPMsg Port UART              │
│   (Escape Coding, Connection Protocol, │
│   Data Transfer, Low Power Support)    │
├────────────────────────────────────────┤
│           UART Driver                  │
└────────────────────────────────────────┘
</pre></div>
</div>
</section>
<section id="protocol-details">
<h2>Protocol Details<a class="headerlink" href="#protocol-details" title="Permalink to this heading"></a></h2>
<section id="escape-coding">
<h3>Escape Coding<a class="headerlink" href="#escape-coding" title="Permalink to this heading"></a></h3>
<p>Special characters (0x70-0x7f) are used to distinguish commands from data:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define RPMSG_PORT_UART_START      0x7f  </span><span class="cm">/* Frame start */</span>
<span class="cp">#define RPMSG_PORT_UART_END        0x70  </span><span class="cm">/* Frame end */</span>
<span class="cp">#define RPMSG_PORT_UART_ESCAPE     0x7c  </span><span class="cm">/* Escape character */</span>
<span class="cp">#define RPMSG_PORT_UART_CONNREQ    0x7e  </span><span class="cm">/* Connection request */</span>
<span class="cp">#define RPMSG_PORT_UART_CONNACK    0x7d  </span><span class="cm">/* Connection acknowledge */</span>
<span class="cp">#define RPMSG_PORT_UART_ESCAPE_MASK 0x20 </span><span class="cm">/* Escape XOR mask */</span>
</pre></div>
</div>
<p>Encoding example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Original:  [0x01, 0x7f, 0x02, 0x70, 0x03]
Encoded:   [START] [0x01] [ESC] [0x5f] [0x02] [ESC] [0x50] [0x03] [END]
           [0x7f]  [0x01] [0x7c][0x5f] [0x02] [0x7c][0x50] [0x03] [0x70]
</pre></div>
</div>
<p>When a byte falls in the 0x70-0x7f range, it is escaped by sending the
ESCAPE character followed by the original byte XORed with 0x20.</p>
</section>
<section id="connection-protocol">
<h3>Connection Protocol<a class="headerlink" href="#connection-protocol" title="Permalink to this heading"></a></h3>
<p>The connection protocol supports:</p>
<ul class="simple">
<li><p>Either side can start first during system boot</p></li>
<li><p>Reconnection after either side restarts</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Normal startup:
┌────────┐                      ┌────────┐
│ CPU A  │                      │ CPU B  │
└────────┘                      └────────┘
    │                               │
    │ ──── CONNREQ (0x7e) ────────&gt; │
    │                               │ Initialize resources
    │ &lt;──── CONNACK (0x7d) ──────── │
    │ Initialize resources          │
    │                               │
    │      Connection established   │

Restart scenario (CPU B restarts):
┌────────┐                      ┌────────┐
│ CPU A  │                      │ CPU B  │
│(running)│                     │(restart)│
└────────┘                      └────────┘
    │                               │
    │ &lt;──── CONNREQ (0x7e) ──────── │
    │ Reinitialize resources        │
    │ ──── CONNACK (0x7d) ────────&gt; │
    │                               │ Initialize resources
    │      Connection established   │
</pre></div>
</div>
</section>
<section id="data-frame-format">
<h3>Data Frame Format<a class="headerlink" href="#data-frame-format" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>┌───────┬─────────────────────────────────┬───────┐
│ START │   Header + Payload (escaped)    │  END  │
│ 0x7f  │                                 │ 0x70  │
└───────┴─────────────────────────────────┴───────┘

Header structure (rpmsg_port_header_s):
┌────────┬────────┬────────┬────────┬──────────────┐
│  crc   │  cmd   │ avail  │  len   │   payload    │
│ 2 byte │ 2 byte │ 2 byte │ 2 byte │   N bytes    │
└────────┴────────┴────────┴────────┴──────────────┘
</pre></div>
</div>
<ul class="simple">
<li><p>crc: CRC16 checksum (optional, enabled via CONFIG_RPMSG_PORT_UART_CRC)</p></li>
<li><p>cmd: Command field (unused for data frames, set to 0)</p></li>
<li><p>avail: Available space (unused for data frames, set to 0)</p></li>
<li><p>len: Total length including header</p></li>
<li><p>payload: Actual RPMsg data</p></li>
</ul>
</section>
</section>
<section id="low-power-support">
<h2>Low Power Support<a class="headerlink" href="#low-power-support" title="Permalink to this heading"></a></h2>
<p>RPMsg Port UART implements low power support without additional GPIOs using
special wake/sleep commands:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define RPMSG_PORT_UART_STAYWAKE1     0x79  </span><span class="cm">/* Wake request 1 */</span>
<span class="cp">#define RPMSG_PORT_UART_STAYWAKEACK1  0x78  </span><span class="cm">/* Wake acknowledge 1 */</span>
<span class="cp">#define RPMSG_PORT_UART_STAYWAKE2     0x75  </span><span class="cm">/* Wake request 2 */</span>
<span class="cp">#define RPMSG_PORT_UART_STAYWAKEACK2  0x74  </span><span class="cm">/* Wake acknowledge 2 */</span>
<span class="cp">#define RPMSG_PORT_UART_RELAXWAKE     0x77  </span><span class="cm">/* Allow sleep */</span>
</pre></div>
</div>
<section id="wake-sleep-flow">
<h3>Wake/Sleep Flow<a class="headerlink" href="#wake-sleep-flow" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>┌────────┐                           ┌────────┐
│ CPU A  │                           │ CPU B  │
│(sender)│                           │(asleep)│
└────────┘                           └────────┘
    │                                    │
    │ Acquire TX PM lock                 │
    │ ──── STAYWAKE1 ──────────────────&gt; │
    │                                    │ Acquire RX PM lock
    │ &lt;──── STAYWAKEACK1 ─────────────── │
    │                                    │
    │ ════ Data Transfer ══════════════&gt; │
    │                                    │
    │ ──── RELAXWAKE ──────────────────&gt; │
    │ Release TX PM lock                 │ Release RX PM lock
    │                                    │
</pre></div>
</div>
</section>
<section id="ping-pong-wake-mechanism">
<h3>Ping-Pong Wake Mechanism<a class="headerlink" href="#ping-pong-wake-mechanism" title="Permalink to this heading"></a></h3>
<p>Two sets of wake commands (STAYWAKE1/ACK1 and STAYWAKE2/ACK2) are used
alternately to prevent false wake acknowledgments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>First transfer:  STAYWAKE1 → STAYWAKEACK1 → Data → RELAXWAKE
Second transfer: STAYWAKE2 → STAYWAKEACK2 → Data → RELAXWAKE
Third transfer:  STAYWAKE1 → STAYWAKEACK1 → Data → RELAXWAKE
...
</pre></div>
</div>
<p>This prevents the sender from mistakenly accepting a delayed ACK from a
previous transfer as confirmation for the current transfer.</p>
</section>
</section>
<section id="source-files">
<h2>Source Files<a class="headerlink" href="#source-files" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nuttx/drivers/rpmsg/rpmsg_port_uart.c</span></code></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rpmsg_port.html" class="btn btn-neutral float-left" title="RPMsg Port Transport Layer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rpmsg_ping.html" class="btn btn-neutral float-right" title="RPMsg Ping" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>