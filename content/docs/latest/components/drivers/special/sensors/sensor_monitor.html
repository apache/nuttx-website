<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sensor Monitor (procfs) &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
      <script src="../../../../_static/jquery.js"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
      <script src="../../../../_static/doctools.js"></script>
      <script src="../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../_static/clipboard.min.js"></script>
      <script src="../../../../_static/copybutton.js"></script>
      <script src="../../../../_static/design-tabs.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="ADT7320" href="adt7320.html" />
    <link rel="prev" title="Sensor Cluster (Obsolete)" href="sensors_cluster.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../../12.11.0" >12.11.0</option>
    
    <option value="../../../../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">OS Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../binfmt.html">Binary Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concurrency/index.html">Concurrency</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Device Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../character/index.html">Character Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../block/index.html">Block Device Drivers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Specialized Device Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../audio.html">Audio Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../clk.html">Clock management (CLK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devicetree.html">Device Tree support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devmem.html">DEVMEM Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dma.html">DMA Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../framebuffer.html">Frame Buffer Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html">I2C Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html#i2c-bit-bang-driver">I2C Bit-Bang Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2c.html#i2c-slave-device-drivers">I2C Slave Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i3c.html">I3C Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ioexpander.html">IO Expander Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../lcd.html">LCD Character Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mtd/index.html">Memory Technology Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../regmap.html">drivers/regmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reset.html">Reset Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rptun.html">Remote Proc Tunnel Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rwbuffer.html"><code class="docutils literal notranslate"><span class="pre">rwbuffer.c</span></code></a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../sensors.html">Sensor Drivers</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="sensors_uorb.html">Sensor “uORB” Drivers</a></li>
<li class="toctree-l5"><a class="reference internal" href="sensors_legacy.html">Sensor Legacy Drivers</a></li>
<li class="toctree-l5"><a class="reference internal" href="sensors_cluster.html">Sensor Cluster (Obsolete)</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Sensor Monitor (procfs)</a></li>
<li class="toctree-l5"><a class="reference internal" href="adt7320.html">ADT7320</a></li>
<li class="toctree-l5"><a class="reference internal" href="adxl345.html">ADXL345</a></li>
<li class="toctree-l5"><a class="reference internal" href="adxl362.html">ADXL362</a></li>
<li class="toctree-l5"><a class="reference internal" href="adxl372.html">ADXL372</a></li>
<li class="toctree-l5"><a class="reference internal" href="aht10.html">AHT10</a></li>
<li class="toctree-l5"><a class="reference internal" href="ak09912.html">AK09912</a></li>
<li class="toctree-l5"><a class="reference internal" href="lsm330.html">LSM330_SPI</a></li>
<li class="toctree-l5"><a class="reference internal" href="mcp9600.html">MCP9600</a></li>
<li class="toctree-l5"><a class="reference internal" href="mpl115a.html">MPL115A</a></li>
<li class="toctree-l5"><a class="reference internal" href="nau7802.html">NAU7802</a></li>
<li class="toctree-l5"><a class="reference internal" href="qmi8658.html">QMI8658</a></li>
<li class="toctree-l5"><a class="reference internal" href="sht4x.html">SHT4X</a></li>
<li class="toctree-l5"><a class="reference internal" href="lsm6dso32.html">LSM6DSO32</a></li>
<li class="toctree-l5"><a class="reference internal" href="lis2mdl.html">LIS2MDL</a></li>
<li class="toctree-l5"><a class="reference internal" href="l86xxx.html">L86-XXX</a></li>
<li class="toctree-l5"><a class="reference internal" href="gnss_lowerhalf.html">GNSS Lower Half uORB Driver</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../segger.html">Segger RTT drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../spi.html">SPI Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../syslog.html">SYSLOG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sdio.html">SDIO Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbdev.html">USB Device-Side Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbhost.html">USB Host-Side Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbmisc.html">USB Miscellaneous Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usbmonitor.html">USB Monitor support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../usrsock.html">Usrsock Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmcsd.html">MMCSD Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../net/index.html">Network interface drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pci/index.html">PCI(e) Bus Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pinctrl.html">Pinctrl Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipes.html">FIFO and named pipe drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../power/index.html">Power-related Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ptp.html">PTP Clock Driver Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="../virtio.html">Virtio Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../video.html">Video Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../wireless.html">Wireless Drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../thermal/index.html">Thermal Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#lower-half-and-upper-half">Lower-half and upper-half</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#subdirectories-of-nuttx-drivers">Subdirectories of <code class="docutils literal notranslate"><span class="pre">nuttx/drivers</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#skeleton-files">Skeleton Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#drivers-early-initialization">Drivers Early Initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxflat.html">NXFLAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxgraphics/index.html">NX Graphics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../paging.html">On-Demand Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../audio/index.html">Audio Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../filesystem/index.html">NuttX File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../libs/index.html">NuttX libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../net/index.html">Network Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../syscall.html">Syscall Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/index.html"><code class="docutils literal notranslate"><span class="pre">/tools</span></code> Host Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arch/index.html">Architecture-Specific Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../boards.html">Boards Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cmake.html">CMake Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openamp.html">OpenAMP Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../video.html">Video Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../crypto.html">Crypto API Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wireless.html">Wireless Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">OS Components</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Specialized Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="../sensors.html">Sensor Drivers</a></li>
      <li class="breadcrumb-item active">Sensor Monitor (procfs)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/components/drivers/special/sensors/sensor_monitor.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sensor-monitor-procfs">
<h1>Sensor Monitor (procfs)<a class="headerlink" href="#sensor-monitor-procfs" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The Sensor Monitor is a dynamic debugging tool implemented as a procfs interface
that allows users to monitor and control sensor logging at runtime. It provides
a flexible way to enable/disable sensor debug output without rebuilding the system,
making it particularly useful for debugging sensor-related issues in production
environments.</p>
<p>The monitor uses a hash table to store monitored sensor topics and their associated
log levels, allowing efficient lookup and modification of monitoring settings.</p>
<section id="why-sensor-monitor">
<h3>Why Sensor Monitor?<a class="headerlink" href="#why-sensor-monitor" title="Permalink to this heading"></a></h3>
<p>In the past, adding debug information to the sensor framework would cause logs
from multiple sensors to be mixed together in the output, making it difficult
to locate and diagnose specific issues. When <code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_SENSORS_INFO</span></code> was
enabled, all sensors would output debug messages simultaneously, creating a noisy
log stream that obscured the information relevant to the problem at hand.</p>
<p><strong>The Sensor Monitor solves this problem by:</strong></p>
<ol class="arabic simple">
<li><p><strong>Selective Monitoring</strong>: Allows you to dynamically specify which sensor types
to monitor, filtering out irrelevant sensor data from the log output.</p></li>
<li><p><strong>Runtime Configuration</strong>: Enables adding or removing monitored sensors without
recompiling the system, eliminating the need for rebuild cycles during debugging.</p></li>
<li><p><strong>Reduced Interference</strong>: By monitoring only the sensors of interest, the log
output becomes cleaner and more focused, significantly reducing noise and
interference from other sensors.</p></li>
<li><p><strong>Improved Debugging Efficiency</strong>: Focused logging makes it much easier to
identify patterns, anomalies, and root causes of sensor-related issues.</p></li>
<li><p><strong>Granular Control</strong>: Each monitored sensor can have its own independent log
level (0-7), allowing fine-tuned control over the verbosity of debug output
for different sensors. This means you can enable detailed DEBUG-level logging
for one sensor while keeping another at ERROR-level only, depending on your
debugging needs.</p></li>
</ol>
<p>For example, in a system with accelerometer, gyroscope, magnetometer, barometer,
and light sensors all running simultaneously, you can choose to monitor only the
accelerometer with detailed DEBUG-level logging while keeping other sensors silent,
making it easy to trace accelerometer-specific issues without being distracted by
unrelated sensor data.</p>
<section id="limitations-of-existing-tools">
<h4>Limitations of Existing Tools<a class="headerlink" href="#limitations-of-existing-tools" title="Permalink to this heading"></a></h4>
<p>While NuttX provides useful tools like <code class="docutils literal notranslate"><span class="pre">apps/system/sensortest</span></code> and
<code class="docutils literal notranslate"><span class="pre">apps/system/uorb</span></code> for sensor testing and monitoring, these tools have
limitations when it comes to debugging the sensor framework:</p>
<ul class="simple">
<li><p><strong>sensortest</strong>: This application is designed to test sensor functionality by
reading sensor data from user space. However, it can only observe the final
output data delivered to applications. It cannot provide visibility into the
sensor framework’s internal operations, such as data processing, topic
management, or subscription handling.</p></li>
<li><p><strong>uorb</strong>: This tool allows subscribing to and monitoring uORB topics, but
similarly works at the application level. It shows what data is being published
to topics, but cannot reveal the framework’s internal behavior, event
propagation, or data flow within the sensor subsystem layer.</p></li>
</ul>
<p>Both tools are excellent for validating sensor output and application-level
integration, but they lack the ability to debug issues within the sensor
framework itself, such as:</p>
<ul class="simple">
<li><p>Topic registration and initialization</p></li>
<li><p>Data publication and subscription flow</p></li>
<li><p>Framework event handling</p></li>
<li><p>Sensor data buffering and queuing</p></li>
<li><p>Framework state management</p></li>
<li><p>Inter-component communication within the sensor subsystem</p></li>
</ul>
<p><strong>Note:</strong> The Sensor Monitor is specifically designed for debugging the sensor
<strong>framework layer</strong>. It does not provide low-level hardware debugging capabilities
such as register access, interrupt handling, or hardware-specific driver issues.
For hardware-level debugging, use hardware debuggers (JTAG/SWD) or driver-specific
debug interfaces.</p>
</section>
</section>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Dynamic Configuration</strong>: Add or remove monitored sensors at runtime</p></li>
<li><p><strong>Log Level Control</strong>: Set different log levels for different sensors</p></li>
<li><p><strong>Batch Operations</strong>: Add or remove multiple sensors in a single command</p></li>
<li><p><strong>Procfs Interface</strong>: Easy to use through standard file operations</p></li>
<li><p><strong>Hash Table Backend</strong>: Efficient storage and lookup using <code class="docutils literal notranslate"><span class="pre">hsearch_r()</span></code></p></li>
<li><p><strong>Persistent Configuration</strong>: Default sensor list can be configured at build time</p></li>
</ul>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>To enable the Sensor Monitor, the following configuration options are required:</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>CONFIG_SENSORS_MONITOR=y<span class="w">                    </span><span class="c1"># Enable sensor monitor</span>
CONFIG_SENSORS_MONITOR_BUCKET=&lt;size&gt;<span class="w">        </span><span class="c1"># Hash table bucket size</span>
CONFIG_SENSORS_MONITOR_LIST=&quot;&lt;sensors&gt;&quot;<span class="w">     </span><span class="c1"># Default monitored sensors</span>
</pre></div>
</div>
<section id="configuration-options">
<h3>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this heading"></a></h3>
<dl>
<dt><strong>CONFIG_SENSORS_MONITOR</strong></dt><dd><p>Enable the sensor monitor procfs interface.</p>
</dd>
<dt><strong>CONFIG_SENSORS_MONITOR_BUCKET</strong></dt><dd><p>Specifies the number of buckets in the hash table used to store monitored
sensors. A larger value provides better performance for many sensors but
uses more memory. Recommended values:</p>
<ul class="simple">
<li><p>Small systems: 16-32</p></li>
<li><p>Medium systems: 64-128</p></li>
<li><p>Large systems: 256+</p></li>
</ul>
</dd>
<dt><strong>CONFIG_SENSORS_MONITOR_LIST</strong></dt><dd><p>A string containing space-separated sensor names to monitor by default.
This list is applied during initialization.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SENSORS_MONITOR_LIST=&quot;sensor_accel sensor_gyro&quot;
</pre></div>
</div>
</dd>
</dl>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>The Sensor Monitor is accessed through the <code class="docutils literal notranslate"><span class="pre">/proc/sensor_monitor</span></code> file.</p>
<section id="reading-status">
<h3>Reading Status<a class="headerlink" href="#reading-status" title="Permalink to this heading"></a></h3>
<p>To view currently monitored sensors and their log levels:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p>This displays:</p>
<ol class="arabic simple">
<li><p>Usage instructions</p></li>
<li><p>Command examples</p></li>
<li><p>List of currently monitored sensors with their log levels</p></li>
</ol>
<p>Example output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Sensor procfs - Dynamic sensor debugging tool

Usage:
  cat /proc/sensor_monitor - Show currently monitored topics
  echo &lt;level&gt; &lt;topic&gt; &gt; /proc/sensor_monitor - Add topic(s)
  echo rm &lt;topic&gt; &gt; /proc/sensor_monitor - Remove topic(s)
  ...

sensor_accel            1
sensor_gyro             2
sensor_compass          1
</pre></div>
</div>
</section>
<section id="adding-sensors">
<h3>Adding Sensors<a class="headerlink" href="#adding-sensors" title="Permalink to this heading"></a></h3>
<p><strong>Add with Default Log Level (1)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>sensor_accel<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p><strong>Add with Specific Log Level</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_accel<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p>Log levels correspond to syslog levels (0-7):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 15.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Level</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>EMERG</p></td>
<td><p>System is unusable right now</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>ALERT</p></td>
<td><p>Immediate action required</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>CRIT</p></td>
<td><p>Serious failure, but system may still run</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>ERR</p></td>
<td><p>Error condition. Operation failed, but scope is limited and system remains stable.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>WARNING</p></td>
<td><p>Abnormal situation. Something unexpected happened, but no failure yet.</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>NOTICE</p></td>
<td><p>Significant normal event. Expected behavior, but important enough to be logged.</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>INFO</p></td>
<td><p>Informational message. Routine state changes, progress messages, normal operation.</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>DEBUG</p></td>
<td><p>Debug-level detail. Developer-oriented, noisy, not for production diagnosis.</p></td>
</tr>
</tbody>
</table>
<p><strong>Add Multiple Sensors</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>sensor_accel<span class="w"> </span>sensor_gyro<span class="w"> </span>sensor_compass<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_accel<span class="w"> </span>sensor_gyro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
</section>
<section id="removing-sensors">
<h3>Removing Sensors<a class="headerlink" href="#removing-sensors" title="Permalink to this heading"></a></h3>
<p><strong>Remove Single Sensor</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>rm<span class="w"> </span>sensor_accel<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p><strong>Remove Multiple Sensors</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>rm<span class="w"> </span>sensor_accel<span class="w"> </span>sensor_gyro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p><strong>Remove All Sensors</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>clean<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
</section>
<section id="batch-operations">
<h3>Batch Operations<a class="headerlink" href="#batch-operations" title="Permalink to this heading"></a></h3>
<p>You can combine add and remove operations in a single command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;add 1 sensor_accel rm sensor_gyro&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p>This command:</p>
<ol class="arabic simple">
<li><p>Adds <code class="docutils literal notranslate"><span class="pre">sensor_accel</span></code> with log level 1</p></li>
<li><p>Removes <code class="docutils literal notranslate"><span class="pre">sensor_gyro</span></code></p></li>
</ol>
</section>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h2>
<section id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this heading"></a></h3>
<p>The Sensor Monitor consists of the following components:</p>
<dl class="simple">
<dt><strong>Procfs Interface</strong></dt><dd><p>Implements standard file operations (open, close, read, write) for
<code class="docutils literal notranslate"><span class="pre">/proc/sensor_monitor</span></code>.</p>
</dd>
<dt><strong>Hash Table Storage</strong></dt><dd><p>Uses POSIX <code class="docutils literal notranslate"><span class="pre">hsearch_r()</span></code> family functions to store sensor-topic mappings:</p>
<ul class="simple">
<li><p><strong>Key</strong>: Sensor name (string)</p></li>
<li><p><strong>Value</strong>: Log level (integer stored as pointer)</p></li>
</ul>
</dd>
<dt><strong>Command Parser</strong></dt><dd><p>Parses space-separated commands from write operations and executes
corresponding actions.</p>
</dd>
</dl>
</section>
<section id="data-structures">
<h3>Data Structures<a class="headerlink" href="#data-structures" title="Permalink to this heading"></a></h3>
<p><strong>struct sensor_monitor_buffer_s</strong></p>
<p>Used for formatting output during read operations:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">sensor_monitor_buffer_s</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">FAR</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">;</span><span class="w">      </span><span class="cm">/* Output buffer pointer */</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w">   </span><span class="n">totalsize</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Total bytes written */</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w">   </span><span class="n">buflen</span><span class="p">;</span><span class="w">       </span><span class="cm">/* Remaining buffer size */</span>
<span class="w">  </span><span class="kt">off_t</span><span class="w">    </span><span class="n">offset</span><span class="p">;</span><span class="w">       </span><span class="cm">/* Current file offset */</span>
<span class="p">};</span>
</pre></div>
</div>
<p><strong>Hash Table Entry</strong></p>
<p>Each monitored sensor is stored as an <code class="docutils literal notranslate"><span class="pre">ENTRY</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ENTRY</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="n">item</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sensor_accel&quot;</span><span class="p">;</span><span class="w">           </span><span class="cm">/* Sensor name */</span>
<span class="n">item</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="mi">1</span><span class="p">;</span><span class="w">     </span><span class="cm">/* Log level */</span>
</pre></div>
</div>
</section>
<section id="key-functions">
<h3>Key Functions<a class="headerlink" href="#key-functions" title="Permalink to this heading"></a></h3>
<p><strong>sensor_monitor_initialize()</strong></p>
<p>Initializes the sensor monitor subsystem:</p>
<ol class="arabic simple">
<li><p>Allocates and initializes the hash table</p></li>
<li><p>Sets the custom <code class="docutils literal notranslate"><span class="pre">free_entry</span></code> callback</p></li>
<li><p>Processes the default sensor list from <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR_LIST</span></code></p></li>
<li><p>Registers the procfs entry</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">sensor_monitor_initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>sensor_monitor_level()</strong></p>
<p>Retrieves the log level for a specific sensor:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">sensor_monitor_level</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Sensor name to query</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>Log level (0-7) if sensor is monitored</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOG_EMERG</span></code> (0) if sensor is not monitored</p></li>
</ul>
<p><strong>Usage Example:</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensor_monitor_level</span><span class="p">(</span><span class="s">&quot;sensor_accel&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">LOG_INFO</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Accel data: x=%d y=%d z=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p><strong>sensor_monitor_add()</strong></p>
<p>Adds a sensor to the monitoring table:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">sensor_monitor_add</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Sensor name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code>: Log level (0-7)</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code> on success</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ENOMEM</span></code> if allocation fails</p></li>
</ul>
<p><strong>Behavior:</strong></p>
<ul class="simple">
<li><p>If sensor already exists, updates its log level</p></li>
<li><p>If sensor is new, allocates memory and adds to hash table</p></li>
</ul>
<p><strong>sensor_monitor_remove()</strong></p>
<p>Removes a sensor from the monitoring table:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">sensor_monitor_remove</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">token</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">token</span></code>: Sensor name to remove</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code> on success</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ENOENT</span></code> if sensor not found</p></li>
</ul>
<p><strong>sensor_monitor_clean()</strong></p>
<p>Removes all monitored sensors:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sensor_monitor_clean</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>Destroys and recreates the hash table, effectively clearing all entries.</p>
<p><strong>sensor_monitor_print()</strong></p>
<p>Callback function used with <code class="docutils literal notranslate"><span class="pre">hforeach_r()</span></code> to print each monitored sensor:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sensor_monitor_print</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="n">ENTRY</span><span class="w"> </span><span class="o">*</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">FAR</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="integration-with-sensor-drivers">
<h2>Integration with Sensor Drivers<a class="headerlink" href="#integration-with-sensor-drivers" title="Permalink to this heading"></a></h2>
<p>Sensor drivers can query the monitor to determine if they should output
debug information:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nuttx/sensors/sensor.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">my_sensor_process_data</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sensor_data_s</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensor_monitor_level</span><span class="p">(</span><span class="s">&quot;sensor_accel&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">LOG_INFO</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sensor data: x=%d y=%d z=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">LOG_DEBUG</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_DEBUG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Detailed sensor state: ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This allows drivers to:</p>
<ol class="arabic simple">
<li><p>Check if their sensor is being monitored</p></li>
<li><p>Adjust verbosity based on the configured log level</p></li>
<li><p>Avoid unnecessary logging overhead when not monitored</p></li>
</ol>
</section>
<section id="memory-management">
<h2>Memory Management<a class="headerlink" href="#memory-management" title="Permalink to this heading"></a></h2>
<p><strong>Hash Table</strong></p>
<p>The hash table is allocated during initialization and persists throughout
system operation. Size is determined by <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR_BUCKET</span></code>.</p>
<p><strong>Sensor Names</strong></p>
<p>Sensor names are dynamically allocated using <code class="docutils literal notranslate"><span class="pre">strdup()</span></code> when added to the
hash table. The custom <code class="docutils literal notranslate"><span class="pre">free_entry</span></code> callback ensures proper cleanup:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sensor_monitor_free_entry</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="n">ENTRY</span><span class="w"> </span><span class="o">*</span><span class="n">entry</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">kmm_free</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Buffer Management</strong></p>
<p>Read operations use temporary stack buffers (<code class="docutils literal notranslate"><span class="pre">NAME_MAX</span></code> size) for
formatting output before copying to user space.</p>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this heading"></a></h2>
<p><strong>Write Operation Errors</strong></p>
<ul class="simple">
<li><p>Invalid sensor name: Silently ignored (allows flexible command syntax)</p></li>
<li><p>Allocation failure: Returns <code class="docutils literal notranslate"><span class="pre">-ENOMEM</span></code></p></li>
<li><p>Sensor not found (for remove): Returns <code class="docutils literal notranslate"><span class="pre">-ENOENT</span></code></p></li>
</ul>
<p><strong>Read Operation</strong></p>
<ul class="simple">
<li><p>Always succeeds</p></li>
<li><p>Returns help text and current monitoring status</p></li>
</ul>
<p><strong>Initialization Errors</strong></p>
<ul class="simple">
<li><p>Hash table allocation failure: Returns <code class="docutils literal notranslate"><span class="pre">-ENOMEM</span></code></p></li>
<li><p>Procfs registration failure: Propagates error from <code class="docutils literal notranslate"><span class="pre">procfs_register()</span></code></p></li>
</ul>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h2>
<section id="example-1-basic-monitoring">
<h3>Example 1: Basic Monitoring<a class="headerlink" href="#example-1-basic-monitoring" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable monitoring for accelerometer with default level</span>
<span class="nb">echo</span><span class="w"> </span>sensor_accel<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Check status</span>
cat<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Output shows:</span>
<span class="c1"># sensor_accel            1</span>
</pre></div>
</div>
</section>
<section id="example-2-multi-sensor-setup">
<h3>Example 2: Multi-Sensor Setup<a class="headerlink" href="#example-2-multi-sensor-setup" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor multiple sensors with different levels</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_accel<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
<span class="nb">echo</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>sensor_gyro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
<span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>sensor_compass<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Verify</span>
cat<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
</section>
<section id="example-3-dynamic-adjustment">
<h3>Example 3: Dynamic Adjustment<a class="headerlink" href="#example-3-dynamic-adjustment" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start with basic monitoring</span>
<span class="nb">echo</span><span class="w"> </span>sensor_accel<span class="w"> </span>sensor_gyro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Increase verbosity for accelerometer</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">7</span><span class="w"> </span>sensor_accel<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Remove gyro monitoring</span>
<span class="nb">echo</span><span class="w"> </span>rm<span class="w"> </span>sensor_gyro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Add new sensor</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_baro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
</section>
<section id="example-4-cleanup">
<h3>Example 4: Cleanup<a class="headerlink" href="#example-4-cleanup" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove all monitored sensors</span>
<span class="nb">echo</span><span class="w"> </span>clean<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Verify empty</span>
cat<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
</section>
<section id="example-5-goldfish-platform-configuration">
<h3>Example 5: Goldfish Platform Configuration<a class="headerlink" href="#example-5-goldfish-platform-configuration" title="Permalink to this heading"></a></h3>
<p>For the Goldfish (QEMU emulator) platform with virtual sensors, you need to
enable the following KCONFIG options:</p>
<p><strong>Basic Sensor Monitor Configuration:</strong></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>CONFIG_SENSORS=y<span class="w">                             </span><span class="c1"># Enable sensor framework</span>
CONFIG_DEBUG_SENSORS_INFO=y<span class="w">                  </span><span class="c1"># Enable sensor debug info (required)</span>
CONFIG_FS_PROCFS=y<span class="w">                           </span><span class="c1"># Enable procfs filesystem</span>
CONFIG_FS_PROCFS_REGISTER=y<span class="w">                  </span><span class="c1"># Enable procfs registration (required)</span>
CONFIG_SENSORS_MONITOR=y<span class="w">                     </span><span class="c1"># Enable sensor monitor</span>
CONFIG_SENSORS_MONITOR_BUCKET=32<span class="w">             </span><span class="c1"># Hash table size (adjust based on sensor count)</span>
CONFIG_SENSORS_MONITOR_LIST=&quot;sensor_accel<span class="w"> </span>sensor_gyro<span class="w"> </span>sensor_mag&quot;<span class="w">  </span><span class="c1"># Default monitored sensors</span>
</pre></div>
</div>
<p><strong>Goldfish-Specific Sensor Driver:</strong></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>CONFIG_SENSORS_GOLDFISH_SENSOR=y<span class="w">             </span><span class="c1"># Enable Goldfish virtual sensors</span>
CONFIG_GOLDFISH_PIPE=y<span class="w">                       </span><span class="c1"># Enable Goldfish pipe (required for communication)</span>
</pre></div>
</div>
<p><strong>Optional Goldfish GNSS Support:</strong></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>CONFIG_SENSORS_GNSS=y<span class="w">                        </span><span class="c1"># Enable GNSS sensor support</span>
CONFIG_SENSORS_GOLDFISH_GNSS=y<span class="w">               </span><span class="c1"># Enable Goldfish GNSS driver</span>
</pre></div>
</div>
<p><strong>Complete Example for Goldfish:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># After configuring the above options and booting the system</span>

<span class="c1"># Check which sensors are being monitored by default</span>
cat<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Add more Goldfish sensors with different log levels</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_baro<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor<span class="w">         </span><span class="c1"># Barometer (CRIT level)</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>sensor_light<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor<span class="w">        </span><span class="c1"># Light sensor (ERR level)</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>sensor_proximity<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor<span class="w">    </span><span class="c1"># Proximity (ALERT level)</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">7</span><span class="w"> </span>sensor_temp<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor<span class="w">         </span><span class="c1"># Temperature (DEBUG level)</span>

<span class="c1"># Monitor orientation and hinge sensors (for foldable device emulation)</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_orient<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>sensor_hinge0<span class="w"> </span>&gt;<span class="w"> </span>/proc/sensor_monitor

<span class="c1"># Verify all monitored sensors</span>
cat<span class="w"> </span>/proc/sensor_monitor
</pre></div>
</div>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_SENSORS_INFO</span></code> and <code class="docutils literal notranslate"><span class="pre">CONFIG_FS_PROCFS_REGISTER</span></code> are mandatory
dependencies for <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR_BUCKET</span></code> should be at least half the number of
sensors you plan to monitor simultaneously (e.g., 32 for up to 64 sensors)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR_LIST</span></code> can specify a default set of sensors to
monitor at boot time, useful for debugging startup issues</p></li>
<li><p>Goldfish sensors communicate through the Goldfish pipe mechanism, so
<code class="docutils literal notranslate"><span class="pre">CONFIG_GOLDFISH_PIPE=y</span></code> is required</p></li>
</ul>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Use Appropriate Log Levels</strong></p>
<ul class="simple">
<li><p>Use lower levels (0-3) for errors and critical events</p></li>
<li><p>Use higher levels (4-7) for verbose debugging</p></li>
<li><p>Default level 1 is suitable for basic monitoring</p></li>
</ul>
</li>
<li><p><strong>Sensor Naming Convention</strong></p>
<ul class="simple">
<li><p>Use descriptive names matching driver names</p></li>
<li><p>Common prefix: <code class="docutils literal notranslate"><span class="pre">sensor_</span></code></p></li>
<li><p>Examples: <code class="docutils literal notranslate"><span class="pre">sensor_accel</span></code>, <code class="docutils literal notranslate"><span class="pre">sensor_gyro_0</span></code>, <code class="docutils literal notranslate"><span class="pre">sensor_temp_cpu</span></code></p></li>
</ul>
</li>
<li><p><strong>Performance Considerations</strong></p>
<ul class="simple">
<li><p>Configure adequate bucket size for your sensor count</p></li>
<li><p>Rule of thumb: buckets ≥ number of sensors / 2</p></li>
<li><p>Avoid excessive logging in interrupt context</p></li>
</ul>
</li>
<li><p><strong>Production Use</strong></p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR_LIST</span></code> for critical sensors</p></li>
<li><p>Use procfs to enable additional debugging when issues occur</p></li>
<li><p>Clean up after debugging to reduce overhead</p></li>
</ul>
</li>
<li><p><strong>Driver Integration</strong></p>
<ul class="simple">
<li><p>Always check monitor level before expensive operations</p></li>
<li><p>Use appropriate syslog levels matching monitor levels</p></li>
<li><p>Consider performance impact of frequent lookups</p></li>
</ul>
</li>
</ol>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Name Length</strong>: Sensor names are limited to <code class="docutils literal notranslate"><span class="pre">NAME_MAX</span></code> characters</p></li>
<li><p><strong>Memory</strong>: Each monitored sensor requires memory for:</p>
<ul class="simple">
<li><p>Hash table entry</p></li>
<li><p>Duplicated sensor name string</p></li>
<li><p>Hash table overhead</p></li>
</ul>
</li>
<li><p><strong>Concurrency</strong>: No explicit locking in current implementation
(relies on kernel mutual exclusion)</p></li>
<li><p><strong>Persistence</strong>: Monitoring configuration is lost on reboot
(except default list from <code class="docutils literal notranslate"><span class="pre">CONFIG_SENSORS_MONITOR_LIST</span></code>)</p></li>
</ol>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="sensors_uorb.html"><span class="doc">Sensor “uORB” Drivers</span></a> - Main sensor framework documentation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nuttx/include/nuttx/sensors/sensor.h</span></code> - Sensor header file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nuttx/drivers/sensors/sensor_monitor.c</span></code> - Implementation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drivers/fs/procfs/</span></code> - Procfs filesystem implementation</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sensors_cluster.html" class="btn btn-neutral float-left" title="Sensor Cluster (Obsolete)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="adt7320.html" class="btn btn-neutral float-right" title="ADT7320" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>