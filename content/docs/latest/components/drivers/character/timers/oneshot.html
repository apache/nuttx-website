<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oneshot Timer Drivers &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
      <script src="../../../../_static/jquery.js"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
      <script src="../../../../_static/doctools.js"></script>
      <script src="../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../_static/clipboard.min.js"></script>
      <script src="../../../../_static/copybutton.js"></script>
      <script src="../../../../_static/design-tabs.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="PWM Drivers" href="pwm.html" />
    <link rel="prev" title="Timer Drivers" href="timer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../../12.11.0" >12.11.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">OS Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../binfmt.html">Binary Loader</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Device Drivers</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Character Device Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../1wire.html">One Wire Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../analog/index.html">Analog (ADC/DAC) Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../bch.html">Block Driver to Character Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../can.html">CAN Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contactless.html">Constactless Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../eeprom.html">EEPROM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../efuse.html">EFUSE Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../gpio.html">GPIO Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../i2s.html">I2S Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../input/index.html">Input Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ipcc.html">IPCC (Inter Processor Communication Controller) Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../leds/index.html">LEDS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../loop.html">Loop Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="../math.html">Math Acceleration Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modem.html">Modem Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="../motor/index.html">Motor Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../note.html">Note Driver Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../nullzero.html"><code class="docutils literal notranslate"><span class="pre">dev_null.c</span></code> and <code class="docutils literal notranslate"><span class="pre">dev_zero.c</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../quadrature.html">Quadrature Encoder Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rc.html">Remote Control Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rf.html">RF Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../serial.html">Serial Device Drivers</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Timers Drivers</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="timer.html">Timer Drivers</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Oneshot Timer Drivers</a></li>
<li class="toctree-l5"><a class="reference internal" href="pwm.html">PWM Drivers</a></li>
<li class="toctree-l5"><a class="reference internal" href="watchdog.html">Watchdog Timer Drivers</a></li>
<li class="toctree-l5"><a class="reference internal" href="rtc.html">RTC Drivers</a></li>
<li class="toctree-l5"><a class="reference internal" href="capture.html">Capture</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../touchscreen.html">Touchscreen Device Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../wireless/index.html">Wireless character drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../block/index.html">Block Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../special/index.html">Specialized Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../thermal/index.html">Thermal Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#lower-half-and-upper-half">Lower-half and upper-half</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#subdirectories-of-nuttx-drivers">Subdirectories of <code class="docutils literal notranslate"><span class="pre">nuttx/drivers</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#skeleton-files">Skeleton Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#drivers-early-initialization">Drivers Early Initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxflat.html">NXFLAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nxgraphics/index.html">NX Graphics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../paging.html">On-Demand Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../audio/index.html">Audio Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../filesystem/index.html">NuttX File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../libs/index.html">NuttX libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../net/index.html">Network Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../syscall.html">Syscall Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/index.html"><code class="docutils literal notranslate"><span class="pre">/tools</span></code> Host Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arch/index.html">Architecture-Specific Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../boards.html">Boards Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cmake.html">CMake Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openamp.html">OpenAMP Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../video.html">Video Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../crypto.html">Crypto API Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wireless.html">Wireless Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">OS Components</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Character Device Drivers</a></li>
          <li class="breadcrumb-item"><a href="index.html">Timers Drivers</a></li>
      <li class="breadcrumb-item active">Oneshot Timer Drivers</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/components/drivers/character/timers/oneshot.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="oneshot-timer-drivers">
<h1>Oneshot Timer Drivers<a class="headerlink" href="#oneshot-timer-drivers" title="Permalink to this heading"></a></h1>
<p>The NuttX timing subsystem consists of four layers:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>1 Hardware Timer Drivers: Includes implementations of various hardware</dt><dd><p>timer drivers.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>2 Timer Driver Abstraction: Such as Oneshot and Timer, which provide</dt><dd><p>oneshot/periodical timer hardware abstraction.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>3 OS Timer Interfaces: Arch_Timer(up_timer_*) and Arch_Alarm(up_alarm_*),</dt><dd><p>offering relative timer (trigger an event with a certain delay)
and absolute timer (trigger an event at a certain time)
interfaces.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>4 OS Timer Abstraction: The wdog timer manages software timers</dt><dd><p>and provides a unified timer API to upper layers.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Here we focus on the oneshot timer driver abstraction.</p>
<p>Oneshot is the timer driver abstraction that provides:</p>
<blockquote>
<div><ul class="simple">
<li><p>Unified API for different timer hardware.</p></li>
<li><p>Functional correct and optimized timing conversion between
cycle counts and natural time.</p></li>
</ul>
</div></blockquote>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading"></a></h2>
<p>Computers typically rely on hardware cycle counters that count level changes
from external clock signals. These signals are generated by a crystal
oscillator. The signal then goes through a Phase-Locked Loop (PLL) for
frequency multiplication, and is output as the clock signal to the
hardware cycle counter.</p>
<p>The counter counting up or counting down—with each level changes, enabling
hardware-based timing. To generate timing interrupts, timer hardware includes
a comparator. It triggers a CPU interrupt when the down-counter reaches zero
or the cycle counter matches a preset value.</p>
<p>Based on the functions of the timers, we can abstract a minimal set of
capabilities that a timer should provide:</p>
<blockquote>
<div><ul class="simple">
<li><ol class="arabic simple">
<li><p>Read the current cycle count</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>Trigger an event at an absolute cycle count</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>Trigger an event after a relative cycle count</p></li>
</ol>
</li>
</ul>
</div></blockquote>
<p>From an OS perspective, The second one and third one are functionally
equivalent assuming the first one is available. By reprogramming the timer,
these can also emulate periodical timers. Although these methods are similar
in expressiveness, timers that use relative delays tend to be less accurate
and efficient than those supporting absolute timing. This is because reading
the current time introduces additional CPU overhead, affecting both
timing-precision and performance.</p>
</section>
<section id="oneshot-drivers-api">
<h2>Oneshot Drivers API<a class="headerlink" href="#oneshot-drivers-api" title="Permalink to this heading"></a></h2>
<p>OneShot currently offers new count-based interfaces, while also providing
timespec-based interfaces for compatibility with older drivers.
We strongly recommend using the count-based interface due to its superior
performance. Besides, count-based APIs are easier to implement, as they only
need to focus on reading and writing timer-related registers without
needing to perform error-prone time conversion.</p>
<p>In count-based interface design, oneshot adopts the following principles:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Minimalist design: Significantly simplifies the implementation</dt><dd><p>for drivers.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Count-based interfaces: Uses count cycles as the unit for both reading</dt><dd><p>time and setting timers.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Supports both absolute and relative timers: Compatible with underlying</dt><dd><p>timer hardware, regardless of whether it uses absolute or
relative timing.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>No status returns: Since read/write operations on timer hardware should</dt><dd><p>not fail, any failure should result in an assertion
at the driver level.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>No callbacks or parameters: All expiration callback and parameter</dt><dd><p>management is handled at the upper layer,
preventing thread-unsafe usage.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>The count-based interface is as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">clkcnt_t</span> <span class="pre">(*current)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span>&#160;&#160;&#160;&#160; <span class="pre">(*start)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower,</span> <span class="pre">clkcnt_t</span> <span class="pre">delay);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span>&#160;&#160;&#160;&#160; <span class="pre">(*start_absolute)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower,</span> <span class="pre">clkcnt_t</span> <span class="pre">cnt);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span>&#160;&#160;&#160;&#160; <span class="pre">(*cancel)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clkcnt_t</span> <span class="pre">(*max_delay)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower);</span></code></p></li>
</ul>
</div></blockquote>
<p>The above count-based interfaces provide functions for:</p>
<blockquote>
<div><ul class="simple">
<li><p>getting the current timer count,</p></li>
<li><p>starting a relative timer,</p></li>
<li><p>starting an absolute timer,</p></li>
<li><p>canceling a timer event</p></li>
<li><p>and getting the maximum timer delay.</p></li>
</ul>
</div></blockquote>
<p>Note that if the driver uses a count-based API, it should call
<code class="docutils literal notranslate"><span class="pre">oneshot_count_init</span></code> during initialization to tell the upper-layer
the timer frequency.</p>
<p>The count-based interfaces are enabled via <code class="docutils literal notranslate"><span class="pre">CONFIG_ONESHOT_COUNT</span></code>.</p>
<p>The following are the deprecated timespec interfaces:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*max_delay)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower,</span> <span class="pre">FAR</span> <span class="pre">struct</span> <span class="pre">timespec</span> <span class="pre">*ts);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*start)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower,</span> <span class="pre">FAR</span> <span class="pre">const</span> <span class="pre">struct</span> <span class="pre">timespec</span> <span class="pre">*ts);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*cancel)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower,</span> <span class="pre">FAR</span> <span class="pre">struct</span> <span class="pre">timespec</span> <span class="pre">*ts);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*current)(FAR</span> <span class="pre">struct</span> <span class="pre">oneshot_lowerhalf_s</span> <span class="pre">*lower,</span> <span class="pre">FAR</span> <span class="pre">struct</span> <span class="pre">timespec</span> <span class="pre">*ts);</span></code></p></li>
</ul>
</div></blockquote>
<p>They provide functions for:</p>
<blockquote>
<div><ul class="simple">
<li><p>getting the maximum timer delay,</p></li>
<li><p>starting a relative timer,</p></li>
<li><p>canceling a timer event</p></li>
<li><p>and getting the current timer count.</p></li>
</ul>
</div></blockquote>
</section>
<section id="clockcount">
<h2>ClockCount<a class="headerlink" href="#clockcount" title="Permalink to this heading"></a></h2>
<p>The recommended oneshot APIs are all count-based. So how do we handle time
conversion? We provide a unified ClockCount(clockcount.h) layer for fast and
safe time conversions, including:</p>
<blockquote>
<div><ul class="simple">
<li><p>count to timespec</p></li>
<li><p>count to tick</p></li>
<li><p>timespec to count</p></li>
<li><p>tick to count</p></li>
</ul>
</div></blockquote>
<p>We notice that there always at least two divisions in timing conversion. So
clockcount implements two methods to accelerate time conversion:</p>
<blockquote>
<div><p>1. Invariant Divisor Division Optimization: Used for converting counts
to seconds or ticks. It can be enabled via <code class="docutils literal notranslate"><span class="pre">CONFIG_ONESHOT_FAST_DIVISION</span></code>.
This division optimization can transforms a division into:</p>
<blockquote>
<div><ul class="simple">
<li><p>one unsigned high multiplication (UMULH),</p></li>
<li><p>one subtraction,</p></li>
<li><p>one addition, and</p></li>
<li><p>one logical right shift (LShR).</p></li>
</ul>
</div></blockquote>
<p>Please note that Invariant Divisor Division Optimization does not
necessarily provide a performance advantage. It is related to the
overhead of UMULH and UDIV instructions on different CPU platforms.
E.g. On early ARMv8A platforms (Cortex A-53), UMULH took 6 cycles,
which meant that enabling optimization was actually less efficient
than direct division using the UDIV instructions.</p>
<p>2. Multiply-Shift Approximate Division: Used to convert delta counts into
nanoseconds or ticks.</p>
<p>Note this was enabled by default. If extramely precise time conversion
is required, it should be disable.
This method trades off slight precision (a few nanoseconds) for better
performance. However, due to potential multiplication overflow, it is
only suitable for relative time conversions.
The first method is exact, but takes about 6-9 CPU cycles. The
approximate approach requires only one unsigned multiplication and one
LShR, typically consuming around 4 CPU cycles, making it
significantly faster.</p>
</div></blockquote>
<p>Combining 1 and 2, we can achieve a fast and precise time conversion.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="timer.html" class="btn btn-neutral float-left" title="Timer Drivers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pwm.html" class="btn btn-neutral float-right" title="PWM Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>