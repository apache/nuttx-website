<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Special Files and Device Numbers &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
      <script src="../../_static/doctools.js"></script>
      <script src="../../_static/sphinx_highlight.js"></script>
      <script src="../../_static/clipboard.min.js"></script>
      <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="V9FS" href="v9fs.html" />
    <link rel="prev" title="Pseudo File System" href="pseudofs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../latest" selected="selected">latest</option>
    
    <option value="../../../10.0.0" >10.0.0</option>
    
    <option value="../../../10.0.1" >10.0.1</option>
    
    <option value="../../../10.1.0" >10.1.0</option>
    
    <option value="../../../10.2.0" >10.2.0</option>
    
    <option value="../../../10.3.0" >10.3.0</option>
    
    <option value="../../../11.0.0" >11.0.0</option>
    
    <option value="../../../12.0.0" >12.0.0</option>
    
    <option value="../../../12.1.0" >12.1.0</option>
    
    <option value="../../../12.2.0" >12.2.0</option>
    
    <option value="../../../12.2.1" >12.2.1</option>
    
    <option value="../../../12.3.0" >12.3.0</option>
    
    <option value="../../../12.4.0" >12.4.0</option>
    
    <option value="../../../12.5.0" >12.5.0</option>
    
    <option value="../../../12.5.1" >12.5.1</option>
    
    <option value="../../../12.6.0" >12.6.0</option>
    
    <option value="../../../12.7.0" >12.7.0</option>
    
    <option value="../../../12.8.0" >12.8.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">OS Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../binfmt.html">Binary Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../drivers/index.html">Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nxflat.html">NXFLAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nxgraphics/index.html">NX Graphics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paging.html">On-Demand Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../audio/index.html">Audio Subsystem</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">NuttX File System</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#virtual-file-system-vfs">Virtual File System (VFS)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#file-systems">File systems</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="aio.html">Asynchronous I/O support</a></li>
<li class="toctree-l4"><a class="reference internal" href="binfs.html">BINFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="cromfs.html">CROMFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="fat.html">FAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="hostfs.html">Host File System</a></li>
<li class="toctree-l4"><a class="reference internal" href="littlefs.html">LITTLEFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="mmap.html">File mapping emulation (mmap)</a></li>
<li class="toctree-l4"><a class="reference internal" href="mnemofs.html">MNEMOFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="nfs.html">NFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="nxffs.html">NXFFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="partition.html">Partition Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="procfs.html">PROCFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="romfs.html">ROMFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpmsgfs.html">RPMSG File System</a></li>
<li class="toctree-l4"><a class="reference internal" href="smartfs.html">SMARTFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="shmfs.html">Shared Memory File System</a></li>
<li class="toctree-l4"><a class="reference internal" href="spiffs.html">SPIFFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="tmpfs.html">TMPFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="unionfs.html">Union File System</a></li>
<li class="toctree-l4"><a class="reference internal" href="userfs.html">User file system</a></li>
<li class="toctree-l4"><a class="reference internal" href="zipfs.html">ZipFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="inotify.html">Inotify</a></li>
<li class="toctree-l4"><a class="reference internal" href="nuttxfs.html">Nuttx FS</a></li>
<li class="toctree-l4"><a class="reference internal" href="nxflat.html">NuttX FLAT Binary Format (NXFLAT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="pseudofs.html">Pseudo File System</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Special Files and Device Numbers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#special-files-in-unix-like-file-systems">Special Files in Unix-like File Systems</a></li>
<li class="toctree-l5"><a class="reference internal" href="#special-files-in-other-file-systems">Special Files in Other File Systems</a></li>
<li class="toctree-l5"><a class="reference internal" href="#special-files-and-nuttx">Special Files and NuttX</a></li>
<li class="toctree-l5"><a class="reference internal" href="#device-files-and-device-numbers">Device Files and Device Numbers</a></li>
<li class="toctree-l5"><a class="reference internal" href="#named-resources">Named Resources</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="v9fs.html">V9FS</a></li>
<li class="toctree-l4"><a class="reference internal" href="v9fs.html#adding-v9fs-to-the-nuttx-configuration">Adding V9FS to the NuttX Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="v9fs.html#nfs-mount-command">NFS Mount Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#fs-categories">FS Categories</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../libs/index.html">NuttX libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net/index.html">Network Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syscall.html">Syscall Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html"><code class="docutils literal notranslate"><span class="pre">/tools</span></code> Host Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-Specific Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../boards.html">Boards Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmake.html">CMake Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openamp.html">OpenAMP Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video.html">Video Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto.html">Crypto API Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wireless.html">Wireless Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logos/index.html">NuttX Logos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">OS Components</a></li>
          <li class="breadcrumb-item"><a href="index.html">NuttX File System</a></li>
      <li class="breadcrumb-item active">Special Files and Device Numbers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/components/filesystem/special_files_dev_num.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="special-files-and-device-numbers">
<h1>Special Files and Device Numbers<a class="headerlink" href="#special-files-and-device-numbers" title="Permalink to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Migrated from:
<a class="reference external" href="https://cwiki.apache.org/confluence/display/NUTTX/Special+Files+and+Device+Numbers">https://cwiki.apache.org/confluence/display/NUTTX/Special+Files+and+Device+Numbers</a></p>
</div>
<section id="special-files-in-unix-like-file-systems">
<h2>Special Files in Unix-like File Systems<a class="headerlink" href="#special-files-in-unix-like-file-systems" title="Permalink to this heading"></a></h2>
<p>In Unix-like operating systems, a <cite>special file</cite> is an interface for
a device driver that appears in a file system as if it were an
ordinary file. Special files are a feature built into Unix-like
file systems such as EXT2.</p>
<p>See also <a class="reference external" href="https://en.wikipedia.org/wiki/Device_file">Wikipedia article</a>.</p>
</section>
<section id="special-files-in-other-file-systems">
<h2>Special Files in Other File Systems<a class="headerlink" href="#special-files-in-other-file-systems" title="Permalink to this heading"></a></h2>
<p>Some other file systems systems, such as NTFS, also have some more
limited and incompatible notion of special files. Others, such as
FAT, do not have any such concept. Unix-like environments such as
Cygwin that run on these other file systems have to do things a
little differently: The have to emulate special files using the
resources of the file system that they operate on. This may mean
creating <cite>regular</cite> files with special naming conventions or with
special content that can be used to emulate the behavior of
special files.</p>
</section>
<section id="special-files-and-nuttx">
<h2>Special Files and NuttX<a class="headerlink" href="#special-files-and-nuttx" title="Permalink to this heading"></a></h2>
<p>NuttX has done things in a very different way. There are no
special files supported in any file system. Rather, special
files can exist only in the NuttX <a class="reference internal" href="pseudofs.html"><span class="doc">pseudo file system</span></a>. This
was a decision that was made in the initial design to simplify
things for resource limited platforms yet still provide a mostly
standard Unix-like/POSIX programming environment.</p>
<p>What are the advantages of the special files in the NuttX
pseudo-file system? Reduce resource usage, reduced bring-up
requirements. What are the disadvantages? In NuttX, special
files can only reside in the pseudo-file system.</p>
<p>The only other consequence that I aware of is that NuttX cannot
support the POSIX requirement for the <code class="docutils literal notranslate"><span class="pre">st_dev</span></code> field in the
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">stat</span></code> structure.</p>
</section>
<section id="device-files-and-device-numbers">
<h2>Device Files and Device Numbers<a class="headerlink" href="#device-files-and-device-numbers" title="Permalink to this heading"></a></h2>
<p>In a Unix-like system, devices are access special device files.
In a Unix-like system, device files can reside in any compatible
file system but, by convention, are always placed in the <code class="docutils literal notranslate"><span class="pre">/dev</span></code>
directory. NuttX achieves programming compatibility with this
convention because the top-level, <cite>root</cite> file system is the
pseudo-file system and <code class="docutils literal notranslate"><span class="pre">/dev</span></code> is part of the pseudo-file system.</p>
<p>But there is a bigger difference that this. The bigger
difference is how device drivers are registered and how
the are accessed. The primary content of the Unix-like
device file is simply a number, a device number, usually
represented as type <code class="docutils literal notranslate"><span class="pre">dev_t</span></code>. The device number an encoded
that consists of a <cite>major</cite> device number and a <cite>minor</cite> device
number. The major device number identifies the type of
driver and the minor number identifies an instance of a
driver of that type.</p>
<p>There is nothing special about these number from the sense of
a file system. Just because device file exists with a
certain major and minor number, that does not mean that there
is actually any real driver instance backing that device file
up. For example, you can create a device file from the Linux
command line like this, knowing nothing other than major and
minor device number:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">dev_t</span><span class="w"> </span><span class="nf">makedev</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maj</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">min</span><span class="p">);</span>
</pre></div>
</div>
<p>In a Unix-like system, when you try to open a device driver
several things must happen: The system must open the device
file, obtain the device major and minor number, and then
look up the driver instance in some internal <cite>registry</cite> of
registered device drivers. If one is found, then the system
can complete the open operation.</p>
<p>So, the device number is then a <cite>key</cite> of some kind into a
<cite>registry</cite> of device drivers. NuttX does this very differently:
There are no device numbers, rather the pseudo-file system <cite>is</cite>
the device registry! In NuttX, device files cannot be created
by users; they can only be created by device drivers by calling
the following, internal interface:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">register_driver</span><span class="p">(</span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">FAR</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">file_operations</span><span class="w"> </span><span class="o">*</span><span class="n">fops</span><span class="p">,</span><span class="w"> </span><span class="kt">mode_t</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">FAR</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">path</span></code> argument determines where in the pseudo-file system the
device file should be placed. <code class="docutils literal notranslate"><span class="pre">mode</span></code> provides device file privileges.
The <code class="docutils literal notranslate"><span class="pre">fops</span></code> and <code class="docutils literal notranslate"><span class="pre">priv</span></code> provide the internal information for the <code class="docutils literal notranslate"><span class="pre">registry</span></code>.</p>
<p>So the when you open a device driver in NuttX, many fewer steps are
involved: The system must still open the device file, but then
since the pseudo-file system <cite>is</cite> the device registry, all of the
device driver information is available and <code class="docutils literal notranslate"><span class="pre">open</span></code> operation
completes with no further actions.</p>
</section>
<section id="named-resources">
<h2>Named Resources<a class="headerlink" href="#named-resources" title="Permalink to this heading"></a></h2>
<p>This use of the pseudo-file system in NuttX to manage device
files is consistent with a core NuttX device philosophy: The
NuttX VFS and the pseudo-file system in particular, are used
to manage all named OS resources. That applies not only to
device files and other special files but also to such things
named message queues and named semaphores (which can be found
in the pseudo-file system in the <code class="docutils literal notranslate"><span class="pre">/var</span></code> directory).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pseudofs.html" class="btn btn-neutral float-left" title="Pseudo File System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="v9fs.html" class="btn btn-neutral float-right" title="V9FS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>