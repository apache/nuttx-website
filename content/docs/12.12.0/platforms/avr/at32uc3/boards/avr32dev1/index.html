<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AVR32DEV1 &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
      <script src="../../../../../_static/jquery.js"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
      <script src="../../../../../_static/doctools.js"></script>
      <script src="../../../../../_static/sphinx_highlight.js"></script>
      <script src="../../../../../_static/clipboard.min.js"></script>
      <script src="../../../../../_static/copybutton.js"></script>
      <script src="../../../../../_static/design-tabs.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Microchip AT90USB" href="../../../at90usb/index.html" />
    <link rel="prev" title="Microchip AT32UC3" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    <option value="../../../../../../12.2.0" >12.2.0</option>
    
    <option value="../../../../../../12.2.1" >12.2.1</option>
    
    <option value="../../../../../../12.3.0" >12.3.0</option>
    
    <option value="../../../../../../12.4.0" >12.4.0</option>
    
    <option value="../../../../../../12.5.0" >12.5.0</option>
    
    <option value="../../../../../../12.5.1" >12.5.1</option>
    
    <option value="../../../../../../12.6.0" >12.6.0</option>
    
    <option value="../../../../../../12.7.0" >12.7.0</option>
    
    <option value="../../../../../../12.8.0" >12.8.0</option>
    
    <option value="../../../../../../12.9.0" >12.9.0</option>
    
    <option value="../../../../../../12.10.0" >12.10.0</option>
    
    <option value="../../../../../../12.11.0" >12.11.0</option>
    
    <option value="../../../../../../12.12.0" >12.12.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../arm/index.html">ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../arm64/index.html">ARM64</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Microchip AVR</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">Microchip AT32UC3</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">AVR32DEV1</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../at90usb/index.html">Microchip AT90USB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../atmega/index.html">Microchip Atmega</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../avrdx/index.html">Microchip DA/DB family</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../common/constants-in-progmem.html">Keeping constants in program memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../common/context-switch-notes.html">Notes on AVR context switch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ceva/index.html">CEVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../hc/index.html">HC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mips/index.html">MIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misco/index.html">Misoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../or1k/index.html">OpenRISC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../renesas/index.html">Renesas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/index.html">Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/network_linux.html">Network Support on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/network_vpnkit.html">Network support with VPNKit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sparc/index.html">SPARC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tricore/index.html">TriCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86/index.html">Intel 80x86</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../x86_64/index.html">Intel 80x86_64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../xtensa/index.html">Xtensa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z16/index.html">Z16</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../z80/index.html">Z80</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../standards/index.html">Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../logos/index.html">NuttX Logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../_tags/tagsindex.html">Tags</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Microchip AVR</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Microchip AT32UC3</a></li>
      <li class="breadcrumb-item active">AVR32DEV1</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/nuttx/blob/master/Documentation/platforms/avr/at32uc3/boards/avr32dev1/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="avr32dev1">
<h1>AVR32DEV1<a class="headerlink" href="#avr32dev1" title="Permalink to this heading"></a></h1>
<p class="tags"><span>Tags: </span><a class="sd-sphinx-override sd-badge sd-bg-secondary sd-bg-text-secondary reference internal" href="../../../../../_tags/chip-at32uc3.html"><span class="doc">chip:at32uc3</span></a><span> </span><a class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary reference internal" href="../../../../../_tags/arch-avr.html"><span class="doc">arch:avr</span></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This port is functional but very basic. There are configurations for NSH
and the OS test.</p>
</div>
<p>This is a port of NuttX to the Atmel AVR32DEV1 board and compatible
with MCUZone UC3B-CPU board depicted here:</p>
<figure class="align-center" id="id1">
<img alt="The MCUZone AVR32DEV1 board" src="../../../../../_images/mcuzone_uc3b-cpu.png" />
<figcaption>
<p><span class="caption-text">The MCUZone AVR32DEV1 board.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>This board is based on the Atmel AT32UC3B0256 MCU and uses a specially patched
version of the GNU toolchain: The patches provide support for the AVR32 family.
That patched GNU toolchain is available only from the Atmel website.</p>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>AVR32 AT32UC3B0256 microcontroller</p></li>
<li><p>mini-USB Connector</p></li>
<li><p>Power LED (LED1)</p></li>
<li><p>MCU controllable LEDs: LED2 and LED3</p></li>
<li><p>S1/RESET and S2 buttons (S2 accessible to user)</p></li>
<li><p>12MHz (main clock) and 32KHz for RTC</p></li>
</ul>
</section>
<section id="serial-console">
<h2>Serial Console<a class="headerlink" href="#serial-console" title="Permalink to this heading"></a></h2>
<p>The board uses by default the USART1 as serial console. The pins PB2 (TXD) and
PA24 (RXD) are used for USART1.</p>
<p>This way you need to connect a USB/Serial adapter to get access to the
NuttShell. Connect the TXD from your USB/Serial to the RXD of the board, and the
RXD from USB/Serial to the TXD of the board.</p>
<p>There is another detail about the baudrate, you need to use 57600 8n1.</p>
<p>The AVR32DEV1 board has no RS-232 drivers or connectors on board. An off-board
MAX232 module was used (search for MAX232 if you want to find one). The MAX232
board was connected as follows:</p>
<p>In <code class="docutils literal notranslate"><span class="pre">boards/avr/at32uc3/avr32dev/include/board.h</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PINMUX_USART1_RXD   PINMUX_USART1_RXD_1</span>
<span class="cp">#define PINMUX_USART1_TXD   PINMUX_USART1_TXD_1</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">arch/avr/src/at32uc3/at32uc3b_pinmux.h</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PINMUX_USART1_RXD_1 (GPIO_PERIPH | GPIO_FUNCD | GPIO_PORTA | 17)</span>
<span class="cp">#define PINMUX_USART1_TXD_1 (GPIO_PERIPH | GPIO_FUNCA | GPIO_PORTA | 23)</span>
</pre></div>
</div>
<p>PA17 and PA23 are available from the AVR32DEV1:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>FUNC</p></th>
<th class="head"><p>GPIO</p></th>
<th class="head"><p>PIN</p></th>
<th class="head"><p>Header 16X2 (J1)</p></th>
<th class="head"><p>MX232 Board</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RXD</p></td>
<td><p>PA17</p></td>
<td><p>PIN37</p></td>
<td><p>Pin 5</p></td>
<td><p>PIN4 RXD (5V TTL/CMOS)</p></td>
</tr>
<tr class="row-odd"><td><p>TXD</p></td>
<td><p>PA23</p></td>
<td><p>PIN47</p></td>
<td><p>Pin 15</p></td>
<td><p>PIN3 TXD (5V TTL/CMOS)</p></td>
</tr>
<tr class="row-even"><td><p>–</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>PIN2 GND</p></td>
</tr>
<tr class="row-odd"><td><p>–</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>PIN1 VCC (5V)</p></td>
</tr>
</tbody>
</table>
<p>Voltage on GPIO Pins with respect to ground for TCK, RESET_N, PA03-PA08,
PA11-PA12, PA18-PA19, PA28-PA31: 0.3 to 3.6V</p>
<p>Other Pins: -0.3 to 5.5V</p>
<p>The 5V are taken from another USB port (using the 5V power cable that normally
provides the extra current needed by my USB IDE drive).</p>
</section>
<section id="buttons-and-leds">
<h2>Buttons and LEDs<a class="headerlink" href="#buttons-and-leds" title="Permalink to this heading"></a></h2>
<p>The only GPIO pin usage is for LEDs (2) and Buttons (2):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>ID</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PIN 13</p></td>
<td><p>PA7</p></td>
<td><p>LED1</p></td>
</tr>
<tr class="row-odd"><td><p>PIN 14</p></td>
<td><p>PA8</p></td>
<td><p>LED2</p></td>
</tr>
<tr class="row-even"><td><p>PIN 24</p></td>
<td><p>PB2</p></td>
<td><p>KEY1</p></td>
</tr>
<tr class="row-odd"><td><p>PIN 25</p></td>
<td><p>PB3</p></td>
<td><p>KEY2</p></td>
</tr>
</tbody>
</table>
<p>The reset button may not be really reliable; if you reset and something weird
happens, try a full power cycle.</p>
</section>
<section id="gpio-pin-configuration">
<h2>GPIO Pin Configuration<a class="headerlink" href="#gpio-pin-configuration" title="Permalink to this heading"></a></h2>
<p>For crystals, JTAG, and USB:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>ID</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PIN 30</p></td>
<td><p>PA11</p></td>
<td><p>XIN32</p></td>
</tr>
<tr class="row-odd"><td><p>PIN 31</p></td>
<td><p>PA12</p></td>
<td><p>XOUT32</p></td>
</tr>
<tr class="row-even"><td><p>PIN 35</p></td>
<td><p>PA15</p></td>
<td><p>EVTO (JTAG)</p></td>
</tr>
<tr class="row-odd"><td><p>PIN 39</p></td>
<td><p>PA18</p></td>
<td><p>X1IN</p></td>
</tr>
<tr class="row-even"><td><p>PIN 40</p></td>
<td><p>PA19</p></td>
<td><p>X1OUT</p></td>
</tr>
<tr class="row-odd"><td><p>PIN 61</p></td>
<td><p>PA26</p></td>
<td><p>ID (USB)</p></td>
</tr>
</tbody>
</table>
<p>All GPIO pins are brought out through connectors J1 (PINS 33-64)
and J2 (PINS 1-32).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There seems to be some difference in labeling for OSC0 and OSC1 between
MCUZone.com and Atmel.</p>
<p>Oscillator pinout:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>QFP48 Pin</p></th>
<th class="head"><p>QFP64 Pin</p></th>
<th class="head"><p>ID</p></th>
<th class="head"><p>Osc. Pin</p></th>
<th class="head"><p>AVR32DEV1 Label</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>30</p></td>
<td><p>39</p></td>
<td><p>PA18</p></td>
<td><p>XIN0</p></td>
<td><p>X1IN   (12MHz)</p></td>
</tr>
<tr class="row-odd"><td><p>–</p></td>
<td><p>41</p></td>
<td><p>PA28</p></td>
<td><p>XIN1</p></td>
<td><p>PA28   (no crystal)</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>30</p></td>
<td><p>PA11</p></td>
<td><p>XIN32</p></td>
<td><p>XIN32  (32KHz)</p></td>
</tr>
<tr class="row-odd"><td><p>31</p></td>
<td><p>40</p></td>
<td><p>PA19</p></td>
<td><p>XOUT0</p></td>
<td><p>X1OUT  (12Mhz)</p></td>
</tr>
<tr class="row-even"><td><p>–</p></td>
<td><p>42</p></td>
<td><p>PA29</p></td>
<td><p>XOUT1</p></td>
<td><p>PA29   (no crystal)</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>31</p></td>
<td><p>PA12</p></td>
<td><p>XOUT32</p></td>
<td><p>XOUT32 (32 Khz)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These crystal inputs/outputs are analog signals and my assumption is that
they need no pin multiplexing setting to enable them for the external crystal
function.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There is no support for OSC1.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are solder pads for the 32KHz OSC32, but the crystal is not populated
on my board. Therefore, the RTC will have to run from the (uncalibrated)
RCOSC.</p>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>Linux, macOS or Cygwin on Windows can be used for the development environment.
The source has been built only using the GNU toolchain (see below).  Other
toolchains will likely cause problems. Testing was performed using the Cygwin
environment.</p>
<section id="gnu-toolchains">
<h3>GNU Toolchains<a class="headerlink" href="#gnu-toolchains" title="Permalink to this heading"></a></h3>
<section id="atmel-toolchain">
<h4>Atmel Toolchain<a class="headerlink" href="#atmel-toolchain" title="Permalink to this heading"></a></h4>
<p>The build logic in these directories assume that you are using the GNU
toolchain with the Atmel patches.  The patch file, pre-patched tool
sources,and pre-built binaries are available from the Atmel website.</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>CONFIG_AVR32_AVRTOOLSW=y<span class="w">  </span><span class="c1"># Use the windows version</span>
CONFIG_AVR32_AVRTOOLSL=y<span class="w">  </span><span class="c1"># Use the Linux version</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The NuttX builtroot cannot be used to build the AVR32 toolchain. This is
because the Atmel patches that add support for the AVR32 are not included in
the NuttX buildroot.</p>
</div>
</section>
<section id="winavr">
<h4>WinAVR<a class="headerlink" href="#winavr" title="Permalink to this heading"></a></h4>
<p>Another option for use under Windows is WinAVR:
<a class="reference external" href="http://sourceforge.net/projects/winavr/files/">http://sourceforge.net/projects/winavr/files/</a>.</p>
<p>WinAVR includes the AVR32 toolchain as well as the AVR toolchain and various
support libraries and header files.</p>
</section>
<section id="avr32-toolchain-builder">
<h4>AVR32 Toolchain Builder<a class="headerlink" href="#avr32-toolchain-builder" title="Permalink to this heading"></a></h4>
<p>A third option is to build the toolchain yourself. For macOS and Linux systems,
this Makefile will build a complete gcc-4.4.3 toolchain:</p>
<p><a class="reference external" href="https://github.com/jsnyder/avr32-toolchain">https://github.com/jsnyder/avr32-toolchain</a></p>
<p>By default the toolchain installs into <code class="docutils literal notranslate"><span class="pre">${HOME}/avr-32-tools-&lt;somedate&gt;</span></code> and
the bin subdirectory must be added to your path before compiling.</p>
</section>
</section>
</section>
<section id="building-nuttx">
<h2>Building NuttX<a class="headerlink" href="#building-nuttx" title="Permalink to this heading"></a></h2>
<p>Because this build uses a native Windows toolchain and the native Windows tools
do not understand Cygwin’s symbolic links, the NuttX make system does something
weird:  It copies the configuration directories instead of linking to them (it
could, perhaps, use the NTFS ‘mklink’ command, but it doesn’t).</p>
<p>A consequence of this is that you can easily get confused when you edit a file
in one of the “linked” directories, re-build NuttX, and then not see your
changes when you run the program.  That is because build is still using the
version of the file in the copied directory, not your modified file! To work
around this annoying behavior, do the following when you re-build:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>make<span class="w"> </span>clean_context<span class="w"> </span>all<span class="w"> </span><span class="c1"># Remove and re-copy all of the directories, then make all</span>
<span class="gp">$ </span>doisp.sh<span class="w">               </span><span class="c1"># Load the code onto the board.</span>
</pre></div>
</div>
</section>
<section id="flashing">
<h2>Flashing<a class="headerlink" href="#flashing" title="Permalink to this heading"></a></h2>
<section id="avr32-bootloader">
<h3>AVR32 Bootloader<a class="headerlink" href="#avr32-bootloader" title="Permalink to this heading"></a></h3>
<section id="boot-sequence">
<h4>Boot Sequence<a class="headerlink" href="#boot-sequence" title="Permalink to this heading"></a></h4>
<p>“An AVR UC3 part having the bootloader programmed resets as any other part at
80000000h. Bootloader execution begins here. The bootloader first performs the
boot process to know whether it should start the USB DFU ISP or the application.
If the tested conditions indicate that the USB DFU ISP should be started, then
execution continues in the bootloader area, i.e. between 80000000h and
80002000h, else the bootloader launches the application at 80002000h.”</p>
</section>
<section id="link-address">
<h4>Link Address<a class="headerlink" href="#link-address" title="Permalink to this heading"></a></h4>
<p>The linker scripts (ld.script) assume that you are using the DFU
bootloader.  The bootloader resides at 0x8000:0000 and so the ld.script
files link the application to execute after the bootloader at
0x8000:2000. To link so that NuttX boots directly without using the
bootloader, change the flash definition from:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>flash (rxai!w)  : ORIGIN = 0x80002000, LENGTH = 256K - 8K
</pre></div>
</div>
<p>to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>flash (rxai!w)  : ORIGIN = 0x80000000, LENGTH = 256K
</pre></div>
</div>
<p>Or to use the MSC bootloader:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>flash (rxai!w)  : ORIGIN = 0x80008000, LENGTH = 256K - 32K
</pre></div>
</div>
</section>
<section id="entering-the-isp">
<h4>Entering the ISP<a class="headerlink" href="#entering-the-isp" title="Permalink to this heading"></a></h4>
<p>In order to use the USB port to download the FLASH(ISP), you need to use the
S3(PA13) to make CPU return to boot status. In this mode, the on chip bootloader
will run, making the ISP possible.</p>
</section>
<section id="batchisp">
<h4>BatchISP<a class="headerlink" href="#batchisp" title="Permalink to this heading"></a></h4>
<p>Unlike other Atmel parts, the AVR32 will not work with the FLIP GUI program.
Instead, you must use the command-line loader call BatchISP. If need to download
FLIP from the atmel.com website, install the USB driver in the FLIP usb
directory. Then in the bin directory where you installed FLIP, you will also
find <code class="docutils literal notranslate"><span class="pre">batchisp.exe</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will need to set the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable to include the path to
the BatchISP bin directory.</p>
</div>
<p><strong>Notes from “AVR32 UC3 USB DFU Bootloader” (doc7745.pdf)</strong></p>
<blockquote>
<div><p>“To launch BatchISP, open a command prompt. Windows or Cygwin command
prompt can be used provided that the bin folder of the FLIP installation
directory is in the PATH (Windows’ or Cygwin’s) environment variable.
When running BatchISP on AT32UC3xxxxx, the target part has to be specified
with -device at32uc3xxxxx and the communication port with -hardware usb.
Commands can then be placed after -operation. These commands are executed
in order. BatchISP options can be placed in a text file invoked using
-cmdfile rather than on the command line.</p>
<dl class="simple">
<dt>“BatchISP works with an internal ISP buffer per target memory. These ISP</dt><dd><p>buffers can be filled from several sources. All target operations (program,
verify, read) are performed using these buffers.”</p>
</dd>
</dl>
<p>The following BatchISP command line will erase FLASH, write the nuttx binary
into FLASH, and reset the AVR32.  This command line is available in the
script <code class="docutils literal notranslate"><span class="pre">config/avr32dev1/tools/doisp.sh</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>batchisp<span class="w"> </span>-device<span class="w"> </span>at32uc3b0256<span class="w"> </span>-hardware<span class="w"> </span>usb<span class="w"> </span>-operation<span class="w"> </span>erase<span class="w"> </span>f<span class="w"> </span>memory<span class="w"> </span>flash<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>blankcheck<span class="w"> </span>loadbuffer<span class="w"> </span>nuttx.elf<span class="w"> </span>program<span class="w"> </span>verify<span class="w"> </span>start<span class="w"> </span>reset<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<p>“BatchISP main commands available on AT32UC3xxxxx are:</p>
<blockquote>
<div><ul class="simple">
<li><p>ASSERT { PASS | FAIL } changes the displayed results of the following
operations according to the expected behavior.</p></li>
<li><p>ONFAIL { ASK | ABORT | RETRY | IGNORE } changes the interactive behavior
of BatchISP in case of failure.</p></li>
<li><p>WAIT &lt;Nsec&gt; inserts a pause between two ISP operations.</p></li>
<li><p>ECHO &lt;comment&gt; displays a message.</p></li>
<li><p>ERASE F erases internal flash contents, except the bootloader.</p></li>
<li><p>MEMORY { FLASH | SECURITY | CONFIGURATION | BOOTLOADER | SIGNATURE | USER }
selects a target memory on which to apply the following operations.</p></li>
<li><p>ADDRANGE &lt;addrMin&gt; &lt;addrMax&gt; selects in the current target memory an
address range on which to apply the following operations.</p></li>
<li><p>BLANKCHECK checks that the selected address range is erased.</p></li>
<li><p>FILLBUFFER &lt;data&gt; fills the ISP buffer with a byte value.</p></li>
<li><p>LOADBUFFER { &lt;in_elffile&gt; | &lt;in_hexfile&gt; } loads the ISP buffer from an
input file.</p></li>
<li><p>PROGRAM programs the selected address range with the ISP buffer.</p></li>
<li><p>VERIFY verifies that the selected address range has the same contents
as the ISP buffer.</p></li>
<li><p>READ reads the selected address range to the ISP buffer.</p></li>
<li><p>SAVEBUFFER &lt;out_hexfile&gt; { HEX386 | HEX86 } saves the ISP buffer to an
output file.</p></li>
<li><p>START { RESET | NORESET } 0 starts the execution of the programmed
application with an optional hardware reset of the target.</p></li>
</ul>
</div></blockquote>
<p>“The AT32UC3xxxxx memories made available by BatchISP are:</p>
<ul class="simple">
<li><p>FLASH: This memory is the internal flash array of the target, including the
bootloader protected area. E.g. on AT32UC3A0512 (512-kB internal flash),
addresses from 0 to 0x7FFFF can be accessed in this memory.</p></li>
<li><p>SECURITY: This memory contains only one byte. The least significant bit
of this byte reflects the value of the target Security bit which can only
be set to 1. Once set, the only accepted commands will be ERASE and START.
After an ERASE command, all commands are accepted until the end of the
non-volatile ISP session, even if the Security bit is set.</p></li>
<li><p>CONFIGURATION: This memory contains one byte per target general-purpose
fuse bit.  The least significant bit of each byte reflects the value of
the corresponding GP fuse bit.</p></li>
<li><p>BOOTLOADER: This memory contains three bytes concerning the ISP: the ISP
version in BCD format without the major version number (always 1), the
ISP ID0 and the ISP ID1.</p></li>
<li><p>SIGNATURE: This memory contains four bytes concerning the part: the product
manufacturer ID, the product family ID, the product ID and the product
revision.</p></li>
<li><p>USER: This memory is the internal flash User page of the target, with
addresses from 0 to 0x1FF.</p></li>
</ul>
<p>“For further details about BatchISP commands, launch <code class="docutils literal notranslate"><span class="pre">batchisp</span> <span class="pre">-h</span></code> or see
the help files installed with FLIP …”</p>
</div></blockquote>
</section>
</section>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<p>Configurations can be selected using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tools/configure.sh<span class="w"> </span>avr32dev1:&lt;config&gt;
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> is one of the following configurations.</p>
<section id="nsh">
<h3>nsh<a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h3>
<p>Configures the NuttShell (<code class="docutils literal notranslate"><span class="pre">nsh</span></code>). The Configuration enables only the serial
NSH interface.</p>
</section>
<section id="ostest">
<h3>ostest<a class="headerlink" href="#ostest" title="Permalink to this heading"></a></h3>
<p>This configuration directory, performs a simple OS test using <code class="docutils literal notranslate"><span class="pre">ostest</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Round-robin scheduling is disabled in this test because the RR test in
examples/ostest declares data structures that are too large for the poor
little uc3 SRAM.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../index.html" class="btn btn-neutral float-left" title="Microchip AT32UC3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../at90usb/index.html" class="btn btn-neutral float-right" title="Microchip AT90USB" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>