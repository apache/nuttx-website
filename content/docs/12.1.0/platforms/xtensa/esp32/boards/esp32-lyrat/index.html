<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ESP32-LyraT V4.3 &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="ESP-WROVER-KIT" href="../esp32-wrover-kit/index.html" />
    <link rel="prev" title="ESP32-Ethernet-Kit V1.2" href="../esp32-ethernet-kit/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../../../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../../../../latest" selected="selected">latest</option>
    
    <option value="../../../../../../10.0.0" >10.0.0</option>
    
    <option value="../../../../../../10.0.1" >10.0.1</option>
    
    <option value="../../../../../../10.1.0" >10.1.0</option>
    
    <option value="../../../../../../10.2.0" >10.2.0</option>
    
    <option value="../../../../../../10.3.0" >10.3.0</option>
    
    <option value="../../../../../../11.0.0" >11.0.0</option>
    
    <option value="../../../../../../12.0.0" >12.0.0</option>
    
    <option value="../../../../../../12.1.0" >12.1.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../arm/index.html">ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../avr/index.html">AVR8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sim/index.html">Simulators</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Xtensa</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">Espressif ESP32</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../index.html#toolchain">Toolchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#flashing">Flashing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#peripheral-support">Peripheral Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#memory-map">Memory Map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#bit-timers">64-bit Timers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#watchdog-timers">Watchdog Timers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#smp">SMP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#wi-fi">Wi-Fi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#wi-fi-softap">Wi-Fi SoftAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#bluetooth">Bluetooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#i2s">I2S</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#using-qemu">Using QEMU</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#secure-boot-and-flash-encryption">Secure Boot and Flash Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index.html#things-to-do">Things to Do</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#supported-boards">Supported Boards</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="../esp32-audio-kit/index.html">ESP32-AUDIO-KIT</a></li>
<li class="toctree-l5"><a class="reference internal" href="../esp32-devkitc/index.html">ESP32 DevKitC</a></li>
<li class="toctree-l5"><a class="reference internal" href="../esp32-ethernet-kit/index.html">ESP32-Ethernet-Kit V1.2</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">ESP32-LyraT V4.3</a></li>
<li class="toctree-l5"><a class="reference internal" href="../esp32-wrover-kit/index.html">ESP-WROVER-KIT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../esp32s2/index.html">Espressif ESP32-S2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../esp32s3/index.html">Espressif ESP32-S3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Xtensa</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Espressif ESP32</a></li>
      <li class="breadcrumb-item active">ESP32-LyraT V4.3</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/platforms/xtensa/esp32/boards/esp32-lyrat/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="esp32-lyrat-v4-3">
<h1>ESP32-LyraT V4.3<a class="headerlink" href="#esp32-lyrat-v4-3" title="Permalink to this heading"></a></h1>
<p>The ESP32-LyraT development board is a hardware platform designed for the
dual-core ESP32 audio applications, e.g., Wi-Fi or BT audio speakers,
speech-based remote controllers, smart-home appliances with audio
functionality(ies), etc. You can find the board schematic <a class="reference external" href="https://dl.espressif.com/dl/schematics/ESP32-LYRAT_V4.3-20220119.pdf">here</a>.</p>
<figure class="align-center align-default" id="id1">
<img alt="ESP32 LyraT V4.3 Board Layout" src="../../../../../_images/esp32-lyrat-v4.3-layout-with-wrover-e-module.jpg" />
<figcaption>
<p><span class="caption-text">ESP32-LyraT V4.3 Board Layout</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The block diagram below presents main components of the ESP32-LyraT.</p>
<figure class="align-center align-default" id="id2">
<img alt="ESP32 LyraT V4.3 Electrical Block Diagram" src="../../../../../_images/esp32-lyrat-v4.3-electrical-block-diagram-with-wrover-e-module.png" />
<figcaption>
<p><span class="caption-text">ESP32-LyraT V4.3 Electrical Block Diagram</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>ESP32-WROVER-E Module</p></li>
<li><p>JTAG Interface</p></li>
<li><p>MicroSD Slot</p></li>
<li><p>Audio Codec Chip</p></li>
<li><p>Battery Charger Chip</p></li>
<li><p>Touch Pad Buttons</p></li>
</ul>
</div></blockquote>
</section>
<section id="serial-console">
<h2>Serial Console<a class="headerlink" href="#serial-console" title="Permalink to this heading"></a></h2>
<p>UART0 is, by default, the serial console. It connects to the on-board
CP2102N bridge and is available on the USB connector.</p>
<p>It will show up as /dev/ttyUSB[n] where [n] will probably be 0.</p>
</section>
<section id="buttons-and-leds">
<h2>Buttons and LEDs<a class="headerlink" href="#buttons-and-leds" title="Permalink to this heading"></a></h2>
<section id="board-buttons">
<h3>Board Buttons<a class="headerlink" href="#board-buttons" title="Permalink to this heading"></a></h3>
<p>Two key labeled <em>Rec</em> and <em>Mode</em>. They are routed to <strong>ESP32-WROVER-E Module</strong>
and intended for developing and testing a UI for audio applications using
dedicated API.</p>
<p>Four touch pads labeled <em>Play</em>, <em>Sel</em>,  <em>Vol+</em> and <em>Vol-</em>.
They are routed to <strong>ESP32-WROVER-E Module</strong> and intended for development and
testing of a UI for audio applications using dedicated API. <strong>They are currently
not supported as the driver is in development.</strong></p>
<p>There are two buttons labeled Boot and EN. The EN button pulls the chip enable
line that doubles as a reset line. The BOOT button is connected to IO0. On
reset it is used as a strapping pin to determine whether the chip boots
normally or into the serial bootloader.</p>
<p>Entering of the ESP32 into upload mode may be done in two ways:</p>
<ul class="simple">
<li><p>Manually by pressing both <strong>Boot</strong> and <strong>RST</strong> keys and then releasing first
<strong>RST</strong> and then <strong>Boot</strong> key.</p></li>
<li><p>Automatically by software performing the upload. The software is using
<strong>DTR</strong> and <strong>RTS</strong> signals of the serial interface to control states of
<strong>EN</strong>, <strong>IO0</strong> and <strong>IO2</strong> pins of the ESP32. This functionality is enabled
by installing jumpers in three headers <strong>JP23</strong>, <strong>JP24</strong> and <strong>JP25</strong>.
Remove all jumpers after upload is complete.</p></li>
</ul>
</section>
<section id="board-leds">
<h3>Board LEDs<a class="headerlink" href="#board-leds" title="Permalink to this heading"></a></h3>
<p>A general purpose green LED controlled by the <strong>ESP32-WROVER-E Module</strong> to
indicate certain operation states of the audio application using dedicated
API. It can also be used by the user for other purposes.</p>
<p>The <strong>Standby</strong> green LED indicates that power has been applied to the
<strong>Micro USB Port</strong>. The <strong>Charging</strong> red LED indicates that a battery
connected to the <strong>Battery Socket</strong> is being charged.</p>
</section>
</section>
<section id="audio-codec">
<h2>Audio Codec<a class="headerlink" href="#audio-codec" title="Permalink to this heading"></a></h2>
<p><strong>This is currently unsupported. Drivers still in development.</strong></p>
<p>The Audio Codec Chip, <a class="reference external" href="http://www.everest-semi.com/pdf/ES8388%20DS.pdf">ES8388</a>,
is a low power stereo audio codec with a headphone amplifier. It consists
of 2-channel ADC, 2-channel DAC, microphone amplifier, headphone amplifier
, digital sound effects, analog mixing and gain functions. It is
interfaced with <strong>ESP32-WROVER-E Module</strong> over I2S and I2S buses to
provide audio processing in hardware independently from the audio
application.</p>
<p>It also provides:</p>
<blockquote>
<div><ul class="simple">
<li><p>Onboard microphone connected to IN1 of the <strong>Audio Codec Chip</strong>.</p></li>
<li><p>Auxiliary input socket connected to IN2 (left and right channel) of the
<strong>Audio Codec Chip</strong>. Use a 3.5 mm stereo jack to connect to this socket.</p></li>
<li><p>Output socket to connect headphones with a 3.5 mm stereo jack.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The socket may be used with mobile phone headsets and is compatible
with OMPT standard headsets only. It does work with CTIA headsets.
Please refer to <a class="reference external" href="https://en.wikipedia.org/wiki/Phone_connector_(audio)#TRRS_standards">Phone connector (audio)</a>
on Wikipedia.</p>
</div>
<ul class="simple">
<li><p>Output socket to connect a speaker. The 4-ohm and 3-watt speaker is
recommended. The pins have a 2.00 mm / 0.08” pitch.</p></li>
</ul>
</div></blockquote>
<p>The development board uses two mono Class D amplifier ICs, model number NS4150
with maximum output power of 3W and operating voltage from 3.0V to 5.25V.
The audio input source is the digital-to-analog converter (DAC) output of the
ES8388. Audio output supports two external speakers.
An optional audio output is a pair of headphones feed from the same DACs as
the amplifier ICs.</p>
<p>To switch between using headphones and speakers, the board provides a digital
input signal to detect when a headphone jack is inserted and a digital output
signal to enable or disable the amplifier ICs. In other words selection
between speakers and headphones is under software control instead of using
mechanical contacts that would disconnect speakers once a headphone jack is
inserted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The codec implementation on the LyraT board was validated using 16-bit,
44.1kHz WAV files. Other configurations might not work as expected.</p>
</div>
</section>
<section id="sd-card">
<h2>SD card<a class="headerlink" href="#sd-card" title="Permalink to this heading"></a></h2>
<p>The development board supports a MicroSD card in SPI/1-bit/4-bit modes,
and can store or play audio files in the MicroSD card. Note that <strong>JTAG</strong>
cannot be used and should be disconnected by setting <strong>Function DIP
Switch</strong> when <strong>MicroSD Card</strong> is in operation, because some of signals
are shared by both devices.</p>
<section id="enable-microsd-card-in-1-wire-mode">
<h3>Enable MicroSD Card in 1-wire Mode<a class="headerlink" href="#enable-microsd-card-in-1-wire-mode" title="Permalink to this heading"></a></h3>
<p>Set <strong>Function DIP Switch</strong> to:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>DIP SW</p></th>
<th class="head"><p>Position</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>OFF <sup>1</sup></p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>n/a</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><p><strong>AUX Input</strong> detection may be enabled by toggling the DIP SW 7 <em>ON</em>.
Note that the <strong>AUX Input</strong> signal pin should not be be plugged in when the
system powers up. Otherwise the ESP32 may not be able to boot correctly.</p></li>
</ol>
<p>In this mode:</p>
<ul class="simple">
<li><p><strong>JTAG</strong> functionality is not available</p></li>
<li><p><em>Vol-</em> touch button is available for use with the API</p></li>
</ul>
</section>
<section id="enable-microsd-card-in-4-wire-mode">
<h3>Enable MicroSD Card in 4-wire Mode<a class="headerlink" href="#enable-microsd-card-in-4-wire-mode" title="Permalink to this heading"></a></h3>
<p>Set <strong>Function DIP Switch</strong> to:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>DIP SW</p></th>
<th class="head"><p>Position</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>n/a</p></td>
</tr>
</tbody>
</table>
<p>In this mode:</p>
<ul class="simple">
<li><p><strong>JTAG</strong> functionality is not available</p></li>
<li><p><em>Vol-</em> touch button is not available for use with the API</p></li>
<li><p><strong>AUX Input</strong> detection from the API is not available</p></li>
</ul>
</section>
</section>
<section id="jtag">
<h2>JTAG<a class="headerlink" href="#jtag" title="Permalink to this heading"></a></h2>
<p>Provides access to the <strong>JTAG</strong> interface of <strong>ESP32-WROVER-E Module</strong>.
It may be used for debugging, application upload, as well as implementing
several other functions.</p>
<section id="enable-jtag">
<h3>Enable JTAG<a class="headerlink" href="#enable-jtag" title="Permalink to this heading"></a></h3>
<p>Set <strong>Function DIP Switch</strong> to:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>DIP SW</p></th>
<th class="head"><p>Position</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>OFF</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>ON</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>n/a</p></td>
</tr>
</tbody>
</table>
<p>In this mode:</p>
<ul class="simple">
<li><p><strong>MicroSD Card</strong> functionality is not available, remove the card from the slot</p></li>
<li><p><em>Vol-</em> touch button is not available for use with the API</p></li>
<li><p><strong>AUX Input</strong> detection from the API is not available</p></li>
</ul>
</section>
</section>
<section id="battery">
<h2>Battery<a class="headerlink" href="#battery" title="Permalink to this heading"></a></h2>
<p>The board has a constant current &amp; constant voltage linear charger for single cell
lithium-ion batteries AP5056. Used for charging of a battery connected to
the <strong>Battery Socket</strong> over the <strong>Micro USB Port</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please verify if polarity on the battery plug matches polarity of the
socket as marked on the board’s soldermask besides the socket.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>Power On Switch</strong> does not affect/disconnect the Li-ion
battery charging.</p>
</div>
</section>
<section id="pin-mapping">
<h2>Pin Mapping<a class="headerlink" href="#pin-mapping" title="Permalink to this heading"></a></h2>
<p>Several pins ESP32 module are allocated to the on board hardware. Some of
them, like GPIO0 or GPIO2, have multiple functions. Please refer to the table
below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>GPIO Pin</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Function Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SENSOR_VP</p></td>
<td><p>I</p></td>
<td><p>Audio <strong>Rec</strong> (PB)</p></td>
</tr>
<tr class="row-odd"><td><p>SENSOR_VN</p></td>
<td><p>I</p></td>
<td><p>Audio <strong>Mode</strong> (PB)</p></td>
</tr>
<tr class="row-even"><td><p>IO32</p></td>
<td><p>I/O</p></td>
<td><p>Audio <strong>Set</strong> (TP)</p></td>
</tr>
<tr class="row-odd"><td><p>IO33</p></td>
<td><p>I/O</p></td>
<td><p>Audio <strong>Play</strong> (TP)</p></td>
</tr>
<tr class="row-even"><td><p>IO27</p></td>
<td><p>I/O</p></td>
<td><p>Audio <strong>Vol+</strong> (TP)</p></td>
</tr>
<tr class="row-odd"><td><p>IO13</p></td>
<td><p>I/O</p></td>
<td><p>JTAG <strong>MTCK</strong>, MicroSD <strong>D3</strong>, Audio <strong>Vol-</strong> (TP)</p></td>
</tr>
<tr class="row-even"><td><p>IO14</p></td>
<td><p>I/O</p></td>
<td><p>JTAG <strong>MTMS</strong>, MicroSD <strong>CLK</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO12</p></td>
<td><p>I/O</p></td>
<td><p>JTAG <strong>MTDI</strong>, MicroSD <strong>D2</strong>, Aux signal <strong>detect</strong></p></td>
</tr>
<tr class="row-even"><td><p>IO15</p></td>
<td><p>I/O</p></td>
<td><p>JTAG <strong>MTDO</strong>, MicroSD <strong>CMD</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO2</p></td>
<td><p>I/O</p></td>
<td><p>Automatic Upload, MicroSD <strong>D0</strong></p></td>
</tr>
<tr class="row-even"><td><p>IO4</p></td>
<td><p>I/O</p></td>
<td><p>MicroSD <strong>D1</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO34</p></td>
<td><p>I</p></td>
<td><p>MicroSD insert <strong>detect</strong></p></td>
</tr>
<tr class="row-even"><td><p>IO0</p></td>
<td><p>I/O</p></td>
<td><p>Automatic Upload, I2S <strong>MCLK</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO5</p></td>
<td><p>I/O</p></td>
<td><p>I2S <strong>SCLK</strong></p></td>
</tr>
<tr class="row-even"><td><p>IO25</p></td>
<td><p>I/O</p></td>
<td><p>I2S <strong>LRCK</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO26</p></td>
<td><p>I/O</p></td>
<td><p>I2S <strong>DSDIN</strong></p></td>
</tr>
<tr class="row-even"><td><p>IO35</p></td>
<td><p>I</p></td>
<td><p>I2S <strong>ASDOUT</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO19</p></td>
<td><p>I/O</p></td>
<td><p>Headphone jack insert <strong>detect</strong></p></td>
</tr>
<tr class="row-even"><td><p>IO22</p></td>
<td><p>I/O</p></td>
<td><p>Green LED indicator</p></td>
</tr>
<tr class="row-odd"><td><p>IO21</p></td>
<td><p>I/O</p></td>
<td><p>PA Enable output</p></td>
</tr>
<tr class="row-even"><td><p>IO18</p></td>
<td><p>I/O</p></td>
<td><p>I2C <strong>SDA</strong></p></td>
</tr>
<tr class="row-odd"><td><p>IO23</p></td>
<td><p>I/O</p></td>
<td><p>I2C <strong>SCL</strong></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>(TP) - touch pad</p></li>
<li><p>(PB) - push button</p></li>
</ul>
<p>There are several pin headers available to connect external components, check
the state of particular signal bus or debug operation of ESP32. Note that some
signals are shared.</p>
<section id="uart-header-jp2">
<h3>UART Header / JP2<a class="headerlink" href="#uart-header-jp2" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Header Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>3.3V</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>TX</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>RX</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>GND</p></td>
</tr>
</tbody>
</table>
</section>
<section id="i2s-header-jp4">
<h3>I2S Header / JP4<a class="headerlink" href="#i2s-header-jp4" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>I2C Header Pin</p></th>
<th class="head"><p>ESP32 Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>MCLK</p></td>
<td><p>GPIO0</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>SCLK</p></td>
<td><p>GPIO5</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>LRCK</p></td>
<td><p>GPIO25</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>DSDIN</p></td>
<td><p>GPIO26</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>ASDOUT</p></td>
<td><p>GPIO35</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>GND</p></td>
<td><p>GND</p></td>
</tr>
</tbody>
</table>
</section>
<section id="i2c-header-jp5">
<h3>I2C Header / JP5<a class="headerlink" href="#i2c-header-jp5" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>I2C Header Pin</p></th>
<th class="head"><p>ESP32 Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>SCL</p></td>
<td><p>GPIO23</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>SDA</p></td>
<td><p>GPIO18</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>GND</p></td>
<td><p>GND</p></td>
</tr>
</tbody>
</table>
</section>
<section id="jtag-header-jp7">
<h3>JTAG Header / JP7<a class="headerlink" href="#jtag-header-jp7" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>ESP32 Pin</p></th>
<th class="head"><p>JTAG Signal</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>MTDO / GPIO15</p></td>
<td><p>TDO</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>MTCK / GPIO13</p></td>
<td><p>TCK</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>MTDI / GPIO12</p></td>
<td><p>TDI</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>MTMS / GPIO14</p></td>
<td><p>TMS</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>JTAG</strong> cannot be used if <strong>MicroSD Card</strong> is enabled.</p>
</div>
</section>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<p>All of the configurations presented below can be tested by running the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./tools/configure.sh esp32-lyrat:&lt;config_name&gt;
$ make flash ESPTOOL_PORT=/dev/ttyUSB0 -j
</pre></div>
</div>
<p>Where &lt;config_name&gt; is the name of board configuration you want to use, i.e.: nsh, buttons, wifi…
Then use a serial console terminal like <code class="docutils literal notranslate"><span class="pre">picocom</span></code> configured to 115200 8N1.</p>
<section id="audio">
<h3>audio<a class="headerlink" href="#audio" title="Permalink to this heading"></a></h3>
<p>This configuration uses the I2S0 peripheral and the ES8388 audio codec
present on the LyraT board to play an audio file streamed over HTTP
while connected to a Wi-Fi network.</p>
<p><strong>Simple HTTP server</strong></p>
<p>Prepare a PCM-encoded (<cite>.wav</cite>) audio file with 16 bits/sample (sampled at
44.1kHz). This file must be placed into a folder in a computer that could
be accessed on the same Wi-Fi network the ESP32 will be connecting to.</p>
<p>Python provides a simple HTTP server. <cite>cd</cite> to the audio file folder on the
PC and run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m http.server

Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/)
</pre></div>
</div>
<p>Look for your PC IP address and test playing the prepared audio on your
browser:</p>
<figure class="align-center">
<img alt="../../../../../_images/esp32-lyrat-v4.3-audio-config-file.png" src="../../../../../_images/esp32-lyrat-v4.3-audio-config-file.png" />
</figure>
<p>After successfully built and flashed, connect the board to the Wi-Fi network:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ nsh&gt; wapi psk wlan0 mypasswd 1
$ nsh&gt; wapi essid wlan0 myssid 1
$ nsh&gt; renew wlan0
</pre></div>
</div>
<p>Once connected, open NuttX’s player and play the file according to its file
name and the IP address of the HTTP server (For example <cite>tones.wav</cite> and
<cite>192.168.1.239:8000</cite>, respectively):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ nsh&gt; nxplayer
$ nxplayer&gt; play http://192.168.1.239:8000/tones.wav
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The codec implementation on the LyraT board was validated using 16-bit,
44.1kHz WAV files. Other configurations might not work as expected.</p>
</div>
</section>
<section id="buttons">
<h3>buttons<a class="headerlink" href="#buttons" title="Permalink to this heading"></a></h3>
<p>This configuration shows the use of the buttons subsystem. It can be used by executing
the <code class="docutils literal notranslate"><span class="pre">buttons</span></code> application and pressing on any of the available board buttons:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; buttons
buttons_main: Starting the button_daemon
buttons_main: button_daemon started
button_daemon: Running
button_daemon: Opening /dev/buttons
button_daemon: Supported BUTTONs 0x01
nsh&gt; Sample = 1
Sample = 0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BOOT</span></code> is connected to GPIO0 that is shared among some peripherals.
To avoid any conflicts, it’s not registered in the buttons subsystem and, thus,
is unable to be used.</p>
</div>
</section>
<section id="mmcsdspi">
<h3>mmcsdspi<a class="headerlink" href="#mmcsdspi" title="Permalink to this heading"></a></h3>
<p>This configuration is used to mount a FAT/FAT32 SD Card into the OS’ filesystem.
For the ESP32-LyraT, make sure the DIP switches 1 and 2 are turned to the ON position.
To access the card’s files, execute the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t vfat /dev/mmcsd0 /mnt
nsh&gt; ls /mnt/
/mnt:
song_16_88200_2ch.wav
song_16_96000_2ch.wav
song_24_44100_2ch.wav
song_32_44100_2ch.wav
</pre></div>
</div>
</section>
<section id="nsh">
<h3>nsh<a class="headerlink" href="#nsh" title="Permalink to this heading"></a></h3>
<p>Basic NuttShell configuration (console enabled in UART0, exposed via
USB connection by means of the CP2102N bridge, at 115200 bps).</p>
</section>
<section id="nxrecorder">
<h3>nxrecorder<a class="headerlink" href="#nxrecorder" title="Permalink to this heading"></a></h3>
<p>This configuration is used to record raw audio from the the ES8388 audio codec
through the I2S0 peripheral to a FAT32 SD Card. By default the audio is recorded from
the on-board microphones.
For the ESP32-LyraT, make sure the DIP switches 1 and 2 are turned to the ON position.
To record audio, execute the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; mount -t vfat /dev/mmcsd0 /mnt
nsh&gt; nxrecorder
nxrecorder&gt; recordraw /mnt/record.raw
nxrecorder&gt; stop
</pre></div>
</div>
<p>To play the recorded audio, import the raw data into Audacity and set the encoding to signed
16-bit PCM, the sample rate to 44.1kHz and the number of channels to 2.</p>
</section>
<section id="wifi">
<h3>wifi<a class="headerlink" href="#wifi" title="Permalink to this heading"></a></h3>
<p>Enables Wi-Fi support. You can define your credentials this way:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ make menuconfig
-&gt; Application Configuration
    -&gt; Network Utilities
        -&gt; Network initialization (NETUTILS_NETINIT [=y])
            -&gt; WAPI Configuration
</pre></div>
</div>
<p>Or if you don’t want to keep it saved in the firmware you can do it
at runtime:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nsh&gt; wapi psk wlan0 mypasswd 3
nsh&gt; wapi essid wlan0 myssid 1
nsh&gt; renew wlan0
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../esp32-ethernet-kit/index.html" class="btn btn-neutral float-left" title="ESP32-Ethernet-Kit V1.2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../esp32-wrover-kit/index.html" class="btn btn-neutral float-right" title="ESP-WROVER-KIT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>