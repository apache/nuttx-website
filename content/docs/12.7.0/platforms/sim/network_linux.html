<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Network Support on Linux &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
      <script src="../../_static/doctools.js"></script>
      <script src="../../_static/sphinx_highlight.js"></script>
      <script src="../../_static/clipboard.min.js"></script>
      <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Network support with VPNKit" href="network_vpnkit.html" />
    <link rel="prev" title="SIM" href="sim/boards/sim/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../../latest" selected="selected">latest</option>
    
    <option value="../../../10.0.0" >10.0.0</option>
    
    <option value="../../../10.0.1" >10.0.1</option>
    
    <option value="../../../10.1.0" >10.1.0</option>
    
    <option value="../../../10.2.0" >10.2.0</option>
    
    <option value="../../../10.3.0" >10.3.0</option>
    
    <option value="../../../11.0.0" >11.0.0</option>
    
    <option value="../../../12.0.0" >12.0.0</option>
    
    <option value="../../../12.1.0" >12.1.0</option>
    
    <option value="../../../12.2.0" >12.2.0</option>
    
    <option value="../../../12.2.1" >12.2.1</option>
    
    <option value="../../../12.3.0" >12.3.0</option>
    
    <option value="../../../12.4.0" >12.4.0</option>
    
    <option value="../../../12.5.0" >12.5.0</option>
    
    <option value="../../../12.5.1" >12.5.1</option>
    
    <option value="../../../12.6.0" >12.6.0</option>
    
    <option value="../../../12.7.0" >12.7.0</option>
    
    <option value="../../../12.8.0" >12.8.0</option>
    
    <option value="../../../12.9.0" >12.9.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Supported Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../arm/index.html">ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arm64/index.html">ARM64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avr/index.html">Microchip AVR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ceva/index.html">CEVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hc/index.html">HC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mips/index.html">MIPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misco/index.html">Misoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../or1k/index.html">OpenRISC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../renesas/index.html">Renesas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../risc-v/index.html">RISC-V</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Simulators</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="sim/index.html">SIM</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Network Support on Linux</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#host-route-mode">Host Route Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bridge-mode">Bridge Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-1-routing-local-traffic-to-the-bridge">Option 1: Routing Local Traffic to the Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-2-live-network-access">Option 2: Live Network Access</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-at-startup">Configuring at Startup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-script">Setup Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="network_vpnkit.html">Network support with VPNKit</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Network Support on Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#host-route-mode">Host Route Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bridge-mode">Bridge Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#option-1-routing-local-traffic-to-the-bridge">Option 1: Routing Local Traffic to the Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#option-2-live-network-access">Option 2: Live Network Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-at-startup">Configuring at Startup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-script">Setup Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="network_vpnkit.html">Network support with VPNKit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sparc/index.html">SPARC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tricore/index.html">TriCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x86/index.html">Intel 80x86</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x86_64/index.html">Intel 80x86_64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xtensa/index.html">Xtensa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../z16/index.html">Z16</a></li>
<li class="toctree-l2"><a class="reference internal" href="../z80/index.html">Z80</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../implementation/index.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logos/index.html">NuttX Logos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Supported Platforms</a></li>
          <li class="breadcrumb-item"><a href="index.html">Simulators</a></li>
      <li class="breadcrumb-item active">Network Support on Linux</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/platforms/sim/network_linux.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="network-support-on-linux">
<h1>Network Support on Linux<a class="headerlink" href="#network-support-on-linux" title="Permalink to this heading"></a></h1>
<p>The simulation uses the TUN/TAP driver under Linux to provide network support.
It can operate in one of two modes: host routed, or bridged.  In the host
routed case no special configuration is necessary, but by default the
simulation will only be accessible to the host on which it runs.</p>
<p>Bridge mode is recommended where possible.  It requires slightly more effort
to set up, but is much more flexible, and is likely to be easier to maintain
in the end.</p>
<section id="host-route-mode">
<h2>Host Route Mode<a class="headerlink" href="#host-route-mode" title="Permalink to this heading"></a></h2>
<p>If CONFIG_SIM_NET_HOST_ROUTE is enabled, the simulation will create and
maintain a host route from the assigned IP address to the instance’s tap
device.  This route will be updated if the application changes the
simulation’s IP address.  Note that you will not see the simulation’s IP
address on the TAP device if you run ifconfig on the host.</p>
<p>No special setup is required.  Simply assign your simulation a free IP address
on the same network as your host, and everything will Just Work.  Note that if
you assign an IP that is already in use on your network, your host won’t be
able to see it until the simulation is stopped.  The host route will force all
traffic destined for that IP to be sent to the tap interface.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you configure an IP address that is not on the same subnet as your
host, additional manual setup will be required. A helper script,
<cite>tools/simhostroute.sh</cite> is provided that can do this setup on Linux.
On Windows or macOS using host route mode is not recommended.</p>
</div>
<p>Recent versions of Linux require setting kernel capabilities to allow the nuttx
executable access to the tap network driver. You can see more about the tun/tap
driver requiring Linux capabilities here:</p>
<p><a class="reference external" href="https://github.com/torvalds/linux/blob/master/Documentation/networking/tuntap.txt">https://github.com/torvalds/linux/blob/master/Documentation/networking/tuntap.txt</a></p>
<p>The <cite>boards/sim/sim/sim/configs/tcpblaster/defconfig</cite> is known to work in this
configuration.</p>
<p>To compile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>boards/sim/sim/sim/configs/tcpblaster/defconfig<span class="w"> </span>.config
$<span class="w"> </span>make<span class="w"> </span>menuconfig<span class="w">  </span><span class="c1"># optional, to adjust configuration</span>
$<span class="w"> </span>make<span class="w"> </span>clean<span class="p">;</span><span class="w"> </span>make
</pre></div>
</div>
<p>You can do the following after compiling the NuttX simulator:</p>
<p>On Linux:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="c1"># necessary on recent Linux distributions</span>
$<span class="w"> </span>sudo<span class="w"> </span>setcap<span class="w"> </span>cap_net_admin+ep<span class="w"> </span>./nuttx
$<span class="w"> </span><span class="c1"># set up the host route and IP tables rules</span>
$<span class="w"> </span><span class="c1"># replace ens33 with your Ethernet or wireless interface</span>
$<span class="w"> </span>sudo<span class="w"> </span>./tools/simhostroute.sh<span class="w"> </span>ens33<span class="w"> </span>on
$<span class="w"> </span><span class="c1"># start the NuttX simulator</span>
$<span class="w"> </span>./nuttx
</pre></div>
</div>
<p>On the NuttX Simulator:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nsh&gt;<span class="w"> </span><span class="c1"># replace or omit dns if needed, IPv6 line is optional</span>
nsh&gt;<span class="w"> </span>ifconfig<span class="w"> </span>eth0<span class="w"> </span>inet6<span class="w"> </span>fc00::2/112<span class="w"> </span>dns<span class="w"> </span><span class="m">2001</span>:4860:4860::8888
nsh&gt;<span class="w"> </span>ifconfig<span class="w"> </span>eth0<span class="w"> </span><span class="m">10</span>.0.1.2<span class="w"> </span>dns<span class="w"> </span><span class="m">8</span>.8.8.8
nsh&gt;<span class="w"> </span>ifup<span class="w"> </span>eth0
</pre></div>
</div>
<p>On Linux:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="c1"># is nuttx up?</span>
$<span class="w"> </span>ping<span class="w"> </span><span class="m">10</span>.0.1.2
</pre></div>
</div>
</section>
<section id="bridge-mode">
<h2>Bridge Mode<a class="headerlink" href="#bridge-mode" title="Permalink to this heading"></a></h2>
</section>
<section id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this heading"></a></h2>
<p>If CONFIG_SIM_NET_BRIDGE is enabled, the simulation’s tap interface will
automatically be added to the Linux bridge device specified by the
CONFIG_SIM_NET_BRIDGE_DEVICE configuration option.  Note that this MUST be a
pre-existing bridge device, or the initialization will fail.  The simulation
will NOT create the bridge for you.</p>
<p>To create the bridge, first install the bridge utilities package for your
platform (the net-tools RPM in RedHat, for example).  Then execute a
command like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ip link add nuttx0 type bridge</span>
</pre></div>
</div>
<p>This will create the nuttx0 bridge.  Once created, the bridge may be used by
one or more simulations.  You only need one bridge per host; if you start
multiple simulations, they will all be added to the same bridge and can talk
amongst themselves.</p>
</section>
<section id="option-1-routing-local-traffic-to-the-bridge">
<h2>Option 1: Routing Local Traffic to the Bridge<a class="headerlink" href="#option-1-routing-local-traffic-to-the-bridge" title="Permalink to this heading"></a></h2>
<p>If you want the host to be able to talk to the simulator, you will
also need to assign the bridge an IP address (this will be the default
gateway you assign to the simulator) and add a network route.  Note
that the subnet chosen should not already be in use.  For example, if
you want to use the 172.26.23.0/24 subnet for your simluations, you
would do something like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ip link add nuttx0 type bridge</span>
<span class="c1"># ifconfig nuttx0 172.26.23.1/24</span>
</pre></div>
</div>
<p>The standard Linux ifconfig utility will automatically add the appropriate
network route, so no further effort is needed.</p>
</section>
<section id="option-2-live-network-access">
<h2>Option 2: Live Network Access<a class="headerlink" href="#option-2-live-network-access" title="Permalink to this heading"></a></h2>
<p>There are two main methods of giving the simulator access to your network
at large.  One is to set up your Linux host as a router and configure your
network so that it knows where to find the appropriate subnet.  This is far
too complex for most use cases, so you can safely ignore it unless you have
specific needs.</p>
<p>The recommended method is to add a real interface to the bridge you’re using
with NuttX.  For example, if you have a secondary eth1 interface on your host,
you can simply connect it to the network you want your simulations to access,
and run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ip link set eth1 master nuttx0</span>
</pre></div>
</div>
<p>From that point on, your simulations will be directly connected to the same
network as your eth1 interface.  Note that your bridge will generally not need
an IP address in this case.</p>
<p>If you only have a single interface, you can configure your system so that eth0
(or other primary interface) is on the bridge.  To do this, you would execute
commands like the following from the system console:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ip link add nuttx0 type bridge</span>
<span class="c1"># ip link set eth0 master nuttx0</span>
<span class="c1"># ifconfig nuttx0 &lt;host-ip-address/netmask&gt;</span>
<span class="c1"># route add -net default gw ...</span>
</pre></div>
</div>
<p>The rest of your network configuration would remain the same; your host’s IP
address has simply moved from being assigned directly to the ethernet interface,
to being assigned to the bridge that contains that interface.  The connection
will operate as normal.  NuttX simulations will join the bridge as with the
previous example.</p>
<p>In either of the live access scenarios presented here, the default gateway you
configure in your simluation should be the normal one for the network you’re
accessing, whether or not the bridge has an IP address.  The bridge is acting
as an ethernet hub; your simluation has direct access to the normal gateway as
if the simluation were a device physically connected to the network.</p>
</section>
<section id="configuring-at-startup">
<h2>Configuring at Startup<a class="headerlink" href="#configuring-at-startup" title="Permalink to this heading"></a></h2>
<p>Most Linux distributions have a mechanism for configuring a bridge at startup.
See your distribution’s documentation for more information.</p>
</section>
<section id="setup-script">
<h2>Setup Script<a class="headerlink" href="#setup-script" title="Permalink to this heading"></a></h2>
<p>There is a script, <cite>tools/simbridge.sh</cite> that will do the setup for you.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this heading"></a></h2>
<blockquote>
<div><ul>
<li><p>Users of VMware ESXi should be aware that the bridge will place the contained
ethernet interface into promiscuous mode (don’t ask me why).  ESXi will
reject this by default, and nothing will work.  To fix this, edit the
properties of the relevant vSwitch or VLAN, select the Security tab, and
set “Promiscuous Mode” to “Accept”.</p>
<p>If anyone knows a better way to deal with this, or if I’m misunderstanding
what’s happening there, please do tell.</p>
<p>I don’t know if VMware’s consumer products have similar issues or not.</p>
</li>
<li><p>tools/simbridge.sh could make the bridge setup easier:</p>
<blockquote>
<div><p># tools/simbridge.sh eth0 on
# tools/simbridge.sh eth0 off</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>– Steve &lt;<a class="reference external" href="mailto:steve&#37;&#52;&#48;floating&#46;io">steve<span>&#64;</span>floating<span>&#46;</span>io</a>&gt;</dt><dd><p><a class="reference external" href="http://floating.io">http://floating.io</a></p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sim/boards/sim/index.html" class="btn btn-neutral float-left" title="SIM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="network_vpnkit.html" class="btn btn-neutral float-right" title="Network support with VPNKit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>