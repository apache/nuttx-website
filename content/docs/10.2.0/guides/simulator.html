<!--
 Documentation/_templates/layout.html

 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.  The
 ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the
 License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 License for the specific language governing permissions and limitations
 under the License.
-->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulator &mdash; NuttX latest documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Drivers" href="drivers.html" />
    <link rel="prev" title="USB Device Trace" href="usbtrace.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  
    <a href="../index.html" class="icon icon-home"> NuttX
  

  
  </a>

  <!-- this version selector is quite ugly, should be probably replaced by something
       more modern -->

  <div class="version-selector">
    <select onchange="javascript:location.href = this.value;">
    
    <option value="../../latest" selected="selected">latest</option>
    
    <option value="../../10.0.0" >10.0.0</option>
    
    <option value="../../10.0.1" >10.0.1</option>
    
    <option value="../../10.1.0" >10.1.0</option>
    
    <option value="../../10.2.0" >10.2.0</option>
    
    <option value="../../10.3.0" >10.3.0</option>
    
    <option value="../../11.0.0" >11.0.0</option>
    
    <option value="../../12.0.0" >12.0.0</option>
    
    <option value="../../12.1.0" >12.1.0</option>
    
    <option value="../../12.2.0" >12.2.0</option>
    
    <option value="../../12.2.1" >12.2.1</option>
    
    <option value="../../12.3.0" >12.3.0</option>
    
    <option value="../../12.4.0" >12.4.0</option>
    
    </select>
  </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/inviolables.html">The Inviolable Principles of NuttX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">OS Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/index.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nfs.html">NFS Client How-To</a></li>
<li class="toctree-l2"><a class="reference internal" href="usbtrace.html">USB Device Trace</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Simulator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compiling">Compiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-network">Accessing the Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stopping">Stopping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="drivers.html">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasktrace.html">Task Trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_cmake.html">C++ Example using CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysimcoder.html">pysimCoder integration with NuttX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NuttX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Guides</a></li>
      <li class="breadcrumb-item active">Simulator</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/simulator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simulator">
<span id="id1"></span><h1>Simulator<a class="headerlink" href="#simulator" title="Permalink to this heading"></a></h1>
<p>Apache NuttX has a simulator that can run as a regular program on Linux, Mac, and Windows computers.
It’s useful for debugging operating system features that aren’t associated with particular
device drivers— for instance the TCP/IP stack itself, a web interface or API for your
application, or other communication protocols. It’s also handy for trying out Apache NuttX without
having a piece of embedded hardware.</p>
<p>This guide assumes you’re on Linux. It works on Windows and Mac too— if you know how,
submit a PR to improve this guide!</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Add Mac and Windows instructions</p>
</div>
<section id="compiling">
<h2>Compiling<a class="headerlink" href="#compiling" title="Permalink to this heading"></a></h2>
<ol class="arabic">
<li><p>Configure the Simulator</p>
<p>There are a lot of simulator configurations available that set you up to test various
operating system features.</p>
<p>Here we’ll use the <code class="docutils literal notranslate"><span class="pre">sim:nsh</span></code> basic NuttX Shell configuration.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>nuttx
<span class="gp">$ </span>./tools/configure.sh<span class="w"> </span>sim:nsh
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Compile</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>make
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Run the simulator:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./nuttx
<span class="go">login: admin</span>
<span class="go">password: Administrator</span>
<span class="go">User Logged-in!</span>

<span class="go">NuttShell (NSH) NuttX-9.1.0</span>
<span class="go">MOTD: username=admin password=Administrator</span>
<span class="go">nsh&gt; help</span>
<span class="go">help usage:  help [-v] [&lt;cmd&gt;]</span>

<span class="go">  [         cp        exit      losetup   mv        rmdir     true</span>
<span class="go">  ?         cmp       false     ls        mw        set       uname</span>
<span class="go">  basename  dirname   free      mb        poweroff  sh        unset</span>
<span class="go">  break     dd        help      mkdir     ps        sleep     usleep</span>
<span class="go">  cat       echo      hexdump   mkfatfs   pwd       test      xd</span>
<span class="go">  cd        exec      kill      mh        rm        time</span>

<span class="go">Builtin Apps:</span>
<span class="go">  hello  nsh</span>

<span class="go">nsh&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Stop the simulator:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; poweroff</span>
<span class="gp">$</span>
<span class="gp">$ </span><span class="c1"># we&#39;re back at the Linux prompt.</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="accessing-the-network">
<h2>Accessing the Network<a class="headerlink" href="#accessing-the-network" title="Permalink to this heading"></a></h2>
<ol class="arabic">
<li><p>Here we’ll use the <code class="docutils literal notranslate"><span class="pre">sim:tcpblaster</span></code> configuration because it comes with networking
that is ready to use.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>make<span class="w"> </span>distclean
<span class="gp">$ </span>./tools/configure.sh<span class="w"> </span>sim:tcpblaster
<span class="gp">$ </span>make
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Give the Simulator Privileges</p>
<p>On recent Linux distributions, you need to give the <code class="docutils literal notranslate"><span class="pre">nuttx</span></code> program the capabilities
(similar to permissions) to access the network:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>setcap<span class="w"> </span>cap_net_admin+ep<span class="w"> </span>./nuttx
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Run the simulator:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./nuttx
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Bring Up the Network Interfaces</p>
<p>On Apache NuttX:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ifup eth0</span>
</pre></div>
</div>
</div></blockquote>
<p>On Linux, first you need to find your main network interface— this will usually either
be an ethernet or wireless network adapter. Do this:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifconfig
<span class="go">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span>
<span class="go">        inet 127.0.0.1  netmask 255.0.0.0</span>
<span class="go">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span>
<span class="go">        loop  txqueuelen 1000  (Local Loopback)</span>
<span class="go">        RX packets 5846  bytes 614351 (614.3 KB)</span>
<span class="go">        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">        TX packets 5846  bytes 614351 (614.3 KB)</span>
<span class="go">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>

<span class="go">wlp0s20f3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span>
<span class="go">        inet 192.168.1.209  netmask 255.255.255.0  broadcast 192.168.1.255</span>
<span class="go">        inet6 fe80::1161:c26b:af05:d784  prefixlen 64  scopeid 0x20&lt;link&gt;</span>
<span class="go">        ether 24:41:8c:a8:30:d1  txqueuelen 1000  (Ethernet)</span>
<span class="go">        RX packets 219369  bytes 176416490 (176.4 MB)</span>
<span class="go">        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">        TX packets 108399  bytes 27213617 (27.2 MB)</span>
<span class="go">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">lo0</span></code> is the Loopback Interface, so <code class="docutils literal notranslate"><span class="pre">wlp0s20f3</span></code> is the wireless interface. Note
that it has an IP address on the local net. There may be other interfaces listed, you’ll
need to pick the one that’s right for your system.</p>
<p>Then, on Linux do this to set up the tap network interface and route that will let
the Apache NuttX simulator access the network:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>./tools/simhostroute.sh<span class="w"> </span>wlp0s20f3<span class="w"> </span>on
<span class="gp">$ </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span>.0.1.2<span class="w">  </span><span class="c1"># nuttx system</span>
<span class="go">PING 10.0.1.2 (10.0.1.2) 56(84) bytes of data.</span>
<span class="go">64 bytes from 10.0.1.2: icmp_seq=1 ttl=64 time=7.52 ms</span>

<span class="go">--- 10.0.1.2 ping statistics ---</span>
<span class="go">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="go">rtt min/avg/max/mdev = 7.529/7.529/7.529/0.000 m</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Test that Apache NuttX can access the Internet</p>
<p>First let’s ping the network interface of our Linux host to prove we can see the
gateway to the Internet:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ping -c 1 10.0.1.1</span>
<span class="go">nsh&gt; ping -c 1 10.0.1.1</span>
<span class="go">PING 10.0.1.1 56 bytes of data</span>
<span class="go">56 bytes from 10.0.1.1: icmp_seq=0 time=0 ms</span>
<span class="go">1 packets transmitted, 1 received, 0% packet loss, time 1010 ms</span>
</pre></div>
</div>
<p>Now let’s ping one of Google’s DNS servers to prove we can access the rest of the
Internet:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nsh&gt; ping -c 1 8.8.8.8</span>
<span class="go">PING 8.8.8.8 56 bytes of data</span>
<span class="go">56 bytes from 8.8.8.8: icmp_seq=0 time=10 ms</span>
<span class="go">1 packets transmitted, 1 received, 0% packet loss, time 1010 ms</span>
</pre></div>
</div>
</div></blockquote>
<p>Success!</p>
</li>
</ol>
</section>
<section id="stopping">
<h2>Stopping<a class="headerlink" href="#stopping" title="Permalink to this heading"></a></h2>
<p>If you don’t have an nsh prompt, the only effective way to stop the simulator is kill it from another terminal:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pkill<span class="w"> </span>nuttx
</pre></div>
</div>
</div></blockquote>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h2>
<p>You can debug the simulator like any regular Linux program.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usbtrace.html" class="btn btn-neutral float-left" title="USB Device Trace" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="drivers.html" class="btn btn-neutral float-right" title="Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, The Apache Software Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>